(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{616:function(s,a,e){s.exports=e.p+"assets/img/Untitled.b7455a5c.png"},617:function(s,a,e){s.exports=e.p+"assets/img/Untitled1.9bd499ad.png"},618:function(s,a,e){s.exports=e.p+"assets/img/Untitled2.94da753c.png"},619:function(s,a,e){s.exports=e.p+"assets/img/Untitled3.47c1267c.png"},620:function(s,a,e){s.exports=e.p+"assets/img/Untitled4.62c72b3b.png"},621:function(s,a,e){s.exports=e.p+"assets/img/Untitled5.204e1b20.png"},622:function(s,a,e){s.exports=e.p+"assets/img/Untitled6.b4024512.png"},623:function(s,a,e){s.exports=e.p+"assets/img/Untitled7.704afdf9.png"},624:function(s,a,e){s.exports=e.p+"assets/img/Untitled8.ccc03f83.png"},625:function(s,a,e){s.exports=e.p+"assets/img/Untitled9.6b6f8569.png"},626:function(s,a,e){s.exports=e.p+"assets/img/Untitled10.10d64686.png"},627:function(s,a,e){s.exports=e.p+"assets/img/Untitled11.92149d70.png"},628:function(s,a,e){s.exports=e.p+"assets/img/Untitled12.3bf6f469.png"},629:function(s,a,e){s.exports=e.p+"assets/img/Untitled13.780d82cc.png"},650:function(s,a,e){"use strict";e.r(a);var n=e(24),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"zookeeper"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper"}},[s._v("#")]),s._v(" Zookeeper")]),s._v(" "),n("h2",{attrs:{id:"第一章-zookeeper入门-了解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一章-zookeeper入门-了解"}},[s._v("#")]),s._v(" 第一章 Zookeeper入门-了解")]),s._v(" "),n("h3",{attrs:{id:"_1-1-概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-概述"}},[s._v("#")]),s._v(" 1.1 概述")]),s._v(" "),n("p",[s._v("开源的分布式的，为分布式应用提供"),n("strong",[s._v("协调服务")]),s._v("的Apache项目")]),s._v(" "),n("p",[n("img",{attrs:{src:e(616),alt:"Untitled.png"}})]),s._v(" "),n("h3",{attrs:{id:"_1-2-特点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-特点"}},[s._v("#")]),s._v(" 1.2 特点")]),s._v(" "),n("p",[n("img",{attrs:{src:e(617),alt:"Untitled1.png"}})]),s._v(" "),n("h3",{attrs:{id:"_1-3-数据结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-数据结构"}},[s._v("#")]),s._v(" 1.3 数据结构")]),s._v(" "),n("p",[n("img",{attrs:{src:e(618),alt:"Untitled2.png"}})]),s._v(" "),n("h3",{attrs:{id:"_1-4-应用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-应用场景"}},[s._v("#")]),s._v(" 1.4 应用场景")]),s._v(" "),n("p",[s._v("提供的服务包括：统一命名服务、统一配置管理、统一集权管理、服务器节点动态上下线、软负载均衡等。")]),s._v(" "),n("p",[s._v("统一命名服务：")]),s._v(" "),n("p",[n("img",{attrs:{src:e(619),alt:"Untitled3.png"}})]),s._v(" "),n("p",[s._v("统一配置管理：")]),s._v(" "),n("p",[n("img",{attrs:{src:e(620),alt:"Untitled4.png"}})]),s._v(" "),n("p",[s._v("统一集权管理：")]),s._v(" "),n("p",[n("img",{attrs:{src:e(621),alt:"Untitled5.png"}})]),s._v(" "),n("p",[s._v("服务器节点动态上下线：")]),s._v(" "),n("p",[n("img",{attrs:{src:e(622),alt:"Untitled6.png"}})]),s._v(" "),n("p",[s._v("4.4中会实现该案例.")]),s._v(" "),n("p",[s._v("软负载均衡：")]),s._v(" "),n("p",[n("img",{attrs:{src:e(623),alt:"Untitled7.png"}})]),s._v(" "),n("h3",{attrs:{id:"_1-5-下载地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-下载地址"}},[s._v("#")]),s._v(" 1.5 下载地址")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://zookeeper.apache.org/releases.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://zookeeper.apache.org/releases.html"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"第二章-zookeeper安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第二章-zookeeper安装"}},[s._v("#")]),s._v(" 第二章 Zookeeper安装")]),s._v(" "),n("h3",{attrs:{id:"_2-1-本地模式安装部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-本地模式安装部署"}},[s._v("#")]),s._v(" 2.1 本地模式安装部署")]),s._v(" "),n("h4",{attrs:{id:"_2-1-1-安装jdk"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-安装jdk"}},[s._v("#")]),s._v(" 2.1.1 安装jdk")]),s._v(" "),n("p",[s._v("上传jdk包到/opt/software")]),s._v(" "),n("p",[s._v("tar -zxvf jdk-8u291-linux-x64.tar.gz")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JAVA_HOME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("software"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("jdk1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0_291")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("  #jdk安装目录\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JRE_HOME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JAVA_HOME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("jre\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLASSPATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JAVA_HOME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JRE_HOME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLASSPATH")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JAVA_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JAVA_HOME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JRE_HOME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JAVA_PATH")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"_2-1-2安装zookeeper"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2安装zookeeper"}},[s._v("#")]),s._v(" 2.1.2安装zookeeper")]),s._v(" "),n("p",[s._v("拷贝到/opt/software")]),s._v(" "),n("p",[s._v("解压")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[s._v("tar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("zxvf apache"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("zookeeper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"_2-1-3修改zookeeper配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3修改zookeeper配置"}},[s._v("#")]),s._v(" 2.1.3修改zookeeper配置")]),s._v(" "),n("p",[s._v('将"/opt/software/apache-zookeeper-3.7.0/conf/zoo_sample.cfg"拷贝份zoo.cfg')]),s._v(" "),n("p",[s._v("打开zoo.cfg，修改vim zoo.cfg")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[s._v("dataDir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("software"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("zookeeper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zkData"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"_2-1-4操作zookeeper"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4操作zookeeper"}},[s._v("#")]),s._v(" 2.1.4操作zookeeper")]),s._v(" "),n("p",[s._v("(1) 启动zookeeper")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[s._v("cd "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("software"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("zookeeper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zkServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh start\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("(2) 查看进程")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[s._v("jps\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zkServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh status\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("(3)启动客户端")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zkCli"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\nquit\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zkServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh stop\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[s._v("netstat "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2181")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_2-2-配置参数解读"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-配置参数解读"}},[s._v("#")]),s._v(" 2.2 配置参数解读")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 心跳ms")]),s._v("\ntickTime=2000\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 10个2s 启动时，leader和felower之间最大延迟时间，超过挂了")]),s._v("\ninitLimit=10\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5个2s 集群启动之后，leader和felower之间最大延迟时间，超过挂了")]),s._v("\nsyncLimit=5\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端访问服务器的端口号")]),s._v("\nclientPort=2181\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"第三章-zookeeper内部原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第三章-zookeeper内部原理"}},[s._v("#")]),s._v(" 第三章 Zookeeper内部原理")]),s._v(" "),n("h3",{attrs:{id:"_3-1-选举机制-面试重点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-选举机制-面试重点"}},[s._v("#")]),s._v(" 3.1 选举机制（面试重点）")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("半数机制：集群中半数以上机器存活，集群可用。所以Zookeeper适合安装奇数台服务器。")])]),s._v(" "),n("li",[n("p",[s._v("Zookeeper在配置文件中没有配置Leader和Follower，但是Zookeeper在工作时，是有一个Leader的，其他的则为Follower，Leader通过内部的选举机制选举产生的。")])]),s._v(" "),n("li",[n("p",[s._v("以一个简单的例子说明选举过程")])])]),s._v(" "),n("p",[s._v("假设有5台服务器组成的Zookeeper集群，它们的id从1-5，同时他们都是最新启动的。也就没有历史数据。在存放数据量上都是一样的。假设服务器依次启动，会发生什么：")]),s._v(" "),n("p",[n("img",{attrs:{src:e(624),alt:"Untitled8.png"}})]),s._v(" "),n("p",[s._v("(1) 服务器1启动，此时只有它一个服务器启动了，它发出去的报文没有任何响应，所以它选举状态一直是LOOKING状态。")]),s._v(" "),n("p",[s._v("(2) 服务器2启动，它也投自己，它与最开始启动的服务器1进行通信，互相交换选举结果，由于两者都没有历史数据。所以id值较大的2号胜出，但由于没有达到半数以上。")]),s._v(" "),n("p",[s._v("(3) 服务器3启动，它投自己，前边的服务器1、2投自己后发现选不出leader，都选择id大的3号服务器。")]),s._v(" "),n("p",[s._v("(4) 服务器4启动，它投自己，但是3号服务器已经担任leader责任。4号服务器当不了了。")]),s._v(" "),n("p",[s._v("(5) 服务器5启动，只要leader选出来之后。改变不了leader了。")]),s._v(" "),n("h3",{attrs:{id:"_3-2-节点类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-节点类型"}},[s._v("#")]),s._v(" 3.2 节点类型")]),s._v(" "),n("h4",{attrs:{id:"_2大类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2大类"}},[s._v("#")]),s._v(" 2大类")]),s._v(" "),n("p",[s._v("持久：客户端和服务端断开连接后，创建的目录节点不删除")]),s._v(" "),n("p",[s._v("短暂：客户端和服务端断开连接后，创建的目录节点自己删除")]),s._v(" "),n("p",[n("img",{attrs:{src:e(625),alt:"Untitled9.png"}})]),s._v(" "),n("h3",{attrs:{id:"持久分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#持久分类"}},[s._v("#")]),s._v(" 持久分类：")]),s._v(" "),n("p",[s._v("(1) 持久化目录节点")]),s._v(" "),n("p",[s._v("客户端与Zookeeper断开连接后，该节点依旧存在")]),s._v(" "),n("p",[s._v("(2) 持久化顺序编号目录节点")]),s._v(" "),n("p",[s._v("客户端与Zookeeper断开连接后，该节点依旧存在，只是Zookeeper给该节点名称进行顺序编号")]),s._v(" "),n("p",[n("strong",[s._v("说明：")])]),s._v(" "),n("p",[s._v("创建znode时设置顺序编号，znode名称后会附加一个值，顺序号是一个单调递增的计数器，由父节点维护")]),s._v(" "),n("p",[n("strong",[s._v("注意：")])]),s._v(" "),n("p",[s._v("在分布式系统中，顺序号可以被用于为所有的事件进行全局排序，这样客户端可以通过顺序号推断事件的顺序")]),s._v(" "),n("h3",{attrs:{id:"短暂分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#短暂分类"}},[s._v("#")]),s._v(" 短暂分类：")]),s._v(" "),n("p",[s._v("(1) 临时目录节点")]),s._v(" "),n("p",[s._v("客户端和Zookeeper断开连接后，创建的目录节点被立刻删除，适合动态上下线")]),s._v(" "),n("p",[s._v("(2) 临时顺序编号目录节点")]),s._v(" "),n("p",[s._v("客户端与Zookeeper断开连接后，该节点被删除，只是Zookeeper给该节点名称进行了顺序编号")]),s._v(" "),n("p",[n("img",{attrs:{src:e(626),alt:"Untitled10.png"}})]),s._v(" "),n("h3",{attrs:{id:"_3-3-stat结构体"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-stat结构体"}},[s._v("#")]),s._v(" 3.3 Stat结构体")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v("[zk: localhost:2181(CONNECTED) 15] get -s /sanguo\njinlian\ncZxid = 0xd\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建节点的事务id，每次修改节点状态都会收到一个zxid形势的时间戳，也就是zookeeper事务id。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 事务id是zookeeper中所有修改总的次序。每个修改都有唯一的zxid，如果zxid1小于zxid2，")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 那么zxid1在zxid2之前发生")]),s._v("\n\nctime = Wed Jun 16 13:44:06 CST 2021\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# znode被创建的毫秒数(从1970年开始)")]),s._v("\n\nmZxid = 0xe\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最后更新的事务zxid")]),s._v("\n\nmtime = Wed Jun 16 13:44:19 CST 2021\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# znode最后被修改的毫秒数(从1970年开始)")]),s._v("\n\npZxid = 0xf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最后更新的子节点zxid")]),s._v("\n\ncversion = 1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# znode子节点变化号，znode子节点修改次数")]),s._v("\n\ndataVersion = 1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# znode数据变化号")]),s._v("\n\naclVersion = 0\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# znode访问控制列表的变化")]),s._v("\n\nephemeralOwner = 0x0\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果是临时节点，这个znode拥有者的session的id。如果不是临时节点则是0")]),s._v("\n\ndataLength = 7\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# znode的数据长度")]),s._v("\n\nnumChildren = 1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# znode子节点数量")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("h3",{attrs:{id:"_3-4-监听原理-面试重点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-监听原理-面试重点"}},[s._v("#")]),s._v(" 3.4 监听原理（面试重点）")]),s._v(" "),n("h4",{attrs:{id:"_3-4-1监听原理详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1监听原理详解"}},[s._v("#")]),s._v(" 3.4.1监听原理详解：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("首先有一个main线程")])]),s._v(" "),n("li",[n("p",[s._v("在main线程中创建zookeeper客户端，这时创建两个线程，一个负责网络通信(connect)，一个负责监听(listener)")])]),s._v(" "),n("li",[n("p",[s._v("通过connect将注册的监听事件发送给zookeeper")])]),s._v(" "),n("li",[n("p",[s._v("在zookeeper的zhu'c监听器列表中将注册的监听事件添加到列表中")])]),s._v(" "),n("li",[n("p",[s._v("zookeeper监听到有数据或路劲的变化后，就会将这条消息发送给listener线程")])]),s._v(" "),n("li",[n("p",[s._v("listener线程内部钓用process方法(在程序中自己写)")])])]),s._v(" "),n("p",[n("img",{attrs:{src:e(627),alt:"Untitled11.png"}})]),s._v(" "),n("h4",{attrs:{id:"_3-4-2常见的监听"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2常见的监听"}},[s._v("#")]),s._v(" 3.4.2常见的监听")]),s._v(" "),n("ol",[n("li",[s._v("监听节点数据的变化")])]),s._v(" "),n("p",[s._v("get path [watch]")]),s._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[s._v("监听子节点增减的变化")])]),s._v(" "),n("p",[s._v("ls path [watch]")]),s._v(" "),n("h3",{attrs:{id:"_3-5-写数据流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-写数据流程"}},[s._v("#")]),s._v(" 3.5 写数据流程")]),s._v(" "),n("h3",{attrs:{id:"问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),n("p",[s._v("客户端提交数据，是怎么写的？")]),s._v(" "),n("p",[s._v("怎么保持副本中都一样？")]),s._v(" "),n("p",[s._v("leader干什么事、server干什么事？")]),s._v(" "),n("h3",{attrs:{id:"步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#步骤"}},[s._v("#")]),s._v(" 步骤")]),s._v(" "),n("p",[n("img",{attrs:{src:e(628),alt:"Untitled12.png"}})]),s._v(" "),n("h2",{attrs:{id:"第四章-zookeeper实战-开发重点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第四章-zookeeper实战-开发重点"}},[s._v("#")]),s._v(" 第四章 Zookeeper实战（开发重点）")]),s._v(" "),n("h3",{attrs:{id:"_4-1-分布式安装部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-分布式安装部署"}},[s._v("#")]),s._v(" 4.1 分布式安装部署")]),s._v(" "),n("h4",{attrs:{id:"_4-1-1集群规划"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1集群规划"}},[s._v("#")]),s._v(" 4.1.1集群规划")]),s._v(" "),n("p",[s._v("在服务器102、服务器103、服务器104三个节点上部署zookeeper")]),s._v(" "),n("h4",{attrs:{id:"_4-1-2解压安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-2解压安装"}},[s._v("#")]),s._v(" 4.1.2解压安装")]),s._v(" "),n("p",[s._v("(1) 解压Zookeeper安装包到/opt/modult/目录下")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v("tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("(2) 同步/opt/module/zookeeper-3.4.10目录内容到服务器103、服务器104")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v("xsync zookeeper-3.4.10\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"_4-1-3-配置服务器编号"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-3-配置服务器编号"}},[s._v("#")]),s._v(" 4.1.3 配置服务器编号")]),s._v(" "),n("p",[s._v("(1) 在/opt/module/zookeeper-3.4.10/下创建zkData")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v("mkdir -p zkData\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("(2) 在/opt/module/zookeeper-3.4.10/zkData/目录下创建一个myid文件")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v("touch myid\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("(3) 编辑myid文件")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v("vim myid\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加与server对应编号")]),s._v("\n2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("(4) 拷贝配置好的zookeeper到其他服务器上")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v("xsync myid\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("分别在103、104服务器上修改myid文件内容为3、4")]),s._v(" "),n("h4",{attrs:{id:"_4-1-4-配置zoo-cfg文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-4-配置zoo-cfg文件"}},[s._v("#")]),s._v(" 4.1.4 配置zoo.cfg文件")]),s._v(" "),n("p",[s._v("(1) 添加如下配置")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###############cluster###################")]),s._v("\nserver.2=hadoop102:2888:3888\nserver.3=hadoop103:2888:3888\nserver.4=hadoop104:2888:3888 \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("(2) 同步zoo.cfg")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v("xsync zoo.cfg\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("(3) 配置解读")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v("server.A=B:C:D\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("A是一个数字，myid些什么A就写什么。")]),s._v(" "),n("p",[s._v("集群模式下配置了一个myid文件，zookeeper启动时读取此文件，拿到数据后与zoo.cfg中的配置信息进行对比从而确定是哪个server")]),s._v(" "),n("p",[s._v("B是这个服务器的ip地址")]),s._v(" "),n("p",[s._v("C是这个服务器与集群中的Leader服务器与Follower交换信息的端口")]),s._v(" "),n("p",[s._v("D是万一集群中的Leader服务器挂了，需要一个端口来进行重新选举，选出一个新的Leader")]),s._v(" "),n("h4",{attrs:{id:"_4-1-5-集群操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-5-集群操作"}},[s._v("#")]),s._v(" 4.1.5 集群操作")]),s._v(" "),n("p",[s._v("(1) 分别启动zookeeper")]),s._v(" "),n("p",[s._v("(2) 查看状态")]),s._v(" "),n("h3",{attrs:{id:"_4-2-客户端命令行操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-客户端命令行操作"}},[s._v("#")]),s._v(" 4.2 客户端命令行操作")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.notion.so/3c402338899946a68de5eea00d2ea386",target:"_blank",rel:"noopener noreferrer"}},[s._v("shell"),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"_4-3-api应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-api应用"}},[s._v("#")]),s._v(" 4.3 API应用")]),s._v(" "),n("h4",{attrs:{id:"_4-3-1-环境搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-环境搭建"}},[s._v("#")]),s._v(" 4.3.1 环境搭建")]),s._v(" "),n("p",[s._v("1.创建工程")]),s._v(" "),n("p",[s._v("2.pom文件添加依赖")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v("<dependency>\n    <groupId>junit</groupId>\n    <artifactId>junit</artifactId>\n    <version>4.13.2</version>\n</dependency>\n<dependency>\n    <groupId>org.apache.logging.log4j</groupId>\n    <artifactId>log4j-core</artifactId>\n    <version>2.14.1</version>\n</dependency>\n<dependency>\n    <groupId>org.apache.zookeeper</groupId>\n    <artifactId>zookeeper</artifactId>\n    <version>3.5.9</version>\n</dependency>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("3.resources目录创建log4j.properties")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 设置###")]),s._v("\nlog4j.rootLogger = info,stdout\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 输出信息到控制抬 ###")]),s._v("\nlog4j.appender.stdout = org.apache.log4j.ConsoleAppender\nlog4j.appender.stdout.Target = System.out\nlog4j.appender.logfile=org.apache.log4j.FileAppender\nlog4j.appender.logfile.File=target/spring.log\nlog4j.appender.logfile.layout=org.apache.log4j.PatternLayout\nlog4j.appender.stdout.layout.ConversionPattern = [%-5p] %d{yyyy-MM-dd HH:mm:ss,SSS} method:%l%n%m%n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h4",{attrs:{id:"_4-3-2-创建zookeeper客户端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-创建zookeeper客户端"}},[s._v("#")]),s._v(" 4.3.2 创建Zookeeper客户端")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v('@Before\npublic void init() throws IOException {\n    String connectString = "39.106.63.189:2181";\n    int sessionTimeout = 200000;\n    ZooKeeper zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() {\n        //监听回调\n        @Override\n        public void process(WatchedEvent watchedEvent) {\n        }\n    });\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h4",{attrs:{id:"_4-3-3-创建子节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-3-创建子节点"}},[s._v("#")]),s._v(" 4.3.3 创建子节点")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v('@Test\npublic void createNode() throws KeeperException, InterruptedException {\n    //参数1：节点路径\n    //参数2：节点数据\n    //参数3：节点权限\n    //参数4：节点类型\n    String path = zkCli.create("/guoyh", "guoyh".getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n    System.out.println(path);\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h4",{attrs:{id:"_4-3-4-获取子节点并监听节点变化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-4-获取子节点并监听节点变化"}},[s._v("#")]),s._v(" 4.3.4 获取子节点并监听节点变化")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v('@Test\npublic void getDataAndWatch() throws KeeperException, InterruptedException {\n    //参数1：节点路径\n    //参数2：是否监听\n    List<String> datas = zkCli.getChildren("/",true);\n    for (String data : datas) {\n        System.out.println(data);\n    }\n\n    //睡一会，当有节点变化时响应,在process中处理\n    Thread.sleep(Long.MAX_VALUE);\n}\n\n@Before\npublic void init() throws IOException {\n    String connectString = "39.106.63.189:2181";\n    int sessionTimeout = 200000;\n    ZooKeeper zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() {\n        //监听回调\n        @Override\n        public void process(WatchedEvent watchedEvent) {\n            //监听节点变化\n            List<String> datas = null;\n            try {\n                datas = zkCli.getChildren("/", true);\n                for (String data : datas) {\n                    System.out.println(data);\n                }\n            } catch (KeeperException e) {\n                e.printStackTrace();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    });\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("h4",{attrs:{id:"_4-3-5-判断znode是否存在"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-5-判断znode是否存在"}},[s._v("#")]),s._v(" 4.3.5 判断Znode是否存在")]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v('@Test\npublic void exist() throws KeeperException, InterruptedException {\n    //参数1：节点路径\n    //参数2：是否监听\n    Stat stat = zkCli.exists("/guoyha", false);\n    System.out.println(stat == null ? "not exist":"exist");\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"_4-4-监听服务器节点动态上下线案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-监听服务器节点动态上下线案例"}},[s._v("#")]),s._v(" 4.4 监听服务器节点动态上下线案例")]),s._v(" "),n("h4",{attrs:{id:"_4-4-1-需求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-需求"}},[s._v("#")]),s._v(" 4.4.1 需求")]),s._v(" "),n("p",[s._v("某分布式系统中，主节点可以有多台，可以动态上下线，任意一台客户端都能实时感知主节点服务器的上下线。")]),s._v(" "),n("h4",{attrs:{id:"_4-4-2-需求分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-需求分析"}},[s._v("#")]),s._v(" 4.4.2 需求分析")]),s._v(" "),n("p",[n("img",{attrs:{src:e(629),alt:"Untitled13.png"}})]),s._v(" "),n("p",[s._v("相对于在Zookeeper集群，3个服务器和3个客户端都是连接zookeeper的客户端，3个服务器在zookeeper的/servers目录下创建对应的节点并存储连接数。3个客户端连接zookeeper集群并监听/servers目录下节点列表，当有服务器下线后，能够监听到节点列表的变化。")]),s._v(" "),n("h4",{attrs:{id:"_4-4-3-代码实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-3-代码实现"}},[s._v("#")]),s._v(" 4.4.3 代码实现")]),s._v(" "),n("p",[n("strong",[s._v("服务端：")])]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v('package com.example.zookeeper.server;\n\nimport org.apache.zookeeper.*;\n\nimport java.io.IOException;\n\n/**\n * @author guoyh\n */\npublic class DistributeServer {\n    private ZooKeeper zkCli;\n    String connectString = "127.0.0.1:2181";\n    int sessionTimeout = 200000;\n\n    public static void main(String[] args) {\n        DistributeServer server = new DistributeServer();\n\n        // 1、连接Zookeeper集群\n        server.getConnect();\n\n        // 2、注册创建临时节点\n        // 设置服务器名称\n        String application = "hadoop101";\n        server.regist(application);\n\n        // 3、自己的业务逻辑代码处理\n        server.business();\n    }\n\n    /**\n     * 服务自己的业务处理\n     */\n    private void business() {\n        try {\n            //保证进程不结束\n            Thread.sleep(Long.MAX_VALUE);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n    /**\n     * 注册服务\n     * @param hostname\n     */\n    private void regist(String hostname) {\n        try {\n            //创建短暂带序号的子节点,存放主机名\n            String path = zkCli.create("/servers/server", hostname.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);\n            System.out.println(hostname + "is online");\n        } catch (KeeperException | InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n    /**\n     * 获取Zookeeper连接\n     */\n    private void getConnect() {\n        try {\n            zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() {\n                //监听回调\n                @Override\n                public void process(WatchedEvent watchedEvent) {\n\n                }\n            });\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br")])]),n("p",[n("strong",[s._v("客户端：")])]),s._v(" "),n("div",{staticClass:"language-docker line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-docker"}},[n("code",[s._v('package com.example.zookeeper.client;\n\nimport org.apache.zookeeper.*;\n\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @author guoyh\n */\npublic class DistributeClient {\n    private ZooKeeper zkCli;\n    String connectString = "0.0.0.0:2181";\n    int sessionTimeout = 200000;\n\n    public static void main(String[] args) {\n        DistributeClient client = new DistributeClient();\n\n        // 1、获取zookeeper连接\n        client.getConnect();\n\n        // 2、注册监听\n        String application = "hadoop101";\n        client.getChildren();\n\n        // 3、业务逻辑处理\n    }\n\n    /**\n     * 注册服务\n     */\n    private void getChildren() {\n        try {\n            List<String> children = zkCli.getChildren("/servers/server", true);\n            // 存储服务器节点主机名称集合\n            List<String> hostnames = new ArrayList<String>();\n\n            System.out.println("------start------");\n            for (String child : children) {\n                byte[] data = zkCli.getData("/servers/" + child, false, null);\n                hostnames.add(new String(data));\n            }\n            // 将所有在线主机名打印\n            System.out.println(hostnames);\n            System.out.println("------end------");\n        } catch (KeeperException | InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n    /**\n     * 获取Zookeeper连接\n     */\n    private void getConnect() {\n        try {\n            zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() {\n                //监听回调\n                @Override\n                public void process(WatchedEvent watchedEvent) {\n\n                }\n            });\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br")])]),n("h2",{attrs:{id:"第五章-企业面试真题-面试重点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第五章-企业面试真题-面试重点"}},[s._v("#")]),s._v(" 第五章 企业面试真题（面试重点）")]),s._v(" "),n("h3",{attrs:{id:"_5-1-简述zookeeper的选择机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-简述zookeeper的选择机制"}},[s._v("#")]),s._v(" 5.1 简述Zookeeper的选择机制")]),s._v(" "),n("p",[s._v("详见3.1")]),s._v(" "),n("p",[s._v("半数机制")]),s._v(" "),n("h3",{attrs:{id:"_5-2-zookeeper的监听原理是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-zookeeper的监听原理是什么"}},[s._v("#")]),s._v(" 5.2  Zookeeper的监听原理是什么")]),s._v(" "),n("p",[s._v("详见3.4")]),s._v(" "),n("h3",{attrs:{id:"_5-3-zookeeper的部署方式有哪几种"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-zookeeper的部署方式有哪几种"}},[s._v("#")]),s._v(" 5.3  Zookeeper的部署方式有哪几种？")]),s._v(" "),n("p",[s._v("(1) 单机模式、集群模式")]),s._v(" "),n("p",[s._v("(2) 角色：Leader和Follower")]),s._v(" "),n("p",[s._v("(3) 集群最少需要机器数3个")]),s._v(" "),n("h3",{attrs:{id:"_5-4-zookeeper的常见命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-zookeeper的常见命令"}},[s._v("#")]),s._v(" 5.4 Zookeeper的常见命令")]),s._v(" "),n("p",[s._v("ls、create、get、delete、set")])])}),[],!1,null,null,null);a.default=t.exports}}]);