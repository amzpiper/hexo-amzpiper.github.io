<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Zookeeper | 私人知识图书馆</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="包含: Java 基础, Java 部分源码, JVM, Spring, Spring Boot, Spring Cloud, 数据库原理, MySQL, ElasticSearch, MongoDB, Docker, k8s, CI&amp;CD, Linux, DevOps, 分布式, 中间件, 开发工具, Git, IDE, 源码阅读，读书笔记, 开源项目...">
    <meta name="robots" content="all">
    <meta name="author" content="pdai">
    <meta name="keywords" content="私人知识图书馆, java体系, java知识体系, java框架,java详解,java学习路线,java spring, java面试, 知识体系, java技术体系, java编程, java编程指南,java开发体系, java开发,java教程,java,java数据结构, 算法, 开发基础">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.cb877f3d.css" as="style"><link rel="preload" href="/assets/js/app.1f563e48.js" as="script"><link rel="preload" href="/assets/js/3.53f669bd.js" as="script"><link rel="preload" href="/assets/js/7.1153cd27.js" as="script"><link rel="prefetch" href="/assets/js/10.676c5100.js"><link rel="prefetch" href="/assets/js/11.9df653b2.js"><link rel="prefetch" href="/assets/js/12.b17e6356.js"><link rel="prefetch" href="/assets/js/13.ed90e22e.js"><link rel="prefetch" href="/assets/js/14.61f9cd6f.js"><link rel="prefetch" href="/assets/js/15.ac0ef010.js"><link rel="prefetch" href="/assets/js/16.3e29f439.js"><link rel="prefetch" href="/assets/js/17.90c09287.js"><link rel="prefetch" href="/assets/js/18.5e9ee40a.js"><link rel="prefetch" href="/assets/js/19.f113b0b6.js"><link rel="prefetch" href="/assets/js/2.a4f6f631.js"><link rel="prefetch" href="/assets/js/20.708a3e23.js"><link rel="prefetch" href="/assets/js/21.3a0dc559.js"><link rel="prefetch" href="/assets/js/22.72642347.js"><link rel="prefetch" href="/assets/js/4.498eb10c.js"><link rel="prefetch" href="/assets/js/5.ee589329.js"><link rel="prefetch" href="/assets/js/6.4e969a30.js"><link rel="prefetch" href="/assets/js/8.cb8ac540.js"><link rel="prefetch" href="/assets/js/9.5e517e4f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cb877f3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.ico" alt="私人知识图书馆" class="logo"> <span class="site-name can-hide">私人知识图书馆</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  概述
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习笔记" class="mobile-dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/learn-typescript.html" class="nav-link">
  Typescript
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/ChromeExtensions.html" class="nav-link">
  ChromeExtensions
</a></li></ul></li><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Stream.html" class="nav-link">
  Stream
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Optional.html" class="nav-link">
  Optional
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Spring笔记.html" class="nav-link">
  Spring笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Spring-MVC笔记.html" class="nav-link">
  SpringMVC笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Mybatis笔记.html" class="nav-link">
  Mybatis笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Maven学习笔记.html" class="nav-link">
  Maven学习笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-zookeeper.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Zookeeper
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-redis.html" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-elasticstack.html" class="nav-link">
  Elasticstack
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Dubbo学习笔记.html" class="nav-link">
  Dubbo学习笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><span class="title">工具|部署</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具|部署" class="mobile-dropdown-title"><span class="title">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/tool/git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/md/java/tool/gittool.html" class="nav-link">
  Gitee
</a></li></ul></div></div><div class="nav-item"><a href="/md/about/about-me.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/amzpiper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  概述
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习笔记" class="mobile-dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/learn-typescript.html" class="nav-link">
  Typescript
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/ChromeExtensions.html" class="nav-link">
  ChromeExtensions
</a></li></ul></li><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Stream.html" class="nav-link">
  Stream
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Optional.html" class="nav-link">
  Optional
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Spring笔记.html" class="nav-link">
  Spring笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Spring-MVC笔记.html" class="nav-link">
  SpringMVC笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Mybatis笔记.html" class="nav-link">
  Mybatis笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Maven学习笔记.html" class="nav-link">
  Maven学习笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-zookeeper.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Zookeeper
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-redis.html" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-elasticstack.html" class="nav-link">
  Elasticstack
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Dubbo学习笔记.html" class="nav-link">
  Dubbo学习笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><span class="title">工具|部署</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具|部署" class="mobile-dropdown-title"><span class="title">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/tool/git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/md/java/tool/gittool.html" class="nav-link">
  Gitee
</a></li></ul></div></div><div class="nav-item"><a href="/md/about/about-me.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/amzpiper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/learn-typescript.html" class="sidebar-link">TypeScript</a></li><li><a href="/md/java/learn/ChromeExtensions.html" class="sidebar-link">Chrome Extensions</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/Java8-Stream.html" class="sidebar-link">Java 8 - Stream</a></li><li><a href="/md/java/learn/Java8-Optional.html" class="sidebar-link">Java 8 - Optional</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/Spring笔记.html" class="sidebar-link">Spring</a></li><li><a href="/md/java/learn/Spring-MVC笔记.html" class="sidebar-link">SpringMVC</a></li><li><a href="/md/java/learn/Mybatis笔记.html" class="sidebar-link">Mybatis</a></li><li><a href="/md/java/learn/Maven学习笔记.html" class="sidebar-link">Maven</a></li><li><a href="/md/java/learn/learn-zookeeper.html" aria-current="page" class="active sidebar-link">Zookeeper</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/md/java/learn/learn-zookeeper.html#第一章-zookeeper入门-了解" class="sidebar-link">第一章 Zookeeper入门-了解</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/learn-zookeeper.html#第二章-zookeeper安装" class="sidebar-link">第二章 Zookeeper安装</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/learn-zookeeper.html#第三章-zookeeper内部原理" class="sidebar-link">第三章 Zookeeper内部原理</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/learn-zookeeper.html#第四章-zookeeper实战-开发重点" class="sidebar-link">第四章 Zookeeper实战（开发重点）</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/learn-zookeeper.html#第五章-企业面试真题-面试重点" class="sidebar-link">第五章 企业面试真题（面试重点）</a></li></ul></li><li><a href="/md/java/learn/learn-redis.html" class="sidebar-link">Redis</a></li><li><a href="/md/java/learn/learn-elasticstack.html" class="sidebar-link">Elasticstack</a></li><li><a href="/md/java/learn/Dubbo学习笔记.html" class="sidebar-link">Dubbo</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="zookeeper"><a href="#zookeeper" class="header-anchor">#</a> Zookeeper</h1> <h2 id="第一章-zookeeper入门-了解"><a href="#第一章-zookeeper入门-了解" class="header-anchor">#</a> 第一章 Zookeeper入门-了解</h2> <h3 id="_1-1-概述"><a href="#_1-1-概述" class="header-anchor">#</a> 1.1 概述</h3> <p>开源的分布式的，为分布式应用提供<strong>协调服务</strong>的Apache项目</p> <p><img src="/assets/img/Untitled.b7455a5c.png" alt="Untitled.png"></p> <h3 id="_1-2-特点"><a href="#_1-2-特点" class="header-anchor">#</a> 1.2 特点</h3> <p><img src="/assets/img/Untitled1.9bd499ad.png" alt="Untitled1.png"></p> <h3 id="_1-3-数据结构"><a href="#_1-3-数据结构" class="header-anchor">#</a> 1.3 数据结构</h3> <p><img src="/assets/img/Untitled2.94da753c.png" alt="Untitled2.png"></p> <h3 id="_1-4-应用场景"><a href="#_1-4-应用场景" class="header-anchor">#</a> 1.4 应用场景</h3> <p>提供的服务包括：统一命名服务、统一配置管理、统一集权管理、服务器节点动态上下线、软负载均衡等。</p> <p>统一命名服务：</p> <p><img src="/assets/img/Untitled3.47c1267c.png" alt="Untitled3.png"></p> <p>统一配置管理：</p> <p><img src="/assets/img/Untitled4.62c72b3b.png" alt="Untitled4.png"></p> <p>统一集权管理：</p> <p><img src="/assets/img/Untitled5.204e1b20.png" alt="Untitled5.png"></p> <p>服务器节点动态上下线：</p> <p><img src="/assets/img/Untitled6.b4024512.png" alt="Untitled6.png"></p> <p>4.4中会实现该案例.</p> <p>软负载均衡：</p> <p><img src="/assets/img/Untitled7.704afdf9.png" alt="Untitled7.png"></p> <h3 id="_1-5-下载地址"><a href="#_1-5-下载地址" class="header-anchor">#</a> 1.5 下载地址</h3> <p><a href="https://zookeeper.apache.org/releases.html" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/releases.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="第二章-zookeeper安装"><a href="#第二章-zookeeper安装" class="header-anchor">#</a> 第二章 Zookeeper安装</h2> <h3 id="_2-1-本地模式安装部署"><a href="#_2-1-本地模式安装部署" class="header-anchor">#</a> 2.1 本地模式安装部署</h3> <h4 id="_2-1-1-安装jdk"><a href="#_2-1-1-安装jdk" class="header-anchor">#</a> 2.1.1 安装jdk</h4> <p>上传jdk包到/opt/software</p> <p>tar -zxvf jdk-8u291-linux-x64.tar.gz</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token constant">JAVA_HOME</span><span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>software<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0_291</span><span class="token operator">/</span>  #jdk安装目录
<span class="token keyword">export</span> <span class="token constant">JRE_HOME</span><span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>jre
<span class="token keyword">export</span> <span class="token constant">CLASSPATH</span><span class="token operator">=</span><span class="token punctuation">.</span><span class="token operator">:</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>lib<span class="token operator">:</span>$<span class="token punctuation">{</span><span class="token constant">JRE_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>lib<span class="token operator">:</span>$<span class="token constant">CLASSPATH</span>
<span class="token keyword">export</span> <span class="token constant">JAVA_PATH</span><span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">:</span>$<span class="token punctuation">{</span><span class="token constant">JRE_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>bin
<span class="token keyword">export</span> <span class="token constant">PATH</span><span class="token operator">=</span>$<span class="token constant">PATH</span><span class="token operator">:</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_PATH</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2-1-2安装zookeeper"><a href="#_2-1-2安装zookeeper" class="header-anchor">#</a> 2.1.2安装zookeeper</h4> <p>拷贝到/opt/software</p> <p>解压</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>tar <span class="token operator">-</span>zxvf apache<span class="token operator">-</span>zookeeper<span class="token operator">-</span><span class="token number">3.7</span><span class="token number">.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-1-3修改zookeeper配置"><a href="#_2-1-3修改zookeeper配置" class="header-anchor">#</a> 2.1.3修改zookeeper配置</h4> <p>将&quot;/opt/software/apache-zookeeper-3.7.0/conf/zoo_sample.cfg&quot;拷贝份zoo.cfg</p> <p>打开zoo.cfg，修改vim zoo.cfg</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>dataDir<span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>software<span class="token operator">/</span>apache<span class="token operator">-</span>zookeeper<span class="token operator">-</span><span class="token number">3.7</span><span class="token number">.0</span><span class="token operator">/</span>zkData<span class="token operator">/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-1-4操作zookeeper"><a href="#_2-1-4操作zookeeper" class="header-anchor">#</a> 2.1.4操作zookeeper</h4> <p>(1) 启动zookeeper</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>cd <span class="token operator">/</span>opt<span class="token operator">/</span>software<span class="token operator">/</span>apache<span class="token operator">-</span>zookeeper<span class="token operator">-</span><span class="token number">3.7</span><span class="token number">.0</span><span class="token operator">/</span>bin
<span class="token punctuation">.</span><span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>(2) 查看进程</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>jps
<span class="token punctuation">.</span><span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh status
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>(3)启动客户端</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">.</span><span class="token operator">/</span>zkCli<span class="token punctuation">.</span>sh
quit
<span class="token punctuation">.</span><span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>netstat <span class="token operator">-</span>apn <span class="token operator">|</span> grep <span class="token number">2181</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-2-配置参数解读"><a href="#_2-2-配置参数解读" class="header-anchor">#</a> 2.2 配置参数解读</h3> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># 心跳ms</span>
tickTime=2000
<span class="token comment"># 10个2s 启动时，leader和felower之间最大延迟时间，超过挂了</span>
initLimit=10
<span class="token comment"># 5个2s 集群启动之后，leader和felower之间最大延迟时间，超过挂了</span>
syncLimit=5
<span class="token comment"># 客户端访问服务器的端口号</span>
clientPort=2181
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="第三章-zookeeper内部原理"><a href="#第三章-zookeeper内部原理" class="header-anchor">#</a> 第三章 Zookeeper内部原理</h2> <h3 id="_3-1-选举机制-面试重点"><a href="#_3-1-选举机制-面试重点" class="header-anchor">#</a> 3.1 选举机制（面试重点）</h3> <ol><li><p>半数机制：集群中半数以上机器存活，集群可用。所以Zookeeper适合安装奇数台服务器。</p></li> <li><p>Zookeeper在配置文件中没有配置Leader和Follower，但是Zookeeper在工作时，是有一个Leader的，其他的则为Follower，Leader通过内部的选举机制选举产生的。</p></li> <li><p>以一个简单的例子说明选举过程</p></li></ol> <p>假设有5台服务器组成的Zookeeper集群，它们的id从1-5，同时他们都是最新启动的。也就没有历史数据。在存放数据量上都是一样的。假设服务器依次启动，会发生什么：</p> <p><img src="/assets/img/Untitled8.ccc03f83.png" alt="Untitled8.png"></p> <p>(1) 服务器1启动，此时只有它一个服务器启动了，它发出去的报文没有任何响应，所以它选举状态一直是LOOKING状态。</p> <p>(2) 服务器2启动，它也投自己，它与最开始启动的服务器1进行通信，互相交换选举结果，由于两者都没有历史数据。所以id值较大的2号胜出，但由于没有达到半数以上。</p> <p>(3) 服务器3启动，它投自己，前边的服务器1、2投自己后发现选不出leader，都选择id大的3号服务器。</p> <p>(4) 服务器4启动，它投自己，但是3号服务器已经担任leader责任。4号服务器当不了了。</p> <p>(5) 服务器5启动，只要leader选出来之后。改变不了leader了。</p> <h3 id="_3-2-节点类型"><a href="#_3-2-节点类型" class="header-anchor">#</a> 3.2 节点类型</h3> <h4 id="_2大类"><a href="#_2大类" class="header-anchor">#</a> 2大类</h4> <p>持久：客户端和服务端断开连接后，创建的目录节点不删除</p> <p>短暂：客户端和服务端断开连接后，创建的目录节点自己删除</p> <p><img src="/assets/img/Untitled9.6b6f8569.png" alt="Untitled9.png"></p> <h3 id="持久分类"><a href="#持久分类" class="header-anchor">#</a> 持久分类：</h3> <p>(1) 持久化目录节点</p> <p>客户端与Zookeeper断开连接后，该节点依旧存在</p> <p>(2) 持久化顺序编号目录节点</p> <p>客户端与Zookeeper断开连接后，该节点依旧存在，只是Zookeeper给该节点名称进行顺序编号</p> <p><strong>说明：</strong></p> <p>创建znode时设置顺序编号，znode名称后会附加一个值，顺序号是一个单调递增的计数器，由父节点维护</p> <p><strong>注意：</strong></p> <p>在分布式系统中，顺序号可以被用于为所有的事件进行全局排序，这样客户端可以通过顺序号推断事件的顺序</p> <h3 id="短暂分类"><a href="#短暂分类" class="header-anchor">#</a> 短暂分类：</h3> <p>(1) 临时目录节点</p> <p>客户端和Zookeeper断开连接后，创建的目录节点被立刻删除，适合动态上下线</p> <p>(2) 临时顺序编号目录节点</p> <p>客户端与Zookeeper断开连接后，该节点被删除，只是Zookeeper给该节点名称进行了顺序编号</p> <p><img src="/assets/img/Untitled10.10d64686.png" alt="Untitled10.png"></p> <h3 id="_3-3-stat结构体"><a href="#_3-3-stat结构体" class="header-anchor">#</a> 3.3 Stat结构体</h3> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>[zk: localhost:2181(CONNECTED) 15] get -s /sanguo
jinlian
cZxid = 0xd
<span class="token comment"># 创建节点的事务id，每次修改节点状态都会收到一个zxid形势的时间戳，也就是zookeeper事务id。</span>
<span class="token comment"># 事务id是zookeeper中所有修改总的次序。每个修改都有唯一的zxid，如果zxid1小于zxid2，</span>
<span class="token comment"># 那么zxid1在zxid2之前发生</span>

ctime = Wed Jun 16 13:44:06 CST 2021
<span class="token comment"># znode被创建的毫秒数(从1970年开始)</span>

mZxid = 0xe
<span class="token comment">#最后更新的事务zxid</span>

mtime = Wed Jun 16 13:44:19 CST 2021
<span class="token comment"># znode最后被修改的毫秒数(从1970年开始)</span>

pZxid = 0xf
<span class="token comment"># 最后更新的子节点zxid</span>

cversion = 1
<span class="token comment"># znode子节点变化号，znode子节点修改次数</span>

dataVersion = 1
<span class="token comment"># znode数据变化号</span>

aclVersion = 0
<span class="token comment"># znode访问控制列表的变化</span>

ephemeralOwner = 0x0
<span class="token comment"># 如果是临时节点，这个znode拥有者的session的id。如果不是临时节点则是0</span>

dataLength = 7
<span class="token comment"># znode的数据长度</span>

numChildren = 1
<span class="token comment"># znode子节点数量</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="_3-4-监听原理-面试重点"><a href="#_3-4-监听原理-面试重点" class="header-anchor">#</a> 3.4 监听原理（面试重点）</h3> <h4 id="_3-4-1监听原理详解"><a href="#_3-4-1监听原理详解" class="header-anchor">#</a> 3.4.1监听原理详解：</h4> <ol><li><p>首先有一个main线程</p></li> <li><p>在main线程中创建zookeeper客户端，这时创建两个线程，一个负责网络通信(connect)，一个负责监听(listener)</p></li> <li><p>通过connect将注册的监听事件发送给zookeeper</p></li> <li><p>在zookeeper的zhu'c监听器列表中将注册的监听事件添加到列表中</p></li> <li><p>zookeeper监听到有数据或路劲的变化后，就会将这条消息发送给listener线程</p></li> <li><p>listener线程内部钓用process方法(在程序中自己写)</p></li></ol> <p><img src="/assets/img/Untitled11.92149d70.png" alt="Untitled11.png"></p> <h4 id="_3-4-2常见的监听"><a href="#_3-4-2常见的监听" class="header-anchor">#</a> 3.4.2常见的监听</h4> <ol><li>监听节点数据的变化</li></ol> <p>get path [watch]</p> <ol start="2"><li>监听子节点增减的变化</li></ol> <p>ls path [watch]</p> <h3 id="_3-5-写数据流程"><a href="#_3-5-写数据流程" class="header-anchor">#</a> 3.5 写数据流程</h3> <h3 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h3> <p>客户端提交数据，是怎么写的？</p> <p>怎么保持副本中都一样？</p> <p>leader干什么事、server干什么事？</p> <h3 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h3> <p><img src="/assets/img/Untitled12.3bf6f469.png" alt="Untitled12.png"></p> <h2 id="第四章-zookeeper实战-开发重点"><a href="#第四章-zookeeper实战-开发重点" class="header-anchor">#</a> 第四章 Zookeeper实战（开发重点）</h2> <h3 id="_4-1-分布式安装部署"><a href="#_4-1-分布式安装部署" class="header-anchor">#</a> 4.1 分布式安装部署</h3> <h4 id="_4-1-1集群规划"><a href="#_4-1-1集群规划" class="header-anchor">#</a> 4.1.1集群规划</h4> <p>在服务器102、服务器103、服务器104三个节点上部署zookeeper</p> <h4 id="_4-1-2解压安装"><a href="#_4-1-2解压安装" class="header-anchor">#</a> 4.1.2解压安装</h4> <p>(1) 解压Zookeeper安装包到/opt/modult/目录下</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>(2) 同步/opt/module/zookeeper-3.4.10目录内容到服务器103、服务器104</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>xsync zookeeper-3.4.10
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4-1-3-配置服务器编号"><a href="#_4-1-3-配置服务器编号" class="header-anchor">#</a> 4.1.3 配置服务器编号</h4> <p>(1) 在/opt/module/zookeeper-3.4.10/下创建zkData</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>mkdir -p zkData
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>(2) 在/opt/module/zookeeper-3.4.10/zkData/目录下创建一个myid文件</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>touch myid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>(3) 编辑myid文件</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>vim myid
<span class="token comment">#添加与server对应编号</span>
2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>(4) 拷贝配置好的zookeeper到其他服务器上</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>xsync myid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>分别在103、104服务器上修改myid文件内容为3、4</p> <h4 id="_4-1-4-配置zoo-cfg文件"><a href="#_4-1-4-配置zoo-cfg文件" class="header-anchor">#</a> 4.1.4 配置zoo.cfg文件</h4> <p>(1) 添加如下配置</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment">###############cluster###################</span>
server.2=hadoop102:2888:3888
server.3=hadoop103:2888:3888
server.4=hadoop104:2888:3888 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>(2) 同步zoo.cfg</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>xsync zoo.cfg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>(3) 配置解读</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>server.A=B:C:D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>A是一个数字，myid些什么A就写什么。</p> <p>集群模式下配置了一个myid文件，zookeeper启动时读取此文件，拿到数据后与zoo.cfg中的配置信息进行对比从而确定是哪个server</p> <p>B是这个服务器的ip地址</p> <p>C是这个服务器与集群中的Leader服务器与Follower交换信息的端口</p> <p>D是万一集群中的Leader服务器挂了，需要一个端口来进行重新选举，选出一个新的Leader</p> <h4 id="_4-1-5-集群操作"><a href="#_4-1-5-集群操作" class="header-anchor">#</a> 4.1.5 集群操作</h4> <p>(1) 分别启动zookeeper</p> <p>(2) 查看状态</p> <h3 id="_4-2-客户端命令行操作"><a href="#_4-2-客户端命令行操作" class="header-anchor">#</a> 4.2 客户端命令行操作</h3> <p><a href="https://www.notion.so/3c402338899946a68de5eea00d2ea386" target="_blank" rel="noopener noreferrer">shell<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_4-3-api应用"><a href="#_4-3-api应用" class="header-anchor">#</a> 4.3 API应用</h3> <h4 id="_4-3-1-环境搭建"><a href="#_4-3-1-环境搭建" class="header-anchor">#</a> 4.3.1 环境搭建</h4> <p>1.创建工程</p> <p>2.pom文件添加依赖</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>&lt;dependency&gt;
    &lt;groupId&gt;junit&lt;/groupId&gt;
    &lt;artifactId&gt;junit&lt;/artifactId&gt;
    &lt;version&gt;4.13.2&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
    &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;
    &lt;version&gt;2.14.1&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;
    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;
    &lt;version&gt;3.5.9&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>3.resources目录创建log4j.properties</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment">### 设置###</span>
log4j.rootLogger = info,stdout

<span class="token comment">### 输出信息到控制抬 ###</span>
log4j.appender.stdout = org.apache.log4j.ConsoleAppender
log4j.appender.stdout.Target = System.out
log4j.appender.logfile=org.apache.log4j.FileAppender
log4j.appender.logfile.File=target/spring.log
log4j.appender.logfile.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern = [%-5p] %d{yyyy-MM-dd HH:mm:ss,SSS} method:%l%n%m%n
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_4-3-2-创建zookeeper客户端"><a href="#_4-3-2-创建zookeeper客户端" class="header-anchor">#</a> 4.3.2 创建Zookeeper客户端</h4> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>@Before
public void init() throws IOException {
    String connectString = &quot;39.106.63.189:2181&quot;;
    int sessionTimeout = 200000;
    ZooKeeper zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() {
        //监听回调
        @Override
        public void process(WatchedEvent watchedEvent) {
        }
    });
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_4-3-3-创建子节点"><a href="#_4-3-3-创建子节点" class="header-anchor">#</a> 4.3.3 创建子节点</h4> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>@Test
public void createNode() throws KeeperException, InterruptedException {
    //参数1：节点路径
    //参数2：节点数据
    //参数3：节点权限
    //参数4：节点类型
    String path = zkCli.create(&quot;/guoyh&quot;, &quot;guoyh&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
    System.out.println(path);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_4-3-4-获取子节点并监听节点变化"><a href="#_4-3-4-获取子节点并监听节点变化" class="header-anchor">#</a> 4.3.4 获取子节点并监听节点变化</h4> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>@Test
public void getDataAndWatch() throws KeeperException, InterruptedException {
    //参数1：节点路径
    //参数2：是否监听
    List&lt;String&gt; datas = zkCli.getChildren(&quot;/&quot;,true);
    for (String data : datas) {
        System.out.println(data);
    }

    //睡一会，当有节点变化时响应,在process中处理
    Thread.sleep(Long.MAX_VALUE);
}

@Before
public void init() throws IOException {
    String connectString = &quot;39.106.63.189:2181&quot;;
    int sessionTimeout = 200000;
    ZooKeeper zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() {
        //监听回调
        @Override
        public void process(WatchedEvent watchedEvent) {
            //监听节点变化
            List&lt;String&gt; datas = null;
            try {
                datas = zkCli.getChildren(&quot;/&quot;, true);
                for (String data : datas) {
                    System.out.println(data);
                }
            } catch (KeeperException e) {
                e.printStackTrace();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    });
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h4 id="_4-3-5-判断znode是否存在"><a href="#_4-3-5-判断znode是否存在" class="header-anchor">#</a> 4.3.5 判断Znode是否存在</h4> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>@Test
public void exist() throws KeeperException, InterruptedException {
    //参数1：节点路径
    //参数2：是否监听
    Stat stat = zkCli.exists(&quot;/guoyha&quot;, false);
    System.out.println(stat == null ? &quot;not exist&quot;:&quot;exist&quot;);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-4-监听服务器节点动态上下线案例"><a href="#_4-4-监听服务器节点动态上下线案例" class="header-anchor">#</a> 4.4 监听服务器节点动态上下线案例</h3> <h4 id="_4-4-1-需求"><a href="#_4-4-1-需求" class="header-anchor">#</a> 4.4.1 需求</h4> <p>某分布式系统中，主节点可以有多台，可以动态上下线，任意一台客户端都能实时感知主节点服务器的上下线。</p> <h4 id="_4-4-2-需求分析"><a href="#_4-4-2-需求分析" class="header-anchor">#</a> 4.4.2 需求分析</h4> <p><img src="/assets/img/Untitled13.780d82cc.png" alt="Untitled13.png"></p> <p>相对于在Zookeeper集群，3个服务器和3个客户端都是连接zookeeper的客户端，3个服务器在zookeeper的/servers目录下创建对应的节点并存储连接数。3个客户端连接zookeeper集群并监听/servers目录下节点列表，当有服务器下线后，能够监听到节点列表的变化。</p> <h4 id="_4-4-3-代码实现"><a href="#_4-4-3-代码实现" class="header-anchor">#</a> 4.4.3 代码实现</h4> <p><strong>服务端：</strong></p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>package com.example.zookeeper.server;

import org.apache.zookeeper.*;

import java.io.IOException;

/**
 * @author guoyh
 */
public class DistributeServer {
    private ZooKeeper zkCli;
    String connectString = &quot;127.0.0.1:2181&quot;;
    int sessionTimeout = 200000;

    public static void main(String[] args) {
        DistributeServer server = new DistributeServer();

        // 1、连接Zookeeper集群
        server.getConnect();

        // 2、注册创建临时节点
        // 设置服务器名称
        String application = &quot;hadoop101&quot;;
        server.regist(application);

        // 3、自己的业务逻辑代码处理
        server.business();
    }

    /**
     * 服务自己的业务处理
     */
    private void business() {
        try {
            //保证进程不结束
            Thread.sleep(Long.MAX_VALUE);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    /**
     * 注册服务
     * @param hostname
     */
    private void regist(String hostname) {
        try {
            //创建短暂带序号的子节点,存放主机名
            String path = zkCli.create(&quot;/servers/server&quot;, hostname.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);
            System.out.println(hostname + &quot;is online&quot;);
        } catch (KeeperException | InterruptedException e) {
            e.printStackTrace();
        }
    }

    /**
     * 获取Zookeeper连接
     */
    private void getConnect() {
        try {
            zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() {
                //监听回调
                @Override
                public void process(WatchedEvent watchedEvent) {

                }
            });
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><p><strong>客户端：</strong></p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>package com.example.zookeeper.client;

import org.apache.zookeeper.*;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

/**
 * @author guoyh
 */
public class DistributeClient {
    private ZooKeeper zkCli;
    String connectString = &quot;0.0.0.0:2181&quot;;
    int sessionTimeout = 200000;

    public static void main(String[] args) {
        DistributeClient client = new DistributeClient();

        // 1、获取zookeeper连接
        client.getConnect();

        // 2、注册监听
        String application = &quot;hadoop101&quot;;
        client.getChildren();

        // 3、业务逻辑处理
    }

    /**
     * 注册服务
     */
    private void getChildren() {
        try {
            List&lt;String&gt; children = zkCli.getChildren(&quot;/servers/server&quot;, true);
            // 存储服务器节点主机名称集合
            List&lt;String&gt; hostnames = new ArrayList&lt;String&gt;();

            System.out.println(&quot;------start------&quot;);
            for (String child : children) {
                byte[] data = zkCli.getData(&quot;/servers/&quot; + child, false, null);
                hostnames.add(new String(data));
            }
            // 将所有在线主机名打印
            System.out.println(hostnames);
            System.out.println(&quot;------end------&quot;);
        } catch (KeeperException | InterruptedException e) {
            e.printStackTrace();
        }
    }

    /**
     * 获取Zookeeper连接
     */
    private void getConnect() {
        try {
            zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() {
                //监听回调
                @Override
                public void process(WatchedEvent watchedEvent) {

                }
            });
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><h2 id="第五章-企业面试真题-面试重点"><a href="#第五章-企业面试真题-面试重点" class="header-anchor">#</a> 第五章 企业面试真题（面试重点）</h2> <h3 id="_5-1-简述zookeeper的选择机制"><a href="#_5-1-简述zookeeper的选择机制" class="header-anchor">#</a> 5.1 简述Zookeeper的选择机制</h3> <p>详见3.1</p> <p>半数机制</p> <h3 id="_5-2-zookeeper的监听原理是什么"><a href="#_5-2-zookeeper的监听原理是什么" class="header-anchor">#</a> 5.2  Zookeeper的监听原理是什么</h3> <p>详见3.4</p> <h3 id="_5-3-zookeeper的部署方式有哪几种"><a href="#_5-3-zookeeper的部署方式有哪几种" class="header-anchor">#</a> 5.3  Zookeeper的部署方式有哪几种？</h3> <p>(1) 单机模式、集群模式</p> <p>(2) 角色：Leader和Follower</p> <p>(3) 集群最少需要机器数3个</p> <h3 id="_5-4-zookeeper的常见命令"><a href="#_5-4-zookeeper的常见命令" class="header-anchor">#</a> 5.4 Zookeeper的常见命令</h3> <p>ls、create、get、delete、set</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/1/15 下午2:19:19</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/md/java/learn/Maven学习笔记.html" class="prev">
        Maven
      </a></span> <span class="next"><a href="/md/java/learn/learn-redis.html">
        Redis
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1f563e48.js" defer></script><script src="/assets/js/3.53f669bd.js" defer></script><script src="/assets/js/7.1153cd27.js" defer></script>
  </body>
</html>
