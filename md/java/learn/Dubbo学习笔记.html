<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dubbo | 私人知识图书馆</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="包含: Java 基础, Java 部分源码, JVM, Spring, Spring Boot, Spring Cloud, 数据库原理, MySQL, ElasticSearch, MongoDB, Docker, k8s, CI&amp;CD, Linux, DevOps, 分布式, 中间件, 开发工具, Git, IDE, 源码阅读，读书笔记, 开源项目...">
    <meta name="robots" content="all">
    <meta name="author" content="pdai">
    <meta name="keywords" content="私人知识图书馆, java体系, java知识体系, java框架,java详解,java学习路线,java spring, java面试, 知识体系, java技术体系, java编程, java编程指南,java开发体系, java开发,java教程,java,java数据结构, 算法, 开发基础">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.cb877f3d.css" as="style"><link rel="preload" href="/assets/js/app.1f563e48.js" as="script"><link rel="preload" href="/assets/js/3.53f669bd.js" as="script"><link rel="preload" href="/assets/js/2.a4f6f631.js" as="script"><link rel="prefetch" href="/assets/js/10.676c5100.js"><link rel="prefetch" href="/assets/js/11.9df653b2.js"><link rel="prefetch" href="/assets/js/12.b17e6356.js"><link rel="prefetch" href="/assets/js/13.ed90e22e.js"><link rel="prefetch" href="/assets/js/14.61f9cd6f.js"><link rel="prefetch" href="/assets/js/15.ac0ef010.js"><link rel="prefetch" href="/assets/js/16.3e29f439.js"><link rel="prefetch" href="/assets/js/17.90c09287.js"><link rel="prefetch" href="/assets/js/18.5e9ee40a.js"><link rel="prefetch" href="/assets/js/19.f113b0b6.js"><link rel="prefetch" href="/assets/js/20.708a3e23.js"><link rel="prefetch" href="/assets/js/21.3a0dc559.js"><link rel="prefetch" href="/assets/js/22.72642347.js"><link rel="prefetch" href="/assets/js/4.498eb10c.js"><link rel="prefetch" href="/assets/js/5.ee589329.js"><link rel="prefetch" href="/assets/js/6.4e969a30.js"><link rel="prefetch" href="/assets/js/7.1153cd27.js"><link rel="prefetch" href="/assets/js/8.cb8ac540.js"><link rel="prefetch" href="/assets/js/9.5e517e4f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cb877f3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.ico" alt="私人知识图书馆" class="logo"> <span class="site-name can-hide">私人知识图书馆</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  概述
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习笔记" class="mobile-dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/learn-typescript.html" class="nav-link">
  Typescript
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/ChromeExtensions.html" class="nav-link">
  ChromeExtensions
</a></li></ul></li><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Stream.html" class="nav-link">
  Stream
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Optional.html" class="nav-link">
  Optional
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Spring笔记.html" class="nav-link">
  Spring笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Spring-MVC笔记.html" class="nav-link">
  SpringMVC笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Mybatis笔记.html" class="nav-link">
  Mybatis笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Maven学习笔记.html" class="nav-link">
  Maven学习笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-zookeeper.html" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-redis.html" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-elasticstack.html" class="nav-link">
  Elasticstack
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Dubbo学习笔记.html" class="nav-link">
  Dubbo学习笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><span class="title">工具|部署</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具|部署" class="mobile-dropdown-title"><span class="title">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/tool/git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/md/java/tool/gittool.html" class="nav-link">
  Gitee
</a></li></ul></div></div><div class="nav-item"><a href="/md/about/about-me.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/amzpiper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  概述
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习笔记" class="mobile-dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/learn-typescript.html" class="nav-link">
  Typescript
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/ChromeExtensions.html" class="nav-link">
  ChromeExtensions
</a></li></ul></li><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Stream.html" class="nav-link">
  Stream
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Optional.html" class="nav-link">
  Optional
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Spring笔记.html" class="nav-link">
  Spring笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Spring-MVC笔记.html" class="nav-link">
  SpringMVC笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Mybatis笔记.html" class="nav-link">
  Mybatis笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Maven学习笔记.html" class="nav-link">
  Maven学习笔记
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-zookeeper.html" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-redis.html" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-elasticstack.html" class="nav-link">
  Elasticstack
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Dubbo学习笔记.html" class="nav-link">
  Dubbo学习笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具|部署" class="dropdown-title"><span class="title">工具|部署</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具|部署" class="mobile-dropdown-title"><span class="title">工具|部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/tool/git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/md/java/tool/gittool.html" class="nav-link">
  Gitee
</a></li></ul></div></div><div class="nav-item"><a href="/md/about/about-me.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/amzpiper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/learn-typescript.html" class="sidebar-link">TypeScript</a></li><li><a href="/md/java/learn/ChromeExtensions.html" class="sidebar-link">Chrome Extensions</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/Java8-Stream.html" class="sidebar-link">Java 8 - Stream</a></li><li><a href="/md/java/learn/Java8-Optional.html" class="sidebar-link">Java 8 - Optional</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/Spring笔记.html" class="sidebar-link">Spring</a></li><li><a href="/md/java/learn/Spring-MVC笔记.html" class="sidebar-link">SpringMVC</a></li><li><a href="/md/java/learn/Mybatis笔记.html" class="sidebar-link">Mybatis</a></li><li><a href="/md/java/learn/Maven学习笔记.html" class="sidebar-link">Maven</a></li><li><a href="/md/java/learn/learn-zookeeper.html" class="sidebar-link">Zookeeper</a></li><li><a href="/md/java/learn/learn-redis.html" class="sidebar-link">Redis</a></li><li><a href="/md/java/learn/learn-elasticstack.html" class="sidebar-link">Elasticstack</a></li><li><a href="/md/java/learn/Dubbo学习笔记.html" class="active sidebar-link">Dubbo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/md/java/learn/Dubbo学习笔记.html#一、基本知识" class="sidebar-link">一、基本知识</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/Dubbo学习笔记.html#二、dubbo配置" class="sidebar-link">二、dubbo配置</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/Dubbo学习笔记.html#三、高可用" class="sidebar-link">三、高可用</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/Dubbo学习笔记.html#四、dubbo原理" class="sidebar-link">四、Dubbo原理</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、基本知识"><a href="#一、基本知识" class="header-anchor">#</a> 一、基本知识</h2> <h3 id="_1-分布式基础理论"><a href="#_1-分布式基础理论" class="header-anchor">#</a> 1 分布式基础理论</h3> <h4 id="_1-1什么是分布式"><a href="#_1-1什么是分布式" class="header-anchor">#</a> 1.1什么是分布式</h4> <p>分布式系统是若干个独立计算机的集合，，计算机对于用户来说就像个单个系统，建立在网络上的软件系统。</p> <p>随着互联网的发展，规模不断扩大，垂直应用架构无法应付，需要一个治理系统确保架构有条不紊的演进。</p> <p>dubbo作用：治理和维护各个分系统。</p> <h4 id="_1-2-发展演变"><a href="#_1-2-发展演变" class="header-anchor">#</a> 1.2 发展演变：</h4> <p><img src="/assets/img/Untitled.e7f1d2d1.png" alt="Untitled.png"></p> <p><strong>单一应用架构：</strong></p> <p>流量小时，所有功能放到一起，减少部署节点和成本。</p> <p><img src="/assets/img/Untitled1.ef8a0492.png" alt="Untitled1.png"></p> <p>缺点：</p> <p>扩展不容易，需要重新打包重新部署</p> <p>协同开发不容易</p> <p>扩大性能提升不容易</p> <p><strong>垂直应用架构：</strong></p> <p>小功能独立为单个应用，部署在多个服务器上</p> <p><img src="/assets/img/Untitled2.11afcbf9.png" alt="Untitled2.png"></p> <p>优点：</p> <p>分工合作容易，分别负责开发</p> <p>性能扩展容易，多部署到几个服务器</p> <p>缺点：</p> <p>单个应用从头到尾都有的，包括页面逻辑和数据库。但是市场上界面改变快，改了需要重新部署，没法做到页面和业务逻辑的分离</p> <p>垂直应用越来越多，不可能完全应用于应用完全独立。用户调用订单和商品，物流调用订单等。应用之间需要交互</p> <p><strong>分布式服务架构：</strong></p> <p>核心业务单独抽取出来，用户应用抽取为页面和业务逻辑。当业务逻辑不变时只改界面，界面重新部署就行了。</p> <p><img src="/assets/img/Untitled3.648b14ef.png" alt="Untitled3.png"></p> <p>问题：</p> <p>用户web可能再A服务器上，业务再B服务器。如果A服务器调用B服务器功能时，因为不在一个进程内，分隔异地了，这2个代码调用需要RPC远程过程调用。</p> <p>难点：</p> <p>如何远程过程调用</p> <p>如何拆分业务，增加业务的复用程度</p> <p>好的分布式服务框架（RPC），应该有调度中心，来实时的监控业务中心实现动态调度，增加利用率，当某一个业务调用多了，可以让更多的服务器来跑业务量更大的业务，这是用流动计算架构</p> <p><strong>流动计算架构：</strong></p> <p><img src="/assets/img/Untitled4.9f0d23eb.png" alt="Untitled4.png"></p> <p>它负责维护业务之间复杂的关系，以及实时管理服务集群，当A访问量大了，可以多来几台服务器。而且多个A服务器中按照访问量动态调用，以此来提高集群的利用率。</p> <h4 id="_1-3-rpc"><a href="#_1-3-rpc" class="header-anchor">#</a> 1.3 RPC</h4> <p><strong>什么叫RPC</strong></p> <p>远程过程调用，A服务器调用B服务器上功能。是一种技术思想，不是规范。它允许程序调用另一个共享空间（通常是共享网络的另一台服务器）上的过程或函数。而不是程序员显示编码这个远程调用的细节。即程序员无论调用本地的还是远程的函数，本质上编写的调用代码基本相同。</p> <p><strong>RPC基本原理</strong></p> <p><img src="/assets/img/Untitled5.ff6910ed.png" alt="Untitled5.png"></p> <p>clent functions想调用server functions时，通过小助手请求，通过sockets创建和server的sockets连接，将想调用的信息传递个server服务器，server小助手收到信息后确定调用函数，server用传递过来的信息调用自己方法后把返回值再通过网络sockets返回给client</p> <p>A和B架起网络连接后调用</p> <p><strong>例子：</strong></p> <p><img src="/assets/img/Untitled6.51b368fc.png" alt="Untitled6.png"></p> <p>A调用B时传递对象需要序列化，B先反序列化为对象，B服务器调用一下，拿到返回值，通过网络传输，序列化后传输给A服务器，A服务器需要反序列化后拿到返回值。</p> <p><strong>调用核心：</strong></p> <p>AB两个需要建立连接</p> <p>传递数据需要序列化和反序列化</p> <p><strong>决定性能有两点：</strong></p> <p>看RPC能否快速建立连接</p> <p>序列化于反序列化是否快</p> <p><strong>RPC框架：</strong></p> <p>dubbo、gRPC、Thrift、HSF</p> <p>思想相同，用法不同</p> <h3 id="_2-dubbo核心概念"><a href="#_2-dubbo核心概念" class="header-anchor">#</a> 2 dubbo核心概念</h3> <h4 id="_2-1-简介"><a href="#_2-1-简介" class="header-anchor">#</a> 2.1 简介</h4> <p>Apache Dubbo 是一款高性能、轻量级的开源 Java 服务框架</p> <p>注：rpc面向服务、cloud的是restful面向资源</p> <p>14.10停止更新，18.1将dubbo和dubbox合并后发布为2.6版本，最终将dubbo开放到apache。</p> <p>netty功能负责网络传输，dubbo使用netty作为网络传输框架。说到网络传输自然离不开Socket，Socket是端到端的连接。dubbo是无中心化，每个client端都能与server端连接，每个client端同时又是server端。</p> <p><strong>特性：</strong></p> <p>1.<strong>面向接口代理的高性能RPC调用</strong></p> <p>提供高性能的基于代理的远程调用能力，服务以接口为粒度，为开发者屏蔽远程调用底层细节。</p> <p>A调用B只需要将接口拿来调用，dubbo会自动的找B服务器的这段代码，屏蔽了整个调用细节。</p> <p>类似Mybatis，调用数据库是只需要写do-mapping接口，调用接口方法就行了。</p> <p><strong>2.智能负载均衡</strong></p> <p>内置多种负载均衡策略，智能感知下游节点健康状况，显著减少调用延迟，提高系统吞吐量。</p> <p>一个服务1台服务器不够时部署多台后，会自动找空闲服务器运行。</p> <p>不会压垮某一台服务器，也不会让某服务器太闲浪费资源。</p> <p><strong>3.服务自动注册与发现</strong></p> <p>支持多种注册中心服务，服务实例上下线实时感知。</p> <p>业务非常多，订单调用支付业务时如何知道业务服务器是否知道有问题切在哪，为了动态感知，将所有程序注册到注册中心，维护注册清单。调用时会问一下调用的服务在哪个服务器，选择请求量最小的。建立通信，进行远程调用。</p> <p><strong>4.高度可扩展能力</strong></p> <p>遵循微内核+插件的设计原则，所有核心能力如Protocol、Transport、Serialization被设计为扩展点，平等对待内置实现和第三方实现。</p> <p>所有东西都可扩展。</p> <p><strong>5.运行期流量调度</strong></p> <p>内置条件、脚本等路由策略，通过配置不同的路由规则，轻松实现灰度发布，同机房优先等功能。</p> <p>灰度发布：比如有个用户服务，现在在100台上服务器在跑，用户服务做了升级，害怕升级不稳定，可以先选定20台服务器，让他们用新版本的用户服务，剩下80台用旧版本的用户服务。等20台用的没问题了，再选20台，一点一点增加，知道100台都过度到新版本用户服务。可以配置不同路由规则，请求进来后一部分用新版本服务。慢慢从旧服务转变到新服务的过程。</p> <p><strong>6.可视化的服务治理与运维</strong></p> <p>提供丰富服务治理、运维工具：随时查询服务元数据、服务健康状态及调用统计，实时下发路由策略、调整配置参数。</p> <p>可以随时查询服务的信息、健康状况、调用统计记录等等。通过可视化界面。</p> <h4 id="_2-2-dubbo设计架构"><a href="#_2-2-dubbo设计架构" class="header-anchor">#</a> 2.2 dubbo设计架构</h4> <p><img src="/assets/img/Untitled7.34a7a4cf.png" alt="Untitled7.png"></p> <p><a href="https://www.notion.so/6c6f03ae75794978a31ec967f82fec02" target="_blank" rel="noopener noreferrer">节点角色说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>运行流程</strong></p> <ol><li>服务容器负责启动，加载，运行服务提供者。</li> <li>服务提供者在启动时，向注册中心注册自己提供的服务。</li> <li>服务消费者在启动时，向注册中心订阅自己所需的服务。当某一个提供者下线了，基于长连接方式，将这个变更推送给消费者，可以实时知道有一个提供者不能调用了。当消费者拿到所有可以调的服务后，可以调用提供者提供的服务，调用时根据负载均衡算法选择一个提供者调用。</li> <li>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</li> <li>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</li> <li>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</li></ol> <p>Dubbo 架构具有以下几个特点，分别是连通性、健壮性、伸缩性、以及向未来架构的升级性。</p> <p>0、1、2是初始时启动完成的，第3、5布是异步的。第4步是同步调用。</p> <p>应先创建提供者，注册到注册中心，再编写消费者，消费者从注册中心调用提供者。然后再编写消费者如何消费提供者提供的功能。</p> <p><strong>连通性<a href="https://dubbo.apache.org/zh/docs/v2.7/user/preface/architecture/#%E8%BF%9E%E9%80%9A%E6%80%A7" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <ul><li>注册中心负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小</li> <li>监控中心负责统计各服务调用次数，调用时间等，统计先在内存汇总后每分钟一次发送到监控中心服务器，并以报表展示</li> <li>服务提供者向注册中心注册其提供的服务，并汇报调用时间到监控中心，此时间不包含网络开销</li> <li>服务消费者向注册中心获取服务提供者地址列表，并根据负载算法直接调用提供者，同时汇报调用时间到监控中心，此时间包含网络开销</li> <li>注册中心，服务提供者，服务消费者三者之间均为长连接，监控中心除外</li> <li>注册中心通过长连接感知服务提供者的存在，服务提供者宕机，注册中心将立即推送事件通知消费者</li> <li>注册中心和监控中心全部宕机，不影响已运行的提供者和消费者，消费者在本地缓存了提供者列表</li> <li>注册中心和监控中心都是可选的，服务消费者可以直连服务提供者</li></ul> <p><strong>健壮性</strong></p> <ul><li>监控中心宕掉不影响使用，只是丢失部分采样数据</li> <li>数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务</li> <li>注册中心对等集群，任意一台宕掉后，将自动切换到另一台</li> <li>注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通讯</li> <li>服务提供者无状态，任意一台宕掉后，不影响使用</li> <li>服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复</li></ul> <p><strong>伸缩性</strong></p> <ul><li>注册中心为对等集群，可动态增加机器部署实例，所有客户端将自动发现新的注册中心</li> <li>服务提供者无状态，可动态增加机器部署实例，注册中心将推送新的服务提供者信息给消费者</li></ul> <p><strong>升级性<a href="https://dubbo.apache.org/zh/docs/v2.7/user/preface/architecture/#%E5%8D%87%E7%BA%A7%E6%80%A7" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <p>当服务集群规模进一步扩大，带动IT治理结构进一步升级，需要实现动态部署，进行流动计算，现有分布式服务架构不会带来阻力。</p> <h3 id="_3-dubbo环境搭建"><a href="#_3-dubbo环境搭建" class="header-anchor">#</a> 3 dubbo环境搭建</h3> <h4 id="_3-1-搭建zookeeper注册中心"><a href="#_3-1-搭建zookeeper注册中心" class="header-anchor">#</a> 3.1 搭建Zookeeper注册中心</h4> <p><strong>3.1.1 安装jdk</strong></p> <p>上传jdk包到/opt/software</p> <p>tar -zxvf jdk-8u291-linux-x64.tar.gz</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token constant">JAVA_HOME</span><span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>software<span class="token operator">/</span>jdk1<span class="token punctuation">.</span><span class="token number">8.0_291</span><span class="token operator">/</span>  #jdk安装目录
<span class="token keyword">export</span> <span class="token constant">JRE_HOME</span><span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>jre
<span class="token keyword">export</span> <span class="token constant">CLASSPATH</span><span class="token operator">=</span><span class="token punctuation">.</span><span class="token operator">:</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>lib<span class="token operator">:</span>$<span class="token punctuation">{</span><span class="token constant">JRE_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>lib<span class="token operator">:</span>$<span class="token constant">CLASSPATH</span>
<span class="token keyword">export</span> <span class="token constant">JAVA_PATH</span><span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>bin<span class="token operator">:</span>$<span class="token punctuation">{</span><span class="token constant">JRE_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>bin
<span class="token keyword">export</span> <span class="token constant">PATH</span><span class="token operator">=</span>$<span class="token constant">PATH</span><span class="token operator">:</span>$<span class="token punctuation">{</span><span class="token constant">JAVA_PATH</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>3.1.2安装zookeeper</strong></p> <p>拷贝到/opt/software</p> <p>解压</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>tar <span class="token operator">-</span>zxvf apache<span class="token operator">-</span>zookeeper<span class="token operator">-</span><span class="token number">3.7</span><span class="token number">.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3.1.3修改zookeeper配置</strong></p> <p>将&quot;/opt/software/apache-zookeeper-3.7.0/conf/zoo_sample.cfg&quot;拷贝份zoo.cfg</p> <p>打开zoo.cfg，修改vim zoo.cfg</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>dataDir<span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>software<span class="token operator">/</span>apache<span class="token operator">-</span>zookeeper<span class="token operator">-</span><span class="token number">3.7</span><span class="token number">.0</span><span class="token operator">/</span>zkData<span class="token operator">/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3.1.4操作zookeeper</strong></p> <p>(1) 启动zookeeper</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>cd <span class="token operator">/</span>opt<span class="token operator">/</span>software<span class="token operator">/</span>apache<span class="token operator">-</span>zookeeper<span class="token operator">-</span><span class="token number">3.7</span><span class="token number">.0</span><span class="token operator">/</span>bin
<span class="token punctuation">.</span><span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>(2) 查看进程</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>jps
<span class="token punctuation">.</span><span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh status
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>(3)启动客户端</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">.</span><span class="token operator">/</span>zkCli<span class="token punctuation">.</span>sh
quit
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>(4) 关闭zookeeper</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">.</span><span class="token operator">/</span>zkServer<span class="token punctuation">.</span>sh stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3-2-搭建监控中心"><a href="#_3-2-搭建监控中心" class="header-anchor">#</a> 3.2. 搭建监控中心</h4> <p><a href="https://github.com/apache/dubbo-admin" target="_blank" rel="noopener noreferrer">https://github.com/apache/dubbo-admin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>root</p> <p>root</p> <p>3.2.1 <strong>服务治理</strong></p> <p>服务治理的部分，按照Dubbo 2.7的格式进行配置，同时兼容Dubbo 2.6，详见<a href="https://github.com/apache/dubbo-admin/wiki/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E5%85%BC%E5%AE%B9%E6%80%A7%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>3.2.2 <strong>前端部分</strong></p> <ul><li>使用<a href="https://vuejs.org/" target="_blank" rel="noopener noreferrer">Vue.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>作为javascript框架</li> <li><a href="https://github.com/apache/dubbo-admin/blob/develop/dubbo-admin-ui/README.md" target="_blank" rel="noopener noreferrer">dubbo-admin-ui/README.md<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中有更详细的介绍</li> <li>设置 npm <strong>代理镜像</strong> : 如果遇到了网络问题，可以设置npm代理镜像来加速npm install的过程：在~/.npmrc中增加 <code>registry =https://registry.npm.taobao.org</code></li></ul> <p>3.2.3 <strong>后端部分</strong></p> <ul><li>标准spring boot工程</li> <li><a href="https://github.com/apache/dubbo-admin/wiki/Dubbo-Admin%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">application.properties配置说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>3.2.4 <strong>生产环境配置</strong></p> <ol><li><p>下载代码: <code>git clone https://github.com/apache/dubbo-admin.git</code></p></li> <li><p>在 <code>dubbo-admin-server/src/main/resources/application.properties</code>中指定注册中心地址</p></li> <li><p>构建</p> <blockquote><p>mvn clean package -Dmaven.test.skip=true</p></blockquote></li> <li><p>启动</p> <ul><li><code>mvn --projects dubbo-admin-server spring-boot:run</code>或者</li> <li><code>cd dubbo-admin-distribution/target; java -jar dubbo-admin-0.1.jar</code></li></ul></li> <li><p>访问 <code>http://localhost:8080</code></p></li></ol> <hr> <p>3.2.5 <strong>开发环境配置</strong></p> <ul><li>运行<code>dubbo admin server, dubbo admin server</code>是一个标准的spring boot项目, 可以在任何java IDE中运行它</li> <li>运行<code>dubbo admin ui</code> <code>dubbo admin ui</code>由npm管理和构建，在开发环境中，可以单独运行: <code>npm run dev</code></li> <li>页面访问 访问 <code>http://localhost:8081</code>, 由于前后端分开部署，前端支持热加载，任何页面的修改都可以实时反馈，不需要重启应用。</li></ul> <p>3.2.6 <strong>Swagger 支持</strong></p> <p>部署完成后，可以访问 <a href="http://localhost:8080/swagger-ui.html" target="_blank" rel="noopener noreferrer">http://localhost:8080/swagger-ui.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来查看所有的restful api</p> <h4 id="_4-dubbo-helloworld"><a href="#_4-dubbo-helloworld" class="header-anchor">#</a> 4 dubbo-helloworld</h4> <p><strong>4.1 需求</strong></p> <p><img src="/assets/img/Untitled8.edebdbc9.png" alt="Untitled8.png"></p> <p><strong>4.2 工程架构</strong></p> <p><img src="/assets/img/Untitled9.28c90d9b.png" alt="Untitled9.png"></p> <p>服务化最佳实践</p> <p><a href="https://dubbo.apache.org/zh/docs/v2.7/user/best-practice/" target="_blank" rel="noopener noreferrer">https://dubbo.apache.org/zh/docs/v2.7/user/best-practice/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>分包：</p> <p>建议将服务接口、服务模型、服务异常等均放在 API 包中，因为服务模型和异常也是 API 的一部分，这样做也符合分包原则：重用发布等价原则(REP)，共同重用原则(CRP)。</p> <p>如果需要，也可以考虑在 API 包中放置一份 Spring 的引用配置，这样使用方只需在 Spring 加载过程中引用此配置即可。配置建议放在模块的包目录下，以免冲突，如：<code>com/alibaba/china/xxx/dubbo-reference.xml</code>。</p> <p>粒度：</p> <p>服务接口尽可能大粒度，每个服务方法应代表一个功能，而不是某功能的一个步骤，否则将面临分布式事务问题，Dubbo 暂未提供分布式事务支持。</p> <p>服务接口建议以业务场景为单位划分，并对相近业务做抽象，防止接口数量爆炸。</p> <p>不建议使用过于抽象的通用接口，如：<code>Map query(Map)</code>，这样的接口没有明确语义，会给后期维护带来不便。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token number">1</span>、指定当前服务<span class="token operator">/</span>应用的名字（同样的服务名字相同，不要和别的服务同名） <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>application</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-service-provider<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>application</span><span class="token punctuation">&gt;</span></span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token number">2</span>、指定注册中心的位置 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zookeeper://127.0.0.1:2181<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>registry</span><span class="token punctuation">&gt;</span></span> <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zookeeper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>127.0.0.1:2181<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>registry</span><span class="token punctuation">&gt;</span></span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token number">3</span>、指定通信规则（通信协议？通信端口） <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>protocol</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dubbo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20882<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>protocol</span><span class="token punctuation">&gt;</span></span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token number">4</span>、暴露服务   ref：指向服务的真正的实现对象 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gmall.service.OrderService<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userServiceImpl01<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getUserAddressList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>method</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>service</span><span class="token punctuation">&gt;</span></span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>统一设置服务提供方的规则  <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>provider</span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>provider</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>4.3 创建模块</strong></p> <p>1、gmall-interface：公共接口层（model，service，exception…）</p> <p>作用：定义公共接口，也可以导入公共依赖</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1</span>、Bean模型
<span class="token keyword">package</span> gmall<span class="token punctuation">.</span>bean<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable<span class="token punctuation">;</span>

<span class="token comment">/**
 * 用户地址
 *
 * @author lfy
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserAddress</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> Integer id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String userAddress<span class="token punctuation">;</span> <span class="token comment">//用户地址</span>
    <span class="token keyword">private</span> String userId<span class="token punctuation">;</span> <span class="token comment">//用户id</span>
    <span class="token keyword">private</span> String consignee<span class="token punctuation">;</span> <span class="token comment">//收货人</span>
    <span class="token keyword">private</span> String phoneNum<span class="token punctuation">;</span> <span class="token comment">//电话号码</span>
    <span class="token keyword">private</span> String isDefault<span class="token punctuation">;</span> <span class="token comment">//是否为默认地址    Y-是     N-否</span>

    <span class="token keyword">public</span> <span class="token function">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// TODO Auto-generated constructor stub</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">UserAddress</span><span class="token punctuation">(</span><span class="token parameter">Integer id<span class="token punctuation">,</span> String userAddress<span class="token punctuation">,</span> String userId<span class="token punctuation">,</span> String consignee<span class="token punctuation">,</span> String phoneNum<span class="token punctuation">,</span>
                       String isDefault</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userAddress <span class="token operator">=</span> userAddress<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userId <span class="token operator">=</span> userId<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>consignee <span class="token operator">=</span> consignee<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>phoneNum <span class="token operator">=</span> phoneNum<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isDefault <span class="token operator">=</span> isDefault<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Integer <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token parameter">Integer id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getUserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserAddress</span><span class="token punctuation">(</span><span class="token parameter">String userAddress</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userAddress <span class="token operator">=</span> userAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token parameter">String userId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userId <span class="token operator">=</span> userId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getConsignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> consignee<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConsignee</span><span class="token punctuation">(</span><span class="token parameter">String consignee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>consignee <span class="token operator">=</span> consignee<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getPhoneNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> phoneNum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPhoneNum</span><span class="token punctuation">(</span><span class="token parameter">String phoneNum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>phoneNum <span class="token operator">=</span> phoneNum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getIsDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> isDefault<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIsDefault</span><span class="token punctuation">(</span><span class="token parameter">String isDefault</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isDefault <span class="token operator">=</span> isDefault<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token number">2</span>、OrderService 接口
<span class="token keyword">package</span> gmall<span class="token punctuation">.</span>service<span class="token punctuation">;</span>

<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>UserAddress<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>

<span class="token comment">/**
 * 订单服务
 * @author guoyh
 * @date 2021/7/5
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAddress</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> initOrder(String userId);
}

3、UserService接口
package gmall.service;

import gmall.bean.UserAddress;
import java.util.List;

/**
 * 用户服务
 * @author guoyh
 * @date 2021/7/5
 */
public interface UserService </span><span class="token punctuation">{</span>

    <span class="token comment">/**
     * 按照用户id返回所有收货地址
     *
     * @param userId
     * @return List&lt;UserAddress&gt;
     */</span>
    <span class="token keyword">public</span> List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAddress</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> getUserAddressList(String userId);

}
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br></div></div><p>2、user-service-provider：用户模块（对用户接口的实现）</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1</span>、pom<span class="token punctuation">.</span>xml
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入公共接口 <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">org.apache.dubbo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">gmall-interface</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">0.0.1-SNAPSHOT</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>	

<span class="token number">2</span>、UserServiceImpl服务
<span class="token keyword">package</span> com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">;</span>

<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>UserAddress<span class="token punctuation">;</span>
<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>UserService<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Arrays<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>

<span class="token comment">/**
 * 1、将服务提供者将服务注册到注册中心（暴漏服务）
 * 1) 导入dubbo依赖
 * 2、让服务消费者去注册中心订阅服务的服务地址
 *
 * @author guoyh
 * @date 2021/7/5
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    @Override
    <span class="token keyword">public</span> List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAddress</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> getUserAddressList(String userId) </span><span class="token punctuation">{</span>
        UserAddress userAddressOne <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userAddressOne<span class="token punctuation">.</span><span class="token function">setUserAddress</span><span class="token punctuation">(</span><span class="token string">&quot;北京市区昌平&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        UserAddress userAddressTwo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userAddressTwo<span class="token punctuation">.</span><span class="token function">setUserAddress</span><span class="token punctuation">(</span><span class="token string">&quot;天安门&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>userAddressOne<span class="token punctuation">,</span> userAddressTwo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token plain-text">
}
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>3、user-service-consumer：订单模块（调用用户模块）</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1</span>、pom<span class="token punctuation">.</span>xml
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">org.apache.dubbo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">gmall-interface</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">0.0.1-SNAPSHOT</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	
<span class="token number">2</span>、OrderServiceImpl服务
<span class="token keyword">package</span> com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">;</span>

<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>UserAddress<span class="token punctuation">;</span>
<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>OrderService<span class="token punctuation">;</span>
<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>UserService<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>

<span class="token comment">/**
 * @author guoyh
 * @date 2021/7/5
 */</span>
@Service
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>

    @Autowired
    UserService userService<span class="token punctuation">;</span>

    @Override
    <span class="token keyword">public</span> List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAddress</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> initOrder(String userId) </span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户id:&quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1、查询用户收获地址</span>
        List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAddress</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> userAddressList = userService.getUserAddressList(userId);
        for (UserAddress address : userAddressList) </span><span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span><span class="token function">getUserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token plain-text">
        return userAddressList;
    }
}
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>现在这样是无法进行调用的。我们gmall-order-web引入了gmall-interface，但是interface的实现是gmall-user，我们并没有引入，而且实际他可能还在别的服务器中。</p> <p><strong>4.4 使用dubbo改造</strong></p> <p>1、改造user-service-provider作为服务提供者</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1</span>、pom<span class="token punctuation">.</span>xml
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入dubbo <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mvnrepository<span class="token punctuation">.</span>com<span class="token operator">/</span>artifact<span class="token operator">/</span>com<span class="token punctuation">.</span>alibaba<span class="token operator">/</span>dubbo <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">com.alibaba</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">dubbo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">2.6.2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 注册中心使用的是zookeeper，引入操作zookeeper的客户端端 <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">org.apache.curator</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">curator-framework</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">2.12.0</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token number">2</span>、配置提供者provider<span class="token punctuation">.</span>xml
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>dubbo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://code.alibabatech.com/schema/dubbo<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd
		http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

    &lt;!-- 1、指定当前服务/应用的名字（同样的服务名字相同，不要和别的服务同名） --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>application</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-service-provider<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>application</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

    &lt;!-- 2、指定注册中心的位置 --&gt;
    &lt;!-- </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zookeeper://127.0.0.1:2181<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>registry</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zookeeper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>127.0.0.1:2181<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>registry</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

    &lt;!-- 3、指定通信规则（通信协议？通信端口） --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>protocol</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dubbo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20882<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>protocol</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

    &lt;!-- 4、暴露服务   ref：指向服务的真正的实现对象 --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gmall.service.UserService<span class="token punctuation">&quot;</span></span>
                   <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userServiceImpl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        &lt;!--</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getUserAddressList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">--&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>service</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

    &lt;!-- 服务的真正实现 --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userServiceImpl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.gmall.service.impl.UserServiceImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>

<span class="token number">3.</span>启动服务
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ClassPathXmlApplicationContext<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{</span>
        ClassPathXmlApplicationContext context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;provider.xml&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//为了不让服务终止，在这阻塞读取一个字符</span>
        System<span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按任意键退出</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>2、改造user-service-consumer作为服务消费者</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1</span>、pom<span class="token punctuation">.</span>xml
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入dubbo <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>mvnrepository<span class="token punctuation">.</span>com<span class="token operator">/</span>artifact<span class="token operator">/</span>com<span class="token punctuation">.</span>alibaba<span class="token operator">/</span>dubbo <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">com.alibaba</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">dubbo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">2.6.2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 注册中心使用的是zookeeper，引入操作zookeeper的客户端端 <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">org.apache.curator</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">curator-framework</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">2.12.0</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token number">2</span>、配置消费者consumer<span class="token punctuation">.</span>xml
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>dubbo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://dubbo.apache.org/schema/dubbo<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd
		http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd
		http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

    &lt;!-- 让注解能够生效 --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.gmall.service.impl<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">

    &lt;!-- 1、指定当前服务/应用的名字（同样的服务名字相同，不要和别的服务同名） --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>application</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order-service-consumer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>application</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

    &lt;!-- 2、指定注册中心的位置 --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zookeeper://127.0.0.1:2181<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>registry</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
		
		&lt;!-- 3、生成远程服务代理，可以和本地bean一样使用demoService --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gmall.service.UserService<span class="token punctuation">&quot;</span></span>
                     <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getUserAddressList<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>reference</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

    &lt;!-- 6、连接监控中心 --&gt;
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>monitor</span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>registry<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>monitor</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>3、调用测试</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">;</span>

<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>UserAddress<span class="token punctuation">;</span>
<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>OrderService<span class="token punctuation">;</span>
<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>UserService<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>

<span class="token comment">/**
 * @author guoyh
 * @date 2021/7/5
 */</span>
@Service
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>

    @Autowired
    UserService userService<span class="token punctuation">;</span>

    @Override
    <span class="token keyword">public</span> List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAddress</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> initOrder(String userId) </span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户id:&quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1、查询用户收获地址</span>
        List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAddress</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> userAddressList = userService.getUserAddressList(userId);
        for (UserAddress address : userAddressList) </span><span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span><span class="token function">getUserAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token plain-text">
        return userAddressList;
    }
}
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>4、注解版本</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1</span>、服务提供方
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>application</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gmall-user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>application</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zookeeper://118.24.44.169:2181<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>protocol</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dubbo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20880<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>annotation</span> <span class="token attr-name">package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.gmall.user.impl<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Service<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gmall<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>UserAddress<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>UserService<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gmall<span class="token punctuation">.</span>user<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>UserAddressMapper<span class="token punctuation">;</span>

@Service <span class="token comment">//使用dubbo提供的service注解，注册暴露服务</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

	@Autowired
	UserAddressMapper userAddressMapper<span class="token punctuation">;</span>

<span class="token number">2</span>、服务消费方
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>application</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gmall-order-web<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>application</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>zookeeper://118.24.44.169:2181<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>annotation</span> <span class="token attr-name">package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.gmall.order.controller<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Reference<span class="token punctuation">;</span>
<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>UserAddress<span class="token punctuation">;</span>
<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>OrderService<span class="token punctuation">;</span>
<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>UserService<span class="token punctuation">;</span>
@Controller
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>
	
	@Reference  <span class="token comment">//使用dubbo提供的reference注解引用远程服务</span>
	UserService userService<span class="token punctuation">;</span>
	
  @Override
    <span class="token keyword">public</span> List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAddress</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> initOrder(String userId) </span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;用户id:&quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1、查询用户收获地址</span>
        List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAddress</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> userAddressList = userService.getUserAddressList(userId);
        return userAddressList;
    }
}
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="_5、监控中心"><a href="#_5、监控中心" class="header-anchor">#</a> 5、监控中心</h4> <p>5.1、dubbo-admin</p> <p>图形化的服务管理页面；安装时需要指定注册中心地址，即可从注册中心中获取到所有的提供者/消费者进行配置管理</p> <p>5.2、dubbo-monitor-simple</p> <p>简单的监控中心；</p> <p>1)、安装</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1</span>、下载 dubbo<span class="token operator">-</span>ops
<span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>apache<span class="token operator">/</span>incubator<span class="token operator">-</span>dubbo<span class="token operator">-</span>ops
<span class="token number">2</span>、修改配置指定注册中心地址
进入 dubbo<span class="token operator">-</span>monitor<span class="token operator">-</span>simple\src\main\resources\conf
修改 dubbo<span class="token punctuation">.</span>properties文件
<span class="token number">3</span>、打包dubbo<span class="token operator">-</span>monitor<span class="token operator">-</span>simple
mvn clean <span class="token keyword">package</span> <span class="token operator">-</span>Dmaven<span class="token punctuation">.</span>test<span class="token punctuation">.</span>skip<span class="token operator">=</span><span class="token boolean">true</span>
<span class="token number">4</span>、解压 tar<span class="token punctuation">.</span>gz 文件，并运行start<span class="token punctuation">.</span>bat
如果缺少servlet<span class="token operator">-</span>api，自行导入servlet<span class="token operator">-</span>api再访问监控中心
<span class="token number">5</span>、启动访问<span class="token number">8080</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>2)、监控中心配置</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>所有服务配置连接监控中心，进行监控统计
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 监控中心协议，如果为protocol<span class="token operator">=</span><span class="token string">&quot;registry&quot;</span>，表示从注册中心发现监控中心地址，否则直连监控中心 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>monitor</span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>registry<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>monitor</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Simple Monitor 挂掉不会影响到 Consumer 和 Provider 之间的调用，所以用于生产环境不会有风险。</p> <p>Simple Monitor 采用磁盘存储统计信息，请注意安装机器的磁盘限制，如果要集群，建议用mount共享磁盘。</p> <h4 id="_6、springboot-整合-dubbo"><a href="#_6、springboot-整合-dubbo" class="header-anchor">#</a> 6、SpringBoot 整合 Dubbo</h4> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> SpringBoot版本 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">org.springframework.boot</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">spring-boot-starter-parent</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">2.0.4.RELEASE</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span><span class="token plain-text"> &lt;!-- lookup parent from repository --&gt;
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">JDK</span> <span class="token number">1.8</span><span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">1.8</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入公共接口项目<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">org.apache.dubbo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">gmall-interface</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">0.0.1-SNAPSHOT</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>6.1、引入spring-boot-starter以及dubbo和curator的依赖</p> <p>注意starter版本适配：</p> <p><img src="/assets/img/Untitled10.270f8d81.png" alt="Untitled10.png"></p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Dubbo Spring Boot Starter <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">com.alibaba.boot</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">dubbo-spring-boot-starter</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">0.2.0</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>6.2、配置application.properties</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1</span>、提供者配置
#dubbo服务名称
dubbo<span class="token punctuation">.</span>application<span class="token punctuation">.</span>name<span class="token operator">=</span>boot<span class="token operator">-</span>order<span class="token operator">-</span>service<span class="token operator">-</span>provider
#注册中心地址
dubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span>address<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">2181</span>
#注册中心协议
dubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span>protocol<span class="token operator">=</span>zookeeper
#通信协议
dubbo<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>name<span class="token operator">=</span>dubbo
dubbo<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>prot<span class="token operator">=</span><span class="token number">20880</span>
#监控中心地址<span class="token operator">:</span>registry从注册中心自动发现
dubbo<span class="token punctuation">.</span>monitor<span class="token punctuation">.</span>protocol<span class="token operator">=</span>registry
#application<span class="token punctuation">.</span>name就是服务名，不能跟别的dubbo提供端重复
#registry<span class="token punctuation">.</span>protocol 是指定注册中心协议
#registry<span class="token punctuation">.</span>address 是注册中心的地址加端口号
#protocol<span class="token punctuation">.</span>name 是分布式固定是dubbo<span class="token punctuation">,</span>不要改。
#base<span class="token operator">-</span><span class="token keyword">package</span>  注解方式要扫描的包

<span class="token number">2</span>、消费者配置
dubbo<span class="token punctuation">.</span>application<span class="token punctuation">.</span>name<span class="token operator">=</span>gmall<span class="token operator">-</span>order<span class="token operator">-</span>web
dubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span>protocol<span class="token operator">=</span>zookeeper
dubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span>address<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.67</span><span class="token number">.159</span><span class="token operator">:</span><span class="token number">2181</span>
dubbo<span class="token punctuation">.</span>scan<span class="token punctuation">.</span>base<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">=</span>com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gmall
dubbo<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>name<span class="token operator">=</span>dubbo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>3、dubbo注解</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>#提供者<span class="token operator">:</span>实现类开放服务
<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Service<span class="token punctuation">;</span>
@Service

#消费者<span class="token operator">:</span>从注册中心自动获取可用的实现服务
<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Reference<span class="token punctuation">;</span>
@Reference

如果没有在配置中写dubbo<span class="token punctuation">.</span>scan<span class="token punctuation">.</span>base<span class="token operator">-</span><span class="token keyword">package</span><span class="token punctuation">,</span>还需要使用@EnableDubbo注解
<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>EnableDubbo<span class="token punctuation">;</span>
@EnableDubbo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="二、dubbo配置"><a href="#二、dubbo配置" class="header-anchor">#</a> 二、dubbo配置</h2> <h3 id="_1、配置原则"><a href="#_1、配置原则" class="header-anchor">#</a> 1、配置原则</h3> <p><img src="/assets/img/Untitled11.22dd177b.png" alt="Untitled11.png"></p> <p>JVM 启动 -D 参数优先，这样可以使用户在部署和启动时进行参数重写，比如在启动时需改变协议的端口。</p> <p>XML /applicatoin.properties次之，如果在 XML 中有配置，则 dubbo.properties 中的相应配置项无效。(自己测试结果为dubbo.properties 比XML/application.properties高)</p> <p>Properties 最后，相当于缺省值，只有 XML 没有配置时，dubbo.properties 的相应配置项才会生效，通常用于共享公共配置，比如应用名。</p> <p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/preflight-check/" target="_blank" rel="noopener noreferrer">https://dubbo.apache.org/zh/docsv2.7/user/examples/preflight-check/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>启动时检查：</strong></p> <p>Dubbo 缺省会在启动时检查依赖的服务是否可用，不可用时会抛出异常，阻止 Spring 初始化完成，以便上线时，能及早发现问题，默认 <code>check=&quot;true&quot;</code>。</p> <p>可以通过 <code>check=&quot;false&quot;</code> 关闭检查，比如，测试时，有些服务不关心，或者出现了循环依赖，必须有一方先启动。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token operator">-</span><span class="token constant">D</span>
java <span class="token operator">-</span>Ddubbo<span class="token punctuation">.</span>reference<span class="token punctuation">.</span>com<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>BarService<span class="token punctuation">.</span>check<span class="token operator">=</span><span class="token boolean">false</span>
java <span class="token operator">-</span>Ddubbo<span class="token punctuation">.</span>reference<span class="token punctuation">.</span>check<span class="token operator">=</span><span class="token boolean">false</span>
java <span class="token operator">-</span>Ddubbo<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>check<span class="token operator">=</span><span class="token boolean">false</span> 
java <span class="token operator">-</span>Ddubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span>check<span class="token operator">=</span><span class="token boolean">false</span>

<span class="token constant">XML</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.foo.BarService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">check</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>consumer</span> <span class="token attr-name">check</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>registry</span> <span class="token attr-name">check</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

dubbo<span class="token punctuation">.</span>properties
dubbo<span class="token punctuation">.</span>reference<span class="token punctuation">.</span>com<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>BarService<span class="token punctuation">.</span>check<span class="token operator">=</span><span class="token boolean">false</span>
dubbo<span class="token punctuation">.</span>reference<span class="token punctuation">.</span>check<span class="token operator">=</span><span class="token boolean">false</span>
dubbo<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>check<span class="token operator">=</span><span class="token boolean">false</span>
dubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span>check<span class="token operator">=</span><span class="token boolean">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_2、重试次数"><a href="#_2、重试次数" class="header-anchor">#</a> 2、重试次数</h3> <p>失败自动切换，当出现失败，重试其它服务器，但重试会带来更长延迟。可通过 retries=&quot;2&quot; 来设置重试次数(不含第一次)。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>重试次数配置如下：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
或
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
或
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>findFoo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>reference</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3、超时时间"><a href="#_3、超时时间" class="header-anchor">#</a> 3、超时时间</h3> <p>由于网络或服务端不可靠，会导致调用出现一种不确定的中间状态（超时）。为了避免超时导致客户端资源（线程）挂起耗尽，必须设置超时时间.</p> <p>3.1、消费端</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>全局超时配置
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>consumer</span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

指定接口以及特定方法超时配置
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.foo.BarService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sayHello<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>reference</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3.2、提供方</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>全局超时配置
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>provider</span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

指定接口以及特定方法超时配置
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>provider</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.foo.BarService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sayHello<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>provider</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3.3、配置规则</p> <p>Dubbo推荐在Provider上尽量多配置Consumer端属性</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1</span>、作服务的提供者，比服务使用方更清楚服务性能参数，如调用的超时时间，合理的重试次数，等等
<span class="token number">2</span>、在Provider配置后，Consumer不配置则会使用Provider的配置值，即Provider配置可以作为Consumer的缺省值。否则，Consumer会使用Consumer端的全局设置，这对于Provider不可控的，并且往往是不合理的
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>配置的覆盖规则：</p> <ol><li><p>方法级配置别优于接口级别，即小Scope优先</p></li> <li><p>Consumer端配置 优于 Provider配置 优于 全局配置，</p></li></ol> <p>3) 最后是缺省值（见配置文档）</p> <h3 id="_4、版本号"><a href="#_4、版本号" class="header-anchor">#</a> 4、版本号</h3> <p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/multi-versions/" target="_blank" rel="noopener noreferrer">https://dubbo.apache.org/zh/docsv2.7/user/examples/multi-versions/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>当一个接口实现，出现不兼容升级时，可以用版本号过渡，版本号不同的服务相互间不引用。可以按照以下的步骤进行版本迁移：</p> <p>在低压力时间段，先升级一半提供者为新版本</p> <p>再将所有消费者升级为新版本</p> <p>然后将剩下的一半提供者升级为新版本</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>服务老版本提供者配置：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.foo.BarService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

服务新版本提供者配置：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.foo.BarService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2.0.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

服务老版本消费者配置：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>barService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.foo.BarService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

新版本服务消费者配置：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>barService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.foo.BarService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2.0.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

如果不需要区分版本，可以按照以下的方式配置：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>barService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.foo.BarService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_5、本地存根"><a href="#_5、本地存根" class="header-anchor">#</a> 5、本地存根</h3> <p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/local-stub/" target="_blank" rel="noopener noreferrer">https://dubbo.apache.org/zh/docsv2.7/user/examples/local-stub/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>远程服务后，客户端通常只剩下接口，而实现全在服务器端，但提供方有些时候想在客户端也执行部分逻辑，比如：做 ThreadLocal 缓存，提前验证参数，调用失败后伪造容错数据等等，此时就需要在 API 中带上 Stub，客户端生成 Proxy 实例，会把 Proxy 通过构造函数传给 Stub <a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/local-stub/#fn:1" target="_blank" rel="noopener noreferrer">1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，然后把 Stub 暴露给用户，Stub 可以决定要不要去调 Proxy。</p> <p><img src="stub.jpg" alt="stub.jpg"></p> <p>在消费方，写一个远程接口本地的实现，提供 Stub 的实现 ：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BarServiceStub</span> <span class="token keyword">implements</span> <span class="token class-name">BarService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> final BarService barService<span class="token punctuation">;</span>
    
    <span class="token comment">// 必须有一个有参构造，并且使构造函数传入真正的远程代理对象</span>
    <span class="token keyword">public</span> <span class="token function">BarServiceStub</span><span class="token punctuation">(</span><span class="token parameter">BarService barService</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>barService <span class="token operator">=</span> barService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> String <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token parameter">String name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 此代码在客户端执行, 你可以在客户端做ThreadLocal本地缓存，或预先验证参数是否合法，等等</span>
        <span class="token comment">// ...自己的代码</span>
				<span class="token comment">// 当自己代码执行结束后，再调真正的远程服务</span>
				<span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> barService<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 你可以容错，可以做任何AOP拦截事项</span>
            <span class="token keyword">return</span> <span class="token string">&quot;容错数据&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>在 spring 配置文件中按以下方式配置：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>提供者方配置
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.foo.BarService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stub</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

消费者方配置
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gmall.service.UserService<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> 
	<span class="token attr-name">stub</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.gmall.service.impl.UserServiceStub<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getUserAddressList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>reference</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr> <ol><li>Stub 必须有可传入 Proxy 的构造函数。</li> <li>在 interface 旁边放一个 Stub 实现，它实现 BarService 接口，并有一个传入远程 BarService 实例的构造函数</li></ol> <h3 id="_6、springboot方式配置"><a href="#_6、springboot方式配置" class="header-anchor">#</a> 6、SpringBoot方式配置</h3> <h4 id="_6-1、超时属性"><a href="#_6-1、超时属性" class="header-anchor">#</a> 6.1、超时属性</h4> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Service<span class="token punctuation">;</span>
@<span class="token function">Service</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Reference<span class="token punctuation">;</span>
@<span class="token function">Reference</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_6-2、springboot与dubbo整合的三种方式"><a href="#_6-2、springboot与dubbo整合的三种方式" class="header-anchor">#</a> 6.2、SpringBoot与Dubbo整合的三种方式</h4> <p><strong>6.2.1、第一种</strong></p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1.</span>导入dobuuo<span class="token operator">-</span>starter
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">com.alibaba.boot</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">dubbo-spring-boot-starter</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">0.2.0</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token number">2.</span>配置application<span class="token punctuation">.</span>properties
#dubbo服务名称
dubbo<span class="token punctuation">.</span>application<span class="token punctuation">.</span>name<span class="token operator">=</span>boot<span class="token operator">-</span>order<span class="token operator">-</span>service<span class="token operator">-</span>provider
#注册中心地址
dubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span>address<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">2181</span>
#注册中心协议
dubbo<span class="token punctuation">.</span>registry<span class="token punctuation">.</span>protocol<span class="token operator">=</span>zookeeper
#通信协议
dubbo<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>name<span class="token operator">=</span>dubbo
dubbo<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>prot<span class="token operator">=</span><span class="token number">20880</span>
#监控中心地址<span class="token operator">:</span>registry从注册中心自动发现
dubbo<span class="token punctuation">.</span>monitor<span class="token punctuation">.</span>protocol<span class="token operator">=</span>registry

<span class="token number">3.</span>暴漏服务注解@Service

<span class="token number">4.</span>使用远程服务@Reference

<span class="token number">5.</span>开启Dubbo注解功能@EnableDubbo

#老版本会指定包扫描规则
dubbo<span class="token punctuation">.</span>scan<span class="token punctuation">.</span>base<span class="token operator">-</span>packages<span class="token operator">=</span>com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>6.2.2、第二种：保留XML</strong></p> <p>想要做到方法级别的配置，保留dubbo的xml配置文件，之后可以在xml中做到method方法级别的配置。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code># 拷贝xml文件到resource目录<span class="token punctuation">,</span>删除application<span class="token punctuation">.</span>properties中dubbo的相关配置
# 所有配置都在xml中
<span class="token number">1.</span>导入dobuuo<span class="token operator">-</span>starter
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">com.alibaba.boot</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">dubbo-spring-boot-starter</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">0.2.0</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token number">2.</span>使用@ImportResource导入dubbo的xml配置文件
<span class="token comment">//@EnableDubbo</span>
@<span class="token function">ImportResource</span><span class="token punctuation">(</span>location<span class="token operator">=</span><span class="token string">&quot;classpath:provider.xml&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>6.2.3、第三种:注解API配置类</strong></p> <p>将每一个组件手动创建到容器中</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1.</span>创建配置类
<span class="token keyword">package</span> com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gmall<span class="token punctuation">.</span>config<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> gmall<span class="token punctuation">.</span>service<span class="token punctuation">.</span>UserService<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Arrays<span class="token punctuation">;</span>

@Configuration
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDubboConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 提供者名
     * @return
     */</span>
    @Bean
    <span class="token keyword">public</span> ApplicationConfig <span class="token function">applicationConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ApplicationConfig applicationConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApplicationConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        applicationConfig<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;boot-order-service-provider-config&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> applicationConfig<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 注册中心地址
     * @return
     */</span>
    @Bean
    <span class="token keyword">public</span> RegistryConfig <span class="token function">registryConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        RegistryConfig registryConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegistryConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registryConfig<span class="token punctuation">.</span><span class="token function">setProtocol</span><span class="token punctuation">(</span><span class="token string">&quot;zookeeper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registryConfig<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:2181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registryConfig<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 通信规则
     * @return
     */</span>
    @Bean
    <span class="token keyword">public</span> ProtocolConfig <span class="token function">protocolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ProtocolConfig protocolConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProtocolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        protocolConfig<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;dubbo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        protocolConfig<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">20882</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> protocolConfig<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 配置暴漏服务
     * @return
     */</span>
    @Bean
    <span class="token keyword">public</span> ServiceConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserService</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> userServiceConfig(UserService userService) </span><span class="token punctuation">{</span>
        ServiceConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserService</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> userServiceConfig = new ServiceConfig</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">();
        //配置接口级别
        userServiceConfig.setInterface(UserService.class);
        userServiceConfig.setRef(userService);
        userServiceConfig.setVersion(&quot;1.0.0&quot;);

        //配置方法级别
        MethodConfig methodConfig = new MethodConfig();
        methodConfig.setName(&quot;getUserAddressList&quot;);
        methodConfig.setTimeout(1000);

        userServiceConfig.setMethods(Arrays.asList(methodConfig));
        return userServiceConfig;
    }

    /**
     * 设置监控中心
     * @return
     */
    @Bean
    public MonitorConfig monitorConfig() </span><span class="token punctuation">{</span>
        MonitorConfig monitorConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MonitorConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        monitorConfig<span class="token punctuation">.</span><span class="token function">setProtocol</span><span class="token punctuation">(</span><span class="token string">&quot;registry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> monitorConfig<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token plain-text">
}

2.暴露服务接口
@Service //暴露服务

3.启动dubbo并指定扫描路径
@EnableDubbo(scanBasePackages = &quot;com.atguigu.gmall&quot;)
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><h2 id="三、高可用"><a href="#三、高可用" class="header-anchor">#</a> 三、高可用</h2> <h3 id="_3-1、zookeeper宕机与dubbo直连"><a href="#_3-1、zookeeper宕机与dubbo直连" class="header-anchor">#</a> 3.1、zookeeper宕机与dubbo直连</h3> <p><img src="/assets/img/Untitled12.32115ce3.png" alt="Untitled12.png"></p> <p>注册中心的作用就是保存服务提供者位置信息，我们完全可以绕过注册中心使用dubbo直连.</p> <p>宕机了有缓存，依旧可以调用。没有注册中心使用直连</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>@<span class="token function">Reference</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>url <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1:20880&quot;</span><span class="token punctuation">)</span>
UserService userService<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-2、集群下dubbo负载均衡机制"><a href="#_3-2、集群下dubbo负载均衡机制" class="header-anchor">#</a> 3.2、集群下dubbo负载均衡机制</h3> <p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/loadbalance/" target="_blank" rel="noopener noreferrer">https://dubbo.apache.org/zh/docsv2.7/user/examples/loadbalance/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在集群负载均衡时，Dubbo 提供了多种均衡策略，缺省为 random 随机调用,</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token operator">**</span>Random LoadBalance<span class="token operator">**</span>
随机，按权重设置随机概率。
在一个截面上碰撞的概率高，但调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重。
<span class="token operator">**</span>RoundRobin LoadBalance<span class="token operator">**</span>
轮循，按公约后的权重设置轮循比率。
存在慢的提供者累积请求的问题，比如：第二台机器很慢，但没挂，当请求调到第二台时就卡在那，久而久之，所有请求都卡在调到第二台上。
<span class="token operator">**</span>LeastActive LoadBalance<span class="token operator">**</span>
最少活跃调用数，相同活跃数的随机，活跃数指调用前后计数差。
使慢的提供者收到更少请求，因为越慢的提供者的调用前后计数差会越大。
<span class="token operator">**</span>ConsistentHash LoadBalance<span class="token operator">**</span>
一致性 Hash，相同参数的请求总是发到同一提供者。
<span class="token literal-property property">当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动。算法参见：http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>en<span class="token punctuation">.</span>wikipedia<span class="token punctuation">.</span>org<span class="token operator">/</span>wiki<span class="token operator">/</span>Consistent_hashing
缺省只对第一个参数 Hash，如果要修改，请配置 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>parameter</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hash.arguments<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0,1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
缺省用 <span class="token number">160</span> 份虚拟节点，如果要修改，请配置 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>parameter</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hash.nodes<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>320<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_3-2-1、random-loadbalance"><a href="#_3-2-1、random-loadbalance" class="header-anchor">#</a> 3.2.1、Random LoadBalance</h4> <p><img src="/assets/img/Untitled13.78e96070.png" alt="Untitled13.png"></p> <h4 id="_3-2-2、roundrobin-loadbalance"><a href="#_3-2-2、roundrobin-loadbalance" class="header-anchor">#</a> 3.2.2、RoundRobin LoadBalance</h4> <p>第一调完，必须去第二个,根据权重1只能占2次，2占4次，3占1次。</p> <p><img src="/assets/img/Untitled14.22a52207.png" alt="Untitled14.png"></p> <h4 id="_3-2-3、leastactive-loadbalance"><a href="#_3-2-3、leastactive-loadbalance" class="header-anchor">#</a> 3.2.3、LeastActive LoadBalance</h4> <p><img src="/assets/img/Untitled15.2f903532.png" alt="Untitled15.png"></p> <p>每次都统计上次请求时间</p> <p>调哪个前会查那个上次最快</p> <h4 id="_3-2-4、consistenthash-loadbalance"><a href="#_3-2-4、consistenthash-loadbalance" class="header-anchor">#</a> 3.2.4、ConsistentHash LoadBalance</h4> <p>比如getUser,id都等于1的，根据hash分布都会来到1号机器。</p> <p><img src="/assets/img/Untitled16.942d6bc7.png" alt="Untitled16.png"></p> <h4 id="_3-2-5、配置"><a href="#_3-2-5、配置" class="header-anchor">#</a> 3.2.5、配置</h4> <p>默认为随机负载均衡机制</p> <p><img src="/assets/img/Untitled17.9602127d.png" alt="Untitled17.png"></p> <p><img src="/assets/img/Untitled18.9f16932f.png" alt="Untitled18.png"></p> <p>XML：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>### <span class="token operator">**</span>服务端服务级别<span class="token operator">**</span>

<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;dubbo:service interface=&quot;...&quot; loadbalance=&quot;roundrobin&quot; /&gt;</span><span class="token template-punctuation string">`</span></span>

### <span class="token operator">**</span>客户端服务级别<span class="token operator">**</span>

<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;dubbo:reference interface=&quot;...&quot; loadbalance=&quot;roundrobin&quot; /&gt;</span><span class="token template-punctuation string">`</span></span>

### <span class="token operator">**</span>服务端方法级别<span class="token operator">**</span>

<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;dubbo:service interface=&quot;...&quot;&gt;
    &lt;dubbo:method name=&quot;...&quot; loadbalance=&quot;roundrobin&quot;/&gt;
&lt;/dubbo:service&gt;</span><span class="token template-punctuation string">`</span></span>

### <span class="token operator">**</span>客户端方法级别<span class="token operator">**</span>

<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;dubbo:reference interface=&quot;...&quot;&gt;
    &lt;dubbo:method name=&quot;...&quot; loadbalance=&quot;roundrobin&quot;/&gt;
&lt;/dubbo:reference&gt;</span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>注解：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>@<span class="token function">Reference</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>loadbalance <span class="token operator">=</span> <span class="token string">&quot;roundrobin&quot;</span><span class="token punctuation">)</span> 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/Untitled19.8b25d3b8.png" alt="Untitled19.png"></p> <h3 id="_3-3、整合hystrix-服务熔断与降级处理"><a href="#_3-3、整合hystrix-服务熔断与降级处理" class="header-anchor">#</a> 3.3、整合hystrix，服务熔断与降级处理</h3> <h4 id="_3-3-1、服务降级"><a href="#_3-3-1、服务降级" class="header-anchor">#</a> 3.3.1、服务降级</h4> <p>什么是服务降级？</p> <p>当服务器压力剧增的情况下，根据实际业务情况及流量，对一些服务和页面有策略的不处理或换种简单的方式处理，从而释放服务器资源以保证核心交易正常运作或高效运作</p> <p>可以通过服务降级功能临时屏蔽某个出错的非关键服务，并定义降级后的返回策略。</p> <p>支持2种：</p> <ul><li>mock=force:return+null 表示消费方对该服务的方法调用都直接返回 null 值，不发起远程调用。用来屏蔽不重要服务不可用时对调用方的影响。（直接在客户端返回null，不发起远程调用）</li> <li>还可以改为 mock=fail:return+null 表示消费方对该服务的方法调用在失败后，再返回 null 值，不抛异常。用来容忍不重要服务不稳定时对调用方的影响。（到达一定超时时间，超时后调用在失败后，再返回 null 值，这个是服务已经调用了）</li></ul> <p>通过服务降级手段，牺牲非核心业务的占用的资源，达到让其他核心业务能占用服务器更多资源</p> <p><strong>配置，在消费者端</strong></p> <p>第一种：屏蔽（不进行远程调用，返回null）</p> <p><img src="/assets/img/Untitled20.02fa2ddd.png" alt="Untitled20.png"></p> <p>第二种：容错（当远程调用失败后，返回null）</p> <p><img src="/assets/img/Untitled21.9cbd4808.png" alt="Untitled21.png"></p> <h4 id="_3-3-2、集群容错"><a href="#_3-3-2、集群容错" class="header-anchor">#</a> 3.3.2、集群容错</h4> <p>在集群调用失败时，Dubbo 提供了多种容错方案，缺省为 failover 重试。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token number">1.</span><span class="token operator">**</span>Failover Cluster<span class="token operator">**</span>
失败自动切换，当出现失败，重试其它服务器。通常<span class="token operator">**</span>用于读操作<span class="token operator">**</span>，但重试会带来更长延迟。
可通过 retries<span class="token operator">=</span><span class="token string">&quot;2&quot;</span> <span class="token function">来设置重试次数</span><span class="token punctuation">(</span>不含第一次<span class="token punctuation">)</span>。

重试次数配置如下：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
或
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
或
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>findFoo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>reference</span><span class="token punctuation">&gt;</span></span>

<span class="token number">2.</span><span class="token operator">**</span>Failfast Cluster<span class="token operator">**</span>
快速失败，只发起一次调用，失败立即报错。通常用于<span class="token operator">**</span>非幂等性<span class="token operator">**</span>的写操作，比如新增记录。

<span class="token number">3.</span><span class="token operator">**</span>Failsafe Cluster<span class="token operator">**</span>
失败安全，出现异常时，直接<span class="token operator">**</span>忽略<span class="token operator">**</span>。通常用于写入审计日志等操作。

<span class="token number">4.</span><span class="token operator">**</span>Failback Cluster<span class="token operator">**</span>
<span class="token operator">**</span>失败自动恢复<span class="token operator">**</span>，后台记录失败请求，定时重发。通常<span class="token operator">**</span>用于消息通知<span class="token operator">**</span>操作。

<span class="token number">5.</span><span class="token operator">**</span>Forking Cluster<span class="token operator">**</span>
<span class="token operator">**</span>并行调用<span class="token operator">**</span>多个服务器，只要一个成功即返回。通常用于实时性要求较高的读操作，
但需要浪费更多服务资源。可通过 forks<span class="token operator">=</span><span class="token string">&quot;2&quot;</span> 来设置最大并行数。太浪费资源。

<span class="token number">6.</span><span class="token operator">**</span>Broadcast Cluster<span class="token operator">**</span>
广播<span class="token operator">**</span>调用所有提供者，逐个调用，任意一台报错则报错<span class="token operator">**</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>。
通常<span class="token operator">**</span>用于通知所有提供者更新缓存<span class="token operator">**</span>或日志等本地资源信息。

<span class="token number">7.</span><span class="token operator">**</span>集群模式配置<span class="token operator">**</span>
按照以下示例在服务提供方和消费方配置集群模式
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>service</span> <span class="token attr-name">cluster</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>failsafe<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
或
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">cluster</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>failsafe<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="_3-3-3、实际开发整合hystrix提供容错-springcloud默认整合的框架"><a href="#_3-3-3、实际开发整合hystrix提供容错-springcloud默认整合的框架" class="header-anchor">#</a> 3.3.3、实际开发整合hystrix提供容错（SpringCloud默认整合的框架）</h4> <p>Hystrix 旨在通过控制那些访问远程系统、服务和第三方库的节点，从而对延迟和故障提供更强大的容错能力。Hystrix具备拥有回退机制和断路器功能的线程和信号隔离，请求缓存和请求打包，以及监控和配置等功能。</p> <p><strong>1、配置spring-cloud-starter-netflix-hystrix</strong></p> <p>spring boot官方提供了对hystrix的集成，直接在消费者、提供者的pom.xml里加入依赖：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">org.springframework.cloud</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">spring-cloud-starter-netflix-hystrix</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">1.4.4.RELEASE</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后在Application类上增加@EnableHystrix来启用hystrix starter：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>@SpringBootApplication
@EnableHystrix
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProviderApplication</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>2、配置Provider端</strong></p> <p>在Dubbo的Provider上增加@HystrixCommand配置，这样子调用就会经过Hystrix代理。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>@<span class="token function">Service</span><span class="token punctuation">(</span>version <span class="token operator">=</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">HelloService</span> <span class="token punctuation">{</span>
		<span class="token comment">//使用Hystrix代理，进行处理容错异常</span>
    @<span class="token function">HystrixCommand</span><span class="token punctuation">(</span>commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span>
     @<span class="token function">HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;circuitBreaker.requestVolumeThreshold&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     @<span class="token function">HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;execution.isolation.thread.timeoutInMilliseconds&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;2000&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    @Override
    <span class="token keyword">public</span> String <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token parameter">String name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// System.out.println(&quot;async provider received: &quot; + name);</span>
        <span class="token comment">// return &quot;annotation: hello, &quot; + name;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Exception to show hystrix enabled.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>3、配置Consumer端</strong></p> <p>对于Consumer端，则可以增加一层method调用，并在method上配置@HystrixCommand。当调用出错时，会走到fallbackMethod = &quot;reliable&quot;的调用里。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>@<span class="token function">Reference</span><span class="token punctuation">(</span>version <span class="token operator">=</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> HelloService demoService<span class="token punctuation">;</span>
		<span class="token comment">//fallbackMethod 回调方法,一旦调用失败出错后，调用reliable方法</span>
		<span class="token comment">//就不用在调用代码中trycatch了</span>
    @<span class="token function">HystrixCommand</span><span class="token punctuation">(</span>fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;reliable&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">doSayHello</span><span class="token punctuation">(</span><span class="token parameter">String name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> demoService<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">reliable</span><span class="token punctuation">(</span><span class="token parameter">String name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;hystrix fallback value&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="四、dubbo原理"><a href="#四、dubbo原理" class="header-anchor">#</a> 四、Dubbo原理</h2> <h3 id="_4-1、rpc原理"><a href="#_4-1、rpc原理" class="header-anchor">#</a> 4.1、RPC原理</h3> <p>rpc就是想完成一次远程调用</p> <p><img src="/assets/img/Untitled22.3eebd98a.png" alt="Untitled22.png"></p> <p>一次完整的RPC调用流程（同步调用，异步另说）如下：</p> <p>1）Computer01（client）发起远程调用请求,接下来有一个代理对象client stub</p> <p><strong>2）client stub接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体；</strong></p> <p><strong>3）client stub找到服务地址，并将消息发送到服务端server stub；</strong></p> <p><strong>4）server stub收到消息后进行解码(可能传输的是序列化对象，需要反序列化)；</strong></p> <p><strong>5）server stub根据解码结果调用本地的方法服务；</strong></p> <p><strong>6）本地方法服务执行完成后，将数据结果返回给server stub；</strong></p> <p><strong>7）server stub将返回结果打包(序列化)成消息通过网络发送至消费方client stub；</strong></p> <p><strong>8）client stub接收到消息，并进行解码(反序列化)；</strong></p> <p>9）服务消费方Computer01得到最终结果。</p> <p>RPC框架的目标就是要2~8这些步骤都封装起来，这些细节对用户来说是透明的，不可见的。</p> <h3 id="_4-2、netty通信原理"><a href="#_4-2、netty通信原理" class="header-anchor">#</a> 4.2、netty通信原理</h3> <p>Dubbo底层通信时是使用netty，Netty时基于Java的NIO(Non-Blocking IO)非阻塞,BIO(Blocking IO)阻塞IO。</p> <p><strong>BIO：</strong></p> <p><img src="/assets/img/Untitled23.01e6f270.png" alt="Untitled23.png"></p> <p>每一个请求进来开一个线程Socket，读取Socket的输入流、进行业务逻辑等等。同时在这操作，并且此时在我们业务逻辑没完成之前，我们线程都不能得到释放的，这样我们的服务器就不能同时处理大量的请求。因为有大量的线程在等待业务逻辑的完成。</p> <p><strong>NIO：</strong></p> <p><img src="/assets/img/Untitled24.624fa881.png" alt="Untitled24.png"></p> <p>Channel：通道，通道里还有Buffer，利用Buffer进行数据传输。</p> <p>Selector ：一般称 为<strong>选择器</strong> ，也可以翻译为 <strong>多路复用器。</strong></p> <p>通道状态：Connect（连接就绪）、Accept（接受就绪）、Read（读就绪）、Write（写就绪）。</p> <p><strong>基本原理：</strong></p> <p>1个Selector会有很多通道注册了进来，Selector通过监听多个通道，监听会有很多事件，如当Connect了发生什么，Accept了会做什么，Read或Write发生了时要做什么，当发现某一个通道数据准备好了。所以我们通过1个Selector监听多个通道的方式，当某个通道任何一个状态准备好了，我们可以额外开一个线程进行处理。这叫多路复用模型。</p> <p><img src="/assets/img/Untitled25.aaf234bf.png" alt="Untitled25.png"></p> <p>1.启动</p> <p>2.监听某一个端口</p> <p>3.初始化一个通道，注册到Selector中</p> <p>4.轮询监听通道的accept事件</p> <p>5.当accept事件发生后，扔到任务队列，处理通道信息，就与客户端建立连接来生成SocketChannel</p> <p>6.然后把刚生成的SocketChannel通道再注册到Selector里面，进行监听read、wirte事件</p> <p>7.read、wirte事件准备就绪了就来处理，抛给任务队列。</p> <p>注意：有2个Selector，一个是boss来进行监听准备就绪事件，另一个woker是当准备就绪后要做什么工作，把这个工作抛给woker慢慢来做。</p> <h3 id="_4-3、dubbo原理"><a href="#_4-3、dubbo原理" class="header-anchor">#</a> 4.3、dubbo原理</h3> <h4 id="_4-3-1、dubbo原理-框架设计"><a href="#_4-3-1、dubbo原理-框架设计" class="header-anchor">#</a> 4.3.1、dubbo原理	-   框架设计</h4> <p><img src="/assets/img/Untitled26.9785a35b.png" alt="Untitled26.png"></p> <p><strong>各层说明</strong></p> <ul><li><strong>config 配置层</strong>：对外配置接口，以 <code>ServiceConfig</code>, <code>ReferenceConfig</code> 为中心，可以直接初始化配置类，也可以通过 spring 解析<strong>配置生成配置类</strong></li> <li><strong>proxy 服务代理层</strong>：服务接口透明代理，<strong>生成服务的客户端 Stub 和服务器端 Skeleton,</strong> 以 <code>ServiceProxy</code> 为中心，扩展接口为 <code>ProxyFactory</code></li> <li><strong>registry 注册中心层</strong>：封装服务地址的<strong>注册与发现</strong>，以服务 URL 为中心，扩展接口为 <code>RegistryFactory</code>, <code>Registry</code>, <code>RegistryService</code></li> <li><strong>cluster 路由层</strong>：封装多个提供者的路由及<strong>负载均衡</strong>，并桥接注册中心，以 <code>Invoker</code> 为中心，扩展接口为 <code>Cluster</code>, <code>Directory</code>, <code>Router</code>, <code>LoadBalance</code></li> <li><strong>monitor 监控层</strong>：RPC <strong>调用次数和调用时间监控</strong>，以 <code>Statistics</code> 为中心，扩展接口为 <code>MonitorFactory</code>, <code>Monitor</code>, <code>MonitorService</code></li> <li><strong>protocol 远程调用层</strong>：<strong>封装 RPC 调用</strong>，以 <code>Invocation</code>, <code>Result</code> 为中心，扩展接口为 <code>Protocol</code>, <code>Invoker</code>, <code>Exporter</code></li> <li><strong>exchange 信息交换层</strong>：封装请求响应模式，同步转异步，以 <code>Request</code>, <code>Response</code> 为中心，扩展接口为 <code>Exchanger</code>, <code>ExchangeChannel</code>, <code>ExchangeClient</code>, <code>ExchangeServer</code>，创建客户端和服务端，两个架起管道进行数据互联互通。</li> <li><strong>transport 网络传输层</strong>：抽象 mina 和 **netty (transport 底层)**为统一接口，以 <code>Message</code> 为中心，扩展接口为 <code>Channel</code>, <code>Transporter</code>, <code>Client</code>, <code>Server</code>, <code>Codec</code></li> <li><strong>serialize 数据序列化层</strong>：可复用的一些工具，扩展接口为 <code>Serialization</code>, <code>ObjectInput</code>, <code>ObjectOutput</code>, <code>ThreadPool</code></li></ul> <p>**说明：**Consumer在左边，Provider在右边。Call为调用逻辑，黑颜色是依赖顺序。</p> <h4 id="_4-3-2、dubbo原理-启动解析、加载配置信息"><a href="#_4-3-2、dubbo原理-启动解析、加载配置信息" class="header-anchor">#</a> 4.3.2、dubbo原理	-   启动解析、加载配置信息</h4> <p>BeanDefinitionParser定义解析器</p> <p>DubboBeanDefinitionParser中的parse方法来解析标签。挨个标签来解析。</p> <p>DubboBeanDefinitionParser构造器打断点看怎么创建出来的。</p> <p><img src="/assets/img/Untitled27.e5633f0b.png" alt="Untitled27.png"></p> <p>init方法注册很多标签解析器。容器启动，解析每一个标签，每一个标签都有对应的***Config.class，保存到指定的对象中,Service标签牵扯到服务暴漏的功能。</p> <p><img src="/assets/img/Untitled28.2f957245.png" alt="Untitled28.png"></p> <h4 id="_4-3-3、dubbo原理-服务暴露"><a href="#_4-3-3、dubbo原理-服务暴露" class="header-anchor">#</a> 4.3.3、dubbo原理	-   服务暴露</h4> <p><img src="dubbo-%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2.jpg" alt="dubbo-%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2.jpg"></p> <p>Service标签牵扯到服务暴漏的功能，ServiceBean它实现了InitalizingBean（它在创建完对象以后调用afterPropertisSet方法）、ApplicationListener(事件是ContextRefreshedEvent(当IOC容器完成后会回调onApplicationEvent方法))</p> <p>afterPropertisSet方法和onApplicationEvent方法都做了什么：</p> <p>afterPropertisSet方法保存配置的属性信息。</p> <p>onApplicationEvent方法判断当没有爆露时调用export方法暴漏服务，调用doExport方法。调用doExportUrls方法，第一步加载注册信息，再调用doExportUrlsFor1Portocol方法，创建invoker，调用protocol(DubboProtocol).export(wrapperInvoker)</p> <p>暴漏URL,OPENServer(url)，启动netty服务器，监听20880端口</p> <p>创建服务器createServer(url)</p> <p>Exchangers.bind(url,requestHandler)绑定url和处理器</p> <p>Transporters.bind(url,new DecodeHandler(new HanderExchangesHandler()))这都是netty的底层，创建一个netty的服务器。</p> <p>注册提供者。</p> <p>总共2步：</p> <p>启动netty服务器，监听20880端口。</p> <p>注册中心进行注册服务，把注册好的地址，把注册信息保存在注册中心。</p> <p>microkernel plugin模式</p> <h4 id="_4-3-4、dubbo原理-服务引用"><a href="#_4-3-4、dubbo原理-服务引用" class="header-anchor">#</a> 4.3.4、dubbo原理	-   服务引用</h4> <p>如何通过配置reference标签远程引用暴漏的服务。</p> <p><img src="/assets/img/Untitled29.39175427.png" alt="Untitled"></p> <p>前置类似暴漏服务原理，对应的是ReferenceBean,特殊在implement FactoryBean，FactoryBean作用是当我们要获取userService，在引用userService的类中需要自动注入userService，需要从spring容器中找，通过调用FactoryBean的getObject方法获取userService对象，getObject调用ReferenceConfig的getT方法，如果ref引用是空的，就init（）初始化对象，ref = createProxy（map）。</p> <p><img src="/assets/img/Untitled30.29126eaa.png" alt="Untitled"></p> <p><img src="/assets/img/Untitled31.67b331c2.png" alt="Untitled"></p> <p>然后远程引用接口，urls保存了注册中心的地址。</p> <p><img src="/assets/img/Untitled32.45f9ceb1.png" alt="Untitled"></p> <p>refprotocal还是Protocal，Protocal有2种，1个是DubboProtocal，另一个是RegistryProtocol，这里调用RegistryProtocol的refer方法。</p> <p><img src="/assets/img/Untitled33.ded27ec9.png" alt="Untitled"></p> <p>先根据注册中心地址得到注册中心信息。然后调用doRefer,传入了注册中心地址，还有要引用的userService</p> <p><img src="/assets/img/Untitled34.14836dc4.png" alt="Untitled"></p> <p>之后进行订阅服务</p> <p><img src="/assets/img/Untitled35.c9d9daab.png" alt="Untitled"></p> <p>订阅服务会进入到DubboProtocol，DubboProtocol会getClients获取客户端。</p> <p><img src="/assets/img/Untitled36.90e07d4b.png" alt="Untitled"></p> <p>拿到客户端，初始化客户端</p> <p><img src="/assets/img/Untitled37.777f71a7.png" alt="Untitled"></p> <p>然偶会进行连接</p> <p><img src="/assets/img/Untitled38.5bb8f19d.png" alt="Untitled"></p> <p>获取返回连接，调用Transporter.connect（），之后就到达了netty的底层。</p> <p><img src="/assets/img/Untitled39.d4a48dd7.png" alt="Untitled"></p> <p><img src="/assets/img/Untitled40.5e27ce0f.png" alt="Untitled"></p> <p><img src="/assets/img/Untitled41.c45f4f9a.png" alt="Untitled"></p> <p>相当于创建一个netty客户端，根据url地址监听一个端口。创建完连接后返回DubboProtocol中，创建好invoker，返回invoker。</p> <p><img src="/assets/img/Untitled42.3968862f.png" alt="Untitled"></p> <p>获取创建好的invoker，里面有url地址，消费者地址。之后在消费者注册表里把刚创建的invoker注册进去。注册进入subscribeUrl订阅地址。记录消费者消费哪个服务。</p> <p><img src="/assets/img/Untitled43.7696e8ff.png" alt="Untitled"></p> <p>保存好了后返回到doRefer()</p> <p><img src="/assets/img/Untitled44.cfb80104.png" alt="Untitled"></p> <p>但后一直返回到createProxy。ref代理对象就创建好了，远程信息等都在里面存好了。</p> <p>之后使用代理对象来执行远程调用方法。</p> <p><img src="/assets/img/Untitled45.cf1d6c45.png" alt="Untitled"></p> <h4 id="_4-3-5、dubbo原理-服务调用"><a href="#_4-3-5、dubbo原理-服务调用" class="header-anchor">#</a> 4.3.5、dubbo原理	-   服务调用</h4> <p>整体流程：</p> <p><img src="/assets/img/Untitled46.a1b5bcc6.png" alt="Untitled"></p> <p>代理对象如何执行方法呢，在这里打个断点。</p> <p><img src="/assets/img/Untitled47.7b2fb05e.png" alt="Untitled"></p> <p>会调用invoke，并且会传入method和args并封装成一个叫RpcInvocation远程调用的对象。</p> <p><img src="/assets/img/Untitled48.ba04fff5.png" alt="Untitled"></p> <p>之后再进一个Invoker，它里面封装了FailOverCluster，他是dubbo带集群容错功能的invoker</p> <p><img src="/assets/img/Untitled49.c513cadd.png" alt="Untitled"></p> <p>进去后查询有多少个可执行版本的方法，再获取负载均衡的机制，之后继续doInvoke</p> <p><img src="/assets/img/Untitled50.c8de4caa.png" alt="Untitled"></p> <p>之后有个select能根据我们的负载均衡策略进行负载随机选择1个invoker</p> <p><img src="/assets/img/Untitled51.059eb3da.png" alt="Untitled"></p> <p>接下来调用invoker.invoke执行，到了真正要执行时还封装了一些filter，这个filter在最开始proxy代理对象要用invoker时会在外面封装filter来做（local、mock、cache）</p> <p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/local-mock/" target="_blank" rel="noopener noreferrer">https://dubbo.apache.org/zh/docsv2.7/user/examples/local-mock/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/result-cache/" target="_blank" rel="noopener noreferrer">https://dubbo.apache.org/zh/docsv2.7/user/examples/result-cache/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>缓存功能时，然后invoker选中了负载均衡功能后，又进入filter，filter就是各个统计信息（监控中心等）ProtocolFilter，ProtocolFilter里封装到最终时DubboInvoker.</p> <p><img src="/assets/img/Untitled52.bc71cde4.png" alt="Untitled"></p> <p><img src="/assets/img/Untitled53.0960c368.png" alt="Untitled"></p> <p><img src="/assets/img/Untitled54.0852dbdc.png" alt="Untitled"></p> <p>在DubboInvoker中获取到在服务引用时建立的客户端，拿到引用的哪个远程服务，之后再request发起请求，返回结果。这里request就已经进入到底层了。之后拿客户端，拿通道。</p> <p><img src="/assets/img/Untitled55.0a519675.png" alt="Untitled"></p> <p><img src="/assets/img/Untitled56.deea738b.png" alt="Untitled"></p> <p><img src="/assets/img/Untitled57.7f1625cb.png" alt="Untitled"></p> <p>然后给通道发送出去。</p> <p><img src="/assets/img/Untitled58.42786fd0.png" alt="Untitled"></p> <p>之后返回拿到返回结果对象，里面封装了结果数据</p> <p><img src="/assets/img/Untitled59.00b792c5.png" alt="Untitled"></p> <p>返回返回， 之后打印到控制台。</p> <p><img src="/assets/img/Untitled60.84b6f0a8.png" alt="Untitled"></p> <h1 id="_5-结束语"><a href="#_5-结束语" class="header-anchor">#</a> 5.结束语</h1> <p>祝大家学业有成</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/1/15 下午2:19:19</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/md/java/learn/learn-elasticstack.html" class="prev">
        Elasticstack
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1f563e48.js" defer></script><script src="/assets/js/3.53f669bd.js" defer></script><script src="/assets/js/2.a4f6f631.js" defer></script>
  </body>
</html>
