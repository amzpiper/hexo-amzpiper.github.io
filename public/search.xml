<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Elasticstack学习笔记</title>
      <link href="/2021/08/13/learn-elasticstack/"/>
      <url>/2021/08/13/learn-elasticstack/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Elasticsearch产品简介"><a href="#1-Elasticsearch产品简介" class="headerlink" title="1.Elasticsearch产品简介"></a>1.Elasticsearch产品简介</h1><p><a href="https://www.elastic.co/cn/elastic-stack/">https://www.elastic.co/cn/elastic-stack/</a></p><p><img src="Untitled.png" alt="Untitled.png"></p><p>文档：<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html">https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html</a></p><h1 id="2-Elasticsearch与Kibana入门"><a href="#2-Elasticsearch与Kibana入门" class="headerlink" title="2.Elasticsearch与Kibana入门"></a>2.Elasticsearch与Kibana入门</h1><h2 id="2-1-安装与运行"><a href="#2-1-安装与运行" class="headerlink" title="2.1.安装与运行"></a>2.1.安装与运行</h2><h3 id="2-1-1-安装JDK1-8"><a href="#2-1-1-安装JDK1-8" class="headerlink" title="2.1.1.安装JDK1.8"></a>2.1.1.安装JDK1.8</h3><h3 id="2-1-2-下载安装Elasticsearch"><a href="#2-1-2-下载安装Elasticsearch" class="headerlink" title="2.1.2.下载安装Elasticsearch"></a>2.1.2.下载安装Elasticsearch</h3><p><a href="https://www.elastic.co/cn/">https://www.elastic.co/cn/</a></p><p><a href="https://www.elastic.co/cn/elastic-stack/">https://www.elastic.co/cn/elastic-stack/</a></p><p><a href="https://www.elastic.co/cn/elasticsearch/">https://www.elastic.co/cn/elasticsearch/</a></p><p><img src="Untitled%201.png" alt="Untitled%201.png"></p><p><a href="http://localhost:9200/">http://localhost:9200/</a></p><h3 id="2-1-3-配置Elasticsearch"><a href="#2-1-3-配置Elasticsearch" class="headerlink" title="2.1.3.配置Elasticsearch"></a>2.1.3.配置Elasticsearch</h3><p><img src="Untitled%202.png" alt="Untitled%202.png"></p><p>配置启动时JVM参数:</p><p>-Xms2g</p><p>-Xms2g</p><p><img src="Untitled%203.png" alt="Untitled%203.png"></p><p>运行有两种模式：</p><p><img src="Untitled%204.png" alt="Untitled%204.png"></p><h3 id="2-1-4-配置启动Elasticsearch集群"><a href="#2-1-4-配置启动Elasticsearch集群" class="headerlink" title="2.1.4.配置启动Elasticsearch集群"></a>2.1.4.配置启动Elasticsearch集群</h3><p><img src="Untitled%205.png" alt="Untitled%205.png"></p><p>./elasticsearch.bat </p><p>./elasticsearch.bat -Ehttp.port=8200 -Epath.data=node2</p><p>./elasticsearch.bat -Ehttp.port=7200 -Epath.data=node3</p><p><a href="http://localhost:9200/_cat/nodes?v">http://localhost:9200/_cat/nodes?v</a></p><p><a href="http://localhost:9200/_cat/nodes?v">http://localhost:9200/_cat/nodes</a></p><p>*为主节点</p><p><a href="http://localhost:9200/_cat/nodes?v">http://localhost:9200/_</a>cluster/stats</p><h3 id="2-1-5-Kibana安装与运行"><a href="#2-1-5-Kibana安装与运行" class="headerlink" title="2.1.5.Kibana安装与运行"></a>2.1.5.Kibana安装与运行</h3><p><a href="https://www.elastic.co/cn/kibana/">https://www.elastic.co/cn/kibana/</a></p><p><a href="https://www.elastic.co/cn/downloads/kibana">https://www.elastic.co/cn/downloads/kibana</a></p><p><img src="Untitled%206.png" alt="Untitled%206.png"></p><h3 id="2-1-6-Kibana配置"><a href="#2-1-6-Kibana配置" class="headerlink" title="2.1.6.Kibana配置"></a>2.1.6.Kibana配置</h3><p><img src="Untitled%207.png" alt="Untitled%207.png"></p><h3 id="2-1-7-Kibana常用功能"><a href="#2-1-7-Kibana常用功能" class="headerlink" title="2.1.7.Kibana常用功能"></a>2.1.7.Kibana常用功能</h3><p><img src="Untitled%208.png" alt="Untitled%208.png"></p><h3 id="2-1-8-Elasticsearch常用术语"><a href="#2-1-8-Elasticsearch常用术语" class="headerlink" title="2.1.8.Elasticsearch常用术语"></a>2.1.8.Elasticsearch常用术语</h3><p>Document文档数据</p><p>Index索引，理解成Mysql的数据库,Document都存储在Index中</p><p>Type索引中的数据类型，为myslq表的数据类型，简单理解为table</p><p>Field字段，文档的属性</p><p>Query DSL查询语法</p><h3 id="2-1-9-Elasticsearch-CRUD操作"><a href="#2-1-9-Elasticsearch-CRUD操作" class="headerlink" title="2.1.9.Elasticsearch CRUD操作"></a>2.1.9.Elasticsearch CRUD操作</h3><p><strong>创建：</strong></p><p><img src="Untitled%209.png" alt="Untitled%209.png"></p><p>accounts 为Index，person为Type</p><p>我们在accounts 这个Index的下面person为Type的下面创建1个id为1的文档.name…等都是文档字段。</p><p>使用Kibana的Dev Tools运行。</p><p><img src="Untitled%2010.png" alt="Untitled%2010.png"></p><p><strong>读取：</strong></p><p><img src="Untitled%2011.png" alt="Untitled%2011.png"></p><p><img src="Untitled%2012.png" alt="Untitled%2012.png"></p><p><strong>修改：</strong></p><p><img src="Untitled%2013.png" alt="Untitled%2013.png"></p><p><img src="Untitled%2014.png" alt="Untitled%2014.png"></p><p><strong>删除：</strong></p><p><img src="Untitled%2015.png" alt="Untitled%2015.png"></p><p><img src="Untitled%2016.png" alt="Untitled%2016.png"></p><h3 id="2-1-10-Elasticsearch-查询操作"><a href="#2-1-10-Elasticsearch-查询操作" class="headerlink" title="2.1.10.Elasticsearch 查询操作"></a>2.1.10.Elasticsearch 查询操作</h3><p><strong>有2种形势:</strong></p><ol><li>Query String:</li></ol><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">GET /accounts/person/_search?q=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span> : <span class="number">989</span>,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span> : <span class="number">1.0</span>,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_type&quot;</span> : <span class="string">&quot;person&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_score&quot;</span> : <span class="number">1.0</span>,</span><br><span class="line">        <span class="string">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span> : <span class="string">&quot;yuhang&quot;</span>,</span><br><span class="line">          <span class="string">&quot;age&quot;</span> : <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>Query DSL:</li></ol><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">GET /accounts/person/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>:<span class="string">&quot;yuhang&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span> : <span class="number">997</span>,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span> : <span class="number">0.18232156</span>,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_type&quot;</span> : <span class="string">&quot;person&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_score&quot;</span> : <span class="number">0.18232156</span>,</span><br><span class="line">        <span class="string">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span> : <span class="string">&quot;yuhang&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;accounts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_type&quot;</span> : <span class="string">&quot;person&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_score&quot;</span> : <span class="number">0.18232156</span>,</span><br><span class="line">        <span class="string">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span> : <span class="string">&quot;yuhang&quot;</span>,</span><br><span class="line">          <span class="string">&quot;age&quot;</span> : <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-Beats入门"><a href="#3-Beats入门" class="headerlink" title="3.Beats入门"></a>3.Beats入门</h1><h2 id="3-1-Beats简介"><a href="#3-1-Beats简介" class="headerlink" title="3.1.Beats简介"></a>3.1.Beats简介</h2><p>Beats 是一个免费且开放的平台，集合了多种单一用途数据采集器。它们从成百上千或成千上万台机器和系统向 Logstash 或 Elasticsearch 发送数据。</p><p><a href="https://www.elastic.co/cn/beats/">https://www.elastic.co/cn/beats/</a></p><p>产品系列：</p><p><img src="Untitled%2017.png" alt="Untitled%2017.png"></p><p>FILEBEAT：无论您是从安全设备、云、容器、主机还是 OT 进行数据收集，Filebeat 都将为您提供一种轻量型方法，用于转发和汇总日志与文件，让简单的事情不再繁杂。</p><p>METRICBEAT：用于从系统和服务收集指标。Metricbeat 能够以一种轻量型的方式，输送各种系统和服务统计数据，从 CPU 到内存，从 Redis 到 Nginx，不一而足。</p><p>PACKETBEAT：监测网络流量对于获得可观测性和保护环境至关重要，有助于确保高水平的性能和安全性。Packetbeat 是一款轻量型网络数据包分析器，能够将主机和容器中的数据发送至 Logstash 或 Elasticsearch。抓包分析服务器网络。</p><p>WINLOGBEAT：用于密切监控基于 Windows 的基础设施上发生的事件。使用 Winlogbeat，将 Windows 事件日志流式传输至 Elasticsearch 和 Logstash。</p><p>HEARTBEAT：通过主动探测来监测服务的可用性。通过给定 URL 列表，Heartbeat 仅仅询问：网站运行正常吗？Heartbeat 会将此信息和响应时间发送至 Elastic 的其他部分，以进行进一步分析。健康检查。</p><p>地位：</p><p><img src="Untitled%2018.png" alt="Untitled%2018.png"></p><p>Beats把所有数据直接传输给elasticsearch，或者传输给logstash处理转换后再传入elasticsearch。最后通过kibana做可视化展示。</p><h2 id="3-2-Filebeat简介"><a href="#3-2-Filebeat简介" class="headerlink" title="3.2.Filebeat简介"></a>3.2.Filebeat简介</h2><p>filebeat 不需要知道 master 节点，你给 filebeat 的是 data 节点地址即可，不必给 master 节点地址</p><h3 id="3-2-1-处理流程"><a href="#3-2-1-处理流程" class="headerlink" title="3.2.1.处理流程"></a>3.2.1.处理流程</h3><ul><li>输入Input</li><li>处理Filter</li><li>输出Output</li></ul><h3 id="3-2-2-构成"><a href="#3-2-2-构成" class="headerlink" title="3.2.2.构成"></a>3.2.2.构成</h3><p><img src="Untitled%2019.png" alt="Untitled%2019.png"></p><p><strong>Prospector:</strong></p><p>针对配置的日志文件探测文件是否有变化，有变化就收集新的日志。1个Filebeat可以有多个Prospector。Prospector 1针对/var/log/*.log所有log文件。Prospector 2针对/var/log/apache2/*下的所有文件。</p><p><strong>Harvester:</strong></p><p>每个Prospector针对自己匹配的日志文件会为每一个日志文件启动1个Harvester。</p><h3 id="3-2-2-Filebeat-Input配置"><a href="#3-2-2-Filebeat-Input配置" class="headerlink" title="3.2.2.Filebeat Input配置"></a>3.2.2.Filebeat Input配置</h3><p>yaml语法：</p><p><img src="Untitled%2020.png" alt="Untitled%2020.png"></p><p>input_type为数据输入类型，目前有2个类型：log、stdin</p><p>paths是指定位置</p><h3 id="3-2-3-Filebeat-Output配置"><a href="#3-2-3-Filebeat-Output配置" class="headerlink" title="3.2.3.Filebeat Output配置"></a>3.2.3.Filebeat Output配置</h3><p><strong>支持输出对象类型：</strong></p><ul><li>console</li><li>elasticsearch</li><li>logstach</li><li>kafka</li><li>redis</li><li>file</li></ul><p>配置为elasticsearch和console：</p><p><img src="Untitled%2021.png" alt="Untitled%2021.png"></p><h3 id="3-2-4-Filebeat-Filter配置简介"><a href="#3-2-4-Filebeat-Filter配置简介" class="headerlink" title="3.2.4.Filebeat Filter配置简介"></a>3.2.4.Filebeat Filter配置简介</h3><p><img src="Untitled%2022.png" alt="Untitled%2022.png"></p><p>Include_lines:当达到这个条件就读入这一行。</p><p>exclude_lines:当达到这个条件就不读这一行。</p><p>exclude_files:当达到这个条件就不读这文件。</p><p>drop_event:当满足这一条件就不输出，直接扔掉</p><p>drop_fields:当满足这一条件就不输出，把某一字段扔掉</p><p>drop_event:当满足这一条件就不输出，直接扔掉</p><p>drop_event:当满足这一条件就不输出，直接扔掉</p><p>Decode_json_fields:对于这条数据里面符合json格式的字段做json解析</p><p>Include_fields:加入一些字段或只想取数据里面的某一些字段</p><p>例子：</p><p>1.当DBG开头的就丢掉，把debbug日志丢弃</p><p><img src="Untitled%2023.png" alt="Untitled%2023.png"></p><p>2.inner后数据是字符串需要做json处理，恢复正常json格式</p><p><img src="Untitled%2024.png" alt="Untitled%2024.png"></p><p>新特性：</p><p><img src="Untitled%2025.png" alt="Untitled%2025.png"></p><h3 id="3-2-5-Filebeat-Module简介"><a href="#3-2-5-Filebeat-Module简介" class="headerlink" title="3.2.5.Filebeat Module简介"></a>3.2.5.Filebeat Module简介</h3><p><img src="Untitled%2026.png" alt="Untitled%2026.png"></p><h3 id="3-2-6-Filebeat-收集Nginx日志实践"><a href="#3-2-6-Filebeat-收集Nginx日志实践" class="headerlink" title="3.2.6.Filebeat 收集Nginx日志实践"></a>3.2.6.Filebeat 收集Nginx日志实践</h3><p>通过stdin收集日志，通过console输出 </p><p>1.下载Filebeat</p><p><a href="https://www.elastic.co/cn/downloads/beats/filebeat">https://www.elastic.co/cn/downloads/beats/filebeat</a></p><p><a href="https://www.elastic.co/cn/downloads/beats/filebeat">filebeat</a>是基于go-lang开发的</p><p>2.配置filebeat.yml</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># ============================== Filebeat inputs ===============================</span><br><span class="line"></span><br><span class="line">filebeat.inputs:</span><br><span class="line"></span><br><span class="line"># Each - is an input. Most options can be set at the input level, so</span><br><span class="line"># you can use different inputs for various configurations.</span><br><span class="line"># Below are the input specific configurations.</span><br><span class="line"></span><br><span class="line">- type: log</span><br><span class="line"></span><br><span class="line">  # Change to true to enable this input configuration.</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  # Paths that should be crawled and fetched. Glob based paths.</span><br><span class="line">  paths:</span><br><span class="line">    #- /var/log/*.log</span><br><span class="line">    #- c:\programdata\elasticsearch\logs\*</span><br><span class="line">    - D:\Application\elasticsearch-<span class="number">7.14</span><span class="number">.0</span>\logs\elasticsearch.log</span><br><span class="line"></span><br><span class="line"># ------------------------------- Console Output -------------------------------</span><br><span class="line">output.console:</span><br><span class="line">  # Boolean flag to enable or disable the output module.</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  # Configure JSON encoding</span><br><span class="line">  codec.json:</span><br><span class="line">    # Pretty-print JSON event</span><br><span class="line">    pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    # Configure escaping HTML symbols in strings.</span><br><span class="line">    #escape_html: <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="3-3-Packetbeat简介"><a href="#3-3-Packetbeat简介" class="headerlink" title="3.3.Packetbeat简介"></a>3.3.Packetbeat简介</h2><p><img src="Untitled%2027.png" alt="Untitled%2027.png"></p><p><img src="Untitled%2028.png" alt="Untitled%2028.png"></p><p><img src="Untitled%2029.png" alt="Untitled%2029.png"></p><p>-strict.perms=false不检查权限，方便运行</p><h1 id="4-Logstach入门"><a href="#4-Logstach入门" class="headerlink" title="4.Logstach入门"></a>4.Logstach入门</h1><h2 id="4-1-Logstach简介"><a href="#4-1-Logstach简介" class="headerlink" title="4.1.Logstach简介"></a>4.1.Logstach简介</h2><p>Data Shipper,ETL,Extract,Transform,Load</p><p><a href="https://www.elastic.co/cn/logstash/">https://www.elastic.co/cn/logstash/</a></p><p>集中、转换和存储数据</p><p>Logstash 是免费且开放的服务器端数据处理管道，能够从多个来源采集数据，转换数据，然后将数据发送到您最喜欢的“存储库”中。</p><h2 id="4-2-Logstach处理流程"><a href="#4-2-Logstach处理流程" class="headerlink" title="4.2.Logstach处理流程"></a>4.2.Logstach处理流程</h2><p>Input：file、redis、beats、kafka</p><p>Filter：grok(表达式，类似正则)、mutate(结构化后数据增删改查)、drop、date</p><p>Output：stdout、elasticsearch、kakfa、redis</p><h2 id="4-3-Logstach配置"><a href="#4-3-Logstach配置" class="headerlink" title="4.3.Logstach配置"></a>4.3.Logstach配置</h2><h3 id="4-3-1-处理流程—input和output配置"><a href="#4-3-1-处理流程—input和output配置" class="headerlink" title="4.3.1.处理流程—input和output配置"></a>4.3.1.处理流程—input和output配置</h3><p><img src="Untitled%2030.png" alt="Untitled%2030.png"></p><h3 id="4-3-2-处理流程—Filter配置"><a href="#4-3-2-处理流程—Filter配置" class="headerlink" title="4.3.2.处理流程—Filter配置"></a>4.3.2.处理流程—Filter配置</h3><p><img src="Untitled%2031.png" alt="Untitled%2031.png"></p><p><img src="Untitled%2032.png" alt="Untitled%2032.png"></p><h1 id="5-实战：分析Elasticsearch查询语句"><a href="#5-实战：分析Elasticsearch查询语句" class="headerlink" title="5.实战：分析Elasticsearch查询语句"></a>5.实战：分析Elasticsearch查询语句</h1><h2 id="5-1-目标"><a href="#5-1-目标" class="headerlink" title="5.1.目标"></a>5.1.目标</h2><p>收集Elasticsearch集群的查询语句</p><p>分析查询语句的常用语句、响应时长等</p><h2 id="5-2-方案"><a href="#5-2-方案" class="headerlink" title="5.2.方案"></a>5.2.方案</h2><p>应用Packetbeat + Logstash完成数据收集工作</p><p>使用Kibana + Elasticsearch完成数据分析工作</p><p><img src="Untitled%2033.png" alt="Untitled%2033.png"></p><h2 id="5-3-环境配置"><a href="#5-3-环境配置" class="headerlink" title="5.3.环境配置"></a>5.3.环境配置</h2><p><img src="Untitled%2034.png" alt="Untitled%2034.png"></p><h2 id="5-4-方案之logstach"><a href="#5-4-方案之logstach" class="headerlink" title="5.4.方案之logstach"></a>5.4.方案之logstach</h2><p><img src="Untitled%2035.png" alt="Untitled%2035.png"></p><h2 id="5-5-方案之packetbeat"><a href="#5-5-方案之packetbeat" class="headerlink" title="5.5.方案之packetbeat"></a>5.5.方案之packetbeat</h2><p><img src="Untitled%2036.png" alt="Untitled%2036.png"></p><h2 id="5-6-kibana数据分析"><a href="#5-6-kibana数据分析" class="headerlink" title="5.6.kibana数据分析"></a>5.6.kibana数据分析</h2><p><img src="Untitled%2037.png" alt="Untitled%2037.png"></p><p><img src="Untitled%2038.png" alt="Untitled%2038.png"></p><h1 id="6-总结与建议"><a href="#6-总结与建议" class="headerlink" title="6.总结与建议"></a>6.总结与建议</h1><p><img src="Untitled%2039.png" alt="Untitled%2039.png"></p><p><img src="Untitled%2040.png" alt="Untitled%2040.png"></p>]]></content>
      
      
      <categories>
          
          <category> 中间件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> elasticstack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dubbo学习笔记</title>
      <link href="/2021/08/13/Dubbo%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2021/08/13/Dubbo%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="一、基本知识"><a href="#一、基本知识" class="headerlink" title="一、基本知识"></a>一、基本知识</h1><h2 id="1-分布式基础理论"><a href="#1-分布式基础理论" class="headerlink" title="1 分布式基础理论"></a>1 分布式基础理论</h2><h3 id="1-1什么是分布式"><a href="#1-1什么是分布式" class="headerlink" title="1.1什么是分布式"></a>1.1什么是分布式</h3><p>分布式系统是若干个独立计算机的集合，，计算机对于用户来说就像个单个系统，建立在网络上的软件系统。</p><p>随着互联网的发展，规模不断扩大，垂直应用架构无法应付，需要一个治理系统确保架构有条不紊的演进。</p><p>dubbo作用：治理和维护各个分系统。</p><h3 id="1-2-发展演变："><a href="#1-2-发展演变：" class="headerlink" title="1.2 发展演变："></a>1.2 发展演变：</h3><p><img src="Untitled.png" alt="Untitled.png"></p><p><strong>单一应用架构：</strong></p><p>流量小时，所有功能放到一起，减少部署节点和成本。</p><p><img src="Untitled%201.png" alt="Untitled%201.png"></p><p>缺点：</p><p>扩展不容易，需要重新打包重新部署</p><p>协同开发不容易</p><p>扩大性能提升不容易</p><p><strong>垂直应用架构：</strong></p><p>小功能独立为单个应用，部署在多个服务器上</p><p><img src="Untitled%202.png" alt="Untitled%202.png"></p><p>优点：</p><p>分工合作容易，分别负责开发</p><p>性能扩展容易，多部署到几个服务器</p><p>缺点：</p><p>单个应用从头到尾都有的，包括页面逻辑和数据库。但是市场上界面改变快，改了需要重新部署，没法做到页面和业务逻辑的分离</p><p>垂直应用越来越多，不可能完全应用于应用完全独立。用户调用订单和商品，物流调用订单等。应用之间需要交互</p><p><strong>分布式服务架构：</strong></p><p>核心业务单独抽取出来，用户应用抽取为页面和业务逻辑。当业务逻辑不变时只改界面，界面重新部署就行了。</p><p><img src="Untitled%203.png" alt="Untitled%203.png"></p><p>问题：</p><p>用户web可能再A服务器上，业务再B服务器。如果A服务器调用B服务器功能时，因为不在一个进程内，分隔异地了，这2个代码调用需要RPC远程过程调用。</p><p>难点：</p><p>如何远程过程调用</p><p>如何拆分业务，增加业务的复用程度</p><p>好的分布式服务框架（RPC），应该有调度中心，来实时的监控业务中心实现动态调度，增加利用率，当某一个业务调用多了，可以让更多的服务器来跑业务量更大的业务，这是用流动计算架构</p><p><strong>流动计算架构：</strong></p><p><img src="Untitled%204.png" alt="Untitled%204.png"></p><p>它负责维护业务之间复杂的关系，以及实时管理服务集群，当A访问量大了，可以多来几台服务器。而且多个A服务器中按照访问量动态调用，以此来提高集群的利用率。</p><h3 id="1-3-RPC"><a href="#1-3-RPC" class="headerlink" title="1.3 RPC"></a>1.3 RPC</h3><p><strong>什么叫RPC</strong></p><p>远程过程调用，A服务器调用B服务器上功能。是一种技术思想，不是规范。它允许程序调用另一个共享空间（通常是共享网络的另一台服务器）上的过程或函数。而不是程序员显示编码这个远程调用的细节。即程序员无论调用本地的还是远程的函数，本质上编写的调用代码基本相同。</p><p><strong>RPC基本原理</strong></p><p><img src="Untitled%205.png" alt="Untitled%205.png"></p><p>clent functions想调用server functions时，通过小助手请求，通过sockets创建和server的sockets连接，将想调用的信息传递个server服务器，server小助手收到信息后确定调用函数，server用传递过来的信息调用自己方法后把返回值再通过网络sockets返回给client</p><p>A和B架起网络连接后调用</p><p><strong>例子：</strong></p><p><img src="Untitled%206.png" alt="Untitled%206.png"></p><p>A调用B时传递对象需要序列化，B先反序列化为对象，B服务器调用一下，拿到返回值，通过网络传输，序列化后传输给A服务器，A服务器需要反序列化后拿到返回值。</p><p><strong>调用核心：</strong></p><p>AB两个需要建立连接</p><p>传递数据需要序列化和反序列化</p><p><strong>决定性能有两点：</strong></p><p>看RPC能否快速建立连接</p><p>序列化于反序列化是否快</p><p><strong>RPC框架：</strong></p><p>dubbo、gRPC、Thrift、HSF</p><p>思想相同，用法不同</p><h2 id="2-dubbo核心概念"><a href="#2-dubbo核心概念" class="headerlink" title="2 dubbo核心概念"></a>2 dubbo核心概念</h2><h3 id="2-1-简介"><a href="#2-1-简介" class="headerlink" title="2.1 简介"></a>2.1 简介</h3><p>Apache Dubbo 是一款高性能、轻量级的开源 Java 服务框架</p><p>注：rpc面向服务、cloud的是restful面向资源</p><p>14.10停止更新，18.1将dubbo和dubbox合并后发布为2.6版本，最终将dubbo开放到apache。</p><p>netty功能负责网络传输，dubbo使用netty作为网络传输框架。说到网络传输自然离不开Socket，Socket是端到端的连接。dubbo是无中心化，每个client端都能与server端连接，每个client端同时又是server端。</p><p><strong>特性：</strong></p><p>1.<strong>面向接口代理的高性能RPC调用</strong></p><p>提供高性能的基于代理的远程调用能力，服务以接口为粒度，为开发者屏蔽远程调用底层细节。</p><p>A调用B只需要将接口拿来调用，dubbo会自动的找B服务器的这段代码，屏蔽了整个调用细节。</p><p>类似Mybatis，调用数据库是只需要写do-mapping接口，调用接口方法就行了。</p><p><strong>2.智能负载均衡</strong></p><p>内置多种负载均衡策略，智能感知下游节点健康状况，显著减少调用延迟，提高系统吞吐量。</p><p>一个服务1台服务器不够时部署多台后，会自动找空闲服务器运行。</p><p>不会压垮某一台服务器，也不会让某服务器太闲浪费资源。</p><p><strong>3.服务自动注册与发现</strong></p><p>支持多种注册中心服务，服务实例上下线实时感知。</p><p>业务非常多，订单调用支付业务时如何知道业务服务器是否知道有问题切在哪，为了动态感知，将所有程序注册到注册中心，维护注册清单。调用时会问一下调用的服务在哪个服务器，选择请求量最小的。建立通信，进行远程调用。</p><p><strong>4.高度可扩展能力</strong></p><p>遵循微内核+插件的设计原则，所有核心能力如Protocol、Transport、Serialization被设计为扩展点，平等对待内置实现和第三方实现。</p><p>所有东西都可扩展。</p><p><strong>5.运行期流量调度</strong></p><p>内置条件、脚本等路由策略，通过配置不同的路由规则，轻松实现灰度发布，同机房优先等功能。</p><p>灰度发布：比如有个用户服务，现在在100台上服务器在跑，用户服务做了升级，害怕升级不稳定，可以先选定20台服务器，让他们用新版本的用户服务，剩下80台用旧版本的用户服务。等20台用的没问题了，再选20台，一点一点增加，知道100台都过度到新版本用户服务。可以配置不同路由规则，请求进来后一部分用新版本服务。慢慢从旧服务转变到新服务的过程。</p><p><strong>6.可视化的服务治理与运维</strong></p><p>提供丰富服务治理、运维工具：随时查询服务元数据、服务健康状态及调用统计，实时下发路由策略、调整配置参数。</p><p>可以随时查询服务的信息、健康状况、调用统计记录等等。通过可视化界面。</p><h3 id="2-2-dubbo设计架构"><a href="#2-2-dubbo设计架构" class="headerlink" title="2.2 dubbo设计架构"></a>2.2 dubbo设计架构</h3><p><img src="Untitled%207.png" alt="Untitled%207.png"></p><p><a href="https://www.notion.so/6c6f03ae75794978a31ec967f82fec02">节点角色说明</a></p><p><strong>运行流程</strong></p><ol><li>服务容器负责启动，加载，运行服务提供者。</li><li>服务提供者在启动时，向注册中心注册自己提供的服务。</li><li>服务消费者在启动时，向注册中心订阅自己所需的服务。当某一个提供者下线了，基于长连接方式，将这个变更推送给消费者，可以实时知道有一个提供者不能调用了。当消费者拿到所有可以调的服务后，可以调用提供者提供的服务，调用时根据负载均衡算法选择一个提供者调用。</li><li>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</li><li>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</li><li>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</li></ol><p>Dubbo 架构具有以下几个特点，分别是连通性、健壮性、伸缩性、以及向未来架构的升级性。</p><p>0、1、2是初始时启动完成的，第3、5布是异步的。第4步是同步调用。</p><p>应先创建提供者，注册到注册中心，再编写消费者，消费者从注册中心调用提供者。然后再编写消费者如何消费提供者提供的功能。</p><p><strong>连通性<a href="https://dubbo.apache.org/zh/docs/v2.7/user/preface/architecture/#%E8%BF%9E%E9%80%9A%E6%80%A7"></a></strong></p><ul><li>注册中心负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小</li><li>监控中心负责统计各服务调用次数，调用时间等，统计先在内存汇总后每分钟一次发送到监控中心服务器，并以报表展示</li><li>服务提供者向注册中心注册其提供的服务，并汇报调用时间到监控中心，此时间不包含网络开销</li><li>服务消费者向注册中心获取服务提供者地址列表，并根据负载算法直接调用提供者，同时汇报调用时间到监控中心，此时间包含网络开销</li><li>注册中心，服务提供者，服务消费者三者之间均为长连接，监控中心除外</li><li>注册中心通过长连接感知服务提供者的存在，服务提供者宕机，注册中心将立即推送事件通知消费者</li><li>注册中心和监控中心全部宕机，不影响已运行的提供者和消费者，消费者在本地缓存了提供者列表</li><li>注册中心和监控中心都是可选的，服务消费者可以直连服务提供者</li></ul><p><strong>健壮性</strong></p><ul><li>监控中心宕掉不影响使用，只是丢失部分采样数据</li><li>数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务</li><li>注册中心对等集群，任意一台宕掉后，将自动切换到另一台</li><li>注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通讯</li><li>服务提供者无状态，任意一台宕掉后，不影响使用</li><li>服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复</li></ul><p><strong>伸缩性</strong></p><ul><li>注册中心为对等集群，可动态增加机器部署实例，所有客户端将自动发现新的注册中心</li><li>服务提供者无状态，可动态增加机器部署实例，注册中心将推送新的服务提供者信息给消费者</li></ul><p><strong>升级性<a href="https://dubbo.apache.org/zh/docs/v2.7/user/preface/architecture/#%E5%8D%87%E7%BA%A7%E6%80%A7"></a></strong></p><p>当服务集群规模进一步扩大，带动IT治理结构进一步升级，需要实现动态部署，进行流动计算，现有分布式服务架构不会带来阻力。</p><h2 id="3-dubbo环境搭建"><a href="#3-dubbo环境搭建" class="headerlink" title="3 dubbo环境搭建"></a>3 dubbo环境搭建</h2><h3 id="3-1-搭建Zookeeper注册中心"><a href="#3-1-搭建Zookeeper注册中心" class="headerlink" title="3.1 搭建Zookeeper注册中心"></a>3.1 搭建Zookeeper注册中心</h3><p><strong>3.1.1 安装jdk</strong></p><p>上传jdk包到/opt/software</p><p>tar -zxvf jdk-8u291-linux-x64.tar.gz</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> JAVA_HOME=<span class="regexp">/opt/</span>software/jdk1<span class="number">.8</span><span class="number">.0_291</span>/  #jdk安装目录</span><br><span class="line"><span class="keyword">export</span> JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line"><span class="keyword">export</span> CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib:$CLASSPATH</span><br><span class="line"><span class="keyword">export</span> JAVA_PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;JRE_HOME&#125;/bin</span><br><span class="line"><span class="keyword">export</span> PATH=$PATH:$&#123;JAVA_PATH&#125;</span><br></pre></td></tr></table></figure><p><strong>3.1.2安装zookeeper</strong></p><p>拷贝到/opt/software</p><p>解压</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-zookeeper-<span class="number">3.7</span><span class="number">.0</span>.tar.gz</span><br></pre></td></tr></table></figure><p><strong>3.1.3修改zookeeper配置</strong></p><p>将”/opt/software/apache-zookeeper-3.7.0/conf/zoo_sample.cfg”拷贝份zoo.cfg</p><p>打开zoo.cfg，修改vim zoo.cfg</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataDir=<span class="regexp">/opt/</span>software/apache-zookeeper-<span class="number">3.7</span><span class="number">.0</span>/zkData/</span><br></pre></td></tr></table></figure><p><strong>3.1.4操作zookeeper</strong></p><p>(1) 启动zookeeper</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/software/apache-zookeeper-<span class="number">3.7</span><span class="number">.0</span>/bin</span><br><span class="line">./zkServer.sh start</span><br></pre></td></tr></table></figure><p>(2) 查看进程</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jps</span><br><span class="line">./zkServer.sh status</span><br></pre></td></tr></table></figure><p>(3)启动客户端</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./zkCli.sh</span><br><span class="line">quit</span><br></pre></td></tr></table></figure><p>(4) 关闭zookeeper</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./zkServer.sh stop</span><br></pre></td></tr></table></figure><h3 id="3-2-搭建监控中心"><a href="#3-2-搭建监控中心" class="headerlink" title="3.2. 搭建监控中心"></a>3.2. 搭建监控中心</h3><p><a href="https://github.com/apache/dubbo-admin">https://github.com/apache/dubbo-admin</a></p><p>root</p><p>root</p><p>3.2.1 <strong>服务治理</strong></p><p>服务治理的部分，按照Dubbo 2.7的格式进行配置，同时兼容Dubbo 2.6，详见<a href="https://github.com/apache/dubbo-admin/wiki/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E5%85%BC%E5%AE%B9%E6%80%A7%E8%AF%B4%E6%98%8E">这里</a></p><p>3.2.2 <strong>前端部分</strong></p><ul><li>使用<a href="https://vuejs.org/">Vue.js</a>作为javascript框架</li><li><a href="https://github.com/apache/dubbo-admin/blob/develop/dubbo-admin-ui/README.md">dubbo-admin-ui/README.md</a>中有更详细的介绍</li><li>设置 npm <strong>代理镜像</strong> : 如果遇到了网络问题，可以设置npm代理镜像来加速npm install的过程：在~/.npmrc中增加 <code>registry =https://registry.npm.taobao.org</code></li></ul><p>3.2.3 <strong>后端部分</strong></p><ul><li>标准spring boot工程</li><li><a href="https://github.com/apache/dubbo-admin/wiki/Dubbo-Admin%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E">application.properties配置说明</a></li></ul><p>3.2.4 <strong>生产环境配置</strong></p><ol><li><p>下载代码: <code>git clone https://github.com/apache/dubbo-admin.git</code></p></li><li><p>在 <code>dubbo-admin-server/src/main/resources/application.properties</code>中指定注册中心地址</p></li><li><p>构建</p><blockquote><p>mvn clean package -Dmaven.test.skip=true</p></blockquote></li><li><p>启动</p><ul><li><code>mvn --projects dubbo-admin-server spring-boot:run</code>或者</li><li><code>cd dubbo-admin-distribution/target; java -jar dubbo-admin-0.1.jar</code></li></ul></li><li><p>访问 <code>http://localhost:8080</code></p></li></ol><hr><p>3.2.5 <strong>开发环境配置</strong></p><ul><li>运行<code>dubbo admin server, dubbo admin server</code>是一个标准的spring boot项目, 可以在任何java IDE中运行它</li><li>运行<code>dubbo admin ui</code> <code>dubbo admin ui</code>由npm管理和构建，在开发环境中，可以单独运行: <code>npm run dev</code></li><li>页面访问 访问 <code>http://localhost:8081</code>, 由于前后端分开部署，前端支持热加载，任何页面的修改都可以实时反馈，不需要重启应用。</li></ul><p>3.2.6 <strong>Swagger 支持</strong></p><p>部署完成后，可以访问 <a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a> 来查看所有的restful api</p><h3 id="4-dubbo-helloworld"><a href="#4-dubbo-helloworld" class="headerlink" title="4 dubbo-helloworld"></a>4 dubbo-helloworld</h3><p><strong>4.1 需求</strong></p><p><img src="Untitled%208.png" alt="Untitled%208.png"></p><p><strong>4.2 工程架构</strong> </p><p><img src="Untitled%209.png" alt="Untitled%209.png"></p><p>服务化最佳实践</p><p><a href="https://dubbo.apache.org/zh/docs/v2.7/user/best-practice/">https://dubbo.apache.org/zh/docs/v2.7/user/best-practice/</a></p><p>分包：</p><p>建议将服务接口、服务模型、服务异常等均放在 API 包中，因为服务模型和异常也是 API 的一部分，这样做也符合分包原则：重用发布等价原则(REP)，共同重用原则(CRP)。</p><p>如果需要，也可以考虑在 API 包中放置一份 Spring 的引用配置，这样使用方只需在 Spring 加载过程中引用此配置即可。配置建议放在模块的包目录下，以免冲突，如：<code>com/alibaba/china/xxx/dubbo-reference.xml</code>。</p><p>粒度：</p><p>服务接口尽可能大粒度，每个服务方法应代表一个功能，而不是某功能的一个步骤，否则将面临分布式事务问题，Dubbo 暂未提供分布式事务支持。</p><p>服务接口建议以业务场景为单位划分，并对相近业务做抽象，防止接口数量爆炸。</p><p>不建议使用过于抽象的通用接口，如：<code>Map query(Map)</code>，这样的接口没有明确语义，会给后期维护带来不便。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="number">1</span>、指定当前服务/应用的名字（同样的服务名字相同，不要和别的服务同名） --&gt;</span><br><span class="line">&lt;dubbo:application name=<span class="string">&quot;user-service-provider&quot;</span>&gt;&lt;/dubbo:application&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- <span class="number">2</span>、指定注册中心的位置 --&gt;</span><br><span class="line">&lt;!-- <span class="xml"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://127.0.0.1:2181&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:registry</span>&gt;</span></span> --&gt;</span><br><span class="line">&lt;dubbo:registry protocol=<span class="string">&quot;zookeeper&quot;</span> address=<span class="string">&quot;127.0.0.1:2181&quot;</span>&gt;&lt;/dubbo:registry&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- <span class="number">3</span>、指定通信规则（通信协议？通信端口） --&gt;</span><br><span class="line">&lt;dubbo:protocol name=<span class="string">&quot;dubbo&quot;</span> port=<span class="string">&quot;20882&quot;</span>&gt;&lt;/dubbo:protocol&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- <span class="number">4</span>、暴露服务   ref：指向服务的真正的实现对象 --&gt;</span><br><span class="line">&lt;dubbo:service interface=<span class="string">&quot;gmall.service.OrderService&quot;</span></span><br><span class="line">ref=<span class="string">&quot;userServiceImpl01&quot;</span> timeout=<span class="string">&quot;1000&quot;</span> version=<span class="string">&quot;1.0.0&quot;</span>&gt;</span><br><span class="line">&lt;dubbo:method name=<span class="string">&quot;getUserAddressList&quot;</span> timeout=<span class="string">&quot;1000&quot;</span>&gt;&lt;/dubbo:method&gt;</span><br><span class="line">&lt;/dubbo:service&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--统一设置服务提供方的规则  --&gt;</span><br><span class="line">&lt;dubbo:provider timeout=<span class="string">&quot;1000&quot;</span>&gt;&lt;/dubbo:provider&gt;</span><br></pre></td></tr></table></figure><p><strong>4.3 创建模块</strong></p><p>1、gmall-interface：公共接口层（model，service，exception…）</p><p>作用：定义公共接口，也可以导入公共依赖</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、Bean模型</span><br><span class="line">package gmall.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户地址</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">lfy</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserAddress</span> <span class="title">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    private Integer id;</span><br><span class="line">    private <span class="built_in">String</span> userAddress; <span class="comment">//用户地址</span></span><br><span class="line">    private <span class="built_in">String</span> userId; <span class="comment">//用户id</span></span><br><span class="line">    private <span class="built_in">String</span> consignee; <span class="comment">//收货人</span></span><br><span class="line">    private <span class="built_in">String</span> phoneNum; <span class="comment">//电话号码</span></span><br><span class="line">    private <span class="built_in">String</span> isDefault; <span class="comment">//是否为默认地址    Y-是     N-否</span></span><br><span class="line"></span><br><span class="line">    public <span class="function"><span class="title">UserAddress</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public UserAddress(Integer id, <span class="built_in">String</span> userAddress, <span class="built_in">String</span> userId, <span class="built_in">String</span> consignee, <span class="built_in">String</span> phoneNum,</span><br><span class="line">                       <span class="built_in">String</span> isDefault) &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.userAddress = userAddress;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">        <span class="built_in">this</span>.consignee = consignee;</span><br><span class="line">        <span class="built_in">this</span>.phoneNum = phoneNum;</span><br><span class="line">        <span class="built_in">this</span>.isDefault = isDefault;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer <span class="function"><span class="title">getId</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setId</span>(<span class="params">Integer id</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getUserAddress</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setUserAddress</span>(<span class="params"><span class="built_in">String</span> userAddress</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userAddress = userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getUserId</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setUserId</span>(<span class="params"><span class="built_in">String</span> userId</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getConsignee</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> consignee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setConsignee</span>(<span class="params"><span class="built_in">String</span> consignee</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.consignee = consignee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getPhoneNum</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> phoneNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setPhoneNum</span>(<span class="params"><span class="built_in">String</span> phoneNum</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.phoneNum = phoneNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getIsDefault</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isDefault;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setIsDefault</span>(<span class="params"><span class="built_in">String</span> isDefault</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.isDefault = isDefault;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、OrderService 接口</span><br><span class="line">package gmall.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单服务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">guoyh</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date </span>2021/7/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public interface OrderService &#123;</span><br><span class="line"></span><br><span class="line">    public List&lt;UserAddress&gt; initOrder(<span class="built_in">String</span> userId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、UserService接口</span><br><span class="line">package gmall.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户服务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">guoyh</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date </span>2021/7/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public interface UserService &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按照用户id返回所有收货地址</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">userId</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return </span>List&lt;UserAddress&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public List&lt;UserAddress&gt; getUserAddressList(<span class="built_in">String</span> userId);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、user-service-provider：用户模块（对用户接口的实现）</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、pom.xml</span><br><span class="line">&lt;!-- 引入公共接口 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;gmall-interface&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、UserServiceImpl服务</span><br><span class="line">package com.atguigu.gmall.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> gmall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1、将服务提供者将服务注册到注册中心（暴漏服务）</span></span><br><span class="line"><span class="comment"> * 1) 导入dubbo依赖</span></span><br><span class="line"><span class="comment"> * 2、让服务消费者去注册中心订阅服务的服务地址</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">guoyh</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date </span>2021/7/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="title">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;UserAddress&gt; <span class="function"><span class="title">getUserAddressList</span>(<span class="params"><span class="built_in">String</span> userId</span>)</span> &#123;</span><br><span class="line">        UserAddress userAddressOne = <span class="keyword">new</span> UserAddress();</span><br><span class="line">        userAddressOne.setUserAddress(<span class="string">&quot;北京市区昌平&quot;</span>);</span><br><span class="line">        UserAddress userAddressTwo = <span class="keyword">new</span> UserAddress();</span><br><span class="line">        userAddressTwo.setUserAddress(<span class="string">&quot;天安门&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(userAddressOne, userAddressTwo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、user-service-consumer：订单模块（调用用户模块）</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、pom.xml</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;gmall-interface&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、OrderServiceImpl服务</span><br><span class="line">package com.atguigu.gmall.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> gmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> gmall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">guoyh</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date </span>2021/7/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@Service</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span> <span class="title">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;UserAddress&gt; <span class="function"><span class="title">initOrder</span>(<span class="params"><span class="built_in">String</span> userId</span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用户id:&quot;</span> + userId);</span><br><span class="line">        <span class="comment">// 1、查询用户收获地址</span></span><br><span class="line">        List&lt;UserAddress&gt; userAddressList = userService.getUserAddressList(userId);</span><br><span class="line">        <span class="keyword">for</span> (UserAddress address : userAddressList) &#123;</span><br><span class="line">            System.out.println(address.getUserAddress());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userAddressList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在这样是无法进行调用的。我们gmall-order-web引入了gmall-interface，但是interface的实现是gmall-user，我们并没有引入，而且实际他可能还在别的服务器中。</p><p><strong>4.4 使用dubbo改造</strong></p><p>1、改造user-service-provider作为服务提供者</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、pom.xml</span><br><span class="line">&lt;!-- 引入dubbo --&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/com.alibaba/dubbo --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;dubbo&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;<span class="number">2.6</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- 注册中心使用的是zookeeper，引入操作zookeeper的客户端端 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;<span class="number">2.12</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、配置提供者provider.xml</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:dubbo=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd</span></span><br><span class="line"><span class="string">http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- <span class="number">1</span>、指定当前服务/应用的名字（同样的服务名字相同，不要和别的服务同名） --&gt;</span><br><span class="line">    &lt;dubbo:application name=<span class="string">&quot;user-service-provider&quot;</span>&gt;&lt;/dubbo:application&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- <span class="number">2</span>、指定注册中心的位置 --&gt;</span><br><span class="line">    &lt;!-- <span class="xml"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://127.0.0.1:2181&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:registry</span>&gt;</span></span> --&gt;</span><br><span class="line">    &lt;dubbo:registry protocol=<span class="string">&quot;zookeeper&quot;</span> address=<span class="string">&quot;127.0.0.1:2181&quot;</span>&gt;&lt;/dubbo:registry&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- <span class="number">3</span>、指定通信规则（通信协议？通信端口） --&gt;</span><br><span class="line">    &lt;dubbo:protocol name=<span class="string">&quot;dubbo&quot;</span> port=<span class="string">&quot;20882&quot;</span>&gt;&lt;/dubbo:protocol&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- <span class="number">4</span>、暴露服务   ref：指向服务的真正的实现对象 --&gt;</span><br><span class="line">    &lt;dubbo:service interface=<span class="string">&quot;gmall.service.UserService&quot;</span></span><br><span class="line">                   ref=<span class="string">&quot;userServiceImpl&quot;</span> timeout=<span class="string">&quot;1000&quot;</span> version=<span class="string">&quot;1.0.0&quot;</span>&gt;</span><br><span class="line">        &lt;!--<span class="xml"><span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">&quot;getUserAddressList&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;1000&quot;</span>/&gt;</span></span>--&gt;</span><br><span class="line">    &lt;/dubbo:service&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 服务的真正实现 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userServiceImpl&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.atguigu.gmall.service.impl.UserServiceImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>启动服务</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="built_in">String</span>[] args) throws Exception &#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="keyword">new</span> <span class="built_in">String</span>[]&#123;<span class="string">&quot;provider.xml&quot;</span>&#125;);</span><br><span class="line">        context.start();</span><br><span class="line">        <span class="comment">//为了不让服务终止，在这阻塞读取一个字符</span></span><br><span class="line">        System.in.read(); <span class="comment">// 按任意键退出</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、改造user-service-consumer作为服务消费者</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、pom.xml</span><br><span class="line">&lt;!-- 引入dubbo --&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/com.alibaba/dubbo --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;dubbo&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;<span class="number">2.6</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- 注册中心使用的是zookeeper，引入操作zookeeper的客户端端 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;<span class="number">2.12</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、配置消费者consumer.xml</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:dubbo=<span class="string">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd</span></span><br><span class="line"><span class="string">http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd</span></span><br><span class="line"><span class="string">http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 让注解能够生效 --&gt;</span><br><span class="line">    &lt;context:component-scan base-package=<span class="string">&quot;com.atguigu.gmall.service.impl&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- <span class="number">1</span>、指定当前服务/应用的名字（同样的服务名字相同，不要和别的服务同名） --&gt;</span><br><span class="line">    &lt;dubbo:application name=<span class="string">&quot;order-service-consumer&quot;</span>&gt;&lt;/dubbo:application&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- <span class="number">2</span>、指定注册中心的位置 --&gt;</span><br><span class="line">    &lt;dubbo:registry address=<span class="string">&quot;zookeeper://127.0.0.1:2181&quot;</span>&gt;&lt;/dubbo:registry&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- <span class="number">3</span>、生成远程服务代理，可以和本地bean一样使用demoService --&gt;</span><br><span class="line">    &lt;dubbo:reference interface=<span class="string">&quot;gmall.service.UserService&quot;</span></span><br><span class="line">                     id=<span class="string">&quot;userService&quot;</span>&gt;</span><br><span class="line">        &lt;dubbo:method name=<span class="string">&quot;getUserAddressList&quot;</span>/&gt;</span><br><span class="line">    &lt;/dubbo:reference&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- <span class="number">6</span>、连接监控中心 --&gt;</span><br><span class="line">    &lt;dubbo:monitor protocol=<span class="string">&quot;registry&quot;</span>&gt;&lt;/dubbo:monitor&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>3、调用测试</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package com.atguigu.gmall.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> gmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> gmall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">guoyh</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date </span>2021/7/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@Service</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span> <span class="title">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;UserAddress&gt; <span class="function"><span class="title">initOrder</span>(<span class="params"><span class="built_in">String</span> userId</span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用户id:&quot;</span> + userId);</span><br><span class="line">        <span class="comment">// 1、查询用户收获地址</span></span><br><span class="line">        List&lt;UserAddress&gt; userAddressList = userService.getUserAddressList(userId);</span><br><span class="line">        <span class="keyword">for</span> (UserAddress address : userAddressList) &#123;</span><br><span class="line">            System.out.println(address.getUserAddress());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userAddressList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、注解版本</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、服务提供方</span><br><span class="line">&lt;dubbo:application name=<span class="string">&quot;gmall-user&quot;</span>&gt;&lt;/dubbo:application&gt;</span><br><span class="line">  &lt;dubbo:registry address=<span class="string">&quot;zookeeper://118.24.44.169:2181&quot;</span> /&gt;</span><br><span class="line">  &lt;dubbo:protocol name=<span class="string">&quot;dubbo&quot;</span> port=<span class="string">&quot;20880&quot;</span> /&gt;</span><br><span class="line">&lt;dubbo:annotation package=<span class="string">&quot;com.atguigu.gmall.user.impl&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.gmall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.gmall.user.mapper.UserAddressMapper;</span><br><span class="line"></span><br><span class="line">@Service <span class="comment">//使用dubbo提供的service注解，注册暴露服务</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="title">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">@Autowired</span><br><span class="line">UserAddressMapper userAddressMapper;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、服务消费方</span><br><span class="line">&lt;dubbo:application name=<span class="string">&quot;gmall-order-web&quot;</span>&gt;&lt;/dubbo:application&gt;</span><br><span class="line">&lt;dubbo:registry address=<span class="string">&quot;zookeeper://118.24.44.169:2181&quot;</span> /&gt;</span><br><span class="line">&lt;dubbo:annotation package=<span class="string">&quot;com.atguigu.gmall.order.controller&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> gmall.bean.UserAddress;</span><br><span class="line"><span class="keyword">import</span> gmall.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> gmall.service.UserService;</span><br><span class="line">@Controller</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">@Reference  <span class="comment">//使用dubbo提供的reference注解引用远程服务</span></span><br><span class="line">UserService userService;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">    public List&lt;UserAddress&gt; <span class="function"><span class="title">initOrder</span>(<span class="params"><span class="built_in">String</span> userId</span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用户id:&quot;</span> + userId);</span><br><span class="line">        <span class="comment">// 1、查询用户收获地址</span></span><br><span class="line">        List&lt;UserAddress&gt; userAddressList = userService.getUserAddressList(userId);</span><br><span class="line">        <span class="keyword">return</span> userAddressList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5、监控中心"><a href="#5、监控中心" class="headerlink" title="5、监控中心"></a>5、监控中心</h3><p>5.1、dubbo-admin</p><p>图形化的服务管理页面；安装时需要指定注册中心地址，即可从注册中心中获取到所有的提供者/消费者进行配置管理</p><p>5.2、dubbo-monitor-simple</p><p>简单的监控中心；</p><p>1)、安装</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、下载 dubbo-ops</span><br><span class="line">https:<span class="comment">//github.com/apache/incubator-dubbo-ops</span></span><br><span class="line"><span class="number">2</span>、修改配置指定注册中心地址</span><br><span class="line">进入 dubbo-monitor-simple\src\main\resources\conf</span><br><span class="line">修改 dubbo.properties文件</span><br><span class="line"><span class="number">3</span>、打包dubbo-monitor-simple</span><br><span class="line">mvn clean package -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line"><span class="number">4</span>、解压 tar.gz 文件，并运行start.bat</span><br><span class="line">如果缺少servlet-api，自行导入servlet-api再访问监控中心</span><br><span class="line"><span class="number">5</span>、启动访问<span class="number">8080</span></span><br></pre></td></tr></table></figure><p>2)、监控中心配置</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">所有服务配置连接监控中心，进行监控统计</span><br><span class="line">&lt;!-- 监控中心协议，如果为protocol=<span class="string">&quot;registry&quot;</span>，表示从注册中心发现监控中心地址，否则直连监控中心 --&gt;</span><br><span class="line">&lt;dubbo:monitor protocol=<span class="string">&quot;registry&quot;</span>&gt;&lt;/dubbo:monitor&gt;</span><br></pre></td></tr></table></figure><p>Simple Monitor 挂掉不会影响到 Consumer 和 Provider 之间的调用，所以用于生产环境不会有风险。</p><p>Simple Monitor 采用磁盘存储统计信息，请注意安装机器的磁盘限制，如果要集群，建议用mount共享磁盘。</p><h3 id="6、SpringBoot-整合-Dubbo"><a href="#6、SpringBoot-整合-Dubbo" class="headerlink" title="6、SpringBoot 整合 Dubbo"></a>6、SpringBoot 整合 Dubbo</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- SpringBoot版本 --&gt;</span><br><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.0</span><span class="number">.4</span>.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt; &lt;!-- lookup parent <span class="keyword">from</span> repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- JDK <span class="number">1.8</span>--&gt;</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;<span class="number">1.8</span>&lt;/java.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 引入公共接口项目--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;gmall-interface&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">  &lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>6.1、引入spring-boot-starter以及dubbo和curator的依赖</p><p>注意starter版本适配：</p><p><img src="Untitled%2010.png" alt="Untitled%2010.png"></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Dubbo Spring Boot Starter --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;<span class="number">0.2</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>6.2、配置application.properties</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、提供者配置</span><br><span class="line">#dubbo服务名称</span><br><span class="line">dubbo.application.name=boot-order-service-provider</span><br><span class="line">#注册中心地址</span><br><span class="line">dubbo.registry.address=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span></span><br><span class="line">#注册中心协议</span><br><span class="line">dubbo.registry.protocol=zookeeper</span><br><span class="line">#通信协议</span><br><span class="line">dubbo.protocol.name=dubbo</span><br><span class="line">dubbo.protocol.prot=<span class="number">20880</span></span><br><span class="line">#监控中心地址:registry从注册中心自动发现</span><br><span class="line">dubbo.monitor.protocol=registry</span><br><span class="line">#application.name就是服务名，不能跟别的dubbo提供端重复</span><br><span class="line">#registry.protocol 是指定注册中心协议</span><br><span class="line">#registry.address 是注册中心的地址加端口号</span><br><span class="line">#protocol.name 是分布式固定是dubbo,不要改。</span><br><span class="line">#base-package  注解方式要扫描的包</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、消费者配置</span><br><span class="line">dubbo.application.name=gmall-order-web</span><br><span class="line">dubbo.registry.protocol=zookeeper</span><br><span class="line">dubbo.registry.address=<span class="number">192.168</span><span class="number">.67</span><span class="number">.159</span>:<span class="number">2181</span></span><br><span class="line">dubbo.scan.base-package=com.atguigu.gmall</span><br><span class="line">dubbo.protocol.name=dubbo</span><br></pre></td></tr></table></figure><p>3、dubbo注解</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#提供者:实现类开放服务</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line">@Service</span><br><span class="line"></span><br><span class="line">#消费者:从注册中心自动获取可用的实现服务</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line">@Reference</span><br><span class="line"></span><br><span class="line">如果没有在配置中写dubbo.scan.base-package,还需要使用@EnableDubbo注解</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.spring.context.annotation.EnableDubbo;</span><br><span class="line">@EnableDubbo</span><br></pre></td></tr></table></figure><h1 id="二、dubbo配置"><a href="#二、dubbo配置" class="headerlink" title="二、dubbo配置"></a>二、dubbo配置</h1><h2 id="1、配置原则"><a href="#1、配置原则" class="headerlink" title="1、配置原则"></a>1、配置原则</h2><p><img src="Untitled%2011.png" alt="Untitled%2011.png"></p><p>JVM 启动 -D 参数优先，这样可以使用户在部署和启动时进行参数重写，比如在启动时需改变协议的端口。</p><p>XML /applicatoin.properties次之，如果在 XML 中有配置，则 dubbo.properties 中的相应配置项无效。(自己测试结果为dubbo.properties 比XML/application.properties高)</p><p>Properties 最后，相当于缺省值，只有 XML 没有配置时，dubbo.properties 的相应配置项才会生效，通常用于共享公共配置，比如应用名。</p><p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/preflight-check/">https://dubbo.apache.org/zh/docsv2.7/user/examples/preflight-check/</a></p><p><strong>启动时检查：</strong></p><p>Dubbo 缺省会在启动时检查依赖的服务是否可用，不可用时会抛出异常，阻止 Spring 初始化完成，以便上线时，能及早发现问题，默认 <code>check=&quot;true&quot;</code>。</p><p>可以通过 <code>check=&quot;false&quot;</code> 关闭检查，比如，测试时，有些服务不关心，或者出现了循环依赖，必须有一方先启动。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-D</span><br><span class="line">java -Ddubbo.reference.com.foo.BarService.check=<span class="literal">false</span></span><br><span class="line">java -Ddubbo.reference.check=<span class="literal">false</span></span><br><span class="line">java -Ddubbo.consumer.check=<span class="literal">false</span> </span><br><span class="line">java -Ddubbo.registry.check=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">XML</span><br><span class="line">&lt;dubbo:reference interface=<span class="string">&quot;com.foo.BarService&quot;</span> check=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line">&lt;dubbo:consumer check=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line">&lt;dubbo:registry check=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">dubbo.properties</span><br><span class="line">dubbo.reference.com.foo.BarService.check=<span class="literal">false</span></span><br><span class="line">dubbo.reference.check=<span class="literal">false</span></span><br><span class="line">dubbo.consumer.check=<span class="literal">false</span></span><br><span class="line">dubbo.registry.check=<span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="2、重试次数"><a href="#2、重试次数" class="headerlink" title="2、重试次数"></a>2、重试次数</h2><p>失败自动切换，当出现失败，重试其它服务器，但重试会带来更长延迟。可通过 retries=”2” 来设置重试次数(不含第一次)。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">重试次数配置如下：</span><br><span class="line">&lt;dubbo:service retries=<span class="string">&quot;2&quot;</span> /&gt;</span><br><span class="line">或</span><br><span class="line">&lt;dubbo:reference retries=<span class="string">&quot;2&quot;</span> /&gt;</span><br><span class="line">或</span><br><span class="line">&lt;dubbo:reference&gt;</span><br><span class="line">    &lt;dubbo:method name=<span class="string">&quot;findFoo&quot;</span> retries=<span class="string">&quot;2&quot;</span> /&gt;</span><br><span class="line">&lt;/dubbo:reference&gt;</span><br></pre></td></tr></table></figure><h2 id="3、超时时间"><a href="#3、超时时间" class="headerlink" title="3、超时时间"></a>3、超时时间</h2><p>由于网络或服务端不可靠，会导致调用出现一种不确定的中间状态（超时）。为了避免超时导致客户端资源（线程）挂起耗尽，必须设置超时时间.</p><p>3.1、消费端</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">全局超时配置</span><br><span class="line">&lt;dubbo:consumer timeout=<span class="string">&quot;5000&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">指定接口以及特定方法超时配置</span><br><span class="line">&lt;dubbo:reference interface=<span class="string">&quot;com.foo.BarService&quot;</span> timeout=<span class="string">&quot;2000&quot;</span>&gt;</span><br><span class="line">    &lt;dubbo:method name=<span class="string">&quot;sayHello&quot;</span> timeout=<span class="string">&quot;3000&quot;</span> /&gt;</span><br><span class="line">&lt;/dubbo:reference&gt;</span><br></pre></td></tr></table></figure><p>3.2、提供方</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">全局超时配置</span><br><span class="line">&lt;dubbo:provider timeout=<span class="string">&quot;5000&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">指定接口以及特定方法超时配置</span><br><span class="line">&lt;dubbo:provider interface=<span class="string">&quot;com.foo.BarService&quot;</span> timeout=<span class="string">&quot;2000&quot;</span>&gt;</span><br><span class="line">    &lt;dubbo:method name=<span class="string">&quot;sayHello&quot;</span> timeout=<span class="string">&quot;3000&quot;</span> /&gt;</span><br><span class="line">&lt;/dubbo:provider&gt;</span><br></pre></td></tr></table></figure><p>3.3、配置规则</p><p>Dubbo推荐在Provider上尽量多配置Consumer端属性</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、作服务的提供者，比服务使用方更清楚服务性能参数，如调用的超时时间，合理的重试次数，等等</span><br><span class="line"><span class="number">2</span>、在Provider配置后，Consumer不配置则会使用Provider的配置值，即Provider配置可以作为Consumer的缺省值。否则，Consumer会使用Consumer端的全局设置，这对于Provider不可控的，并且往往是不合理的</span><br></pre></td></tr></table></figure><p>配置的覆盖规则：</p><ol><li><p>方法级配置别优于接口级别，即小Scope优先</p></li><li><p>Consumer端配置 优于 Provider配置 优于 全局配置，</p></li></ol><p>3) 最后是缺省值（见配置文档）</p><h2 id="4、版本号"><a href="#4、版本号" class="headerlink" title="4、版本号"></a>4、版本号</h2><p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/multi-versions/">https://dubbo.apache.org/zh/docsv2.7/user/examples/multi-versions/</a></p><p>当一个接口实现，出现不兼容升级时，可以用版本号过渡，版本号不同的服务相互间不引用。可以按照以下的步骤进行版本迁移：</p><p>在低压力时间段，先升级一半提供者为新版本</p><p>再将所有消费者升级为新版本</p><p>然后将剩下的一半提供者升级为新版本</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">服务老版本提供者配置：</span><br><span class="line">&lt;dubbo:service interface=<span class="string">&quot;com.foo.BarService&quot;</span> version=<span class="string">&quot;1.0.0&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">服务新版本提供者配置：</span><br><span class="line">&lt;dubbo:service interface=<span class="string">&quot;com.foo.BarService&quot;</span> version=<span class="string">&quot;2.0.0&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">服务老版本消费者配置：</span><br><span class="line">&lt;dubbo:reference id=<span class="string">&quot;barService&quot;</span> interface=<span class="string">&quot;com.foo.BarService&quot;</span> version=<span class="string">&quot;1.0.0&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">新版本服务消费者配置：</span><br><span class="line">&lt;dubbo:reference id=<span class="string">&quot;barService&quot;</span> interface=<span class="string">&quot;com.foo.BarService&quot;</span> version=<span class="string">&quot;2.0.0&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">如果不需要区分版本，可以按照以下的方式配置：</span><br><span class="line">&lt;dubbo:reference id=<span class="string">&quot;barService&quot;</span> interface=<span class="string">&quot;com.foo.BarService&quot;</span> version=<span class="string">&quot;*&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><h2 id="5、本地存根"><a href="#5、本地存根" class="headerlink" title="5、本地存根"></a>5、本地存根</h2><p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/local-stub/">https://dubbo.apache.org/zh/docsv2.7/user/examples/local-stub/</a></p><p>远程服务后，客户端通常只剩下接口，而实现全在服务器端，但提供方有些时候想在客户端也执行部分逻辑，比如：做 ThreadLocal 缓存，提前验证参数，调用失败后伪造容错数据等等，此时就需要在 API 中带上 Stub，客户端生成 Proxy 实例，会把 Proxy 通过构造函数传给 Stub <a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/local-stub/#fn:1">1</a>，然后把 Stub 暴露给用户，Stub 可以决定要不要去调 Proxy。</p><p><img src="stub.jpg" alt="stub.jpg"></p><p>在消费方，写一个远程接口本地的实现，提供 Stub 的实现 ：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.foo;</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">BarServiceStub</span> <span class="title">implements</span> <span class="title">BarService</span> </span>&#123;</span><br><span class="line">    private final BarService barService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 必须有一个有参构造，并且使构造函数传入真正的远程代理对象</span></span><br><span class="line">    public <span class="function"><span class="title">BarServiceStub</span>(<span class="params">BarService barService</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.barService = barService;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">sayHello</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 此代码在客户端执行, 你可以在客户端做ThreadLocal本地缓存，或预先验证参数是否合法，等等</span></span><br><span class="line">        <span class="comment">// ...自己的代码</span></span><br><span class="line"><span class="comment">// 当自己代码执行结束后，再调真正的远程服务</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> barService.sayHello(name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// 你可以容错，可以做任何AOP拦截事项</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;容错数据&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 spring 配置文件中按以下方式配置：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">提供者方配置</span><br><span class="line">&lt;dubbo:service interface=<span class="string">&quot;com.foo.BarService&quot;</span> stub=<span class="string">&quot;true&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">消费者方配置</span><br><span class="line">&lt;dubbo:reference interface=<span class="string">&quot;gmall.service.UserService&quot;</span></span><br><span class="line">  id=<span class="string">&quot;userService&quot;</span> timeout=<span class="string">&quot;5000&quot;</span> retries=<span class="string">&quot;3&quot;</span> version=<span class="string">&quot;*&quot;</span> </span><br><span class="line">stub=<span class="string">&quot;com.atguigu.gmall.service.impl.UserServiceStub&quot;</span>&gt;</span><br><span class="line">&lt;dubbo:method name=<span class="string">&quot;getUserAddressList&quot;</span> timeout=<span class="string">&quot;1000&quot;</span>/&gt;</span><br><span class="line">&lt;/dubbo:reference&gt;</span><br></pre></td></tr></table></figure><hr><ol><li>Stub 必须有可传入 Proxy 的构造函数。 </li><li>在 interface 旁边放一个 Stub 实现，它实现 BarService 接口，并有一个传入远程 BarService 实例的构造函数 </li></ol><h2 id="6、SpringBoot方式配置"><a href="#6、SpringBoot方式配置" class="headerlink" title="6、SpringBoot方式配置"></a>6、SpringBoot方式配置</h2><h3 id="6-1、超时属性"><a href="#6-1、超时属性" class="headerlink" title="6.1、超时属性"></a>6.1、超时属性</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line">@Service(timeout)</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line">@Reference(timeout = <span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="6-2、SpringBoot与Dubbo整合的三种方式"><a href="#6-2、SpringBoot与Dubbo整合的三种方式" class="headerlink" title="6.2、SpringBoot与Dubbo整合的三种方式"></a>6.2、SpringBoot与Dubbo整合的三种方式</h3><p><strong>6.2.1、第一种</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>导入dobuuo-starter</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">0.2</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>配置application.properties</span><br><span class="line">#dubbo服务名称</span><br><span class="line">dubbo.application.name=boot-order-service-provider</span><br><span class="line">#注册中心地址</span><br><span class="line">dubbo.registry.address=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span></span><br><span class="line">#注册中心协议</span><br><span class="line">dubbo.registry.protocol=zookeeper</span><br><span class="line">#通信协议</span><br><span class="line">dubbo.protocol.name=dubbo</span><br><span class="line">dubbo.protocol.prot=<span class="number">20880</span></span><br><span class="line">#监控中心地址:registry从注册中心自动发现</span><br><span class="line">dubbo.monitor.protocol=registry</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>暴漏服务注解@Service</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>使用远程服务@Reference</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>开启Dubbo注解功能@EnableDubbo</span><br><span class="line"></span><br><span class="line">#老版本会指定包扫描规则</span><br><span class="line">dubbo.scan.base-packages=com</span><br></pre></td></tr></table></figure><p><strong>6.2.2、第二种：保留XML</strong></p><p>想要做到方法级别的配置，保留dubbo的xml配置文件，之后可以在xml中做到method方法级别的配置。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 拷贝xml文件到resource目录,删除application.properties中dubbo的相关配置</span><br><span class="line"># 所有配置都在xml中</span><br><span class="line"><span class="number">1.</span>导入dobuuo-starter</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">0.2</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>使用@ImportResource导入dubbo的xml配置文件</span><br><span class="line"><span class="comment">//@EnableDubbo</span></span><br><span class="line">@ImportResource(location=<span class="string">&quot;classpath:provider.xml&quot;</span>)</span><br></pre></td></tr></table></figure><p><strong>6.2.3、第三种:注解API配置类</strong></p><p>将每一个组件手动创建到容器中</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>创建配置类</span><br><span class="line">package com.atguigu.gmall.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.*;</span><br><span class="line"><span class="keyword">import</span> gmall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyDubboConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提供者名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Bean</span><br><span class="line">    public ApplicationConfig <span class="function"><span class="title">applicationConfig</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        ApplicationConfig applicationConfig = <span class="keyword">new</span> ApplicationConfig();</span><br><span class="line">        applicationConfig.setName(<span class="string">&quot;boot-order-service-provider-config&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> applicationConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册中心地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Bean</span><br><span class="line">    public RegistryConfig <span class="function"><span class="title">registryConfig</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        RegistryConfig registryConfig = <span class="keyword">new</span> RegistryConfig();</span><br><span class="line">        registryConfig.setProtocol(<span class="string">&quot;zookeeper&quot;</span>);</span><br><span class="line">        registryConfig.setAddress(<span class="string">&quot;127.0.0.1:2181&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registryConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通信规则</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Bean</span><br><span class="line">    public ProtocolConfig <span class="function"><span class="title">protocolConfig</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        ProtocolConfig protocolConfig = <span class="keyword">new</span> ProtocolConfig();</span><br><span class="line">        protocolConfig.setName(<span class="string">&quot;dubbo&quot;</span>);</span><br><span class="line">        protocolConfig.setPort(<span class="number">20882</span>);</span><br><span class="line">        <span class="keyword">return</span> protocolConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置暴漏服务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Bean</span><br><span class="line">    public ServiceConfig&lt;UserService&gt; <span class="function"><span class="title">userServiceConfig</span>(<span class="params">UserService userService</span>)</span> &#123;</span><br><span class="line">        ServiceConfig&lt;UserService&gt; userServiceConfig = <span class="keyword">new</span> ServiceConfig&lt;&gt;();</span><br><span class="line">        <span class="comment">//配置接口级别</span></span><br><span class="line">        userServiceConfig.setInterface(UserService.class);</span><br><span class="line">        userServiceConfig.setRef(userService);</span><br><span class="line">        userServiceConfig.setVersion(<span class="string">&quot;1.0.0&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//配置方法级别</span></span><br><span class="line">        MethodConfig methodConfig = <span class="keyword">new</span> MethodConfig();</span><br><span class="line">        methodConfig.setName(<span class="string">&quot;getUserAddressList&quot;</span>);</span><br><span class="line">        methodConfig.setTimeout(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        userServiceConfig.setMethods(Arrays.asList(methodConfig));</span><br><span class="line">        <span class="keyword">return</span> userServiceConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置监控中心</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Bean</span><br><span class="line">    public MonitorConfig <span class="function"><span class="title">monitorConfig</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        MonitorConfig monitorConfig = <span class="keyword">new</span> MonitorConfig();</span><br><span class="line">        monitorConfig.setProtocol(<span class="string">&quot;registry&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> monitorConfig;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>暴露服务接口</span><br><span class="line">@Service <span class="comment">//暴露服务</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>启动dubbo并指定扫描路径</span><br><span class="line">@EnableDubbo(scanBasePackages = <span class="string">&quot;com.atguigu.gmall&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="三、高可用"><a href="#三、高可用" class="headerlink" title="三、高可用"></a>三、高可用</h1><h2 id="3-1、zookeeper宕机与dubbo直连"><a href="#3-1、zookeeper宕机与dubbo直连" class="headerlink" title="3.1、zookeeper宕机与dubbo直连"></a>3.1、zookeeper宕机与dubbo直连</h2><p><img src="Untitled%2012.png" alt="Untitled%2012.png"></p><p>注册中心的作用就是保存服务提供者位置信息，我们完全可以绕过注册中心使用dubbo直连.</p><p>宕机了有缓存，依旧可以调用。没有注册中心使用直连</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Reference(timeout = <span class="number">0</span>,url = <span class="string">&quot;127.0.0.1:20880&quot;</span>)</span><br><span class="line">UserService userService;</span><br></pre></td></tr></table></figure><h2 id="3-2、集群下dubbo负载均衡机制"><a href="#3-2、集群下dubbo负载均衡机制" class="headerlink" title="3.2、集群下dubbo负载均衡机制"></a>3.2、集群下dubbo负载均衡机制</h2><p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/loadbalance/">https://dubbo.apache.org/zh/docsv2.7/user/examples/loadbalance/</a></p><p>在集群负载均衡时，Dubbo 提供了多种均衡策略，缺省为 random 随机调用,</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">**Random LoadBalance**</span><br><span class="line">随机，按权重设置随机概率。</span><br><span class="line">在一个截面上碰撞的概率高，但调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重。</span><br><span class="line">**RoundRobin LoadBalance**</span><br><span class="line">轮循，按公约后的权重设置轮循比率。</span><br><span class="line">存在慢的提供者累积请求的问题，比如：第二台机器很慢，但没挂，当请求调到第二台时就卡在那，久而久之，所有请求都卡在调到第二台上。</span><br><span class="line">**LeastActive LoadBalance**</span><br><span class="line">最少活跃调用数，相同活跃数的随机，活跃数指调用前后计数差。</span><br><span class="line">使慢的提供者收到更少请求，因为越慢的提供者的调用前后计数差会越大。</span><br><span class="line">**ConsistentHash LoadBalance**</span><br><span class="line">一致性 Hash，相同参数的请求总是发到同一提供者。</span><br><span class="line">当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动。算法参见：http:<span class="comment">//en.wikipedia.org/wiki/Consistent_hashing</span></span><br><span class="line">缺省只对第一个参数 Hash，如果要修改，请配置 &lt;dubbo:parameter key=<span class="string">&quot;hash.arguments&quot;</span> value=<span class="string">&quot;0,1&quot;</span> /&gt;</span><br><span class="line">缺省用 <span class="number">160</span> 份虚拟节点，如果要修改，请配置 &lt;dubbo:parameter key=<span class="string">&quot;hash.nodes&quot;</span> value=<span class="string">&quot;320&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><h3 id="3-2-1、Random-LoadBalance"><a href="#3-2-1、Random-LoadBalance" class="headerlink" title="3.2.1、Random LoadBalance"></a>3.2.1、Random LoadBalance</h3><p><img src="Untitled%2013.png" alt="Untitled%2013.png"></p><h3 id="3-2-2、RoundRobin-LoadBalance"><a href="#3-2-2、RoundRobin-LoadBalance" class="headerlink" title="3.2.2、RoundRobin LoadBalance"></a>3.2.2、RoundRobin LoadBalance</h3><p>第一调完，必须去第二个,根据权重1只能占2次，2占4次，3占1次。</p><p><img src="Untitled%2014.png" alt="Untitled%2014.png"></p><h3 id="3-2-3、LeastActive-LoadBalance"><a href="#3-2-3、LeastActive-LoadBalance" class="headerlink" title="3.2.3、LeastActive LoadBalance"></a>3.2.3、LeastActive LoadBalance</h3><p><img src="Untitled%2015.png" alt="Untitled%2015.png"></p><p>每次都统计上次请求时间</p><p>调哪个前会查那个上次最快</p><h3 id="3-2-4、ConsistentHash-LoadBalance"><a href="#3-2-4、ConsistentHash-LoadBalance" class="headerlink" title="3.2.4、ConsistentHash LoadBalance"></a>3.2.4、ConsistentHash LoadBalance</h3><p>比如getUser,id都等于1的，根据hash分布都会来到1号机器。</p><p><img src="Untitled%2016.png" alt="Untitled%2016.png"></p><h3 id="3-2-5、配置"><a href="#3-2-5、配置" class="headerlink" title="3.2.5、配置"></a>3.2.5、配置</h3><p>默认为随机负载均衡机制</p><p><img src="Untitled%2017.png" alt="Untitled%2017.png"></p><p><img src="Untitled%2018.png" alt="Untitled%2018.png"></p><p>XML：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">### **服务端服务级别**</span><br><span class="line"></span><br><span class="line"><span class="string">`&lt;dubbo:service interface=&quot;...&quot; loadbalance=&quot;roundrobin&quot; /&gt;`</span></span><br><span class="line"></span><br><span class="line">### **客户端服务级别**</span><br><span class="line"></span><br><span class="line"><span class="string">`&lt;dubbo:reference interface=&quot;...&quot; loadbalance=&quot;roundrobin&quot; /&gt;`</span></span><br><span class="line"></span><br><span class="line">### **服务端方法级别**</span><br><span class="line"></span><br><span class="line"><span class="string">`&lt;dubbo:service interface=&quot;...&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;dubbo:method name=&quot;...&quot; loadbalance=&quot;roundrobin&quot;/&gt;</span></span><br><span class="line"><span class="string">&lt;/dubbo:service&gt;`</span></span><br><span class="line"></span><br><span class="line">### **客户端方法级别**</span><br><span class="line"></span><br><span class="line"><span class="string">`&lt;dubbo:reference interface=&quot;...&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;dubbo:method name=&quot;...&quot; loadbalance=&quot;roundrobin&quot;/&gt;</span></span><br><span class="line"><span class="string">&lt;/dubbo:reference&gt;`</span></span><br></pre></td></tr></table></figure><p>注解：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Reference(timeout = <span class="number">0</span>,loadbalance = <span class="string">&quot;roundrobin&quot;</span>) </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="Untitled%2019.png" alt="Untitled%2019.png"></p><h2 id="3-3、整合hystrix，服务熔断与降级处理"><a href="#3-3、整合hystrix，服务熔断与降级处理" class="headerlink" title="3.3、整合hystrix，服务熔断与降级处理"></a>3.3、整合hystrix，服务熔断与降级处理</h2><h3 id="3-3-1、服务降级"><a href="#3-3-1、服务降级" class="headerlink" title="3.3.1、服务降级"></a>3.3.1、服务降级</h3><p>什么是服务降级？</p><p>当服务器压力剧增的情况下，根据实际业务情况及流量，对一些服务和页面有策略的不处理或换种简单的方式处理，从而释放服务器资源以保证核心交易正常运作或高效运作</p><p>可以通过服务降级功能临时屏蔽某个出错的非关键服务，并定义降级后的返回策略。</p><p>支持2种：</p><ul><li>mock=force:return+null 表示消费方对该服务的方法调用都直接返回 null 值，不发起远程调用。用来屏蔽不重要服务不可用时对调用方的影响。（直接在客户端返回null，不发起远程调用）</li><li>还可以改为 mock=fail:return+null 表示消费方对该服务的方法调用在失败后，再返回 null 值，不抛异常。用来容忍不重要服务不稳定时对调用方的影响。（到达一定超时时间，超时后调用在失败后，再返回 null 值，这个是服务已经调用了）</li></ul><p>通过服务降级手段，牺牲非核心业务的占用的资源，达到让其他核心业务能占用服务器更多资源</p><p><strong>配置，在消费者端</strong></p><p>第一种：屏蔽（不进行远程调用，返回null）</p><p><img src="Untitled%2020.png" alt="Untitled%2020.png"></p><p>第二种：容错（当远程调用失败后，返回null）</p><p><img src="Untitled%2021.png" alt="Untitled%2021.png"></p><h3 id="3-3-2、集群容错"><a href="#3-3-2、集群容错" class="headerlink" title="3.3.2、集群容错"></a>3.3.2、集群容错</h3><p>在集群调用失败时，Dubbo 提供了多种容错方案，缺省为 failover 重试。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>**Failover Cluster**</span><br><span class="line">失败自动切换，当出现失败，重试其它服务器。通常**用于读操作**，但重试会带来更长延迟。</span><br><span class="line">可通过 retries=<span class="string">&quot;2&quot;</span> 来设置重试次数(不含第一次)。</span><br><span class="line"></span><br><span class="line">重试次数配置如下：</span><br><span class="line">&lt;dubbo:service retries=<span class="string">&quot;2&quot;</span> /&gt;</span><br><span class="line">或</span><br><span class="line">&lt;dubbo:reference retries=<span class="string">&quot;2&quot;</span> /&gt;</span><br><span class="line">或</span><br><span class="line">&lt;dubbo:reference&gt;</span><br><span class="line">    &lt;dubbo:method name=<span class="string">&quot;findFoo&quot;</span> retries=<span class="string">&quot;2&quot;</span> /&gt;</span><br><span class="line">&lt;/dubbo:reference&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>**Failfast Cluster**</span><br><span class="line">快速失败，只发起一次调用，失败立即报错。通常用于**非幂等性**的写操作，比如新增记录。</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>**Failsafe Cluster**</span><br><span class="line">失败安全，出现异常时，直接**忽略**。通常用于写入审计日志等操作。</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>**Failback Cluster**</span><br><span class="line">**失败自动恢复**，后台记录失败请求，定时重发。通常**用于消息通知**操作。</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>**Forking Cluster**</span><br><span class="line">**并行调用**多个服务器，只要一个成功即返回。通常用于实时性要求较高的读操作，</span><br><span class="line">但需要浪费更多服务资源。可通过 forks=<span class="string">&quot;2&quot;</span> 来设置最大并行数。太浪费资源。</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>**Broadcast Cluster**</span><br><span class="line">广播**调用所有提供者，逐个调用，任意一台报错则报错** [<span class="number">2</span>]。</span><br><span class="line">通常**用于通知所有提供者更新缓存**或日志等本地资源信息。</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>**集群模式配置**</span><br><span class="line">按照以下示例在服务提供方和消费方配置集群模式</span><br><span class="line">&lt;dubbo:service cluster=<span class="string">&quot;failsafe&quot;</span> /&gt;</span><br><span class="line">或</span><br><span class="line">&lt;dubbo:reference cluster=<span class="string">&quot;failsafe&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><h3 id="3-3-3、实际开发整合hystrix提供容错（SpringCloud默认整合的框架）"><a href="#3-3-3、实际开发整合hystrix提供容错（SpringCloud默认整合的框架）" class="headerlink" title="3.3.3、实际开发整合hystrix提供容错（SpringCloud默认整合的框架）"></a>3.3.3、实际开发整合hystrix提供容错（SpringCloud默认整合的框架）</h3><p>Hystrix 旨在通过控制那些访问远程系统、服务和第三方库的节点，从而对延迟和故障提供更强大的容错能力。Hystrix具备拥有回退机制和断路器功能的线程和信号隔离，请求缓存和请求打包，以及监控和配置等功能。</p><p><strong>1、配置spring-cloud-starter-netflix-hystrix</strong></p><p>spring boot官方提供了对hystrix的集成，直接在消费者、提供者的pom.xml里加入依赖：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">1.4</span><span class="number">.4</span>.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>然后在Application类上增加@EnableHystrix来启用hystrix starter：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableHystrix</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ProviderApplication</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2、配置Provider端</strong></p><p>在Dubbo的Provider上增加@HystrixCommand配置，这样子调用就会经过Hystrix代理。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Service(version = <span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">HelloServiceImpl</span> <span class="title">implements</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line"><span class="comment">//使用Hystrix代理，进行处理容错异常</span></span><br><span class="line">    @HystrixCommand(commandProperties = &#123;</span><br><span class="line">     @HystrixProperty(name = <span class="string">&quot;circuitBreaker.requestVolumeThreshold&quot;</span>, value = <span class="string">&quot;10&quot;</span>),</span><br><span class="line">     @HystrixProperty(name = <span class="string">&quot;execution.isolation.thread.timeoutInMilliseconds&quot;</span>, value = <span class="string">&quot;2000&quot;</span>) &#125;)</span><br><span class="line">    @Override</span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">sayHello</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;async provider received: &quot; + name);</span></span><br><span class="line">        <span class="comment">// return &quot;annotation: hello, &quot; + name;</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Exception to show hystrix enabled.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3、配置Consumer端</strong></p><p>对于Consumer端，则可以增加一层method调用，并在method上配置@HystrixCommand。当调用出错时，会走到fallbackMethod = “reliable”的调用里。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Reference(version = <span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line">    private HelloService demoService;</span><br><span class="line"><span class="comment">//fallbackMethod 回调方法,一旦调用失败出错后，调用reliable方法</span></span><br><span class="line"><span class="comment">//就不用在调用代码中trycatch了</span></span><br><span class="line">    @HystrixCommand(fallbackMethod = <span class="string">&quot;reliable&quot;</span>)</span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">doSayHello</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> demoService.sayHello(name);</span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">reliable</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hystrix fallback value&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="四、Dubbo原理"><a href="#四、Dubbo原理" class="headerlink" title="四、Dubbo原理"></a>四、Dubbo原理</h1><h2 id="4-1、RPC原理"><a href="#4-1、RPC原理" class="headerlink" title="4.1、RPC原理"></a>4.1、RPC原理</h2><p>rpc就是想完成一次远程调用</p><p><img src="Untitled%2022.png" alt="Untitled%2022.png"></p><p>一次完整的RPC调用流程（同步调用，异步另说）如下：</p><p>1）Computer01（client）发起远程调用请求,接下来有一个代理对象client stub</p><p><strong>2）client stub接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体；</strong></p><p><strong>3）client stub找到服务地址，并将消息发送到服务端server stub；</strong></p><p><strong>4）server stub收到消息后进行解码(可能传输的是序列化对象，需要反序列化)；</strong></p><p><strong>5）server stub根据解码结果调用本地的方法服务；</strong></p><p><strong>6）本地方法服务执行完成后，将数据结果返回给server stub；</strong></p><p><strong>7）server stub将返回结果打包(序列化)成消息通过网络发送至消费方client stub；</strong></p><p><strong>8）client stub接收到消息，并进行解码(反序列化)；</strong></p><p>9）服务消费方Computer01得到最终结果。</p><p>RPC框架的目标就是要2~8这些步骤都封装起来，这些细节对用户来说是透明的，不可见的。</p><h2 id="4-2、netty通信原理"><a href="#4-2、netty通信原理" class="headerlink" title="4.2、netty通信原理"></a>4.2、netty通信原理</h2><p>Dubbo底层通信时是使用netty，Netty时基于Java的NIO(Non-Blocking IO)非阻塞,BIO(Blocking IO)阻塞IO。</p><p><strong>BIO：</strong></p><p><img src="Untitled%2023.png" alt="Untitled%2023.png"></p><p>每一个请求进来开一个线程Socket，读取Socket的输入流、进行业务逻辑等等。同时在这操作，并且此时在我们业务逻辑没完成之前，我们线程都不能得到释放的，这样我们的服务器就不能同时处理大量的请求。因为有大量的线程在等待业务逻辑的完成。</p><p><strong>NIO：</strong></p><p><img src="Untitled%2024.png" alt="Untitled%2024.png"></p><p>Channel：通道，通道里还有Buffer，利用Buffer进行数据传输。</p><p>Selector ：一般称 为<strong>选择器</strong> ，也可以翻译为 <strong>多路复用器。</strong></p><p>通道状态：Connect（连接就绪）、Accept（接受就绪）、Read（读就绪）、Write（写就绪）。</p><p><strong>基本原理：</strong></p><p>1个Selector会有很多通道注册了进来，Selector通过监听多个通道，监听会有很多事件，如当Connect了发生什么，Accept了会做什么，Read或Write发生了时要做什么，当发现某一个通道数据准备好了。所以我们通过1个Selector监听多个通道的方式，当某个通道任何一个状态准备好了，我们可以额外开一个线程进行处理。这叫多路复用模型。</p><p><img src="Untitled%2025.png" alt="Untitled%2025.png"></p><p>1.启动</p><p>2.监听某一个端口</p><p>3.初始化一个通道，注册到Selector中</p><p>4.轮询监听通道的accept事件</p><p>5.当accept事件发生后，扔到任务队列，处理通道信息，就与客户端建立连接来生成SocketChannel</p><p>6.然后把刚生成的SocketChannel通道再注册到Selector里面，进行监听read、wirte事件</p><p>7.read、wirte事件准备就绪了就来处理，抛给任务队列。</p><p>注意：有2个Selector，一个是boss来进行监听准备就绪事件，另一个woker是当准备就绪后要做什么工作，把这个工作抛给woker慢慢来做。</p><h2 id="4-3、dubbo原理"><a href="#4-3、dubbo原理" class="headerlink" title="4.3、dubbo原理"></a>4.3、dubbo原理</h2><h3 id="4-3-1、dubbo原理-框架设计"><a href="#4-3-1、dubbo原理-框架设计" class="headerlink" title="4.3.1、dubbo原理    -   框架设计"></a>4.3.1、dubbo原理    -   框架设计</h3><p><img src="Untitled%2026.png" alt="Untitled%2026.png"></p><p><strong>各层说明</strong></p><ul><li><strong>config 配置层</strong>：对外配置接口，以 <code>ServiceConfig</code>, <code>ReferenceConfig</code> 为中心，可以直接初始化配置类，也可以通过 spring 解析<strong>配置生成配置类</strong></li><li><strong>proxy 服务代理层</strong>：服务接口透明代理，<strong>生成服务的客户端 Stub 和服务器端 Skeleton,</strong> 以 <code>ServiceProxy</code> 为中心，扩展接口为 <code>ProxyFactory</code></li><li><strong>registry 注册中心层</strong>：封装服务地址的<strong>注册与发现</strong>，以服务 URL 为中心，扩展接口为 <code>RegistryFactory</code>, <code>Registry</code>, <code>RegistryService</code></li><li><strong>cluster 路由层</strong>：封装多个提供者的路由及<strong>负载均衡</strong>，并桥接注册中心，以 <code>Invoker</code> 为中心，扩展接口为 <code>Cluster</code>, <code>Directory</code>, <code>Router</code>, <code>LoadBalance</code></li><li><strong>monitor 监控层</strong>：RPC <strong>调用次数和调用时间监控</strong>，以 <code>Statistics</code> 为中心，扩展接口为 <code>MonitorFactory</code>, <code>Monitor</code>, <code>MonitorService</code></li><li><strong>protocol 远程调用层</strong>：<strong>封装 RPC 调用</strong>，以 <code>Invocation</code>, <code>Result</code> 为中心，扩展接口为 <code>Protocol</code>, <code>Invoker</code>, <code>Exporter</code></li><li><strong>exchange 信息交换层</strong>：封装请求响应模式，同步转异步，以 <code>Request</code>, <code>Response</code> 为中心，扩展接口为 <code>Exchanger</code>, <code>ExchangeChannel</code>, <code>ExchangeClient</code>, <code>ExchangeServer</code>，创建客户端和服务端，两个架起管道进行数据互联互通。</li><li><strong>transport 网络传输层</strong>：抽象 mina 和 **netty (transport 底层)**为统一接口，以 <code>Message</code> 为中心，扩展接口为 <code>Channel</code>, <code>Transporter</code>, <code>Client</code>, <code>Server</code>, <code>Codec</code></li><li><strong>serialize 数据序列化层</strong>：可复用的一些工具，扩展接口为 <code>Serialization</code>, <code>ObjectInput</code>, <code>ObjectOutput</code>, <code>ThreadPool</code></li></ul><p><strong>说明：</strong>Consumer在左边，Provider在右边。Call为调用逻辑，黑颜色是依赖顺序。</p><h3 id="4-3-2、dubbo原理-启动解析、加载配置信息"><a href="#4-3-2、dubbo原理-启动解析、加载配置信息" class="headerlink" title="4.3.2、dubbo原理    -   启动解析、加载配置信息"></a>4.3.2、dubbo原理    -   启动解析、加载配置信息</h3><p>BeanDefinitionParser定义解析器</p><p>DubboBeanDefinitionParser中的parse方法来解析标签。挨个标签来解析。</p><p>DubboBeanDefinitionParser构造器打断点看怎么创建出来的。</p><p><img src="Untitled%2027.png" alt="Untitled%2027.png"></p><p>init方法注册很多标签解析器。容器启动，解析每一个标签，每一个标签都有对应的***Config.class，保存到指定的对象中,Service标签牵扯到服务暴漏的功能。</p><p><img src="Untitled%2028.png" alt="Untitled%2028.png"></p><h3 id="4-3-3、dubbo原理-服务暴露"><a href="#4-3-3、dubbo原理-服务暴露" class="headerlink" title="4.3.3、dubbo原理    -   服务暴露"></a>4.3.3、dubbo原理    -   服务暴露</h3><p><img src="dubbo-%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2.jpg" alt="dubbo-%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2.jpg"></p><p>Service标签牵扯到服务暴漏的功能，ServiceBean它实现了InitalizingBean（它在创建完对象以后调用afterPropertisSet方法）、ApplicationListener(事件是ContextRefreshedEvent(当IOC容器完成后会回调onApplicationEvent方法))</p><p>afterPropertisSet方法和onApplicationEvent方法都做了什么：</p><p>afterPropertisSet方法保存配置的属性信息。</p><p>onApplicationEvent方法判断当没有爆露时调用export方法暴漏服务，调用doExport方法。调用doExportUrls方法，第一步加载注册信息，再调用doExportUrlsFor1Portocol方法，创建invoker，调用protocol(DubboProtocol).export(wrapperInvoker)</p><p>暴漏URL,OPENServer(url)，启动netty服务器，监听20880端口</p><p>创建服务器createServer(url)</p><p>Exchangers.bind(url,requestHandler)绑定url和处理器</p><p>Transporters.bind(url,new DecodeHandler(new HanderExchangesHandler()))这都是netty的底层，创建一个netty的服务器。</p><p>注册提供者。</p><p>总共2步：</p><p>启动netty服务器，监听20880端口。</p><p>注册中心进行注册服务，把注册好的地址，把注册信息保存在注册中心。</p><p>microkernel plugin模式</p><h3 id="4-3-4、dubbo原理-服务引用"><a href="#4-3-4、dubbo原理-服务引用" class="headerlink" title="4.3.4、dubbo原理    -   服务引用"></a>4.3.4、dubbo原理    -   服务引用</h3><p>如何通过配置reference标签远程引用暴漏的服务。</p><p><img src="Untitled%2029.png" alt="Untitled"></p><p>前置类似暴漏服务原理，对应的是ReferenceBean,特殊在implement FactoryBean，FactoryBean作用是当我们要获取userService，在引用userService的类中需要自动注入userService，需要从spring容器中找，通过调用FactoryBean的getObject方法获取userService对象，getObject调用ReferenceConfig的getT方法，如果ref引用是空的，就init（）初始化对象，ref = createProxy（map）。</p><p><img src="Untitled%2030.png" alt="Untitled"></p><p><img src="Untitled%2031.png" alt="Untitled"></p><p>然后远程引用接口，urls保存了注册中心的地址。</p><p><img src="Untitled%2032.png" alt="Untitled"></p><p>refprotocal还是Protocal，Protocal有2种，1个是DubboProtocal，另一个是RegistryProtocol，这里调用RegistryProtocol的refer方法。</p><p><img src="Untitled%2033.png" alt="Untitled"></p><p>先根据注册中心地址得到注册中心信息。然后调用doRefer,传入了注册中心地址，还有要引用的userService</p><p><img src="Untitled%2034.png" alt="Untitled"></p><p>之后进行订阅服务</p><p><img src="Untitled%2035.png" alt="Untitled"></p><p>订阅服务会进入到DubboProtocol，DubboProtocol会getClients获取客户端。</p><p><img src="Untitled%2036.png" alt="Untitled"></p><p>拿到客户端，初始化客户端</p><p><img src="Untitled%2037.png" alt="Untitled"></p><p>然偶会进行连接</p><p><img src="Untitled%2038.png" alt="Untitled"></p><p>获取返回连接，调用Transporter.connect（），之后就到达了netty的底层。</p><p><img src="Untitled%2039.png" alt="Untitled"></p><p><img src="Untitled%2040.png" alt="Untitled"></p><p><img src="Untitled%2041.png" alt="Untitled"></p><p>相当于创建一个netty客户端，根据url地址监听一个端口。创建完连接后返回DubboProtocol中，创建好invoker，返回invoker。</p><p><img src="Untitled%2042.png" alt="Untitled"></p><p>获取创建好的invoker，里面有url地址，消费者地址。之后在消费者注册表里把刚创建的invoker注册进去。注册进入subscribeUrl订阅地址。记录消费者消费哪个服务。</p><p><img src="Untitled%2043.png" alt="Untitled"></p><p>保存好了后返回到doRefer()</p><p><img src="Untitled%2044.png" alt="Untitled"></p><p>但后一直返回到createProxy。ref代理对象就创建好了，远程信息等都在里面存好了。</p><p>之后使用代理对象来执行远程调用方法。</p><p><img src="Untitled%2045.png" alt="Untitled"></p><h3 id="4-3-5、dubbo原理-服务调用"><a href="#4-3-5、dubbo原理-服务调用" class="headerlink" title="4.3.5、dubbo原理    -   服务调用"></a>4.3.5、dubbo原理    -   服务调用</h3><p>整体流程：</p><p><img src="Untitled%2046.png" alt="Untitled"></p><p>代理对象如何执行方法呢，在这里打个断点。</p><p><img src="Untitled%2047.png" alt="Untitled"></p><p>会调用invoke，并且会传入method和args并封装成一个叫RpcInvocation远程调用的对象。</p><p><img src="Untitled%2048.png" alt="Untitled"></p><p>之后再进一个Invoker，它里面封装了FailOverCluster，他是dubbo带集群容错功能的invoker</p><p><img src="Untitled%2049.png" alt="Untitled"></p><p>进去后查询有多少个可执行版本的方法，再获取负载均衡的机制，之后继续doInvoke</p><p><img src="Untitled%2050.png" alt="Untitled"></p><p>之后有个select能根据我们的负载均衡策略进行负载随机选择1个invoker</p><p><img src="Untitled%2051.png" alt="Untitled"></p><p>接下来调用invoker.invoke执行，到了真正要执行时还封装了一些filter，这个filter在最开始proxy代理对象要用invoker时会在外面封装filter来做（local、mock、cache）</p><p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/local-mock/">https://dubbo.apache.org/zh/docsv2.7/user/examples/local-mock/</a></p><p><a href="https://dubbo.apache.org/zh/docsv2.7/user/examples/result-cache/">https://dubbo.apache.org/zh/docsv2.7/user/examples/result-cache/</a></p><p>缓存功能时，然后invoker选中了负载均衡功能后，又进入filter，filter就是各个统计信息（监控中心等）ProtocolFilter，ProtocolFilter里封装到最终时DubboInvoker.</p><p><img src="Untitled%2052.png" alt="Untitled"></p><p><img src="Untitled%2053.png" alt="Untitled"></p><p><img src="Untitled%2054.png" alt="Untitled"></p><p>在DubboInvoker中获取到在服务引用时建立的客户端，拿到引用的哪个远程服务，之后再request发起请求，返回结果。这里request就已经进入到底层了。之后拿客户端，拿通道。</p><p><img src="Untitled%2055.png" alt="Untitled"></p><p><img src="Untitled%2056.png" alt="Untitled"></p><p><img src="Untitled%2057.png" alt="Untitled"></p><p>然后给通道发送出去。</p><p><img src="Untitled%2058.png" alt="Untitled"></p><p>之后返回拿到返回结果对象，里面封装了结果数据</p><p><img src="Untitled%2059.png" alt="Untitled"></p><p>返回返回， 之后打印到控制台。</p><p><img src="Untitled%2060.png" alt="Untitled"></p><h1 id="5-结束语"><a href="#5-结束语" class="headerlink" title="5.结束语"></a>5.结束语</h1><p>祝大家学业有成</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dubbo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring笔记</title>
      <link href="/2021/08/13/Spring%E7%AC%94%E8%AE%B0/"/>
      <url>/2021/08/13/Spring%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="1、spring"><a href="#1、spring" class="headerlink" title="1、spring"></a>1、spring</h1><h2 id="1-1、简介"><a href="#1-1、简介" class="headerlink" title="1.1、简介"></a>1.1、简介</h2><ul><li>spring:春天—→给软件按行业带来了春天</li><li>2002,首次推出Spring雏形：interface21框架！</li><li>Spring框架即以interface21框架为基础，经过重新设计，并不断丰富其内涵，于2004年3月24号发布1.0版本</li><li>Rod Johnson,framework创始人，音乐博士</li><li>Spring理念：使现有技术更加容易使用，本身是个大杂烩，整合了现有的技术框架。</li></ul><p>官网：<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/overview.html#overview">https://docs.spring.io/spring-framework/docs/current/reference/html/overview.html#overview</a></p><p>官方Github地址：<a href="https://github.com/spring-projects/spring-framework">https://github.com/spring-projects/spring-framework</a></p><p>maven-spring:</p><p>我们导入spring-webmvc后，他会导入其他很多，除了spring-webmvc，可能还需要jdbc</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">5.3</span><span class="number">.9</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.springframework/spring-jdbc --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">5.3</span><span class="number">.9</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="1-2、优点"><a href="#1-2、优点" class="headerlink" title="1.2、优点"></a>1.2、优点</h2><ul><li>开源的免费框架</li><li>轻量级、非入侵式的框架</li><li>控制反转(IOC)、面向切面(AOP)</li><li>支持事务的处理、支持声明式事务</li><li>对框架整合的支持</li></ul><p><strong><em>总结一句话：Spring就是一个轻量级非入侵的控制反转(IOC)和面向切面(AOP)编程的框架</em></strong></p><h2 id="1-3、组成"><a href="#1-3、组成" class="headerlink" title="1.3、组成"></a>1.3、组成</h2><p><img src="Untitled.png" alt="Untitled"></p><p>7大部分组成：</p><ul><li>core：核心</li><li>aop：</li><li>orm：</li><li>dao：dao层</li><li>web：</li><li>web mvc：</li><li>context：对ui界面等支持</li></ul><h2 id="1-4、扩展"><a href="#1-4、扩展" class="headerlink" title="1.4、扩展"></a>1.4、扩展</h2><p>现代化的java开发。</p><p><img src="Untitled%201.png" alt="Untitled"></p><p>构建一切(springboot)、协调一切(springcloud)、连接一切(spring data flow)</p><p>springboot：快速开发的脚手架；可以快速开发微服务，约定大于配置。</p><p>springcloud：基于springboot实现的，微服务的整合。</p><p>弊端：spring发展太久后，违背了原来的理念！配置十分繁琐，人称配置地狱。直到springboot</p><h1 id="2、IOC"><a href="#2、IOC" class="headerlink" title="2、IOC"></a>2、IOC</h1><h2 id="2-1、理论推导"><a href="#2-1、理论推导" class="headerlink" title="2.1、理论推导"></a>2.1、理论推导</h2><p>原来的步骤：</p><p>1.UserDao接口</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">public interface UserDao &#123;</span><br><span class="line">    public <span class="keyword">void</span> getUser();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.UserDaoImpl实现类</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="title">implements</span> <span class="title">UserDao</span></span>&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">getUser</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取用户数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserDaoMysqlImpl</span> <span class="title">implements</span> <span class="title">UserDao</span></span>&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">getUser</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDaoMysql&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.UserService业务接口</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kuang.dao.UserDao;</span><br><span class="line"></span><br><span class="line">public interface UserService &#123;</span><br><span class="line">    <span class="keyword">void</span> getUser();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> setUserDao(UserDao userDao);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.UserServiceImpl业务实现类</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kuang.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.kuang.dao.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.kuang.dao.UserDaoMysqlImpl;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="title">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增加了UserDaoMysql,只能改变原来的类,会因为用户的需求改变原有的业务代码，适应不了用户的变更</span></span><br><span class="line">    <span class="comment">//private UserDao userDao = new UserDaoImpl();</span></span><br><span class="line">    private UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加set方法，利用set实现动态实现值的输入</span></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setUserDao</span>(<span class="params">UserDao userDao</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">getUser</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        userDao.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.Client</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.kuang.dao.UserDaoMysqlImpl;</span><br><span class="line"><span class="keyword">import</span> com.kuang.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.kuang.service.UserServiceImpl;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>)</span> &#123;</span><br><span class="line">        <span class="comment">//用户实际是调用的业务层，dao层他们不用接触！</span></span><br><span class="line">        UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//有个set后，用户想用什么直接去自己创建就可以了</span></span><br><span class="line">        userService.setUserDao(<span class="keyword">new</span> UserDaoMysqlImpl());</span><br><span class="line"></span><br><span class="line">        userService.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样做的时候，我们写一下看出现什么问题，创建spring-study。</p><p>在我们之前的业务中，用户的需求可能会影响我们原来的代码，我们需要更具需求去修改源代码！如果代码量大，修改一次的成本代价十分昂贵。</p><p>我们使用了Set接口实现，发生了革命性的变化！</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加set方法，利用set实现动态实现值的输入</span></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setUserDao</span>(<span class="params">UserDao userDao</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>之前，程序是主动性创建对象！控制权在程序员手上！</li><li>使用了Set之后，程序不再具有主动性，而是变成了被动的接受对象！</li></ul><p>现在我们的程序由主动创建对象，通过set方式编程被动接收对象去操作，这就叫控制反转。</p><p>这种思想，从本质想解决了问题，我们程序员不再去管理对象的创建了。系统的耦合性大大降低，可以更加专注在业务的实现上。(当增加新东西后，给客户端，我们程序的架构不用变)，这是IOC原型！</p><p><a href="https://blog.csdn.net/qq_33369905/article/details/106647330?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162908447416780269868479%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=162908447416780269868479&biz_id=0&spm=1018.2226.3001.4450">https://blog.csdn.net/qq_33369905/article/details/106647330?ops_request_misc=%7B%22request%5Fid%22%3A%22162908447416780269868479%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&amp;request_id=162908447416780269868479&amp;biz_id=0&amp;spm=1018.2226.3001.4450</a></p><p>早期：</p><p><img src="Untitled%202.png" alt="Untitled"></p><p>现在：</p><p><img src="Untitled%203.png" alt="Untitled"></p><h2 id="2-2、本质"><a href="#2-2、本质" class="headerlink" title="2.2、本质"></a>2.2、本质</h2><p>控制反转IoC(Inversion of Control)，是一种设计思想，<strong>DI(依赖注入)是实现IoC的一种方式</strong>，也有人认为DI只是IoC的另一种说法。<strong>没有IoC</strong>的程序中 , 我们使用面向对象编程 , <strong>对象的创建与对象间的依赖</strong>关系<strong>完全硬编码在程序中</strong>，对象的创建由程序自己控制；<strong>控制反转后</strong>将对象的<strong>创建转移给第三方</strong>，个人认为所谓控制反转就是：<strong>获得依赖对象的方式反转了</strong>。</p><p><img src="Untitled%204.png" alt="Untitled"></p><p>图1：早些时候我们想能在4轮子之间增加个中间件，调用中间件就可以了。于是乎图2 IOC容器诞生了。然后就是用户想要调谁就调谁。</p><p><strong>IoC是Spring框架的核心内容</strong>，使用多种方式完美的实现了IoC，可以使用XML配置，也可以使用注解，新版本的Spring也可以零配置实现IoC。</p><p>Spring容器在初始化时先读取配置文件，根据配置文件或元数据创建与组织对象存入容器中，程序使用时再从Ioc容器中取出需要的对象。</p><p><img src="Untitled%205.png" alt="Untitled"></p><p><img src="Untitled%206.png" alt="Untitled"></p><p>采用XML方式配置Bean的时候，Bean的定义信息是和实现分离的，而采用注解的方式可以把两者合为一体，Bean的定义信息直接以注解的形式定义在实现类中，从而达到了零配置的目的。</p><p><strong>控制反转是一种通过描述（XML或注解）并通过第三方去生产或获取特定对象的方式。在Spring中实现控制反转的是IoC容器，其实现方法是依赖注入（Dependency Injection,DI）。</strong></p><h1 id="3、HelloSpring"><a href="#3、HelloSpring" class="headerlink" title="3、HelloSpring"></a>3、HelloSpring</h1><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">guoyh</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    private <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setName</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">show</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--  使用Spring创建对象,在Spring中这些都成为bean</span><br><span class="line">      bean = 对象     <span class="keyword">new</span> Hello();</span><br><span class="line"></span><br><span class="line">      类型  变量名  = <span class="keyword">new</span> 类型();</span><br><span class="line">      Hello hello = <span class="keyword">new</span> Hello();</span><br><span class="line"></span><br><span class="line">      id = 变量名</span><br><span class="line">      <span class="class"><span class="keyword">class</span> </span>= <span class="keyword">new</span>的对象全路径</span><br><span class="line">      property 相当于给对象中的属性设置一个值</span><br><span class="line">      --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;hello&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.Hello&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;Spring&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.kuang.pojo.Hello;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>)</span> &#123;</span><br><span class="line">        <span class="comment">//获取spring的上下文对象！</span></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//我们的对象现在都在spring中管理了，我们要使用，直接去里面取出来就可以了！</span></span><br><span class="line">        Hello hello = (Hello) context.getBean(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        hello.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>思考问题:</p><p>Hello对象是谁创建的？</p><p>hello对象是怎么创建的？</p><p>这个过程叫控制反转！<br>控制：谁来控制对象的创建，传统的应用程序是由程序本身创建的，使用了Spring后，对象是由Spring创建的。</p><p>反转：程序本身不创建对象，变成被动的接受对象</p><p>依赖注入：就是利用set方法注入的</p><p>IOC是一种编程思想，由主动编程编程被动的接收</p><p>可以通过ClassPathXmlApplicationContext去浏览一下底层的源码。</p><p><img src="Untitled%207.png" alt="Untitled"></p><p>创建bean有很多种：注解、xml、文件</p><p><img src="Untitled%208.png" alt="Untitled"></p><p>OK，到了现在，我们彻底不用在程序中改动了，要实现不同的操作，只需要在xml配置文件中进行修改，所谓的ioc，一句话：对象由Spring来创建，管理，装配。</p><h1 id="4、IOC对象创建方式"><a href="#4、IOC对象创建方式" class="headerlink" title="4、IOC对象创建方式"></a>4、IOC对象创建方式</h1><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    private <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">    public <span class="function"><span class="title">User</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;User的无参构造&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="function"><span class="title">User</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setName</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">show</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;name=&quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.使用无参构造创建对象(默认实现)</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;user&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;admin&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>2.使用有参构造时</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span></span><br><span class="line">&lt;!--  下标赋值  --&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;user&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="title">constructor</span>-<span class="title">arg</span> <span class="title">index</span>=&quot;0&quot; <span class="title">value</span>=&quot;<span class="title">admin</span>&quot;/&gt;</span><br><span class="line">&lt;/<span class="title">bean</span>&gt;</span><br><span class="line">2.</span><br><span class="line">&lt;!--  不建议使用  --&gt;</span><br><span class="line">&lt;<span class="title">bean</span> <span class="title">id</span>=&quot;<span class="title">user</span>&quot; <span class="title">class</span>=&quot;<span class="title">com</span>.<span class="title">kuang</span>.<span class="title">pojo</span>.<span class="title">User</span>&quot;&gt;</span><br><span class="line">    &lt;<span class="title">constructor</span>-<span class="title">arg</span> <span class="title">type</span>=&quot;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span>&quot; <span class="title">value</span>=&quot;<span class="title">admin</span>&quot;/&gt;</span><br><span class="line">&lt;/<span class="title">bean</span>&gt;</span><br><span class="line">3.</span><br><span class="line">&lt;!--  通过参数名赋值  --&gt;</span><br><span class="line">&lt;<span class="title">bean</span> <span class="title">id</span>=&quot;<span class="title">user3</span>&quot; <span class="title">class</span>=&quot;<span class="title">com</span>.<span class="title">kuang</span>.<span class="title">pojo</span>.<span class="title">User</span>&quot;&gt;</span><br><span class="line">    &lt;<span class="title">constructor</span>-<span class="title">arg</span> <span class="title">name</span>=&quot;<span class="title">name</span>&quot; <span class="title">value</span>=&quot;<span class="title">admin</span>&quot;/&gt;</span><br><span class="line">&lt;/<span class="title">bean</span>&gt;</span><br></pre></td></tr></table></figure><p>3.无论用不用bean都会被实例化</p><p>总结：在配置文件加载的时候，容器中管理的对象就已经初始化了！默认单例</p><h1 id="5、Spring配置"><a href="#5、Spring配置" class="headerlink" title="5、Spring配置"></a>5、Spring配置</h1><h2 id="3-1、别名"><a href="#3-1、别名" class="headerlink" title="3.1、别名"></a>3.1、别名</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  别名  --&gt;</span><br><span class="line">&lt;alias name=<span class="string">&quot;user1&quot;</span> alias=<span class="string">&quot;user&quot;</span>/&gt;</span><br></pre></td></tr></table></figure><h2 id="3-2、Bean的配置"><a href="#3-2、Bean的配置" class="headerlink" title="3.2、Bean的配置"></a>3.2、Bean的配置</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!--</span><br><span class="line">    id:bean的唯一标识符</span><br><span class="line">    class:bean对象对应的全限定名：包名+类型</span><br><span class="line">    name:也是别名，而且可以起多个</span><br><span class="line">      --&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;us&quot;</span> name=<span class="string">&quot;use,use2 use3;use4&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span> scope=<span class="string">&quot;prototype&quot;</span>&gt;</span><br><span class="line">    &lt;description&gt;User&lt;/description&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;kuang&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><h2 id="3-3、Import"><a href="#3-3、Import" class="headerlink" title="3.3、Import"></a>3.3、Import</h2><p>一般用于团队开发使用，将多个文件导入合并为一个applicationContext.xml</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;<span class="keyword">import</span> resource=<span class="string">&quot;beans.xml&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>内容相同也会被合并</p><h1 id="6、DI依赖注入"><a href="#6、DI依赖注入" class="headerlink" title="6、DI依赖注入"></a>6、DI依赖注入</h1><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-dependencies">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-dependencies</a></p><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-collection-elements">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-collection-elements</a></p><h2 id="6-1、构造器注入"><a href="#6-1、构造器注入" class="headerlink" title="6.1、构造器注入"></a>6.1、构造器注入</h2><p>。。。</p><h2 id="6-2、Set方式注入"><a href="#6-2、Set方式注入" class="headerlink" title="6.2、Set方式注入"></a>6.2、Set方式注入</h2><ul><li>依赖注入：Set注入！</li><li>依赖：bean对象的创建依赖于容器</li><li>注入：bean对象的所有属性，由容器来注入</li></ul><p>【环境搭建】：</p><p>1.复杂类型</p><p>Address.java</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">guoyh</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    private <span class="built_in">String</span> address;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getAddress</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setAddress</span>(<span class="params"><span class="built_in">String</span> address</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Address&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;address=&#x27;&quot;</span> + address + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Student.java</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">guoyh</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    private <span class="built_in">String</span> name;</span><br><span class="line">    private Address address;</span><br><span class="line">    private <span class="built_in">String</span>[] books;</span><br><span class="line">    private List&lt;<span class="built_in">String</span>&gt; hobbys;</span><br><span class="line">    private <span class="built_in">Map</span>&lt;<span class="built_in">String</span>,<span class="built_in">String</span>&gt; card;</span><br><span class="line">    private <span class="built_in">Set</span>&lt;<span class="built_in">String</span>&gt; games;</span><br><span class="line">    private Properties info;</span><br><span class="line">    private <span class="built_in">String</span> wife;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setName</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Address <span class="function"><span class="title">getAddress</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setAddress</span>(<span class="params">Address address</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span>[] <span class="function"><span class="title">getBooks</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> books;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setBooks</span>(<span class="params"><span class="built_in">String</span>[] books</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.books = books;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;<span class="built_in">String</span>&gt; <span class="function"><span class="title">getHobbys</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hobbys;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setHobbys</span>(<span class="params">List&lt;<span class="built_in">String</span>&gt; hobbys</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hobbys = hobbys;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; <span class="function"><span class="title">getCard</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> card;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setCard</span>(<span class="params"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; card</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.card = card;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">Set</span>&lt;<span class="built_in">String</span>&gt; <span class="function"><span class="title">getGames</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> games;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setGames</span>(<span class="params"><span class="built_in">Set</span>&lt;<span class="built_in">String</span>&gt; games</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.games = games;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Properties <span class="function"><span class="title">getInfo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setInfo</span>(<span class="params">Properties info</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.info = info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getWife</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> wife;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setWife</span>(<span class="params"><span class="built_in">String</span> wife</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.wife = wife;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, address=&quot;</span> + address.toString() +</span><br><span class="line">                <span class="string">&quot;, books=&quot;</span> + Arrays.toString(books) +</span><br><span class="line">                <span class="string">&quot;, hobbys=&quot;</span> + hobbys +</span><br><span class="line">                <span class="string">&quot;, card=&quot;</span> + card +</span><br><span class="line">                <span class="string">&quot;, games=&quot;</span> + games +</span><br><span class="line">                <span class="string">&quot;, info=&quot;</span> + info +</span><br><span class="line">                <span class="string">&quot;, wife=&#x27;&quot;</span> + wife + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>beans.xml</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=<span class="string">&quot;address&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.Address&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;address&quot;</span> value=<span class="string">&quot;address&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=<span class="string">&quot;student&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.Student&quot;</span>&gt;</span><br><span class="line">        &lt;!--第一种，普通值的注入，value--&gt;</span><br><span class="line">        &lt;!--<span class="xml"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;kuang&quot;</span>/&gt;</span></span>--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span>&gt;</span><br><span class="line">            &lt;value&gt;kuang&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--第二种，bean注入，ref--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;address&quot;</span> ref=<span class="string">&quot;address&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--第三种，数组注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;books&quot;</span>&gt;</span><br><span class="line">            &lt;array&gt;</span><br><span class="line">                &lt;value&gt;红楼梦&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;西游戏&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;三国演义&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;水浒传&lt;/value&gt;</span><br><span class="line">            &lt;/array&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--第四种，list注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;hobbys&quot;</span>&gt;</span><br><span class="line">            &lt;list&gt;</span><br><span class="line">                &lt;value&gt;听歌&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;代码&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;电影&lt;/value&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--第五种，map注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">            &lt;map&gt;</span><br><span class="line">                &lt;entry key=<span class="string">&quot;身份证&quot;</span> value=<span class="string">&quot;123&quot;</span>/&gt;</span><br><span class="line">                &lt;entry key=<span class="string">&quot;银行卡&quot;</span> value=<span class="string">&quot;456&quot;</span>/&gt;</span><br><span class="line">            &lt;/map&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--第六种，set注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;games&quot;</span>&gt;</span><br><span class="line">            &lt;set&gt;</span><br><span class="line">                &lt;value&gt;VC&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;LOL&lt;/value&gt;</span><br><span class="line">            &lt;/set&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--第七种，<span class="literal">null</span>注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;wife&quot;</span>&gt;</span><br><span class="line">            &lt;<span class="literal">null</span>/&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--第八种，props注入--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;info&quot;</span>&gt;</span><br><span class="line">            &lt;props&gt;</span><br><span class="line">                &lt;prop key=<span class="string">&quot;学号&quot;</span>&gt;<span class="number">001</span>&lt;/prop&gt;</span><br><span class="line">                &lt;prop key=<span class="string">&quot;邮箱&quot;</span>&gt;<span class="number">123456</span>@qq.com&lt;/prop&gt;</span><br><span class="line">            &lt;/props&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>2.真实测试</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.kuang.pojo.Student;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>)</span> &#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        Student student = (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">        System.out.println(student.toString());</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Student&#123;name=&#x27;kuang&#x27;, address=Address&#123;address=&#x27;address&#x27;&#125;, books=[红楼梦, 西游戏, 三国演义, 水浒传], hobbys=[听歌, 代码, 电影], card=&#123;身份证=123, 银行卡=456&#125;, games=[VC, LOL], info=&#123;学号=001, 邮箱=123456@qq.com&#125;, wife=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-3、拓展方式注入"><a href="#6-3、拓展方式注入" class="headerlink" title="6.3、拓展方式注入"></a>6.3、拓展方式注入</h2><p>我们可以使用p和c命名空间进行注入。</p><p>注意：p命名和c命名不知直接使用需要导入约束。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line"> xmlns:c=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span><br><span class="line">       xmlns:p=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h3 id="1、p命名空间注入"><a href="#1、p命名空间注入" class="headerlink" title="1、p命名空间注入:"></a>1、<strong>p命名空间注入:</strong></h3><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-p-namespace">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-p-namespace</a></p><p>例子：</p><p>User.java</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    private <span class="built_in">String</span> name;</span><br><span class="line">    private int age;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setName</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int <span class="function"><span class="title">getAge</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setAge</span>(<span class="params">int age</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>userbeans.xml</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:p=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean name=<span class="string">&quot;user&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;someone&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;age&quot;</span> value=<span class="string">&quot;123&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--p命名空间,可以注入属性的值，property,通过set注入--&gt;</span><br><span class="line">    &lt;bean name=<span class="string">&quot;p-user&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span></span><br><span class="line">          p:name=<span class="string">&quot;someone&quot;</span> p:age=<span class="string">&quot;123&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">test</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;userbeans.xml&quot;</span>);</span><br><span class="line">    User student = context.getBean(<span class="string">&quot;p-user&quot;</span>,User.class);</span><br><span class="line">    System.out.println(student.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、c命名空间注入"><a href="#2、c命名空间注入" class="headerlink" title="2、c命名空间注入:"></a>2、<strong>c命名空间注入:</strong></h3><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-c-namespace">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-c-namespace</a></p><p>例子：</p><p>User.java-增加有参构造</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    private <span class="built_in">String</span> name;</span><br><span class="line">    private int age;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setName</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="function"><span class="title">User</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="function"><span class="title">User</span>(<span class="params"><span class="built_in">String</span> name, int age</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int <span class="function"><span class="title">getAge</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setAge</span>(<span class="params">int age</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>cuserbeans.xml</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:c=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean name=<span class="string">&quot;user&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;someone&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;age&quot;</span> value=<span class="string">&quot;123&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--c命名空间,可以注入属性的值,construct,通过构造器注入--&gt;</span><br><span class="line">    &lt;bean name=<span class="string">&quot;p-user&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span></span><br><span class="line">          c:name=<span class="string">&quot;someone&quot;</span> c:age=<span class="string">&quot;123&quot;</span> c:_0=<span class="string">&quot;someone&quot;</span> c:_1=<span class="string">&quot;123&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>测试:</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">test2</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;cuserbeans.xml&quot;</span>);</span><br><span class="line">    User student = context.getBean(<span class="string">&quot;c-user&quot;</span>,User.class);</span><br><span class="line">    System.out.println(student.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-4、Bean作用域"><a href="#6-4、Bean作用域" class="headerlink" title="6.4、Bean作用域"></a>6.4、Bean作用域</h2><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes</a></p><p><a href="https://www.notion.so/0bd0992aa4764165a604d301872cb00e">作用域分类</a></p><p>1、单例模式(默认)</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=<span class="string">&quot;c-user&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span></span><br><span class="line">          c:name=<span class="string">&quot;someone&quot;</span> c:age=<span class="string">&quot;123&quot;</span> c:_0=<span class="string">&quot;someone&quot;</span> c:_1=<span class="string">&quot;123&quot;</span> scope=<span class="string">&quot;singleton&quot;</span>/&gt;</span><br></pre></td></tr></table></figure><p>有时候并发情况下会产生延迟或不一致。</p><p>2、原型模式：每次从容器中get的时候都会产生一个新的对象！</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean name=<span class="string">&quot;c-user&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span></span><br><span class="line">          c:name=<span class="string">&quot;someone&quot;</span> c:age=<span class="string">&quot;123&quot;</span> c:_0=<span class="string">&quot;someone&quot;</span> c:_1=<span class="string">&quot;123&quot;</span> scope=<span class="string">&quot;prototype&quot;</span>/&gt;</span><br></pre></td></tr></table></figure><p>多线程时好用，但是浪费资源，尽量单例</p><p>3、其余的request、session、application，只有在webmvc时用。</p><h1 id="7、Bean的自动装配"><a href="#7、Bean的自动装配" class="headerlink" title="7、Bean的自动装配"></a>7、Bean的自动装配</h1><p>官方没讲</p><p>现在默认是手动装配。</p><p>自动装配是Spring满足Bean依赖的一种方式。</p><p>Spring会在上下文中自动寻找，并自动装配属性。</p><p>有三种：</p><p>1.在xml中显示配置：</p><p>2.在java中显示配置【后面讲】：</p><p>3.隐式的装配【重要】：</p><h2 id="7-1、测试"><a href="#7-1、测试" class="headerlink" title="7.1、测试"></a>7.1、测试</h2><p>1、环境：一个人有两个宠物！</p><p>people</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">People</span> </span>&#123;</span><br><span class="line">    private Cat cat;</span><br><span class="line">    private Dog dog;</span><br><span class="line">    private <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">    public Cat <span class="function"><span class="title">getCat</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setCat</span>(<span class="params">Cat cat</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Dog <span class="function"><span class="title">getDog</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setDog</span>(<span class="params">Dog dog</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setName</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dog</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">shout</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;旺旺&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>cat</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">shout</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;喵喵&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>beans.xml</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=<span class="string">&quot;cat&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.Cat&quot;</span>&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=<span class="string">&quot;dog&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.Dog&quot;</span>&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=<span class="string">&quot;people&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.People&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;cat&quot;</span> ref=<span class="string">&quot;cat&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dog&quot;</span> ref=<span class="string">&quot;dog&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;狂神&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h2 id="7-2、ByName自动装配"><a href="#7-2、ByName自动装配" class="headerlink" title="7.2、ByName自动装配"></a>7.2、ByName自动装配</h2><p>beans.xml</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;dog2&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.Dog&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--byName会自动查在容器上下文中查找，和自己对象set方法后面的值对应的beanid--&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;people&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.People&quot;</span> autowire=<span class="string">&quot;byName&quot;</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;狂神&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>people</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">setDog2</span>(<span class="params">Dog dog</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.dog = dog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>7.3、ByType自动装配</p><p>beans.xml</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--byType会自动查在容器上下文中查找，和自己对象对象属性类型相同的bean--&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;people&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.pojo.People&quot;</span> autowire=<span class="string">&quot;byType&quot;</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;狂神&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>假如有2个bean相同类型直接报错。弊端：必须保证这个bean类型全局唯一才可以。</p><p>好处：id可以省略</p><h2 id="7-4、使用注解实现自动装配"><a href="#7-4、使用注解实现自动装配" class="headerlink" title="7.4、使用注解实现自动装配"></a>7.4、使用注解实现自动装配</h2><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-autowired-annotation">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-autowired-annotation</a></p><p>jdk1.5支持注解</p><p>Spring2.5开始支持注解</p><p>要使用注解须知：</p><p>1.导入约束: xmlns:context</p><p>2.配置注解的支持:<a href="context:annotation-config/">context:annotation-config/</a>【重点】</p><p>3.</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">    xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">    xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">    xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--开启注解支持--&gt;</span><br><span class="line">    &lt;context:annotation-config/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h3 id="1、-Autowired"><a href="#1、-Autowired" class="headerlink" title="1、@Autowired"></a>1、@Autowired</h3><p>直接在属性上即可</p><p>set方法上也可以</p><p>使用Autowired可以不用编写set方法，前提是自动装配属性在IOC容器中存在且符合名字</p><p>Autowired = ByType</p><p>@Autowired (required = false)，required 是标志这个可以为空</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Nullable字段标记了这个属性，标志这个可以为空</span><br></pre></td></tr></table></figure><p>添加@Qualifier(value = “cat”)后使用ByName</p><p>如果@Autowired自动装配环境比较复杂，无法通过一个注解@Autowired完成装配时，可以使用@Qualifier(value=””)来配合@Autowired使用，指定一个唯一的bean</p><h3 id="2、-Resource"><a href="#2、-Resource" class="headerlink" title="2、@Resource"></a>2、@Resource</h3><p>java自带注解</p><p>@Resource会先通过名字查找，名字找不到通过类型找，两个找不到才报错。</p><p>@Resource(name = “dog”)指定唯一bean</p><p>小结：@Autowired和@Resource区别：</p><p>都是用来自动装配的，都可以放在属性字段上</p><p>@Autowired默认通过ByType，而且必须要求bean对象存在，否则报null【常用】</p><p>@Resource默认通过ByName，如果找不到名字，则通过ByType，如果两个都找不到时就报错</p><p>执行顺序不同：Autowired默认通过ByType，Resource默认通过ByName</p><p>Autowired还需要Qualifier辅助找Name</p><h1 id="8、使用注解开发"><a href="#8、使用注解开发" class="headerlink" title="8、使用注解开发"></a>8、使用注解开发</h1><p>在spring4之后，要使用注解开发，必须要保证aop包的导入.webmvc包括aop。</p><p><img src="Untitled%209.png" alt="Untitled"></p><p>在使用注解需要导入context约束，增加注解的支持。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--指定要扫描的包，这个包下的注解会自动生效，spring特定的注解--&gt;</span><br><span class="line">    &lt;context:component-scan base-package=<span class="string">&quot;com.kuang&quot;</span>/&gt;</span><br><span class="line">    &lt;context:annotation-config&gt;&lt;/context:annotation-config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h2 id="8-1、bean"><a href="#8-1、bean" class="headerlink" title="8.1、bean"></a>8.1、bean</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">guoyh</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//等价于注册一个bean</span></span><br><span class="line">@Component</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> name = <span class="string">&quot;秦将&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Component:组件，放在类上，说明这个类被Spring管理了，就是xml中的bean</p><h2 id="8-2、属性如何注入"><a href="#8-2、属性如何注入" class="headerlink" title="8.2、属性如何注入"></a>8.2、属性如何注入</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">guoyh</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//等价于注册一个bean</span></span><br><span class="line">@Component</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//相当于bean里的property中的配置属性值</span></span><br><span class="line">    @Value(<span class="string">&quot;秦将&quot;</span>)</span><br><span class="line">    public <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">    @Value(<span class="string">&quot;秦将&quot;</span>)</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setName</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>复杂的配置还是要是有配置文件。</p><h2 id="8-3、衍生的注解"><a href="#8-3、衍生的注解" class="headerlink" title="8.3、衍生的注解"></a>8.3、衍生的注解</h2><p>@Component的衍生注解，功能是一样的，都是组件注册到Spring中的意思。在web开发中会按照mvc三层分层：</p><ul><li>dao：@Repository</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line">@Repository</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>service：@Service</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>controller：@RestController、@Controller</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">@RestController</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-4、自动装配"><a href="#8-4、自动装配" class="headerlink" title="8.4、自动装配"></a>8.4、自动装配</h2><p>1.@Autowired:自动装配通过类型。名字<br>    如果Autowired不能唯一自动装配上属性，则需要通过@Qualifier(value=”name”)<br>2.@Nullable字段标记了这个属性，标志这个可以为null<br>3.@Resource:java自带注解,先通过名字查找，名字找不到通过类型找，两个找不到才报错。<br>    @Resource(name = “dog”)指定唯一bean</p><h2 id="8-5、作用域"><a href="#8-5、作用域" class="headerlink" title="8.5、作用域"></a>8.5、作用域</h2><p>1、@Scope(“singleton”)<br>2、@Scope(“prototype”)<br>3、@Scope(“request”)<br>4、@Scope(“session”)</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Scope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">@RestController</span><br><span class="line">@Scope(<span class="string">&quot;singleton&quot;</span>)</span><br><span class="line">@Scope(<span class="string">&quot;prototype&quot;</span>)</span><br><span class="line">@Scope(<span class="string">&quot;request&quot;</span>)</span><br><span class="line">@Scope(<span class="string">&quot;session&quot;</span>)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-6、小结"><a href="#8-6、小结" class="headerlink" title="8.6、小结"></a>8.6、小结</h2><p>1、xml与注解：</p><ul><li>xml更加万能，适用于任何场景！可以配置不是自己的类</li><li>注解不是自己的类是用不了，维护相对复杂！</li></ul><p>2、除了springboot会用注解，spring用xml更强大。</p><p>3、xml与注解最佳实践：</p><ul><li>xml用来管理bean</li><li>注解完成属性的注入</li><li>我们在使用过程中需要注意：必须让注解生效就需要开启注解的支持</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--指定要扫描的包，这个包下的注解会自动生效，spring特定的注解--&gt;</span><br><span class="line">    &lt;context:component-scan base-package=<span class="string">&quot;com.kuang&quot;</span>/&gt;</span><br><span class="line">    &lt;context:annotation-config&gt;&lt;/context:annotation-config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h1 id="9、基于Java的方式配置Spring"><a href="#9、基于Java的方式配置Spring" class="headerlink" title="9、基于Java的方式配置Spring"></a>9、基于Java的方式配置Spring</h1><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java">https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java</a></p><p>我们现在完全不使用Spring的xml配置了，全权交给java来做。</p><p>JavaConfig是Spring的子项目，在Spring4之后成为了核功能，现在是推荐了。</p><p>配置类：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Configuration本身就是Component,这个类也会注册到IOC容器,Configuration代表着是一个配置类，就是beans.xml</span></span><br><span class="line">@Configuration</span><br><span class="line"><span class="comment">//扫描其他包下的注解</span></span><br><span class="line">@ComponentScan(<span class="string">&quot;com.kuang&quot;</span>)</span><br><span class="line"><span class="comment">//引入配置类</span></span><br><span class="line">@Import(MyConfig.class)</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法名=bean.id</span></span><br><span class="line">    <span class="comment">//注册一个bean相当于之前写的bean</span></span><br><span class="line">    <span class="comment">//方法的返回值相当于bean标签的class</span></span><br><span class="line"><span class="comment">//name可以指定bean的name</span></span><br><span class="line">    @Bean(name = <span class="string">&quot;getUser2&quot;</span>)</span><br><span class="line">    public User <span class="function"><span class="title">getUser</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实体类</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注册到容器</span></span><br><span class="line">@Component</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    private <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">    public <span class="built_in">String</span> <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Value(<span class="string">&quot;狂神&quot;</span>)</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setName</span>(<span class="params"><span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试类</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.kuang.config.MyConfig;</span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">test</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">//如果完全使用了配置类方式做，只能通过AnnotationConfigApplicationContext来获取容器</span></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(MyConfig.class);</span><br><span class="line">        <span class="comment">//扫描包注册的bean</span></span><br><span class="line">User user = context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line"><span class="comment">//配置类中手动注册的bean</span></span><br><span class="line">        User user2 = context.getBean(<span class="string">&quot;getUser&quot;</span>, User.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(user.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="10、代理模式"><a href="#10、代理模式" class="headerlink" title="10、代理模式"></a>10、代理模式</h1><p>为什么用代理模式？aop的基础</p><p>分类：</p><ul><li>静态代理</li><li>动态代理</li></ul><h2 id="10-1、静态代理"><a href="#10-1、静态代理" class="headerlink" title="10.1、静态代理"></a>10.1、静态代理</h2><p><img src="Untitled%2010.png" alt="Untitled"></p><p>角色分析：</p><p>抽象角色：一般使用接口或抽象类解决。出租房</p><p>真实角色：被代理的角色。房东</p><p>代理角色：代理真实角色，代理真实角色后，我们一般会做一些附属操作。中介</p><p>客户：访问代理对象的人！我</p><p><strong><em>spring-08-proxy:demo01</em></strong></p><p>代码步骤：</p><p>1.接口:出租</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.demo01;</span><br><span class="line"></span><br><span class="line"><span class="comment">//出租</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Rent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.真实角色:房东</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Host</span> <span class="keyword">implements</span> <span class="title">Rent</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;房东出租房屋&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.代理角色:中介</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.demo01;</span><br><span class="line"></span><br><span class="line"><span class="comment">//中介</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Rent</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Host host;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">(Host host)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        seeHost();</span><br><span class="line">        sign();</span><br><span class="line">        fee();</span><br><span class="line">        host.rent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//看房</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">seeHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;看房&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//收费</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收费&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//签合同</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sign</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;签合同&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.客户端访问代理角色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//房东要出租房屋</span></span><br><span class="line">        Host host = <span class="keyword">new</span> Host();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//代理，中介帮助房东出租房屋</span></span><br><span class="line">        Proxy proxy = <span class="keyword">new</span> Proxy(host);</span><br><span class="line">        <span class="comment">//找中介租房</span></span><br><span class="line">        proxy.rent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代理模式的好处：</p><ul><li>可以使真是的角色更加纯粹，不用关注公共业务</li><li>公共业务交给代理角色，<strong>实现业务的分共!</strong></li><li><strong>公共业务发生扩展的时候,方便集中管理</strong></li><li>耦合性降低了</li></ul><p>缺点：</p><ul><li>一个真实角色就产生一个代理角色；代码量翻倍~开发效率遍地</li><li>解决需要用动态代理~反射</li></ul><h2 id="10-2、静态代理加深理解"><a href="#10-2、静态代理加深理解" class="headerlink" title="10.2、静态代理加深理解"></a>10.2、静态代理加深理解</h2><p><strong><em>spring-08-proxy:demo02</em></strong></p><ol><li><strong>实现业务的分共!</strong></li><li><strong>公共业务发生扩展的时候,方便集中管理</strong></li></ol><p>实例：</p><p>userService</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.demo02;</span><br><span class="line"></span><br><span class="line">public interface UserService &#123;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> add();</span><br><span class="line">    public <span class="keyword">void</span> <span class="keyword">delete</span>();</span><br><span class="line">    public <span class="keyword">void</span> update();</span><br><span class="line">    public <span class="keyword">void</span> query();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>userServiceImpl</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.demo02;</span><br><span class="line"></span><br><span class="line"><span class="comment">//真实对象</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="title">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;增加了一个用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">delete</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;删除了一个用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;修改了一个用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">query</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;查询一个用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Client</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.demo02;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>)</span> &#123;</span><br><span class="line">        UserServiceImpl userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        userService.add();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在客户要求增加一个功能，在不改变原有代码的基础上。</p><p>增加一个代理:</p><p>UserServiceProxy</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.demo02;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserServiceProxy</span> <span class="title">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    UserServiceImpl userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line"></span><br><span class="line">    public <span class="function"><span class="title">UserServiceProxy</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">setUserService</span>(<span class="params">UserServiceImpl userService</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        log(<span class="string">&quot;add&quot;</span>);</span><br><span class="line">        userService.add();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">delete</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        log(<span class="string">&quot;delete&quot;</span>);</span><br><span class="line">        userService.delete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">update</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        log(<span class="string">&quot;update&quot;</span>);</span><br><span class="line">        userService.update();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">query</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        log(<span class="string">&quot;query&quot;</span>);</span><br><span class="line">        userService.query();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//日志</span></span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">log</span>(<span class="params"><span class="built_in">String</span> msg</span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[INFO]使用了&quot;</span> + msg + <span class="string">&quot;方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.demo02;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>)</span> &#123;</span><br><span class="line">        UserServiceImpl userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        userService.add();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//找代理做</span></span><br><span class="line">        UserServiceProxy proxy = <span class="keyword">new</span> UserServiceProxy();</span><br><span class="line">        proxy.setUserService(userService);</span><br><span class="line">        proxy.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>为什么不能在原有基础上加，在公司是大忌，容易崩！</strong></p><p>横向开发和纵向开发，增加log功能时增加代理类，AOP的实现机制:</p><p><img src="Untitled%2011.png" alt="Untitled"></p><h2 id="10-3、动态代理"><a href="#10-3、动态代理" class="headerlink" title="10.3、动态代理"></a>10.3、动态代理</h2><p><strong><em>spring-08-proxy:demo03,demo04</em></strong></p><p>底层是反射</p><ul><li>动态代理和静态代理角色一样</li><li>动态代理的代理类是动态生成的，不是直接写好的！静态是直接写的，比较麻烦</li><li>动态代理分为两大类：基于接口的动态代理；基于类的动态代理；<ol><li>基于接口：JDK原生动态代理【我们在这里使用】</li><li>基于类：cglib</li><li>java字节码：javasist，优点：简单、快速、直接只有java编码，不需要了解虚拟机指令，能动态改变类的结构，动态生成类。</li></ol></li></ul><p><strong>需要了解两个类：Proxy：代理、InvocationHandler：调用处理程序</strong></p><p>1、<strong>InvocationHandler：</strong></p><p>java.lang.reflect包下的接口。<strong>InvocationHandler</strong>是由代理实例的调用处理程序的接口，每个代理实例都有一个关联的调用处理程序，当在代理实例上调用方法时，方法将调用将被编码并分派到其调用处理程序的invoke方法</p><p>只有1个方法，3个参数：proxy：调用该方法的代理实例；method：所属方法对应于调用代理实例上的接口方法的实例。方法对象的声明类将是该方法声明的接口，可以是代理类继承该方法的代理接口的超级接口；args：方法调用传递代理实例的参数的对象的阵列或null。</p><p>他是一个中间程序。</p><p><strong>2、Proxy：</strong></p><p>提供了创建动态代理类和实例的静态方法。</p><p><img src="Untitled%2012.png" alt="Untitled"></p><p>方法：</p><p><img src="Untitled%2013.png" alt="Untitled"></p><p>动态代理好处：</p><ul><li>可以使真是的角色更加纯粹，不用关注公共业务</li><li>公共业务交给代理角色，<strong>实现业务的分共!</strong></li><li><strong>公共业务发生扩展的时候,方便集中管理</strong></li><li>耦合性降低了</li><li>一个动态代理代理的是一个接口，一般对于一类业务</li><li>一个动态代理可以代理多个实现同一个接口的类</li></ul><h1 id="11、AOP"><a href="#11、AOP" class="headerlink" title="11、AOP"></a>11、AOP</h1><h2 id="11-1-什么是AOP"><a href="#11-1-什么是AOP" class="headerlink" title="11.1 什么是AOP"></a>11.1 什么是AOP</h2><p>AOP (Aspect Oriented Programming) 意为：面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。AOP是OOP的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容是函数式编程的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p><p><img src="Untitled%2014.png" alt="Untitled"></p><p>目标对象的业务增加日志、验证功能，在不改变原有角色的情况下。</p><h2 id="11-2-AOP在Spring中的作用"><a href="#11-2-AOP在Spring中的作用" class="headerlink" title="11.2 AOP在Spring中的作用"></a>11.2 AOP在Spring中的作用</h2><p>提高声明式事务，允许用户自定义切面。</p><ul><li>横切关注点:跨越应用程序多个模块的方法或功能。即是，与我们业务逻辑无关的，但是我们需要关注的部分，就是横切关注点。如日志,安全,缓存,事务等等…</li><li>切面(ASPECT) :横切关注点被模块化的特殊对象。即，它是一个<strong>类</strong>。</li><li>通知(Advice) :切面必须要完成的工作。即，它是类中的-一个<strong>方法</strong>。</li><li>目标(Target) :被通知对象，<strong>接口或方法</strong>。</li><li>代理(Proxy) :向目标对象应用通知之后创建的对象，<strong>代理类</strong>。</li><li>切入点(PointCut) :切面通知执行的“地点”的定义，**哪个地方执行(method.invoke())**。</li><li>连接点(JointPoint) :与切入点匹配的执行点,，**哪个地方执行(method.invoke())**。</li></ul><p><img src="Untitled%2015.png" alt="Untitled"></p><p>程序纵向开发，横向增加关注点。</p><p>Spring AOP中通过Advice定义横切逻辑，Spring支持5中类型的Advice。</p><p><img src="Untitled%2016.png" alt="Untitled"></p><p>即AOP在不改变原有代码的情况下，增加新的功能。</p><h2 id="11-3-使用Spring实现AOP"><a href="#11-3-使用Spring实现AOP" class="headerlink" title="11.3 使用Spring实现AOP"></a>11.3 使用Spring实现AOP</h2><p>重点：使用AOP织入，需要导入依赖包。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.9</span><span class="number">.7</span>&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p><strong><em>spring-09-aop</em></strong></p><h3 id="方式一：使用原创Spring-API的接口【advisor】"><a href="#方式一：使用原创Spring-API的接口【advisor】" class="headerlink" title="方式一：使用原创Spring API的接口【advisor】"></a>方式一：使用原创Spring API的接口【advisor】</h3><p><strong><em>spring-09-aop:demo01</em></strong></p><h3 id="方式二：使用自定义类实现AOP【切面】"><a href="#方式二：使用自定义类实现AOP【切面】" class="headerlink" title="方式二：使用自定义类实现AOP【切面】"></a>方式二：使用自定义类实现AOP【切面】</h3><p><strong><em>spring-09-aop:demo02</em></strong></p><h3 id="方式三：使用注解实现AOP"><a href="#方式三：使用注解实现AOP" class="headerlink" title="方式三：使用注解实现AOP"></a>方式三：使用注解实现AOP</h3><p><strong><em>spring-09-aop:demo03</em></strong></p><p>使用的话用配置比较多</p><p>结果分析：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">com.kuang.demo01.service.UserServiceImpl类的add方法被执行了</span><br><span class="line">=====执行前=====</span><br><span class="line">***方法环绕前***</span><br><span class="line">***方法环绕:切入点joinPoint:execution(int com.kuang.demo01.service.UserServiceImpl.add())***</span><br><span class="line">***方法环绕:签名getSignature:int com.kuang.demo01.service.UserServiceImpl.add()***</span><br><span class="line">***方法环绕:位置getSourceLocation:org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint$SourceLocationImpl@65f095f8***</span><br><span class="line">***方法环绕:对象getTarget:com.kuang.demo01.service.UserServiceImpl@59af0466***</span><br><span class="line">***方法环绕:自己getThis:com.kuang.demo01.service.UserServiceImpl@59af0466***</span><br><span class="line">***方法执行前***</span><br><span class="line">增加一个用户</span><br><span class="line">***方法执行后***</span><br><span class="line">***方法环绕后***</span><br><span class="line">=====执行后=====</span><br><span class="line">com.kuang.demo01.service.UserServiceImpl类执行了add方法，返回结果为：<span class="number">0</span></span><br></pre></td></tr></table></figure><p>方式一在方式二前执行，方式二在方式三前执行，方式环绕在Before和After前后执行</p><p>AOP实现声明式事务</p><h1 id="12、-整合Mybatis"><a href="#12、-整合Mybatis" class="headerlink" title="12、 整合Mybatis"></a>12、 整合Mybatis</h1><p>步骤：</p><p>1.导入相关jar包</p><ul><li>junit</li><li>mybatis</li><li>mysql</li><li>spring相关</li><li>aop织入</li><li>mybatis-spring【new】<a href="http://mybatis.org/spring/zh/">http://mybatis.org/spring/zh/</a></li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">4.12</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--mysql--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">8.0</span><span class="number">.22</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--mybatis--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">3.5</span><span class="number">.6</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--spring相关的包--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">5.3</span><span class="number">.9</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--spring操作数据库--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">5.3</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--织入--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.9</span><span class="number">.7</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--mybatis-spring整合的包--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.0</span><span class="number">.6</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>2.编写配置文件-先看【12.1、回忆Mybatis】</p><p>3.测试 </p><h2 id="12-1、回忆Mybatis"><a href="#12-1、回忆Mybatis" class="headerlink" title="12.1、回忆Mybatis"></a>12.1、回忆Mybatis</h2><p>步骤：</p><p>1.编写实体类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.编写Mybatis核心配置文件</p><p>resources/mybatis-config.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="line">&lt;configuration&gt; </span><br><span class="line">    &lt;typeAliases&gt;</span><br><span class="line">        &lt;<span class="keyword">package</span> name=<span class="string">&quot;com.kuang.pojo&quot;</span>/&gt;</span><br><span class="line">    &lt;/typeAliases&gt;</span><br><span class="line"></span><br><span class="line">    &lt;environments <span class="keyword">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span><br><span class="line">        &lt;environment id=<span class="string">&quot;development&quot;</span>&gt;</span><br><span class="line">            &lt;transactionManager type=<span class="string">&quot;JDBC&quot;</span>/&gt;</span><br><span class="line">            &lt;dataSource type=<span class="string">&quot;POOLED&quot;</span>&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;driver&quot;</span> value=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql://39.106.63.189/mybatis&quot;</span>/&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line"></span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;!--想要注解等都生效，需要UserMapper和UserMapper.xml在同一个包下且名字一样--&gt;</span><br><span class="line">        &lt;mapper <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.mapper.UserMapper&quot;</span>/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><p>3.编写接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">selectUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.编写Mapper.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.kuang.mapper.UserMapper&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectUser&quot;</span> resultType=<span class="string">&quot;user&quot;</span>&gt;</span><br><span class="line">        select * from mybatis.user;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><p>5.测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.kuang.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String resource = <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">        InputStream in = Resources.getResourceAsStream(resource);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        List&lt;User&gt; users = mapper.selectUser();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>idea连接数据库</li></ol><p>2.maven静态资源过滤问题</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">        &lt;resource&gt;</span><br><span class="line">            &lt;directory&gt;src/main/java&lt;/directory&gt;</span><br><span class="line">            &lt;includes&gt;</span><br><span class="line">                &lt;include&gt;**<span class="comment">/*.xml&lt;/include&gt;</span></span><br><span class="line"><span class="comment">            &lt;/includes&gt;</span></span><br><span class="line"><span class="comment">            &lt;filtering&gt;true&lt;/filtering&gt;</span></span><br><span class="line"><span class="comment">        &lt;/resource&gt;</span></span><br><span class="line"><span class="comment">    &lt;/resources&gt;</span></span><br><span class="line"><span class="comment">&lt;/build&gt;</span></span><br></pre></td></tr></table></figure><h2 id="12-2、Mybatis-Spring"><a href="#12-2、Mybatis-Spring" class="headerlink" title="12.2、Mybatis-Spring"></a>12.2、Mybatis-Spring</h2><p><a href="http://mybatis.org/spring/zh/index.html">http://mybatis.org/spring/zh/index.html</a></p><h3 id="12-2-1、什么是-MyBatis-Spring？"><a href="#12-2-1、什么是-MyBatis-Spring？" class="headerlink" title="12.2.1、什么是 MyBatis-Spring？"></a>12.2.1、<strong>什么是 MyBatis-Spring？</strong></h3><p>MyBatis-Spring 会帮助你将 MyBatis 代码无缝地整合到 Spring 中。它将允许 MyBatis 参与到 Spring 的事务管理之中，创建映射器 mapper 和 <code>SqlSession</code> 并注入到 bean 中，以及将 Mybatis 的异常转换为 Spring 的 <code>DataAccessException</code>。 最终，可以做到应用代码不依赖于 MyBatis，Spring 或 MyBatis-Spring。</p><h3 id="12-2-2、知识基础"><a href="#12-2-2、知识基础" class="headerlink" title="12.2.2、知识基础"></a>12.2.2、<strong>知识基础</strong></h3><p>在开始使用 MyBatis-Spring 之前，你需要先熟悉 Spring 和 MyBatis 这两个框架和有关它们的术语。这很重要——因为本手册中不会提供二者的基本内容，安装和配置教程。</p><p><a href="https://www.notion.so/68f85e8c74a749cb878f9bc927b65271">MyBatis-Spring 需要以下版本：</a></p><h3 id="12-2-3、快速上手"><a href="#12-2-3、快速上手" class="headerlink" title="12.2.3、快速上手"></a>12.2.3、<strong>快速上手</strong></h3><p>假设你定义了一个如下的 mapper 接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Select(&quot;SELECT * FROM users WHERE id = #&#123;userId&#125;&quot;)</span></span><br><span class="line">  <span class="function">User <span class="title">getUser</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> String userId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>要和 Spring 一起使用 MyBatis，需要在 Spring 应用上下文中定义至少两样东西：一个 <code>SqlSessionFactory</code> 和至少一个数据映射器类(数据源)。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span><br><span class="line">  &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span> /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">sqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    SqlSessionFactoryBean factoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">    factoryBean.setDataSource(dataSource());</span><br><span class="line">    <span class="keyword">return</span> factoryBean.getObject();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 MyBatis-Spring 中，可使用 <code>SqlSessionFactoryBean</code>来创建 <code>SqlSessionFactory</code>。 要配置这个工厂 bean，只需要把下面代码放在 Spring 的 XML 配置文件中：</p><p>注意：<code>SqlSessionFactory</code> 需要一个 <code>DataSource</code>（数据源）。这可以是任意的 <code>DataSource</code>，只需要和配置其它 Spring 数据库连接一样配置它就可以了。</p><p>注意：</p><p>这数据源配置都是mybatis配置死的，sqlsession是代码实现的。现在都由spring管理。</p><h3 id="12-2-4、快速上手（kuang）-第一种"><a href="#12-2-4、快速上手（kuang）-第一种" class="headerlink" title="12.2.4、快速上手（kuang）- 第一种"></a>12.2.4、<strong>快速上手（kuang）- 第一种</strong></h3><p>步骤：</p><ul><li>实体类</li><li>实体类接口</li><li>实体类Mapper.xml</li><li>spring整合mybatis编写数据源配置</li><li>注册sqlSessionFactory</li><li>注册sqlSessionTemplate</li><li>给接口加实现类【UserMapperImpl】，sqlSessionTemplate这个 bean 就可以直接注入到你的 DAO bean 中了。你需要在你的 bean 中添加一个 SqlSession 属性</li><li>接口实现类注入到spring中【spring只能注入实现类】</li><li>测试使用</li></ul><p>1、实体类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、实体类接口</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">import com.kuang.pojo.User;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public interface UserMapper &#123;</span><br><span class="line">    public List<span class="tag">&lt;<span class="name">User</span>&gt;</span> selectUser();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、实体类Mapper.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.kuang.dao.UserMapper&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectUser&quot;</span> resultType=<span class="string">&quot;user&quot;</span>&gt;</span><br><span class="line">        select * from mybatis.user;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><p>4、创建spring-dao.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1.DataSource:使用spring的数据源替换mybatis的配置 c3p0、dbcp、druid</span></span><br><span class="line"><span class="comment">    这里使用Spring的jdbc</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://39.106.63.189/mybatis&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--2.SqlSessionFactory--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--绑定Mybatis配置文件,这样的话原mybatis-config.xml和这里连起来了，可以实现扩展--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:com/kuang/dao/*.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com/kuang/pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--3.SqlSession,只能构造器注入sqlSessionFactory，因为没有set方法,--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SqlSessionTemplate 还有一个接收 ExecutorType 参数的构造方法。这允许你使用如下 Spring 配置来批量创建对象，</span></span><br><span class="line"><span class="comment">    例如批量创建一些 SqlSession：--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSession&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--4.多了这个类，在原来都是使用sqlSession来执行，现在使用SqlSessionTemplate--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userMapperImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.dao.UserMapperImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSession&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSession&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>5、创建UserMapperImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperImpl</span> <span class="keyword">implements</span> <span class="title">UserMapper</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//多了这个类，在原来都是使用sqlSession来执行，现在使用SqlSessionTemplate</span></span><br><span class="line">    <span class="comment">//sqlSessionTemplate这个 bean 就可以直接注入到你的 DAO bean 中了。你需要在你的 bean 中添加一个 SqlSession 属性</span></span><br><span class="line">    <span class="keyword">private</span> SqlSession sqlSession;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSqlSession</span><span class="params">(SqlSession sqlSession)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sqlSession = sqlSession;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">selectUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSession.getMapper(UserMapper.class).selectUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6、.测试使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.kuang.dao.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * spring整合mybatis测试</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// spring的bean中注册了sqlSession和userMapperImpl，可以直接用来</span></span><br><span class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;spring-dao.xml&quot;</span>);</span><br><span class="line">        UserMapper userMapper = applicationContext.getBean(<span class="string">&quot;userMapperImpl&quot;</span>, UserMapper.class);</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectUser();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="12-2-5、第二种使用方式-SqlSessionDaoSupport【新版本增加的】"><a href="#12-2-5、第二种使用方式-SqlSessionDaoSupport【新版本增加的】" class="headerlink" title="12.2.5、第二种使用方式 SqlSessionDaoSupport【新版本增加的】"></a>12.2.5、<strong>第二种使用方式</strong> SqlSessionDaoSupport【新版本增加的】</h3><p>1.实体Mapper实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.support.SqlSessionDaoSupport;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SqlSessionDaoSupport 是一个抽象的支持类，用来为你提供 SqlSession。调用 getSqlSession() 方法你会得到一个 SqlSessionTemplate，之后可以用于执行 SQL 方法，就像下面这样:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperImpl2</span> <span class="keyword">extends</span> <span class="title">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title">UserMapper</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">selectUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSqlSession().getMapper(UserMapper.class).selectUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.注册bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--5.SqlSessionDaoSupport 需要通过属性设置一个 sqlSessionFactory 或 SqlSessionTemplate。</span></span><br><span class="line"><span class="comment">如果两个属性都被设置了，那么 SqlSessionFactory 将被忽略。</span></span><br><span class="line"><span class="comment">假设类 UserMapperImpl 是 SqlSessionDaoSupport 的子类，可以编写如下的 Spring 配置来执行设置：--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userMapperImpl2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.dao.UserMapperImpl2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.测试使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.kuang.dao.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * spring整合mybatis测试,使用继承SqlSessionDaoSupport</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// spring的bean中注册了sqlSession和userMapperImpl，可以直接用来</span></span><br><span class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;spring-dao.xml&quot;</span>);</span><br><span class="line">        UserMapper userMapper = applicationContext.getBean(<span class="string">&quot;userMapperImpl2&quot;</span>, UserMapper.class);</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectUser();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>还有更简单的mybatis-plus、通用mapper</strong></p><h1 id="13、声明式事务"><a href="#13、声明式事务" class="headerlink" title="13、声明式事务"></a>13、声明式事务</h1><h2 id="13-1、回顾事务"><a href="#13-1、回顾事务" class="headerlink" title="13.1、回顾事务"></a>13.1、回顾事务</h2><ul><li>把一组业务当作一个业务来做，要么都成功，要么都失败！</li><li>事务在项目开发中，十分的重要，涉及到数据的一致性问题，不能马虎！</li><li>确保完整性和一致性！</li></ul><p><strong>事务ACID原则：</strong></p><ul><li>原子性：确保这个过程要么都成功，要么都失败！</li><li>一致性：确保事务完成要么都提交，要么都没提交！</li><li>隔离性：多个业务可能操作同一个资源，是互相隔离的，不会影响数据的正确性，防止数据损坏！</li><li>持久性：事务一旦完成，无论系统发生什么问题，结果都不会改变，被持久化的写入到存储器中！</li></ul><h2 id="13-2、Spring的事务管理"><a href="#13-2、Spring的事务管理" class="headerlink" title="13.2、Spring的事务管理"></a>13.2、Spring的事务管理</h2><p><strong>两类：</strong></p><ul><li>声明式事务：AOP</li><li>编程式事务：需要在代码中，进行事务的管理</li></ul><p><strong>步骤：</strong></p><p>1.配置声明式事务</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--3.配置声明式事务--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>思考：</p><p>为什么配置事务？</p><ul><li><p>如果不配置事务，可能存在数据提交不一致情况</p></li><li><p>如果我们不在Spring中配置声明式事务，我们就需要在代码中手动配置事务</p></li><li><p>事务在项目开发中十分重要，涉及到数据的一致性和完整性，不容马虎！</p><p>注意：</p></li></ul><p>新版5.**的spring-jdbc以上带了tx包</p><p>事务注解</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis笔记</title>
      <link href="/2021/08/13/Mybatis%E7%AC%94%E8%AE%B0/"/>
      <url>/2021/08/13/Mybatis%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p><strong>环境：</strong></p><ul><li>JDK1.8</li><li>Mysql:5.7</li><li>maven:3.6.3</li></ul><p><strong>回顾：</strong></p><ul><li>JDBC</li><li>mysql</li><li>java基础</li><li>maven</li><li>junit</li></ul><p>框架：配置文件、最好的学习方式看官网<a href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></p><p><strong>目录：</strong></p><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><h3 id="1-1、什么是Mybatis、作用、为什么需要"><a href="#1-1、什么是Mybatis、作用、为什么需要" class="headerlink" title="1.1、什么是Mybatis、作用、为什么需要"></a>1.1、什么是Mybatis、作用、为什么需要</h3><ul><li>MyBatis 是一款优秀的<strong>持久层框架</strong></li><li>支持<strong>自定义 SQL、存储过程以及高级映射</strong>。</li><li>MyBatis <strong>免除了</strong>几乎所有的 <strong>JDBC 代码</strong>以及<strong>设置参数和获取结果集</strong>的工作。</li><li>MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</li><li>MyBatis 本是apache的一个<strong>开源项目iBatis</strong>, 2010年这个项目<strong>由apache software foundation 迁移到了google code</strong>，并且改名为MyBatis 。</li><li><strong>2013年11月迁移到Github</strong>。</li><li>iBATIS一词来源于“internet”和“abatis”的组合，是一个基于Java的持久层框架。iBATIS提供的持久层框架包括SQL Maps和Data Access Objects（DAOs）</li></ul><p>如何获取mybatis</p><ul><li>maven仓库：<a href="https://mvnrepository.com/artifact/org.mybatis/mybatis/3.5.7">https://mvnrepository.com/artifact/org.mybatis/mybatis/3.5.7</a></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>中文官网：<a href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></li><li>github：<a href="https://github.com/mybatis/mybatis3">https://github.com/mybatis/mybatis3</a></li></ul><h3 id="1-2、持久化"><a href="#1-2、持久化" class="headerlink" title="1.2、持久化"></a>1.2、持久化</h3><p>数据持久化：</p><ul><li>将程序的数据在持久状态和瞬时状态转化的过程</li><li>内存：“<strong>断电即失</strong>”</li><li>如：数据库（jdbc）、IO文件持久化（浪费资源）、冷藏、罐头</li></ul><p>为什么需要持久化？</p><ul><li>因为内存断电即失</li><li>有一些对象，不能让他丢掉、如：钱</li><li>内存太贵了</li></ul><h3 id="1-3、持久层"><a href="#1-3、持久层" class="headerlink" title="1.3、持久层"></a>1.3、持久层</h3><p>以前用的：Dao层、Service层、Controller层</p><ul><li><strong>持久层是完成持久化工作的代码块</strong></li><li>层界限十分明显</li></ul><h3 id="1-4、为什么需要Mybatis"><a href="#1-4、为什么需要Mybatis" class="headerlink" title="1.4、为什么需要Mybatis"></a>1.4、为什么需要Mybatis</h3><ul><li>传统的JDBC太复杂了</li><li>方便、简化</li><li>框架、自动化</li><li>帮助程序员将数据存入到数据库中</li><li>不用mybatis也可以，他只是个框架，用了更容易上手</li><li>特点：<ul><li>sql与代码的分离</li><li>灵活，sql写在xml中，便于管理</li><li>提供映射标签，支持对象与数据库的orm字段关系映射</li><li>提供对象关系映射标签，支持对对象关系组建维护</li><li>提供xml标签，支持编写动态sql</li></ul></li></ul><p><strong>最重要的一点：使用的人多！</strong></p><h2 id="2、第一个Mybatis程序"><a href="#2、第一个Mybatis程序" class="headerlink" title="2、第一个Mybatis程序"></a>2、第一个Mybatis程序</h2><p>先理思路：搭建环境-导入mybatis-编写代码-测试</p><h3 id="2-1、搭建环境"><a href="#2-1、搭建环境" class="headerlink" title="2.1、搭建环境"></a>2.1、搭建环境</h3><p>1、搭建数据库</p><p><img src="Untitled.png" alt="Untitled"></p><p>2、新建项目</p><p>新建普通maven项目</p><p>删除src目录-父工程</p><p><img src="Untitled%201.png" alt="Untitled"></p><p>3、导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2、创建模块Mybatis-01"><a href="#2-2、创建模块Mybatis-01" class="headerlink" title="2.2、创建模块Mybatis-01"></a>2.2、创建模块M<strong>ybatis-01</strong></h3><ul><li>编写mybatis核心配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--核心配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>编写mybatis工具类</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.utils;</span><br><span class="line"></span><br><span class="line">import org.apache.ibatis.io.Resources;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line">import org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * sqlSessionFactory</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> */</span><br><span class="line">public class MybatisUtils &#123;</span><br><span class="line"></span><br><span class="line">    //提升作用域-局部变全局</span><br><span class="line">    private static SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 使用mybatis第一步</span><br><span class="line">            String resource = &quot;mybatis-config.xml&quot;;</span><br><span class="line">            InputStream inputStream = null;</span><br><span class="line">            inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">            sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static SqlSession getSqlSession() &#123;</span><br><span class="line">        return sqlSessionFactory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3、编写代码"><a href="#2-3、编写代码" class="headerlink" title="2.3、编写代码"></a>2.3、编写代码</h3><ul><li>实体类</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> */</span><br><span class="line">public class User &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPassword() &#123;</span><br><span class="line">        return password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPassword(String password) &#123;</span><br><span class="line">        this.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, password=&#x27;&quot; + password + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>操作实体类的Dao接口</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">import com.kuang.pojo.User;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> */</span><br><span class="line">public interface UserDao &#123;</span><br><span class="line">    public List<span class="tag">&lt;<span class="name">User</span>&gt;</span> getUserList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>实现类配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.kuang.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--select查询语句--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--方法的名字id=&quot;getUserList&quot;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from mybatis.user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-4、测试"><a href="#2-4、测试" class="headerlink" title="2.4、测试"></a>2.4、测试</h3><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">import com.kuang.pojo.User;</span><br><span class="line">import com.kuang.utils.MybatisUtils;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class UserDaoTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test() &#123;</span><br><span class="line">        //第一步：获得sqlSession对象</span><br><span class="line">        SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">        //第二步：面向接口编程,获取UserDao,执行SQL</span><br><span class="line">        List<span class="tag">&lt;<span class="name">User</span>&gt;</span> userList = sqlSession.getMapper(UserDao.class).getUserList();</span><br><span class="line">        for (User user : userList) &#123;</span><br><span class="line">            System.out.println(user.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        //关闭sqlSession  </span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>问题：</p><p>1.配置文件没有注册</p><p>2.绑定接口错误</p><p>3.方法名不对</p><p>4.返回类型不对</p><p>5.Maven导出Mapper.xml资源问题</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-5、生命周期："><a href="#2-5、生命周期：" class="headerlink" title="2.5、生命周期："></a>2.5、<strong>生命周期：</strong></h3><p><strong>SqlSessionFactoryBuilder：</strong></p><p>这个类可以被实例化、使用和丢弃，<strong>一旦创建了 SqlSessionFactory，就不再需要它了</strong>。 因此 SqlSessionFactoryBuilder 实例的最佳作用域是方法作用域（也就是局部方法变量）。 你可以重用 SqlSessionFactoryBuilder 来创建多个 SqlSessionFactory 实例，但最好还是不要一直保留着它，以保证所有的 XML 解析资源可以被释放给更重要的事情。</p><p><strong>SqlSessionFactory：</strong></p><p>SqlSessionFactory <strong>一旦被创建就应该在应用的运行期间一直存在</strong>，没有任何理由丢弃它或重新创建另一个实例。 使用 SqlSessionFactory 的最佳实践是在应用运行期间不要重复创建多次，多次重建 SqlSessionFactory 被视为一种代码“坏习惯”。因此 SqlSessionFactory 的最佳作用域是应用作用域。 有很多方法可以做到，最简单的就是使用单例模式或者静态单例模式。</p><p><strong>SqlSession：</strong></p><p>每个线程都应该有它自己的 SqlSession 实例。<strong>SqlSession 的实例不是线程安全的，因此是不能被共享的</strong>，所以它的最佳的作用域是请求或方法作用域。 绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。 也绝不能将 SqlSession 实例的引用放在任何类型的托管作用域中，比如 Servlet 框架中的 HttpSession。 如果你现在正在使用一种 Web 框架，考虑将 SqlSession 放在一个和 HTTP 请求相似的作用域中。 <strong>换句话说，每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。</strong> 这个关闭操作很重要，为了确保每次都能执行关闭操作，你应该把这个关闭操作放到 finally 块中。 下面的示例就是一个确保 SqlSession 关闭的标准模式：</p><h2 id="3、CRUD"><a href="#3、CRUD" class="headerlink" title="3、CRUD"></a>3、CRUD</h2><p><strong>所有的操作只和接口和配置文件有关，然后写测试。</strong></p><p><strong>步骤：</strong></p><ul><li>1、编写接口</li><li>2、编写对应的mapper中的sql语句</li><li>3、测试接口</li></ul><h3 id="3-1、namespace"><a href="#3-1、namespace" class="headerlink" title="3.1、namespace"></a>3.1、namespace</h3><p><mapper namespace="com.kuang.dao.UserMapper">中的包名要和DAO\MAPPER接口的路径相同。</p><h3 id="3-2、select"><a href="#3-2、select" class="headerlink" title="3.2、select"></a>3.2、select</h3><p>查询语句</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span></span><br><span class="line">     select * from mybatis.user</span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>id：就是对于namespace中配置接口中的方法名。</li><li>resultType：Sql语句执行后的返回值类型！Class、基本类型，集合Map以类为主。</li><li>parameterType：sql传入的参数类型。获取传入参数#{}、${}</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span> **<span class="attr">parameterType</span>**=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    select * from mybatis.user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-3、insert"><a href="#3-3、insert" class="headerlink" title="3.3、insert"></a>3.3、insert</h3><p><strong>注意：增删该需要提交事务!</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * @param user</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public int addUser(User user);</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--传入对象中的值可以直接取--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    insert into mybatis.user (id, name, password) values (#&#123;id&#125;, #&#123;name&#125;, #&#123;password&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 插入</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void test3() &#123;</span><br><span class="line">    //第一步：获得sqlSession对象</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line"></span><br><span class="line">    //第二步：面向接口编程,获取UserDao,执行SQL</span><br><span class="line">    User user = new User(4,&quot;root&quot;,&quot;1234&quot;);</span><br><span class="line">    int res = sqlSession.getMapper(UserMapper.class).addUser(user);</span><br><span class="line">    if (res&gt;0)&#123;</span><br><span class="line">        System.out.println(&quot;插入成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //提交事务</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    //关闭sqlSession</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-4、update"><a href="#3-4、update" class="headerlink" title="3.4、update"></a>3.4、update</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 修改User</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public int updateUser(User user);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    update mybatis.user set name = #&#123;name&#125;,password = #&#123;password&#125; where id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 修改</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void test4() &#123;</span><br><span class="line">    //第一步：获得sqlSession对象</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line"></span><br><span class="line">    //第二步：面向接口编程,获取UserDao,执行SQL</span><br><span class="line">    User user = new User(4,&quot;root&quot;,&quot;root&quot;);</span><br><span class="line">    int res = sqlSession.getMapper(UserMapper.class).updateUser(user);</span><br><span class="line">    if (res&gt;0)&#123;</span><br><span class="line">        System.out.println(&quot;修改成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //提交事务</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    //关闭sqlSession</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5、delete"><a href="#3-5、delete" class="headerlink" title="3.5、delete"></a>3.5、delete</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 删除User</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public int deleteUser(int id);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    delete from mybatis.user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 删除</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void test5() &#123;</span><br><span class="line">    //第一步：获得sqlSession对象</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line"></span><br><span class="line">    //第二步：面向接口编程,获取UserDao,执行SQL</span><br><span class="line">    int res = sqlSession.getMapper(UserMapper.class).deleteUser(4);</span><br><span class="line">    if (res&gt;0)&#123;</span><br><span class="line">        System.out.println(&quot;删除成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //提交事务</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    //关闭sqlSession</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-6、总结"><a href="#3-6、总结" class="headerlink" title="3.6、总结"></a>3.6、总结</h3><p><strong>注意：增删该需要提交事务!</strong></p><p><strong>分析错误：</strong></p><ul><li>insert标签写成select标签后报错</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;addUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    insert into mybatis.user (id, name, password) values (#&#123;id&#125;, #&#123;name&#125;, #&#123;password&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>配置mapper路径时要用”/“</li><li>sql错误</li><li>连接数据库url错误</li><li>乱码问题：mysql修改为utf8mb4</li></ul><h3 id="3-7、万能Map"><a href="#3-7、万能Map" class="headerlink" title="3.7、万能Map"></a>3.7、万能Map</h3><p>假设我们的实体类，或者数据库中的表参数过多，应当考虑使用map，可以空很多字段。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * inset map,万能的map</span><br><span class="line"> * 好处：不需要知道数据库有什么</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public int addUser2(Map&lt;String,Object&gt; map);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addUser2&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    insert into mybatis.user (id, name, password) values (#&#123;userId&#125;,#&#123;userName&#125;,#&#123;userPaw&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Map传递参数，直接在sql中取key即可！parameterType=”map”<br>对象传递参数，直接在sql中取属性名即可！parameterType=”User”</p><p>只有基本类型时，直接在sql中取名即可！parameterType=”int”【可以不写】</p><p>多个参数用map，或者注解！</p><h3 id="3-8、模糊查询"><a href="#3-8、模糊查询" class="headerlink" title="3.8、模糊查询"></a>3.8、模糊查询</h3><p>sql注入问题！sql用%%，这种安全！</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List<span class="tag">&lt;<span class="name">User</span>&gt;</span> userList = sqlSession.getMapper(UserMapper.class).getUserListLike(&quot;%roo%&quot;);</span><br></pre></td></tr></table></figure><p>防止sql注入问题，在sql拼接中使用通配符”where name like “%” #{value} “%”“：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--模糊查询--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserListLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    select * from user where name like &quot;%&quot; #&#123;value&#125; &quot;%&quot;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">List<span class="tag">&lt;<span class="name">User</span>&gt;</span> userList = sqlSession.getMapper(UserMapper.class).getUserListLike(&quot;roo&quot;);</span><br></pre></td></tr></table></figure><h2 id="4、配置解析"><a href="#4、配置解析" class="headerlink" title="4、配置解析"></a>4、配置解析</h2><p><strong>项目例子：mybatis-02</strong></p><p>MyBatis 的配置文件包含了会深深影响 MyBatis 行为的设置和属性信息。</p><p><a href="https://mybatis.org/mybatis-3/zh/configuration.html">https://mybatis.org/mybatis-3/zh/configuration.html</a></p><h3 id="4-1、核心配置文件"><a href="#4-1、核心配置文件" class="headerlink" title="4.1、核心配置文件"></a>4.1、核心配置文件</h3><p><strong>mybatis-config.xml</strong></p><p><img src="Untitled%202.png" alt="Untitled"></p><p>除了红框的，其他了解即可。</p><h3 id="4-2、环境配置（environments）"><a href="#4-2、环境配置（environments）" class="headerlink" title="4.2、环境配置（environments）"></a>4.2、环境配置（environments）</h3><p>MyBatis 可以配置成适应多种环境，<strong>不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</strong></p><p>事务管理器<strong>默认JDBC；数据源默认为POOLED，有连接池的实现。</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--default切换环境--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://39.106.63.189:3306/mybatis?useSSL=false<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://39.106.63.189:3306/mybatis?useSSL=false<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>4.2.1 事务管理器（transactionManager）</strong></p><p><strong>默认JDBC</strong></p><p>在 MyBatis 中有两种类型的事务管理器（也就是 type=”[JDBC|MANAGED]”）：</p><ul><li><p>JDBC – 这个配置直接使用了 JDBC 的提交和回滚设施，它依赖从数据源获得的连接来管理事务作用域。</p></li><li><p>MANAGED – 这个配置几乎没做什么。它从不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 默认情况下它会关闭连接。然而一些容器并不希望连接被关闭，因此需要将 closeConnection 属性设置为 false 来阻止默认的关闭行为。例如:</p><p>  `<transactionManager type="MANAGED"></p><pre><code>&lt;property name=&quot;closeConnection&quot; value=&quot;false&quot;/&gt;</code></pre><p>  </transactionManager>`</p></li></ul><p><strong>提示</strong> 如果你正在使用 Spring + MyBatis，则没有必要配置事务管理器，因为 Spring 模块会使用自带的管理器来覆盖前面的配置。</p><p><strong>4.2.2 数据源（dataSource）</strong></p><p><strong>默认为POOLED，有连接池的实现</strong></p><p>dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。</p><ul><li>大多数 MyBatis 应用程序会按示例中的例子来配置数据源。虽然数据源配置是可选的，但如果要启用延迟加载特性，就必须配置数据源。</li></ul><p>有三种内建的数据源类型（也就是 type=”[UNPOOLED|POOLED|JNDI]”）：</p><p><strong>池子：用完可以回收，下面只有2个，一个是没池子，一个有池子。</strong></p><p><strong>UNPOOLED</strong>– 这个数据源的实现会每次请求时打开和关闭连接。虽然有点慢，但对那些数据库连接可用性<strong>要求不高</strong>的简单应用程序来说，是一个很好的选择。 <strong>性能表现则依赖于使用的数据库</strong>，对某些数据库来说，<strong>使用连接池并不重要</strong>，这个配置就很适合这种情形。UNPOOLED 类型的数据源仅仅需要配置以下 5 种属性：</p><ul><li><code>driver</code> – 这是 JDBC 驱动的 Java 类全限定名（并不是 JDBC 驱动中可能包含的数据源类）。</li><li><code>url</code> – 这是数据库的 JDBC URL 地址。</li><li><code>username</code> – 登录数据库的用户名。</li><li><code>password</code> – 登录数据库的密码。</li><li><code>defaultTransactionIsolationLevel</code> – 默认的连接事务隔离级别。</li><li><code>defaultNetworkTimeout</code> – 等待数据库操作完成的默认网络超时时间（单位：毫秒）。查看 <code>java.sql.Connection#setNetworkTimeout()</code> 的 API 文档以获取更多信息。</li></ul><p>作为可选项，你也可以传递属性给数据库驱动。只需在属性名加上“driver.”前缀即可，例如：</p><ul><li><code>driver.encoding=UTF8</code></li></ul><p>这将通过 DriverManager.getConnection(url, driverProperties) 方法传递值为 <code>UTF8</code> 的 <code>encoding</code> 属性给数据库驱动。</p><p><strong>POOLED</strong>– 这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。</p><p>除了上述提到 UNPOOLED 下的属性外，还有更多属性用来配置 POOLED 的数据源：</p><ul><li><code>poolMaximumActiveConnections</code> – 在任意时间可存在的活动（正在使用）连接数量，默认值：10</li><li><code>poolMaximumIdleConnections</code> – 任意时间可能存在的空闲连接数。</li><li><code>poolMaximumCheckoutTime</code> – 在被强制返回之前，池中连接被检出（checked out）时间，默认值：20000 毫秒（即 20 秒）</li><li><code>poolTimeToWait</code> – 这是一个底层设置，如果获取连接花费了相当长的时间，连接池会打印状态日志并重新尝试获取一个连接（避免在误配置的情况下一直失败且不打印日志），默认值：20000 毫秒（即 20 秒）。</li><li><code>poolMaximumLocalBadConnectionTolerance</code> – 这是一个关于坏连接容忍度的底层设置， 作用于每一个尝试从缓存池获取连接的线程。 如果这个线程获取到的是一个坏的连接，那么这个数据源允许这个线程尝试重新获取一个新的连接，但是这个重新尝试的次数不应该超过 <code>poolMaximumIdleConnections</code> 与 <code>poolMaximumLocalBadConnectionTolerance</code> 之和。 默认值：3（新增于 3.4.5）</li><li><code>poolPingQuery</code> – 发送到数据库的侦测查询，用来检验连接是否正常工作并准备接受请求。默认是“NO PING QUERY SET”，这会导致多数数据库驱动出错时返回恰当的错误消息。</li><li><code>poolPingEnabled</code> – 是否启用侦测查询。若开启，需要设置 <code>poolPingQuery</code> 属性为一个可执行的 SQL 语句（最好是一个速度非常快的 SQL 语句），默认值：false。</li><li><code>poolPingConnectionsNotUsedFor</code> – 配置 poolPingQuery 的频率。可以被设置为和数据库连接超时时间一样，来避免不必要的侦测，默认值：0（即所有连接每一时刻都被侦测 — 当然仅当 poolPingEnabled 为 true 时适用）。</li></ul><p><strong>JNDI</strong> – 这个数据源<strong>实现是为了能在如 EJB 或应用服务器这类容器中使用</strong>，<strong>容器可以集中或在外部配置数据源</strong>，然后<strong>放置一个 JNDI 上下文的数据源引用</strong>。这种数据源配置只需要两个属性：</p><ul><li><code>initial_context</code> – 这个属性用来在 InitialContext 中寻找上下文（即，initialContext.lookup(initial_context)）。这是个可选属性，如果忽略，那么将会直接从 InitialContext 中寻找 data_source 属性。</li><li><code>data_source</code> – 这是引用数据源实例位置的上下文路径。提供了 initial_context 配置时会在其返回的上下文中进行查找，没有提供时则直接在 InitialContext 中查找。</li></ul><p>和其他数据源配置类似，可以通过添加前缀“env.”直接把属性传递给 InitialContext。比如：</p><ul><li><code>env.encoding=UTF8</code></li></ul><p>这就会在 InitialContext 实例化时往它的构造方法传递值为 <code>UTF8</code> 的 <code>encoding</code> 属性。</p><h3 id="4-3、属性（properties）"><a href="#4-3、属性（properties）" class="headerlink" title="4.3、属性（properties）"></a>4.3、属性（properties）</h3><p>我们可以通过properties属性来实现引用。</p><p>这些属性可以在外部进行配置且动态替换。既可以在典型的 Java 属性文件中配置，亦可通过 properties 元素的子元素中设置。【db.properties】</p><p>mybatis-config.xml标签顺序：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties?, settings?, typeAliases?, typeHandlers?, objectFactory?, objectWrapperFactory?, reflectorFactory?, plugins?, environments?, databaseIdProvider?, mappers?</span><br></pre></td></tr></table></figure><p>1、编写配置文件db.properties</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://39.106.63.189:3306/mybatis?useSSL=false<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8</span><br><span class="line">username=root</span><br><span class="line">password=root</span><br></pre></td></tr></table></figure><p>2、引入配置文件，并定义自己新属性</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入外部配置文件db.properties--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--自定义添加属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3、使用外部文件和自定义的新属性</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--使用配置文件--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username2&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>优先级：</strong></p><p>属性名相同，优先使用外部文件。</p><h3 id="4-4、类型别名（typeAliases）"><a href="#4-4、类型别名（typeAliases）" class="headerlink" title="4.4、类型别名（typeAliases）"></a>4.4、类型别名（typeAliases）</h3><p>类型别名可<strong>为 Java 类型设置一个缩写名字</strong>。 它仅用于 XML 配置，意在<strong>降低冗余的全限定类名书写</strong>。例如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置别名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;User&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当这样配置时，<code>Blog</code> 可以用在任何使用 <code>domain.blog.Blog</code> 的地方。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from mybatis.user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，比如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置别名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;User&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.kuang.pojo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>每一个在包 domain.blog 中的 Java Bean，在<strong>没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名</strong>。 比如 domain.blog.Author 的别名为 author；<strong>若有注解，则别名为其注解值</strong>。见下面的例子：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Alias(&quot;author&quot;)</span><br><span class="line">public class Author &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from mybatis.user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;ser&quot;</span>&gt;</span></span><br><span class="line">    select * from mybatis.user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>别名配置包扫描时，大写小写都可以用。</p><p><strong>总结：</strong></p><ul><li>实体类中比较少时，使用第一种。</li><li>实体类多的时候，建议用第二章。</li><li>第一种可以DIY别名。第二种不行，可以用注解取别名来DIY。</li></ul><p>常见的 Java 类型内建的类型别名。它们都是不区分大小写的，注意，为了应对原始类型的命名重复，采取了特殊的命名风格。</p><p><a href="https://www.notion.so/e29f21e467194d89b97a4f60e80c255e">默认别名</a></p><h3 id="4-5、设置（settings）"><a href="#4-5、设置（settings）" class="headerlink" title="4.5、设置（settings）"></a>4.5、设置（settings）</h3><p>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。 下表描述了设置中各项设置的含义、默认值等。</p><p><a href="https://www.notion.so/6db511f1f66b408f8ed57a35d5c22375">Untitled</a></p><p>spring之后就不用它了。</p><h3 id="4-6、其他配置"><a href="#4-6、其他配置" class="headerlink" title="4.6、其他配置"></a>4.6、其他配置</h3><ul><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">typeHandlers（类型处理器）</a></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#objectFactory">objectFactory（对象工厂）</a></li><li><a href="https://mybatis.org/mybatis-3/zh/configuration.html#plugins">plugins（插件）</a>，插件例子：<ul><li>MyBatis Generator Core</li><li>MyBatis Plus <a href="https://baomidou.com/">https://baomidou.com/</a></li><li>通用mapper</li></ul></li></ul><h3 id="4-7、映射器（mappers）"><a href="#4-7、映射器（mappers）" class="headerlink" title="4.7、映射器（mappers）"></a>4.7、映射器（mappers）</h3><p>MapperRegistry:注册绑定我们的Mapper文件。</p><p>既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要来定义 SQL 映射语句了。 但首先，我们需要告诉 MyBatis 到哪里去找到这些语句。 在自动查找资源方面，Java 并没有提供一个很好的解决方案，所以最好的办法是直接告诉 MyBatis 到哪里去找映射文件。 你可以使用相对于类路径的资源引用，或完全限定资源定位符（包括 file:/// 形式的 URL），或类名和包名等。例如：</p><p>有四种，通常只用1、2种：</p><p>方式1、使用相对于类路径的资源引用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>常用！也可以放到resource目录下。</p><p>方式2、使用完全限定资源定位符（URL）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用完全限定资源定位符（URL） --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 不用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>不用！</p><p>方式3、使用映射器接口实现类的完全限定类名</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.BlogMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.PostMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>用class，有讲究 。</p><p>注意：</p><ul><li><strong>需要和接口在同一个目录</strong></li><li><strong>配置名字和接口名字得一样。</strong></li></ul><p>方式4、将包内的映射器接口实现全部注册为映射器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>有一些问题。</p><p>注意：</p><ul><li><strong>需要和接口在同一个目录</strong></li><li><strong>配置名字和接口名字得一样。</strong></li></ul><p>总结：优先使用写一个注册一个。</p><h3 id="4-8、作用域（Scope）和生命周期"><a href="#4-8、作用域（Scope）和生命周期" class="headerlink" title="4.8、作用域（Scope）和生命周期"></a>4.8、作用域（Scope）和生命周期</h3><p>理解我们之前讨论过的不同作用域和生命周期类别是至关重要的，因为错误的使用会导致非常严重的<strong>并发问题</strong>。</p><p><strong>并发问题，分析下为什么？</strong></p><p>流程：</p><p><img src="Untitled%203.png" alt="Untitled"></p><p><strong>SqlSessionFactoryBuilder：</strong></p><ul><li><strong>一旦创建了 SqlSessionFactory，就不再需要它了。他只是用来创建工厂类。</strong></li><li>局部变量</li></ul><p><strong>SqlSessionFactory：</strong></p><ul><li><strong>一旦被创建就应该在应用的运行期间一直存在。</strong></li><li><strong>多次重建</strong> SqlSessionFactory 被视为一种<strong>代码“坏习惯”</strong>。因此 SqlSessionFactory 的<strong>最佳作用域是应用作用域</strong>。</li><li>最简单的就是使用<strong>单例模式或者静态单例模式</strong>。保证全局只有一个变量。</li></ul><p><strong>SqlSession：</strong></p><ul><li><p>每个线程都应该有它自己的 SqlSession 实例。<strong>连接到连接池的请求，请求完关闭。</strong></p></li><li><p>SqlSession 的实例不是线程安全的，因此是不能被共享的。<strong>最佳的作用域是请求或方法作用域</strong>。</p></li><li><p><strong>用完后赶紧关闭，否则资源被占用。例子：</strong>换句话说，每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。 这个关闭操作很重要。<strong>不关闭，容易引起宕机。</strong></p><p>  <img src="Untitled%204.png" alt="Untitled"></p></li></ul><h2 id="5、ResultMap-解决属性名和字段名不一致的问题"><a href="#5、ResultMap-解决属性名和字段名不一致的问题" class="headerlink" title="5、ResultMap-解决属性名和字段名不一致的问题"></a>5、ResultMap-解决属性名和字段名不一致的问题</h2><p>比如：数据库和实体类不一致，我们新建一个项目。测试实体类不一致状况。</p><p><strong>resultMap，结果集映射:</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id name pwd</span><br><span class="line">id name password</span><br></pre></td></tr></table></figure><p><strong>项目例子：mybatis-03</strong></p><p>实体类：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> */</span><br><span class="line">public class User &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String pwd;</span><br><span class="line"></span><br><span class="line">    public User() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public User(int id, String name, String password) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPwd() &#123;</span><br><span class="line">        return pwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPwd(String pwd) &#123;</span><br><span class="line">        this.pwd = pwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;id=&quot; + id +</span><br><span class="line">                &quot;, name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, password=&#x27;&quot; + password + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>数据库：</p><p><img src="Untitled%205.png" alt="Untitled"></p><p>直接执行结果为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User&#123;id=1, name=&#x27;guoyuhang&#x27;, pwd=&#x27;null&#x27;&#125;</span><br></pre></td></tr></table></figure><p><strong>解决方案：</strong></p><ul><li>sql取别名（最简单、暴力）：select id,name,<strong>password as pwd</strong> from mybatis.user where id = #{id}</li><li>ResultMap</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.kuang.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--结果集映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--column是数据库字段名，property是实体类属性名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;pwd&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select id,name,password from mybatis.user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>resultMap 元素是 MyBatis 中最重要最强大的元素。</li><li>ResultMap 的设计思想是，对简单的语句做到零配置，对于<strong>复杂一点的语句，只需要描述语句之间的关系</strong>就行了。</li><li>ResultMap 的优秀之处——你完全可以不用显式地配置它们</li></ul><p>如果这个世界总是这么简单就好了。</p><p><img src="Untitled%206.png" alt="Untitled"></p><h2 id="6、日志"><a href="#6、日志" class="headerlink" title="6、日志"></a>6、日志</h2><p><strong>mybatis-04</strong></p><h3 id="6-1、日志工厂"><a href="#6-1、日志工厂" class="headerlink" title="6.1、日志工厂"></a>6.1、日志工厂</h3><p>如果一个数据库操作，出现了异常，我们需要排错。日志是最好的帮手！</p><p>曾经：out、dubug</p><p>现在：日志工厂</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置日志工厂--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>SLF4J</li><li>LOG4J 【掌握】</li><li>LOG4J2</li><li>JDK_LOGGING</li><li>COMMONS_LOGGING</li><li>STDOUT_LOGGING 【掌握】</li><li>NO_LOGGING</li></ul><p>具体使用哪个，在设置中配置。</p><p>STDOUT_LOGGING 测试结果：</p><p><img src="Untitled%207.png" alt="Untitled"></p><h3 id="6-1、Log4J"><a href="#6-1、Log4J" class="headerlink" title="6.1、Log4J"></a>6.1、Log4J</h3><p>什么是？</p><ul><li>Log4j是Apache的一个开源项目，通过使用Log4j，我们可以控制日志信息输送的目的地是控制台、文件、GUI组件，甚至是套接口服务器、NT的事件记录器、UNIX Syslog守护进程等；</li><li>我们也可以控制每一条日志的输出格式；</li><li>通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程。</li><li>可以<strong>通过一个配置文件来灵活地进行配置</strong>，而不需要修改应用的代码。</li></ul><p>步骤：</p><p>1.配置mybatis-config.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.导包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.配置文件：log4j.properties</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">###setloglevels###</span><br><span class="line">log4j.rootLogger=DEBUG,console,file</span><br><span class="line"></span><br><span class="line">###输出到控制台###</span><br><span class="line">log4j.appender.console=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.console.Target=System.out</span><br><span class="line">log4j.appender.console.Threshold=DEBUG</span><br><span class="line">log4j.appender.console.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.console.layout.ConversionPattern=[%c]-%m%n</span><br><span class="line"></span><br><span class="line">###输出到日志文件###</span><br><span class="line">log4j.appender.file=org.apache.log4j.DailyRollingFileAppender</span><br><span class="line">log4j.appender.file.File=./logs/log.log</span><br><span class="line">log4j.appender.MaxFileSize=10mb</span><br><span class="line">log4j.appender.file.Threshold=DEBUG</span><br><span class="line">log4j.appender.file.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.file.layout.ConversionPattern=[%p][%d&#123;yy-MM-dd&#125;][%c]%m%n</span><br><span class="line"></span><br><span class="line">###日志文件输出级别###</span><br><span class="line">log4j.logger.org.mybatis=DEBUG</span><br><span class="line">log4j.logger.java.sql=DEBUG</span><br><span class="line">log4j.logger.java.sql.Statement=DEBUG</span><br><span class="line">log4j.logger.java.sql.ResultSet=DEBUG</span><br><span class="line">log4j.logger.java.sql.PreparedStatement=DEBUG</span><br></pre></td></tr></table></figure><p>4.Log4j的使用</p><p><img src="Untitled%208.png" alt="Untitled"></p><p><strong>简单使用：</strong></p><p>1.在使用log4j的类中，导入包：import org.apache.log4j.Logger;</p><p>2.日志对象，加载参数为当前类的class</p><p>3.使用static Logger logger = Logger.getLogger(UserMapperTest.class);</p><p>4.使用：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">static Logger logger = Logger.getLogger(UserMapperTest.class);</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testLog4j() &#123;</span><br><span class="line">    logger.info(&quot;info:进入testLog4j方法&quot;);</span><br><span class="line">    logger.debug(&quot;debug:进入调试语句&quot;);</span><br><span class="line">    logger.error(&quot;error:trycatch紧急&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7、分页"><a href="#7、分页" class="headerlink" title="7、分页"></a>7、分页</h2><p>分页-减少数据的处理量。</p><p><strong>mybatis-04</strong></p><h3 id="7-1、limit"><a href="#7-1、limit" class="headerlink" title="7.1、limit"></a>7.1、limit</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from user limit startIndex,pageSize;</span><br><span class="line">#从startIndex到最后一个，是bug被修复了。</span><br><span class="line">select * from user limit startIndex,-1;</span><br></pre></td></tr></table></figure><p>使用mybatis：</p><p>1.接口</p><p>2.Mapper.xml</p><p>3.测试</p><h3 id="7-2、RowBounds【不建议使用】"><a href="#7-2、RowBounds【不建议使用】" class="headerlink" title="7.2、RowBounds【不建议使用】"></a>7.2、RowBounds【不建议使用】</h3><p>面向对象方式。</p><p>不在使用sql实现分页</p><p>1、接口</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public List<span class="tag">&lt;<span class="name">User</span>&gt;</span> getUserByRowBounds();</span><br></pre></td></tr></table></figure><p>2、mapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--RowBounds--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByRowBounds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    select * from mybatis.user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3、测试</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public void test3() &#123;</span><br><span class="line">        //第一步：获得sqlSession对象</span><br><span class="line">        SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line"></span><br><span class="line">        //第二步：通过java代码实现分页</span><br><span class="line">        //RowBouns</span><br><span class="line">        RowBounds rowBounds = new RowBounds(1, 2);</span><br><span class="line"></span><br><span class="line">        List<span class="tag">&lt;<span class="name">User</span>&gt;</span> userList = sqlSession.selectList(&quot;com.kuang.dao.UserMapper.getUserByRowBounds&quot;,User.class,rowBounds);</span><br><span class="line">        for (User user : userList) &#123;</span><br><span class="line">            System.out.println(user.toString());</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        //关闭sqlSession</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="7-3、分页插件-pagehelper"><a href="#7-3、分页插件-pagehelper" class="headerlink" title="7.3、分页插件-pagehelper"></a>7.3、分页插件-pagehelper</h3><p><a href="https://pagehelper.github.io/">https://pagehelper.github.io/</a></p><p>1、引入jar包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>最新版本<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、配置拦截器插件</p><p>2.1、 在 MyBatis 配置 xml 中配置拦截器插件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置pagehelper--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- com.github.pagehelper为PageHelper类所在包名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用下面的方式配置参数，后面会有所有的参数介绍 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3、接口</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取全部用户</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public List<span class="tag">&lt;<span class="name">User</span>&gt;</span> getUserList();</span><br></pre></td></tr></table></figure><p>4、mapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from mybatis.user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>5、测试</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test4() &#123;</span><br><span class="line">    //第一步：获得sqlSession对象</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line"></span><br><span class="line">    //第二步：通过PageHelper实现分页</span><br><span class="line">    PageHelper.startPage(1, 2);</span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    List<span class="tag">&lt;<span class="name">User</span>&gt;</span> userList = mapper.getUserList();</span><br><span class="line">    for (User user : userList) &#123;</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //关闭sqlSession</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8、使用注解开发"><a href="#8、使用注解开发" class="headerlink" title="8、使用注解开发"></a>8、使用注解开发</h2><h3 id="8-1、面向接口编程"><a href="#8-1、面向接口编程" class="headerlink" title="8.1、面向接口编程"></a>8.1、面向接口编程</h3><p>大家之前都学过面向对象编程，也学习过接口，但在真正的开发中，很多时候我们会选择面向接口编程。</p><p>根本原因:<strong>解耦</strong>，可拓展,提高复用,分层开发中,上层不用管具体的实现,大家都遵守共同的标准,使得</p><p>开发变得容易,规范性更好</p><p><strong>关于接口的理解：</strong></p><ul><li>接口从更深层次的理解，应是<strong>定义(规范，约束)与实现(名实分离的原则)的分离</strong>。（假设项目多个人来做，架构师只需要写接口提需求。从而实现接口与实现的分离。）</li><li>接口的本身反映了系统设计人员对系统的抽象理解。</li><li>接口应有两类:<ul><li>第一类是对一个个体的抽象，它可对应为一个抽象体(abstract class);</li><li>第二类是对一个个体某一 方面的抽象，即形成-个抽象面(interface) ;</li></ul></li><li>个体有可能有多个抽象面。抽象体与抽象面是有区别的。</li></ul><p>注解开发主要是为了更符合这种面向接口的思想。</p><h3 id="8-2、使用注解开发"><a href="#8-2、使用注解开发" class="headerlink" title="8.2、使用注解开发"></a>8.2、使用注解开发</h3><p><strong>mybatis-05</strong></p><p>1、写注解在接口上</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取全部用户</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Select(&quot;select * from user&quot;)</span><br><span class="line">public List<span class="tag">&lt;<span class="name">User</span>&gt;</span> getUserList();</span><br></pre></td></tr></table></figure><p>2、在核心配置文件mybatis-config.xml-绑定接口</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用注解时不需要注册配置文件--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;mapper resource=&quot;com/kuang/dao/UserMapper.xml&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.dao.UserMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3、测试</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test1() &#123;</span><br><span class="line">    //第一步：获得sqlSession对象</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    //第二步：面向接口编程,获取UserDao,执行SQL</span><br><span class="line">    //方式1</span><br><span class="line">    List<span class="tag">&lt;<span class="name">User</span>&gt;</span> userList = sqlSession.getMapper(UserMapper.class).getUserList();</span><br><span class="line">    for (User user : userList) &#123;</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //关闭sqlSession</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用注解来映射简单语句会使代码显得更加简洁，但对于稍微复杂一点的语句，Java 注解不仅力不从心，还会让你本就复杂的 SQL 语句更加混乱不堪。 因此，如果你需要做一些很复杂的操作，最好用 XML 来映射语句。</p><p>当数据字段名和实体类名不一样时，力不从心。</p><p><strong>debug执行过程：反射</strong></p><p><strong>Mybatis详细执行流程：</strong></p><p><img src="Untitled%209.png" alt="Untitled"></p><p>事务：</p><p><img src="Untitled%2010.png" alt="Untitled"></p><p>执行：</p><p><img src="Untitled%2011.png" alt="Untitled"></p><p>成功就返回结果，失败就返回上面的事务。</p><h3 id="8-3、CRUD注解"><a href="#8-3、CRUD注解" class="headerlink" title="8.3、CRUD注解"></a>8.3、CRUD注解</h3><p>之前改3个文件，现在改两个就可以了。</p><p>我们可以在工具类创建的时候实现自动提交事务！</p><p><img src="Untitled%2012.png" alt="Untitled"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static SqlSession getSqlSession() &#123;</span><br><span class="line">//自动提交事务</span><br><span class="line">    return sqlSessionFactory.openSession(true);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1、查询ById：</p><p>接口：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 查询by id</span><br><span class="line"> * 方法存在多个参数时，所有的参数前面都要加@Param</span><br><span class="line"> * @return User</span><br><span class="line"> */</span><br><span class="line">@Select(&quot;select * from user where id = #&#123;id&#125; and name = #&#123;name&#125;&quot;)</span><br><span class="line">public User getUserById(@Param(&quot;id&quot;) int id,@Param(&quot;name&quot;) String name);</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 测试查询通过id</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void test2() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line"></span><br><span class="line">    User user = sqlSession.getMapper(UserMapper.class).getUserById(1,&quot;guoyuhang&quot;);</span><br><span class="line">    System.out.println(user.toString());</span><br><span class="line"></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、插入：</p><p>接口：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 这个地方只能写实体类属性名</span><br><span class="line"> * @param user</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Insert(&quot;insert into user(id,name,password) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;password&#125;)&quot;)</span><br><span class="line">public int addUser(User user);</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 插入</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void test3() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line"></span><br><span class="line">    User user = new User(4,&quot;root&quot;,&quot;1234&quot;);</span><br><span class="line">    int res = sqlSession.getMapper(UserMapper.class).addUser(user);</span><br><span class="line">    if (res&gt;0)&#123;</span><br><span class="line">        System.out.println(&quot;插入成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //提交事务,openSession已经自动提交事务了</span><br><span class="line">    //sqlSession.commit();</span><br><span class="line">    //关闭sqlSession</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、修改：</p><p>接口：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 修改User</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Update(&quot;update user set name = #&#123;name&#125;,password = #&#123;password&#125; where id = #&#123;id&#125;&quot;)</span><br><span class="line">public int updateUser(User user);</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 修改</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void test4() &#123;</span><br><span class="line">    //第一步：获得sqlSession对象</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line"></span><br><span class="line">    User user = new User(4,&quot;root&quot;,&quot;root&quot;);</span><br><span class="line">    int res = sqlSession.getMapper(UserMapper.class).updateUser(user);</span><br><span class="line">    if (res&gt;0)&#123;</span><br><span class="line">        System.out.println(&quot;修改成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //关闭sqlSession</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、删除：</p><p>接口：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 删除User</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Delete(&quot;delete from user where id = #&#123;id&#125;&quot;)</span><br><span class="line">public int deleteUser(@Param(&quot;id&quot;) int id);</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 删除</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void test5() &#123;</span><br><span class="line">    //第一步：获得sqlSession对象</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line"></span><br><span class="line">    //第二步：面向接口编程,获取UserDao,执行SQL</span><br><span class="line">    int res = sqlSession.getMapper(UserMapper.class).deleteUser(4);</span><br><span class="line">    if (res&gt;0)&#123;</span><br><span class="line">        System.out.println(&quot;删除成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //关闭sqlSession</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意：</strong></p><p>我们必须要将接口注册绑定到我们的核心配置文件中！</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--每一个接口都需要在Mybatis的核心配置文件中注册--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.dao.UserMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>关于@Param()注解：</strong></p><ul><li>基本类型的参数或者String类型，需要叫上</li><li>引用类型不要加</li><li>如果只有一个基本类型的话可以忽略，但建议加上！</li><li>在SQL中引用的就是我们@Param中设置的属性名！</li></ul><p><strong>#{}、${}区别：</strong></p><ul><li>一个预编译#{}，一个是拼接${}。</li><li>#{}预编译且可以防止sql注入！</li></ul><h2 id="9、Lombok"><a href="#9、Lombok" class="headerlink" title="9、Lombok"></a>9、Lombok</h2><p>Lombok是一个java库，可以自动插入编辑器和构建工具，提高java的性能。</p><p>永远不要再编写另一个getter或equals方法，使用一个注释，您的类就有了一个功能齐全的生成器，自动化了日志变量等等。</p><p>使用步骤：</p><p>1、在IDEA安装Lombok插件</p><p><img src="Untitled%2013.png" alt="Untitled"></p><p>2、在项目导入Lombok的jar包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3、使用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">**@Getter and @Setter**</span><br><span class="line">@FieldNameConstants</span><br><span class="line">**@ToString</span><br><span class="line">@EqualsAndHashCode**</span><br><span class="line">**@AllArgsConstructor, @RequiredArgsConstructor and @NoArgsConstructor**</span><br><span class="line">**@Log, @Log4j, @Log4j2, @Slf4j**, @XSlf4j, @CommonsLog, @JBossLog, @Flogger, @CustomLog</span><br><span class="line">**@Data**</span><br><span class="line">@Builder</span><br><span class="line">@SuperBuilder</span><br><span class="line">@Singular</span><br><span class="line">@Delegate</span><br><span class="line">@Value</span><br><span class="line">@Accessors</span><br><span class="line">@Wither</span><br><span class="line">@With</span><br><span class="line">@SneakyThrows</span><br><span class="line">@val</span><br><span class="line">@var</span><br><span class="line">experimental @var</span><br><span class="line">@UtilityClass</span><br><span class="line">@ExtensionMethod (Experimental, activate manually in plugin settings)</span><br><span class="line">Lombok config system</span><br><span class="line">Code inspections</span><br><span class="line">Refactoring actions (lombok and delombok)</span><br></pre></td></tr></table></figure><p>1、**@Data**</p><p><img src="Untitled%2014.png" alt="Untitled"></p><p>生成：无参构造、get、set、toString、hashcode、equals</p><p>2、@NoArgsConstructor，@AllArgsConstructor，@RequiredArgsConstructor</p><p>生成：无参、有参构造、生成带有必需参数的构造函数。 必需的参数是最终字段和具有约束的字段，例如@NonNull 。</p><p>3、@ToString，@EqualsAndHashCode</p><p>4、@Getter，@Setter</p><p>5、@NonNull非空检查</p><p>优点：</p><ul><li>通过注解自动生成构造器、set、get等方法，提高效率</li><li>代码更简洁，不用过多的去关注相应的方法</li><li>属性做修改时，简化了维护这些属性生产的set、get、构造器方法</li></ul><p>缺点：</p><ul><li>不支持多种参数构造器的重载</li><li>省去创建get、set等方法的麻烦，但大大降低了源代码的可读性和完整性，降低了阅读源代码的舒适度。</li></ul><p>总结：</p><p>类似插件，但需要jar包，需要在编译时用到他的注解。编译器编译时通过操作AST（抽象语法树）改变字节码生成，变相的在改变java语法。</p><p>他不是像spring依赖注入、mybatis等ORM一样的运行时的特性，而是编译时的特性。</p><h2 id="10、多对一"><a href="#10、多对一" class="headerlink" title="10、多对一"></a>10、多对一</h2><p>多对一：<a href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#Result_Maps">https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#Result_Maps</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">之前用result，现在用下面这些了:</span><br><span class="line">association – 一个复杂类型的关联；许多结果将包装成这种类型</span><br><span class="line">- 嵌套结果映射 – 关联可以是 resultMap 元素，或是对其它结果映射的引用</span><br><span class="line">collection – 一个复杂类型的集合</span><br><span class="line">- 嵌套结果映射 – 集合可以是 resultMap 元素，或是对其它结果映射的引用</span><br></pre></td></tr></table></figure><p><img src="Untitled%2015.png" alt="Untitled"></p><p>多个学生对应一个老师，对于学生而言。</p><p>多个学生<strong>关联</strong>一个老师。</p><p>但对应老师而言，是一对多。一个老师有一个学生<strong>集合</strong></p><p>SQL:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">create table teacher</span><br><span class="line">(</span><br><span class="line">id int not null,</span><br><span class="line">name varchar(30) null</span><br><span class="line">primary key(id)</span><br><span class="line">);</span><br><span class="line">//插入1老师</span><br><span class="line"></span><br><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">id int not null,</span><br><span class="line">name varchar(30) default null null,</span><br><span class="line">tid int default null null,</span><br><span class="line">constraint student_pk</span><br><span class="line">primary key (id),</span><br><span class="line">constraint student_teacher_id_fk</span><br><span class="line">foreign key (tid) references teacher (id)</span><br><span class="line">);</span><br><span class="line">//5个学生，并关联id为1的老师  </span><br></pre></td></tr></table></figure><p><img src="Untitled%2016.png" alt="Untitled"></p><h3 id="10-1、测试环境搭建："><a href="#10-1、测试环境搭建：" class="headerlink" title="10.1、测试环境搭建："></a>10.1、<strong>测试环境搭建：</strong></h3><p><strong>mybatis-06</strong></p><p>1、导入lombok、junit</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、新建实体类Teacher、Student</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/22</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">public class Student &#123;</span><br><span class="line"></span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    //学生要关联1个老师</span><br><span class="line">    private Teacher teacher;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/22</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">public class Teacher &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、建立Mapper接口</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">import com.kuang.pojo.Teacher;</span><br><span class="line">import org.apache.ibatis.annotations.Param;</span><br><span class="line">import org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/22</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">public interface TeacherMapper &#123;</span><br><span class="line"></span><br><span class="line">    Teacher getTeacher(@Param(&quot;tid&quot;) int id);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/22</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">public interface StudentMapper &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、写TeacherMapper.xml、StudentMapper.xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.kuang.dao.TeacherMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTeacher&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">        select * from teacher where id = #&#123;tid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.kuang.dao.StudentMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>5、核心配置文件绑定注册和properties文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--核心配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--引入外部配置文件db.properties--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置日志工厂--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.com.kuang.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--default切换环境--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--使用配置文件--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--每一个接口都需要在Mybatis的核心配置文件中注册--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.dao.TeacherMapper&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.dao.StudentMapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://39.106.63.189:3307/mybatis?useSSL=false<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8</span><br><span class="line">username=root</span><br><span class="line">password=root</span><br></pre></td></tr></table></figure><p>6、测试</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">import com.kuang.pojo.Teacher;</span><br><span class="line">import com.kuang.utils.MybatisUtils;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/22</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">public class MyTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test() &#123;</span><br><span class="line">        SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">        TeacherMapper mapper = sqlSession.getMapper(TeacherMapper.class);</span><br><span class="line">        Teacher teacher = mapper.getTeacher(1);</span><br><span class="line">        System.out.println(teacher.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-2、查询所有学生信息以及对应的老师"><a href="#10-2、查询所有学生信息以及对应的老师" class="headerlink" title="10.2、查询所有学生信息以及对应的老师"></a>10.2、查询所有学生信息以及对应的老师</h3><p><strong>方式一、按照查询嵌套处理</strong></p><p>xml：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentTeacher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;result property=&quot;teacher&quot; /&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--teacher：复杂属性需要单独出来,result做不了--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--对象使用association,集合使用collection--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        javaType=&quot;teacher&quot;-由于是对象，设置对象类型</span></span><br><span class="line"><span class="comment">        column=&quot;tid&quot;-查询teacher需要的id</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">select</span>=<span class="string">&quot;getTeacher&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    思路：</span></span><br><span class="line"><span class="comment">        1、查询所有学生</span></span><br><span class="line"><span class="comment">        2、根据查询出来学生的tid，寻找对应的老师getTeacher,现在怎么把2个select连接起来</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudent&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentTeacher&quot;</span>&gt;</span></span><br><span class="line">    select id,name,tid from student s</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTeacher&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">    select id,name from teacher where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">    List<span class="tag">&lt;<span class="name">Student</span>&gt;</span> students = mapper.getStudent();</span><br><span class="line">    for (Student student : students) &#123;</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>方式二、安装结果嵌套查询</strong></p><p>xml：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--方式二、安装结果嵌套查询--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    思路：</span></span><br><span class="line"><span class="comment">        1、查询所有学生</span></span><br><span class="line"><span class="comment">        2、根据查询出来学生的tid，寻找对应的老师getTeacher,现在怎么把2个select连接起来</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudent2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentTeacher2&quot;</span>&gt;</span></span><br><span class="line">    select s.id sid,s.name sname,t.name tname</span><br><span class="line">    from student s,teacher t</span><br><span class="line">    where s.tid = t.id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentTeacher2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        处理:</span></span><br><span class="line"><span class="comment">        javaType=&quot;teacher&quot;</span></span><br><span class="line"><span class="comment">        property=&quot;name&quot; column=&quot;tname&quot;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test3() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">    List<span class="tag">&lt;<span class="name">Student</span>&gt;</span> students = mapper.getStudent2();</span><br><span class="line">    for (Student student : students) &#123;</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>mysql多对一查询sql：</strong></p><p>子查询：方式一</p><p>连表查询：方式二</p><h2 id="11、一对多"><a href="#11、一对多" class="headerlink" title="11、一对多"></a>11、一对多</h2><p>比如：一个老师拥有多个学生</p><p>对应老师而言是一对多关系</p><h3 id="11-1、环境搭建-和刚才一样"><a href="#11-1、环境搭建-和刚才一样" class="headerlink" title="11.1、环境搭建-和刚才一样"></a>11.1、环境搭建-和刚才一样</h3><p><strong>mybatis-07</strong></p><p>实体类：</p><p>Teacher：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/22</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">public class Teacher &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    //一个老师包含多个学生</span><br><span class="line">    private List<span class="tag">&lt;<span class="name">Student</span>&gt;</span> students;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Student：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/22</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">public class Student &#123;</span><br><span class="line"></span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private int tid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>方式一、按结果嵌套查询</p><p>xml：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--方式一、按结果嵌套查询--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTeacher&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;TeacherStudent&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">        s.id sid,</span><br><span class="line">        s.name sname,</span><br><span class="line">        t.name tname,</span><br><span class="line">        t.id tid</span><br><span class="line">    from teacher t,student s</span><br><span class="line">    where</span><br><span class="line">        s.tid = t.id</span><br><span class="line">        and t.id = #&#123;tid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;TeacherStudent&quot;</span> <span class="attr">type</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        对象使用association,集合使用collection</span></span><br><span class="line"><span class="comment">        javaType是指定属性的类型,这里是list,不合规范</span></span><br><span class="line"><span class="comment">        集合中泛型类型使用ofType指定</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;student&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;ArrayList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;tid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    TeacherMapper mapper = sqlSession.getMapper(TeacherMapper.class);</span><br><span class="line">    List<span class="tag">&lt;<span class="name">Teacher</span>&gt;</span> teachers = mapper.getTeacher(1);</span><br><span class="line">    for (Teacher teacher : teachers) &#123;</span><br><span class="line">        System.out.println(teacher);</span><br><span class="line">    &#125;</span><br><span class="line">    //Teacher(id=1, name=missLi, students=[Student(id=1, name=ming, tid=1), Student(id=2, name=hong, tid=1), Student(id=3, name=zhang, tid=1), Student(id=4, name=li, tid=1), Student(id=5, name=wang, tid=1)])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>方式二、按子查询</p><p>xml：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--方式二、按子查询--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    思路：</span></span><br><span class="line"><span class="comment">        查老师先</span></span><br><span class="line"><span class="comment">        根据老师id传入到查询学生语句中</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTeacher2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;TeacherStudent2&quot;</span>&gt;</span></span><br><span class="line">    select id,name from teacher where id = #&#123;tid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudentByTeacherId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">    select id,name,tid from student s where tid = #&#123;tid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;TeacherStudent2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用javaType是List--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;ArrayList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;student&quot;</span> <span class="attr">select</span>=<span class="string">&quot;getStudentByTeacherId&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    TeacherMapper mapper = sqlSession.getMapper(TeacherMapper.class);</span><br><span class="line">    List<span class="tag">&lt;<span class="name">Teacher</span>&gt;</span> teachers = mapper.getTeacher2(1);</span><br><span class="line">    for (Teacher teacher : teachers) &#123;</span><br><span class="line">        System.out.println(teacher);</span><br><span class="line">    &#125;</span><br><span class="line">    //Teacher(id=1, name=missLi, students=[Student(id=1, name=ming, tid=1), Student(id=2, name=hong, tid=1), Student(id=3, name=zhang, tid=1), Student(id=4, name=li, tid=1), Student(id=5, name=wang, tid=1)])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11-2、小结"><a href="#11-2、小结" class="headerlink" title="11.2、小结"></a>11.2、小结</h3><p>1.关联-association【多对一：对象】</p><p>2.集合-collection【一对多：List】</p><p>3.javaType &amp; ofType</p><p>3.1.javaType用来指定属性的实体类型，多对一为对象类型，一对多为集合类型</p><p>3.2.ofType用来指定集合中的泛型类型 </p><p>4.注意点：按结果嵌套查询、按子查询，尽量使用sql可读性高的一种，保证维护方便</p><p>5.注意一对多和多对一中的属性名和字段对应问题</p><p>6.如果问题不好排查，建议使用日志Log4j</p><p>7.SQL性能问题，注意积累：sql引擎、innoDB底层原理、索引、索引优化，网上搜题</p><p>8.多回忆总结</p><h2 id="12、动态SQL"><a href="#12、动态SQL" class="headerlink" title="12、动态SQL"></a>12、动态SQL</h2><p><a href="https://mybatis.org/mybatis-3/zh/dynamic-sql.html">https://mybatis.org/mybatis-3/zh/dynamic-sql.html</a></p><p>动态sql就是指更加不同条件生产不同的sql语句</p><ul><li>if</li><li>choose (when, otherwise)</li><li>trim (where, set)</li><li>foreach</li></ul><h3 id="12-1、搭建环境"><a href="#12-1、搭建环境" class="headerlink" title="12.1、搭建环境"></a>12.1、搭建环境</h3><p><strong>mybatis-08</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table blog</span><br><span class="line">(</span><br><span class="line">id int not null,</span><br><span class="line">title varchar(100) not null,</span><br><span class="line">author varchar(30) not null,</span><br><span class="line">create_time datetime not null,</span><br><span class="line">views int(30) not null</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>1、导包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、编写配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--核心配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--引入外部配置文件db.properties--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置日志工厂--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.kuang.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--default切换环境--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--使用配置文件--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--每一个接口都需要在Mybatis的核心配置文件中注册--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.dao.BlogMapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://39.106.63.189:3307/mybatis?useSSL=false<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8</span><br><span class="line">username=root</span><br><span class="line">password=root</span><br></pre></td></tr></table></figure><p>3、编写实体类</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/23</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">public class Blog &#123;</span><br><span class="line"></span><br><span class="line">    private String id;</span><br><span class="line">    private String title;</span><br><span class="line">    private String author;</span><br><span class="line">    private Date createTime; //属性名和字段名不一致，开启驼峰</span><br><span class="line">    private int views;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、编写实体类对应的mapper接口和mapper.xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">import com.kuang.pojo.Blog;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/23</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">public interface BlogMapper &#123;</span><br><span class="line"></span><br><span class="line">    int addBlog(Blog blog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.kuang.dao.BlogMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addBlog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;blog&quot;</span>&gt;</span></span><br><span class="line">        insert into blog (id, title, author, create_time, views)</span><br><span class="line">        values (#&#123;id&#125;, #&#123;title&#125;, #&#123;author&#125;, #&#123;createTime&#125;, #&#123;views&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>5、测试添加数据</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.dao;</span><br><span class="line"></span><br><span class="line">import com.kuang.pojo.Blog;</span><br><span class="line">import com.kuang.utils.IDutils;</span><br><span class="line">import com.kuang.utils.MybatisUtils;</span><br><span class="line">import org.apache.ibatis.session.SqlSession;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/23</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">public class MyTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test() &#123;</span><br><span class="line">        SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">        BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);</span><br><span class="line"></span><br><span class="line">        Blog blog = new Blog();</span><br><span class="line">        blog.setId(IDutils.getUUIDString());</span><br><span class="line">        blog.setTitle(&quot;mybatis-tools&quot;);</span><br><span class="line">        blog.setAuthor(&quot;kuang&quot;);</span><br><span class="line">        blog.setCreateTime(new Date());</span><br><span class="line">        blog.setViews(9999);</span><br><span class="line">        mapper.addBlog(blog);</span><br><span class="line"></span><br><span class="line">        blog.setId(IDutils.getUUIDString());</span><br><span class="line">        blog.setTitle(&quot;spring-tools&quot;);</span><br><span class="line">        blog.setAuthor(&quot;shen&quot;);</span><br><span class="line">        blog.setCreateTime(new Date());</span><br><span class="line">        mapper.addBlog(blog);</span><br><span class="line"></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="12-2、if、where、trim"><a href="#12-2、if、where、trim" class="headerlink" title="12.2、if、where、trim"></a>12.2、if、where、trim</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findActiveBlogWithTitleLike&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE state = ‘ACTIVE’</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这条语句提供了可选的查找文本功能。如果不传入 “title”，那么所有处于 “ACTIVE” 状态的 BLOG 都会返回；如果传入了 “title” 参数，那么就会对 “title” 一列进行模糊查找并返回对应的 BLOG 结果（细心的读者可能会发现，“title” 的参数值需要包含查找掩码或通配符字符）。</p><p>如果希望通过 “title” 和 “author” 两个参数进行可选搜索该怎么办呢？首先，我想先将语句名称修改成更名副其实的名称；接下来，只需要加入另一个条件即可。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findActiveBlogLike&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null and author.name != null&quot;</span>&gt;</span></span><br><span class="line">    AND author_name like #&#123;author.name&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>练习1：查询博客，传title，查指定书；传作者，查作者所有书；不传时，查所有书</strong></p><p>interface:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//查询博客，传title，查指定书；传作者，查作者所有书；不传时，查所有书</span><br><span class="line">List<span class="tag">&lt;<span class="name">Blog</span>&gt;</span> queryBlog(Map map);</span><br></pre></td></tr></table></figure><p>xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    传title，查指定书</span></span><br><span class="line"><span class="comment">    传作者，查作者所有书</span></span><br><span class="line"><span class="comment">    不传时，查所有书</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryBlog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;blog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    select * from blog</span><br><span class="line">    where 1 = 1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">        and title = #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">        and author = #&#123;author&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);</span><br><span class="line"></span><br><span class="line">    //查询所有</span><br><span class="line">    Map map = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    List<span class="tag">&lt;<span class="name">Blog</span>&gt;</span> blogs = mapper.queryBlog(map);</span><br><span class="line">    for (Blog blog : blogs) &#123;</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;---------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">    //查询title</span><br><span class="line">    map.put(&quot;title&quot;, &quot;mybatis-tools&quot;);</span><br><span class="line">    blogs = mapper.queryBlog(map);</span><br><span class="line">    for (Blog blog : blogs) &#123;</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;---------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">    //查询author</span><br><span class="line">    map.remove(&quot;title&quot;);</span><br><span class="line">    map.put(&quot;author&quot;, &quot;kuang&quot;);</span><br><span class="line">    blogs = mapper.queryBlog(map);</span><br><span class="line">    for (Blog blog : blogs) &#123;</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;---------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用where标签改造xml:</p><p>where 元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句。而且，若子句的开头为 “AND” 或 “OR”，where 元素也会将它们去除。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    传title，查指定书</span></span><br><span class="line"><span class="comment">    传作者，查作者所有书</span></span><br><span class="line"><span class="comment">    不传时，查所有书</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryBlog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;blog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    select * from blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">            title = #&#123;title&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">            and author = #&#123;author&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果 where 元素与你期望的不太一样，你也可以通过自定义 trim 元素来定制 where 元素的功能。比如，和 where 元素等价的自定义 trim 元素为:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    传title，查指定书</span></span><br><span class="line"><span class="comment">    传作者，查作者所有书</span></span><br><span class="line"><span class="comment">    不传时，查所有书</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryBlog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;blog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select * from blog</span><br><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND |OR &quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">            title = #&#123;title&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">            and author = #&#123;author&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="12-3、choose、when、otherwise、set"><a href="#12-3、choose、when、otherwise、set" class="headerlink" title="12.3、choose、when、otherwise、set"></a>12.3、choose、when、otherwise、set</h3><p>有时候，我们不想使用所有的条件，而只是想从多个条件中选择一个使用。针对这种情况，MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。</p><p>还是上面的例子，但是策略变为：传入了 “title” 就按 “title” 查找，传入了 “author” 就按 “author” 查找的情形。若两者都没有传入，就返回标记为 featured 的 BLOG（这可能是管理员认为，与其返回大量的无意义随机 Blog，还不如返回一些由管理员精选的 Blog）。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findActiveBlogLike&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’</span><br><span class="line">  <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">      AND title like #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;author != null and author.name != null&quot;</span>&gt;</span></span><br><span class="line">      AND author_name like #&#123;author.name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">      AND featured = 1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>练习2：传title，查指定书;传作者，查作者所有书;不传时，查精选的书</strong></p><p>xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    传title，查指定书</span></span><br><span class="line"><span class="comment">    传作者，查作者所有书</span></span><br><span class="line"><span class="comment">    不传时，查精选的书</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryBlogChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;blog&quot;</span>&gt;</span></span><br><span class="line">    select * from blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">                title = #&#123;title&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">                and author = #&#123;author&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                and views &gt; 5000</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test3() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);</span><br><span class="line"></span><br><span class="line">    //查精选的书</span><br><span class="line">    Map map = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    List<span class="tag">&lt;<span class="name">Blog</span>&gt;</span> blogs = mapper.queryBlogChoose(map);</span><br><span class="line">    for (Blog blog : blogs) &#123;</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;---------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">    //查询title</span><br><span class="line">    map.put(&quot;title&quot;, &quot;mybatis-tools&quot;);</span><br><span class="line">    blogs = mapper.queryBlog(map);</span><br><span class="line">    for (Blog blog : blogs) &#123;</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;---------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">    //查询author</span><br><span class="line">    map.remove(&quot;title&quot;);</span><br><span class="line">    map.put(&quot;author&quot;, &quot;kuang&quot;);</span><br><span class="line">    blogs = mapper.queryBlog(map);</span><br><span class="line">    for (Blog blog : blogs) &#123;</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;---------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只会选择其中1个when</p><p><strong>练习3：查询博客，传title，查指定书；传作者，查作者所有书；不传时，查所有书</strong></p><p>set 元素会动态地在行首插入 SET 关键字，并会删掉额外的逗号</p><p>xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    更新博客</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateBlog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    update blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">            title = #&#123;title&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">            author = #&#123;author&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test4() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);</span><br><span class="line"></span><br><span class="line">    //修改id=1的title</span><br><span class="line">    Map map = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    map.put(&quot;id&quot;, &quot;1&quot;);</span><br><span class="line">    map.put(&quot;title&quot;, &quot;mybatis-tools2&quot;);</span><br><span class="line">    mapper.updateBlog(map);</span><br><span class="line">    System.out.println(&quot;---------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">    //修改id=1的author</span><br><span class="line">    map.remove(&quot;title&quot;);</span><br><span class="line">    map.put(&quot;author&quot;, &quot;kuang2&quot;);</span><br><span class="line">    mapper.updateBlog(map);</span><br><span class="line">    System.out.println(&quot;---------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>trim实现:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    更新博客</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateBlog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    update blog</span><br><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">            title = #&#123;title&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">            author = #&#123;author&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p>所谓的动态sql还是sql语句，只是我们可以在sql层面，增加逻辑代码！</p><h3 id="12-3、foreach、可拔插脚本sql片段、script、bind"><a href="#12-3、foreach、可拔插脚本sql片段、script、bind" class="headerlink" title="12.3、foreach、可拔插脚本sql片段、script、bind"></a>12.3、foreach、可拔插脚本sql片段、script、bind</h3><p><strong>1、sql片段:</strong></p><p>这个元素可以用来定义可重用的 SQL 代码片段，以便在其它语句中使用。 参数可以静态地（在加载的时候）确定下来，并且可以在不同的 include 元素中定义不同的参数值。比如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;userColumns&quot;</span>&gt;</span> $&#123;alias&#125;.id,$&#123;alias&#125;.username,$&#123;alias&#125;.password <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个 SQL 片段可以在其它语句中使用，例如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userColumns&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;alias&quot;</span> <span class="attr">value</span>=<span class="string">&quot;t1&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span>,</span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userColumns&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;alias&quot;</span> <span class="attr">value</span>=<span class="string">&quot;t2&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">  from some_table t1</span><br><span class="line">    cross join some_table t2</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>也可以在 include 元素的 refid 属性或内部语句中使用属性值，例如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;sometable&quot;</span>&gt;</span></span><br><span class="line">  $&#123;prefix&#125;Table</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;someinclude&quot;</span>&gt;</span></span><br><span class="line">  from</span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;$&#123;include_target&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;select&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    field1, field2, field3</span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;someinclude&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Some&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;include_target&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sometable&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>练习：</p><p>1.使用sql标签抽取公共部分</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--sql片段--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;if-title-author&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">        title = #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">        and author = #&#123;author&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.在需要使用的地方使用includ引用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    传title，查指定书</span></span><br><span class="line"><span class="comment">    传作者，查作者所有书</span></span><br><span class="line"><span class="comment">    不传时，查所有书</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryBlog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;blog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    select * from blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--引入sql片段--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;if-title-author&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;if test=&quot;title != null&quot;&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    title = #&#123;title&#125;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;/if&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;if test=&quot;author != null&quot;&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    and author = #&#123;author&#125;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;/if&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2、foreach</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select * from blog b where 1=1 and (id = 1 or id = 2 or id = 3)</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPostIn&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;blog&quot;</span>&gt;</span></span><br><span class="line">  SELECT *</span><br><span class="line">  FROM BLOG b</span><br><span class="line">  WHERE 1 = 1</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">open</span>=<span class="string">&quot;and (&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;or&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="Untitled%2017.png" alt="Untitled"></p><p>练习：</p><p>xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    拼接select * from blog b where 1=1 and (id = 1 or id = 2 or id = 3)</span></span><br><span class="line"><span class="comment">    传递万能map，在map中存入一个list,key=ids</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryBlogForeach&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;blog&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from blog</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--where 会把open中的第一个and去掉--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;and (&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;or&quot;</span>&gt;</span></span><br><span class="line">            id = #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * foreach</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void test5() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);</span><br><span class="line"></span><br><span class="line">    Map map = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    List<span class="tag">&lt;<span class="name">Integer</span>&gt;</span> list = new ArrayList<span class="tag">&lt;<span class="name">Integer</span>&gt;</span>();</span><br><span class="line">    list.add(1);</span><br><span class="line">    list.add(2);</span><br><span class="line">    list.add(3);</span><br><span class="line">    map.put(&quot;ids&quot;, list);</span><br><span class="line">    List<span class="tag">&lt;<span class="name">Blog</span>&gt;</span> blogs = mapper.queryBlogForeach(map);</span><br><span class="line">    for (Blog blog : blogs) &#123;</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;---------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>动态sql就是在拼接sql语句，我们只需要保证sql正确性，按照sql的格式去排列组合</p><p>建议：</p><p>先写完整的sql，再对应的修改成为动态sql。</p><p><strong>3、script</strong></p><p>要在带注解的映射器接口类中使用动态 SQL，可以使用 script 元素。比如:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Update(&#123;&quot;<span class="tag">&lt;<span class="name">script</span>&gt;</span>&quot;,</span><br><span class="line"><span class="javascript">  <span class="string">&quot;update Author&quot;</span>,</span></span><br><span class="line"><span class="javascript">  <span class="string">&quot;  &lt;set&gt;&quot;</span>,</span></span><br><span class="line"><span class="handlebars"><span class="xml">  &quot;    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&#x27;username != null&#x27;</span>&gt;</span>username=#&#123;username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span>&quot;,</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">  &quot;    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&#x27;password != null&#x27;</span>&gt;</span>password=#&#123;password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span>&quot;,</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">  &quot;    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&#x27;email != null&#x27;</span>&gt;</span>email=#&#123;email&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span>&quot;,</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">  &quot;    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&#x27;bio != null&#x27;</span>&gt;</span>bio=#&#123;bio&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span>&quot;,</span></span></span><br><span class="line"><span class="javascript">  <span class="string">&quot;  &lt;/set&gt;&quot;</span>,</span></span><br><span class="line"><span class="javascript">  <span class="string">&quot;where id=#&#123;id&#125;&quot;</span>,</span></span><br><span class="line">  &quot;<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&quot;&#125;)</span><br><span class="line">void updateAuthorValues(Author author);</span><br></pre></td></tr></table></figure><p>4、<strong>bind</strong></p><p>bind 元素允许你在 OGNL 表达式以外创建一个变量，并将其绑定到当前的上下文。比如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlogsLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27; + _parameter.getTitle() + &#x27;%&#x27;&quot;</span> /&gt;</span></span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE title LIKE #&#123;pattern&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="13、缓存"><a href="#13、缓存" class="headerlink" title="13、缓存"></a>13、缓存</h2><p><a href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#cache">https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#cache</a></p><p><strong>mybatis-09</strong></p><h3 id="13-1、简介"><a href="#13-1、简介" class="headerlink" title="13.1、简介"></a>13.1、简介</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查询：连接数据库，耗资源！</span><br><span class="line">一次查询的结果，给他暂存再一个可以直接取到的地方--&gt;内存：缓存</span><br><span class="line">我们再次查询相同的数据，直接走缓存，不走数据库了。</span><br></pre></td></tr></table></figure><p>1.什么是缓存【cache】？</p><p>存在内存中的临时数据。</p><p>将用户查询的数据放在缓存（内存）中，用户去查询数据就不用从磁盘上（关系型数据库数据文件）查询，从缓存中查询，从而提高查询效率，解决了高并发系统的性能问题。</p><p>——三高问题：高并发、高可用、高性能！用缓存能极大解决这个问题。</p><p>2.为什么使用缓存？</p><p>减少和数据库的交互次数，减少系统开销，提高系统效率。</p><p>3.什么样的数据能使用缓存？</p><p>经常查询并且不经常改动的数据。【使用缓存】</p><p>不经常查询并且经常改动的数据。【不使用缓存】</p><p><img src="Untitled%2018.png" alt="Untitled"></p><h3 id="13-2、Mybatis缓存"><a href="#13-2、Mybatis缓存" class="headerlink" title="13.2、Mybatis缓存"></a>13.2、Mybatis缓存</h3><p>1.MyBatis包含一个非常强大的查询缓存特性，它可以非常方便地定制和配置缓存。可以极大的提高查询效率。—-<strong>加标签开启</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>2.Mybatis系统中默认定义了两级缓存：一级缓存和二级缓存</p><ul><li>默认情况下，只有一级缓存开启。（Sqlsession级别的缓存（close后无效），也称为本地缓存）</li><li>二级缓存需要手动开启和配置，他是基于namespace级别的缓存。</li><li>为了提高扩展性，Mybatis定义了缓存接口cache。可以通过实现cache接口自定义二级缓存！org.apache.ibatis.cache。默认实现策略：</li></ul><p><img src="Untitled%2019.png" alt="Untitled"></p><p>缓存只作用于 cache 标签所在的映射文件中的语句。如果你混合使用 Java API 和 XML 映射文件，在共用接口中的语句将不会被默认缓存。你需要使用 @CacheNamespaceRef 注解指定缓存作用域。</p><p>这些属性可以通过 cache 元素的属性来修改。比如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;cache</span><br><span class="line">  eviction=&quot;FIFO&quot;</span><br><span class="line">  flushInterval=&quot;60000&quot;</span><br><span class="line">  size=&quot;512&quot;</span><br><span class="line">  readOnly=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure><h3 id="13-3、一级缓存"><a href="#13-3、一级缓存" class="headerlink" title="13.3、一级缓存"></a>13.3、一级缓存</h3><p>一级缓存也叫本地缓存：</p><ul><li>默认开启,关闭不掉</li><li>与数据库<strong>同一次会话期间查询</strong>到的数据会放到本地缓存中</li><li>以后如果获取相同的数据，直接从缓存中拿，不再查数据库</li></ul><p>测试步骤：</p><p>1.开启日志！</p><p>2.测试在一个sqlSession中查询相同的记录</p><p>3.查看日志输出</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Created connection 270397815.</span><br><span class="line">==&gt;  Preparing: select * from user where id = ?</span><br><span class="line">==&gt; Parameters: 1(Integer)</span><br><span class="line">&lt;==    Columns: id, name, password</span><br><span class="line">&lt;==        Row: 1, guoyuhang, guoyuhang</span><br><span class="line">&lt;==      Total: 1</span><br><span class="line">User(id=1, name=guoyuhang, password=guoyuhang)</span><br><span class="line">User(id=1, name=guoyuhang, password=guoyuhang)</span><br><span class="line">true</span><br><span class="line">Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@101df177]</span><br></pre></td></tr></table></figure><p>缓存失效的情况：</p><p>1.查询不同的东西</p><p>2.增删改操作，可能改变原来的数据。</p><p>3.查询不同的Mapper.xml</p><p>4.手动清理缓存</p><p>一级缓存相当于Map</p><h3 id="13-4、二级缓存"><a href="#13-4、二级缓存" class="headerlink" title="13.4、二级缓存"></a>13.4、二级缓存</h3><ul><li>二级缓存也叫全局缓存，一级缓存作用域太低了，所以诞生了二级缓存！</li><li>基于namespace级别，一个命名空间，对应一个二级缓存！</li><li>工作机制：<ul><li>一个会话查询一条数据，这个数据会被缓存到当前会话当中；</li><li>如果当前会话关闭了，这个一级缓存就没有了；但我们想要的是，会话关闭了，一级缓存中的数据被保存到二级缓存中；</li><li>新的会话查询信息，就可以从二级缓存中获取内容；</li><li>不同的mapper查询出的数据，会放到自己对应的缓存中；</li></ul></li></ul><p><strong>开启步骤：</strong></p><p>1.开启全局二级缓存</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--显示的开启全局缓存，默认开启true--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.要启用全局的二级缓存，只需要在你的 SQL 映射Mapper文件中添加一行：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  开启二级缓存</span></span><br><span class="line"><span class="comment">  策略FIFO</span></span><br><span class="line"><span class="comment">  刷新间隔flushInterval</span></span><br><span class="line"><span class="comment">  最大缓存个数size</span></span><br><span class="line"><span class="comment">  返回的对象被认为是只读readOnly</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  &lt;cache</span><br><span class="line">          eviction=&quot;FIFO&quot;</span><br><span class="line">          flushInterval=&quot;60000&quot;</span><br><span class="line">          size=&quot;512&quot;</span><br><span class="line">          readOnly=&quot;true&quot;</span><br><span class="line">  /&gt;</span><br></pre></td></tr></table></figure><p>3.测试</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 测试二级缓存,2次查询使用2个sqlSession</span><br><span class="line"> * sql走了1次</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void test3() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    User user = mapper.queryUserById(1);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    sqlSession.close();</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession2 = MybatisUtils.getSqlSession();</span><br><span class="line">    UserMapper mapper2 = sqlSession2.getMapper(UserMapper.class);</span><br><span class="line">    User user2 = mapper2.queryUserById(1);</span><br><span class="line">    System.out.println(user2);</span><br><span class="line">    sqlSession2.close();</span><br><span class="line"></span><br><span class="line">    //true</span><br><span class="line">    System.out.println(user==user2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意:</strong></p><p>1.我们需要将实体类序列化,否则就会报错Caused by: java.io.NotSerializableException: com.kuang.pojo.User</p><p>2.所有的数据都会先放到一级缓存，只有当会话关闭的时候，才会提交到二级缓存！</p><p>基本上就是这样。这个简单语句的效果如下:</p><ul><li>映射语句文件中的<strong>所有 select 语句的结果将会被缓存</strong>。</li><li>映射语句文件中的所有 <strong>insert、update 和 delete 语句会刷新缓存</strong>。</li><li>缓存会<strong>使用最近最少使用</strong>算法（LRU, Least Recently Used）算法<strong>来清除不需要的缓存</strong>。</li><li>缓存<strong>不会定时进行刷新</strong>（也就是说，没有刷新间隔）。</li><li>缓存会保存列表或对象（无论查询方法返回哪种）的 1024 个引用。</li><li>缓存会被视为读/写缓存，这意味着<strong>获取到的对象并不是共享的</strong>，可以安全地被调用者修改，而<strong>不干扰其他调用者或线程</strong>所做的潜在修改。</li></ul><p><strong>提示</strong> 缓存只作用于 cache 标签所在的映射文件中的语句。如果你混合使用 Java API 和 XML 映射文件，在共用接口中的语句将不会被默认缓存。你需要使用 @CacheNamespaceRef 注解指定缓存作用域。</p><p>这些属性可以通过 cache 元素的属性来修改。比如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;cache</span><br><span class="line">  eviction=&quot;FIFO&quot;</span><br><span class="line">  flushInterval=&quot;60000&quot;</span><br><span class="line">  size=&quot;512&quot;</span><br><span class="line">  readOnly=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure><p>这个更高级的配置创建了一个 <strong>FIFO</strong> 缓存，<strong>每隔 60 秒刷新</strong>，<strong>最多</strong>可以<strong>存储结果对象</strong>或列表的 <strong>512 个引用</strong>，而且<strong>返回的对象</strong>被<strong>认为是只读</strong>的，因此<strong>对它们进行修改</strong>可能<strong>会在不同线程中的调用者产生冲突。</strong></p><p>可用的<strong>清除策略</strong>有：</p><ul><li><code>**LRU</code> – 最近最少使用：移除最长时间不被使用的对象。**</li><li><code>**FIFO</code> – 先进先出：按对象进入缓存的顺序来移除它们。**</li><li><code>SOFT</code> – 软引用：基于垃圾回收器状态和软引用规则移除对象。</li><li><code>WEAK</code> – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。</li></ul><p>默认的清除策略是 LRU。</p><p>flushInterval（刷新间隔）属性可以被设置为任意的正整数，设置的值应该是一个<strong>以毫秒为单位</strong>的合理时间量。 <strong>默认</strong>情况是<strong>不设置</strong>，也就是<strong>没有刷新间隔</strong>，<strong>缓存仅仅会在调用语句时刷新</strong>。</p><p>size（引用数目）属性可以被设置为任意正整数，要注意欲缓存对象的大小和运行环境中可用的内存资源。<strong>默认值是 1024</strong>。</p><p>readOnly（只读）属性可以被设置为 true 或 false。只读的缓存会给所有调用者返回缓存对象的相同实例。 因此这些对象不能被修改。这就提供了可观的性能提升。而可读写的缓存会（通过序列化）返回缓存对象的拷贝。 速度上会慢一些，但是更安全，因此默认值是 false。</p><p><strong>提示</strong> 二级缓存是事务性的。这意味着，当 SqlSession 完成并提交时，或是完成并回滚，但没有执行 flushCache=true 的 insert/delete/update 语句时，缓存会获得更新。</p><h3 id="13-5、缓存原理"><a href="#13-5、缓存原理" class="headerlink" title="13.5、缓存原理"></a>13.5、缓存原理</h3><p><img src="Untitled%2020.png" alt="Untitled"></p><p>查询顺序：</p><p>1.先看二级缓存中有没有</p><p>2.再看一级缓存中有没有</p><p>3.查询数据库</p><p>测试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 测试查询顺序</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void test4() &#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtils.getSqlSession();</span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    System.out.println(&quot;查数据库，sqlSession关闭，放入二级缓存&quot;);</span><br><span class="line">    User user = mapper.queryUserById(1);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    sqlSession.close();</span><br><span class="line">    System.out.println(&quot;=============================================&quot;);</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession2 = MybatisUtils.getSqlSession();</span><br><span class="line">    UserMapper mapper2 = sqlSession2.getMapper(UserMapper.class);</span><br><span class="line">    System.out.println(&quot;查二级缓存&quot;);</span><br><span class="line">    User user2 = mapper2.queryUserById(1);</span><br><span class="line">    System.out.println(user2);</span><br><span class="line">    System.out.println(&quot;=============================================&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;二级一级缓存没有，查数据库，放入一级缓存&quot;);</span><br><span class="line">    User user3 = mapper2.queryUserById(2);</span><br><span class="line">    System.out.println(user3);</span><br><span class="line">    System.out.println(&quot;=============================================&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;查二级缓存没有，查一级缓存&quot;);</span><br><span class="line">    User user4 = mapper2.queryUserById(2);</span><br><span class="line">    System.out.println(user4);</span><br><span class="line">    System.out.println(&quot;=============================================&quot;);</span><br><span class="line"></span><br><span class="line">    sqlSession2.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>日志：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">查数据库，sqlSession关闭，放入二级缓存</span><br><span class="line">Cache Hit Ratio [com.kuang.dao.UserMapper]: 0.0</span><br><span class="line">Opening JDBC Connection</span><br><span class="line">Created connection 852445367.</span><br><span class="line">==&gt;  Preparing: select * from user where id = ?</span><br><span class="line">==&gt; Parameters: 1(Integer)</span><br><span class="line">&lt;==    Columns: id, name, password</span><br><span class="line">&lt;==        Row: 1, guoyuhang, guoyuhang</span><br><span class="line">&lt;==      Total: 1</span><br><span class="line">User(id=1, name=guoyuhang, password=guoyuhang)</span><br><span class="line">Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@32cf48b7]</span><br><span class="line">Returned connection 852445367 to pool.</span><br><span class="line">=============================================</span><br><span class="line">查二级缓存</span><br><span class="line">Cache Hit Ratio [com.kuang.dao.UserMapper]: 0.5</span><br><span class="line">User(id=1, name=guoyuhang, password=guoyuhang)</span><br><span class="line">=============================================</span><br><span class="line">二级一级缓存没有，查数据库，放入一级缓存</span><br><span class="line">Cache Hit Ratio [com.kuang.dao.UserMapper]: 0.3333333333333333</span><br><span class="line">Opening JDBC Connection</span><br><span class="line">Checked out connection 852445367 from pool.</span><br><span class="line">==&gt;  Preparing: select * from user where id = ?</span><br><span class="line">==&gt; Parameters: 2(Integer)</span><br><span class="line">&lt;==    Columns: id, name, password</span><br><span class="line">&lt;==        Row: 2, bbbbbb, bbbbbbb</span><br><span class="line">&lt;==      Total: 1</span><br><span class="line">User(id=2, name=bbbbbb, password=bbbbbbb)</span><br><span class="line">=============================================</span><br><span class="line">查二级缓存没有，查一级缓存</span><br><span class="line">Cache Hit Ratio [com.kuang.dao.UserMapper]: 0.25</span><br><span class="line">User(id=2, name=bbbbbb, password=bbbbbbb)</span><br><span class="line">=============================================</span><br><span class="line">Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@32cf48b7]</span><br></pre></td></tr></table></figure><p>调优：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--调优时用：useCache=&quot;true&quot; flushCache=&quot;true&quot;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">useCache</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    select * from user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">flushCache</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    update user set name = #&#123;name&#125;,password = #&#123;password&#125; where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="13-6、自定义缓存-Ehcache"><a href="#13-6、自定义缓存-Ehcache" class="headerlink" title="13.6、自定义缓存-Ehcache"></a>13.6、自定义缓存-Ehcache</h3><p>EhCache 是一个纯Java的进程内缓存框架，具有快速、精干等特点，是Hibernate中默认的CacheProvider。</p><p>Ehcache是一种广泛使用的开源Java分布式缓存。主要面向通用缓存。</p><p><strong>使用Ehcache步骤：</strong></p><p>1.导包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.caches/mybatis-ehcache --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.mapper.xml配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--第三方缓存ehcache,type为实现缓存的接口--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>3.resource下创建ehcache.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;http://ehcache.org/ehcache.xsd&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">updateCheck</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        diskStore:缓存路径,ehcache分为内存和磁盘两级，此属性定义磁盘缓存位置，参数如下：</span></span><br><span class="line"><span class="comment">        user.home：用户主目录</span></span><br><span class="line"><span class="comment">        user.dir：用户当前工作目录</span></span><br><span class="line"><span class="comment">        java.io.tmpdir：临时文件目录</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;./tmpdir/Tmp_EhCache/&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;defaultCache</span><br><span class="line">        eternal=&quot;false&quot;</span><br><span class="line">        maxElementsInMemory=&quot;10000&quot;</span><br><span class="line">        overflowToDisk=&quot;false&quot;</span><br><span class="line">        diskPersistent=&quot;false&quot;</span><br><span class="line">        timeToIdleSeconds=&quot;1800&quot;</span><br><span class="line">        timeToLiveSeconds=&quot;259200&quot;</span><br><span class="line">        memoryStoreEvictionPolicy=&quot;LRU&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;cache</span><br><span class="line">        name=&quot;cloud_user&quot;</span><br><span class="line">        eternal=&quot;false&quot;</span><br><span class="line">        maxElementsInMemory=&quot;5000&quot;</span><br><span class="line">        overflowToDisk=&quot;false&quot;</span><br><span class="line">        diskPersistent=&quot;false&quot;</span><br><span class="line">        timeToIdleSeconds=&quot;1800&quot;</span><br><span class="line">        timeToLiveSeconds=&quot;1800&quot;</span><br><span class="line">        memoryStoreEvictionPolicy=&quot;LRU&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>使用自定义缓存:</strong></p><p>1.创建自定义缓存类</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.utils;</span><br><span class="line"></span><br><span class="line">import org.apache.ibatis.cache.Cache;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/9/29</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">public class MyCache implements Cache &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String getId() &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void putObject(Object o, Object o1) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object getObject(Object o) &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object removeObject(Object o) &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void clear() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getSize() &#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.使用自定义缓存</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使用自定义,type为实现缓存的接口--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;com.kuang.utils.MyCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="13-7、引用缓存cache-ref"><a href="#13-7、引用缓存cache-ref" class="headerlink" title="13.7、引用缓存cache-ref"></a>13.7、引用缓存cache-ref</h3><p>回想一下上一节的内容，对某一命名空间的语句，只会使用该命名空间的缓存进行缓存或刷新。 但你可能会想要在多个命名空间中共享相同的缓存配置和实例。要实现这种需求，你可以使用 cache-ref 元素来引用另一个缓存。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache-ref</span> <span class="attr">namespace</span>=<span class="string">&quot;com.someone.application.data.SomeMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="14、29练习题实战"><a href="#14、29练习题实战" class="headerlink" title="14、29练习题实战"></a>14、29练习题实战</h2><p><strong>mybatis-10</strong></p><p><img src="Untitled%2021.png" alt="Untitled"></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-MVC笔记</title>
      <link href="/2021/08/13/Spring-MVC%E7%AC%94%E8%AE%B0/"/>
      <url>/2021/08/13/Spring-MVC%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="1、回顾Servlet"><a href="#1、回顾Servlet" class="headerlink" title="1、回顾Servlet"></a>1、回顾Servlet</h1><p>javaSE：</p><p>javaWeb：</p><p>SSM框架：<strong>研究官方文档，锻炼自学能力，锻炼笔记能力，锻炼项目能力</strong>。</p><p>SpringMVC+Vue+SpringBoot+SpringCloud+Linux</p><p>SSM=Javaweb做项目</p><p>Spring：IOC和AOP</p><p>SpringMVC：SpringMVC执行流程！</p><p>尽量跟着官方文档！</p><h2 id="1-1、什么是MVC："><a href="#1-1、什么是MVC：" class="headerlink" title="1.1、什么是MVC："></a>1.1、什么是MVC：</h2><p>MVC是模型(Model)、视图(View)、控制器(Controller)的简写，是一种软件设计规范。</p><p>是将业务逻辑、数据、显示分离的方法来组织代码。</p><p>MVC主要作用是降低了视图与业务逻辑间的双向偶合。</p><p>MVC不是一种设计模式，MVC是一种架构模式。当然不同的MVC存在差异。</p><p><strong>重要概念：</strong></p><p>1、转发和重定向</p><p>2、前端 数据传输 实体类</p><p>实体类：用户名、密码、生日等20个</p><p>前端：用户名、密码</p><p>有必要创建bean来接收数据吗？会有好多null</p><p>pogo：User</p><p>vo：UserVo  还是实体类，拆掉了很多不必要的字段</p><p>dto：数据传输时对象</p><p>Model（模型）：数据模型，提供要展示的数据，因此包含数据和行为，可以认为是领域模型或JavaBean组件（包含数据和行为），不过现在一般都分离开来：Value Object（数据Dao） 和 服务层（行为Service）。也就是模型提供了模型数据查询和模型数据的状态更新等功能，包括数据和业务。<br>View（视图）：负责进行模型的展示，一般就是我们见到的用户界面，客户想看到的东西。<br>Controller（控制器）：接收用户请求，委托给模型进行处理（状态改变），处理完毕后把返回的模型数据返回给视图，由视图负责展示。 也就是说控制器做了个调度员的工作。<br>最典型的MVC就是JSP + servlet + javabean的模式。</p><p><img src="Untitled.png" alt="Untitled"></p><h2 id="1-2、Model1时代"><a href="#1-2、Model1时代" class="headerlink" title="1.2、Model1时代"></a>1.2、Model1时代</h2><p><img src="Untitled%201.png" alt="Untitled"></p><h2 id="1-3、Model2时代"><a href="#1-3、Model2时代" class="headerlink" title="1.3、Model2时代"></a>1.3、Model2时代</h2><p><img src="Untitled%202.png" alt="Untitled"></p><p><img src="Untitled%203.png" alt="Untitled"></p><p><img src="Untitled%204.png" alt="Untitled"></p><p>更好的是方便团队开发！java越大约好维护</p><p><strong>面试问题</strong>：你们的项目的架构，是设计好的，还是演进的？</p><p>演进的！</p><p>有本书叫：淘宝的10年革命！</p><ul><li>Alibaba PHP</li><li>随着用户变大 Java</li><li>王坚 去IOE  MySQL</li><li>MySQL：Ali自己的MySQL-》aliSQL、AliRedis</li><li>所有的项目从All in one —&gt; 微服务，不是一撮而就。</li></ul><h2 id="1-4、回顾Servlet的实现"><a href="#1-4、回顾Servlet的实现" class="headerlink" title="1.4、回顾Servlet的实现"></a>1.4、回顾Servlet的实现</h2><p>1、新建Maven项目，导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/servlet-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/jsp-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp.jstl/jstl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、创建springmvc-01-servlet的普通maven项目添加AddFrameworkSupport</p><p><img src="Untitled%205.png" alt="Untitled"></p><p>3、导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/servlet-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/jsp-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4、编写一个Servlet类，用来处理用户请求</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.servlet;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/1</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">public class HelloServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        //1.获取前端参数</span><br><span class="line">        String method = req.getParameter(&quot;method&quot;);</span><br><span class="line">        if (method.equals(&quot;add&quot;)) &#123;</span><br><span class="line">            req.getSession().setAttribute(&quot;msg&quot;,&quot;执行了add方法&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (method.equals(&quot;delete&quot;)) &#123;</span><br><span class="line">            req.getSession().setAttribute(&quot;msg&quot;,&quot;执行了delete方法&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        //2.调用业务层</span><br><span class="line"></span><br><span class="line">        //3.试图转发或重定向</span><br><span class="line">        //转发-用的多</span><br><span class="line">        req.getRequestDispatcher(&quot;/WEB-INF/jsp/test.jsp&quot;).forward(req,resp);</span><br><span class="line">        //重定向</span><br><span class="line">        //resp.sendRedirect(&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5、配置servlet,web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.kuang.servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>1500<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>from.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>6、创建from.jsp(web/)和test.jsp(web/WEB-INF/jsp)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: 2021/10/1</span><br><span class="line">  Time: 16:30</span><br><span class="line">  To change this template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>From<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/hello&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;method&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: 2021/10/1</span><br><span class="line">  Time: 16:26</span><br><span class="line">  To change this template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">$&#123;msg&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>7、配置并启动tomcat，测试</p><p><a href="http://localhost:8080/hello?method=add">http://localhost:8080/hello?method=add</a></p><p><img src="Untitled%206.png" alt="Untitled"></p><p>MVVM：M、V、VM：ViewModel双向绑定。</p><h1 id="2、SpringMvc"><a href="#2、SpringMvc" class="headerlink" title="2、SpringMvc"></a>2、SpringMvc</h1><h2 id="2-1、什么是SpringMvc"><a href="#2-1、什么是SpringMvc" class="headerlink" title="2.1、什么是SpringMvc"></a>2.1、什么是SpringMvc</h2><h3 id="2-1-1、概述"><a href="#2-1-1、概述" class="headerlink" title="2.1.1、概述"></a>2.1.1、概述</h3><p>SpringMvc是SpringFramework的一部分，是基于Java实现的MVC的轻量级的Web框架。</p><p>新文档官网：<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-servlet">https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-servlet</a></p><p>老文档：<a href="https://docs.spring.io/spring-framework/docs/4.3.24.RELEASE/spring-framework-reference/html/">https://docs.spring.io/spring-framework/docs/4.3.24.RELEASE/spring-framework-reference/html/</a></p><p><a href="https://docs.spring.io/spring-framework/docs/4.3.24.RELEASE/spring-framework-reference/html/mvc.html#mvc-servlet">https://docs.spring.io/spring-framework/docs/4.3.24.RELEASE/spring-framework-reference/html/mvc.html#mvc-servlet</a></p><p>我们为什么学习SpringMVC呢？</p><p>特点：</p><p>1.轻量级，简单易学</p><p>2.高效，基于请求与响应的MVC框架</p><p>3.与Spring兼容性好，无缝结合，可以将所有SpringMVC中用到的类，注册到Spring中！</p><p>4.约定优于配置</p><p>5.功能强大：RESTful、数据验证、格式化、本地化、主题等</p><p>6.简单灵活</p><h3 id="2-2-2、搭建HelloMVC"><a href="#2-2-2、搭建HelloMVC" class="headerlink" title="2.2.2、搭建HelloMVC"></a>2.2.2、搭建HelloMVC</h3><p><strong>springmvc-02-hellomvc</strong></p><p>步骤：</p><p>1.新建moudle，添加web支持！</p><p>2.导入Springmvc依赖</p><p>3.配置web.xml，注册DispatcherServlet</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--1.注册DispatcherServlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-servlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4.新建springmvc-servlet.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--1.处理器映射器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--2.处理器适配器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--3.视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>5.编写操作接口Controller</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.servlet.ModelAndView;</span><br><span class="line">import org.springframework.web.servlet.mvc.Controller;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/1</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">public class HelloController implements Controller &#123;</span><br><span class="line"></span><br><span class="line">    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception &#123;</span><br><span class="line">        //ModelAndView 模型和试图</span><br><span class="line">        ModelAndView mv = new ModelAndView();</span><br><span class="line"></span><br><span class="line">        //封装对象，放到ModelAndView中</span><br><span class="line">        mv.addObject(&quot;msg&quot;,&quot;HelloSpringMVC&quot;);</span><br><span class="line">        //封装要跳转的试图，放到ModelAndView中,/WEB-INF/jsp/hello.jsp</span><br><span class="line">        mv.setViewName(&quot;hello&quot;);</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6.将Controller注册到bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--1.处理器映射器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--2.处理器适配器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--3.视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--HelloController--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;/hello&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.controller.HelloController&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>7.创建跳转页面/WEB-INF/jsp/hello.jsp</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: 2021/10/1</span><br><span class="line">  Time: 19:27</span><br><span class="line">  To change this template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>$&#123;msg&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">$&#123;msg&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注意问题：</strong></p><p>1.可能遇到404，问题，排查步骤：</p><p>1.查看控制台输出，缺少什么jar包</p><p>2.如果jar包存在，显示无法输出，就在IDEA的项目发布中，添加lib依赖！</p><p>3.重启Tomcat</p><p><img src="Untitled%207.png" alt="Untitled"></p><p>4.D:\Application\apache-tomcat-9.0.34\apache-tomcat-9.0.34\conf</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">109   tomcat.util.scan.StandardJarScanFilter.jarsToSkip=***.jar**</span><br></pre></td></tr></table></figure><p>5.检查是不是<servlet-mapping></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">即路径写错，/后面不能加*，通常情况下都是</span><br><span class="line">/即可，表示拦截所有请求。</span><br></pre></td></tr></table></figure><h3 id="2-2-3、SpringMVC执行原理"><a href="#2-2-3、SpringMVC执行原理" class="headerlink" title="2.2.3、SpringMVC执行原理"></a>2.2.3、SpringMVC执行原理</h3><p><strong>初理解：</strong></p><p>Spring的web框架围绕DispatcherServlet【调度Servlet】设计。</p><p>DispatcherServlet是请求分发的作用。将请求分发到不同的处理器。从Spring2.5和Java5开启可以使用注解的controller声明方式开发。 </p><p><img src="Untitled%208.png" alt="Untitled"></p><p>DispatcherServlet实际是一个Servlet，继承自HttpServlet基类。也有doGET和doPOST等。</p><p><img src="Untitled%209.png" alt="Untitled"></p><p>SpringMVC原理如下图：</p><p><img src="Untitled%2010.png" alt="Untitled"></p><p><strong>再理解：</strong></p><p><img src="Untitled%2011.png" alt="Untitled"></p><p>注：实现都是springmvc实现的，我们只需要实现虚线的（3个） </p><p>分析执行流程：</p><p>1.DispatcherServlet是前端控制器，是整个SpringMVC的控制中心。用户发送的请求，都会被DispathcerServlet接收请求并拦截请求。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--1.注册DispatcherServlet--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-servlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    springmvc中 / 和 /*</span></span><br><span class="line"><span class="comment">    /:只匹配所有的请求，不会匹配jsp页面</span></span><br><span class="line"><span class="comment">    /*:匹配所有的请求，包括jsp页面</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    **<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>**</span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>我们假设请求的url为：<a href="http://localhost:8080/hello">http://localhost:8080/springmvc/hello</a></li><li>如上url拆分为3部分：<ul><li><a href="http://localhost:8080/hello">http://localhost:8080</a>服务域名</li><li><a href="http://localhost:8080/hello">springmvc/</a>是部署在服务器上的web站点</li><li>hello是控制器</li></ul></li><li>通过分析，如上url表示：请求位于服务器<a href="http://localhost:8080/hello">localhost:8080</a>上的springmvc站点的hello控制器</li></ul><p>2.HandlerMapping为处理器映射。由DispathcherServlet自行调用。</p><p>HandlerMapping根据请求的url调用HandlerExecution查找handler处理器（/hello）。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--1.处理器映射器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>在执行一个HandlerExecution操作后，把结果（hello）又返回给DispathcherServlet。</p><p>3.HandlerExecution表示具体的Handler，其主要作用是根据url（/hello）查找控制器，如上url查到的控制器为hello。</p><p>4.HandlerExecution将解析后的信息传递给DispathcherServlet，如解析控制器映射等。</p><p>5.DispathcherServlet调用HandlerAdapter，HandlerAdapter表示处理器适配器（如查u盘后，usb找usb适配器）。其按照特定的规则去执行Handler。找具体的hello控制器的类。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--2.处理器适配器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>6.HandlerAdapter让具体的控制器Controller（HelloController.java）执行。</p><ol start="7"><li>Controller执行相关操作，并将执行后的信息返回给HandlerAdapter，如ModelAndView。</li></ol><p>8.HandlerAdapter将Controller将执行后的信息ModelAndView（视图逻辑名和模型）返回给DispathcherServlet。</p><p>9.DispathcherServlet将调用视图解析器ViewResolver。</p><p>ViewResolver来解析DispathcherServlet传递过来的ModelAndView里的逻辑视图名，并拼接视图的名字，找到对应的视图。</p><p>将ModelAndView里的Model数据渲染到视图上。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--3.视图解析器：DispathcherServlet传给他ModelAndView</span></span><br><span class="line"><span class="comment">    1.获取了ModelAndView的数据</span></span><br><span class="line"><span class="comment">    2.解析ModelAndView的视图名字</span></span><br><span class="line"><span class="comment">    3.拼接视图的名字，找到对应的视图</span></span><br><span class="line"><span class="comment">    4.将ModelAndView里的Model数据渲染到视图上</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>10.视图解析器ViewResolver将解析的视图名传递给DispathcherServlet。</p><p>11.DispathcherServlet根据视图解析器ViewResolver的结果调用具体的视图。</p><p>12.最终视图呈现给用户。</p><p>原理<strong>总结：先拦截、再找url对应的controller、再找对应的视图、再展示视图。</strong></p><p>我们需要做的只有controller调用service层，然后返回视图名和数据。</p><p>*<em>注意：springmvc中 / 和 /**</em><br>/ : 只匹配所有的请求，不会匹配jsp页面<br>/*: 匹配所有的请求，包括jsp页面</p><p>小结：实际开发不会这么写，用注解开发。</p><h2 id="2-2、注解开发SpringMvc"><a href="#2-2、注解开发SpringMvc" class="headerlink" title="2.2、注解开发SpringMvc"></a>2.2、注解开发SpringMvc</h2><p><strong>springmvc-03-annotation</strong></p><p>注：maven文件过滤问题</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>1、创建maven项目，引入依赖和引入web支持</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/servlet-api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/jsp-api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp.jstl/jstl --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、配置web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3、添加spring配置文件</p><p>让IOC的注解生效</p><p>静态资源过滤：HTML、JS、CSS、图片、视频…</p><p>MVC的注解驱动(注册处理器映射器和处理器适配器的注解)</p><p>配置视图解析器</p><p>在resource目录添加spring-mvc.xml文件。为了支持注解的IOC，设置了自动扫描包功能。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/context/spring-context-4.2.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--自动扫描包，让报下注解生效，由IOC统一管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.kuang&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--让SpringMVC不出来静态资源 .css .js .html .mp3 .mp4等--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        支持mvc注解驱动</span></span><br><span class="line"><span class="comment">        在spring中一般采用@RequestMapping注解来完成映射关系</span></span><br><span class="line"><span class="comment">        想要@RequestMapping注解直接生效，必须向上下文注册DefaultAnnotationHandlerMapping和一个AnnotationMethodHandlerAdapter实例</span></span><br><span class="line"><span class="comment">        这两个实例分别在类级别和方法级别处理</span></span><br><span class="line"><span class="comment">        而annotation-driven配置帮助我们完成这2个实例配置注册IOC</span></span><br><span class="line"><span class="comment">        就不需要处理器映射器和处理器适配器了</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--前缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--后缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在视图解析器中我们把视图文件放到/WEB-INF/jsp目录下，保证视图安全。</p><p>4、创建Controller</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.comtroller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/1</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Controller</span><br><span class="line">//@RestController 不调用视图解析器，直接返回数据，json格式用他</span><br><span class="line">@RequestMapping(&quot;/hello&quot;)</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 访问地址 http://localhost/hello/h1</span><br><span class="line">     * 封装数据到 model</span><br><span class="line">     * @param model</span><br><span class="line">     */</span><br><span class="line">    @RequestMapping(value =&quot;/h1&quot;)</span><br><span class="line">    public String hello(Model model) &#123;</span><br><span class="line">        //向模型中添加属性msg和值，可以在jsp中取出来并渲染</span><br><span class="line">        model.addAttribute(&quot;msg&quot;, &quot;Hello,SpringMVCAnnotation!&quot;);</span><br><span class="line"></span><br><span class="line">        //会被视图解析器处理,hello是视图名字</span><br><span class="line">        return &quot;hello&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5、创建jsp页面，/WEB-INF/jsp/hello.jsp</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: 2021/10/1</span><br><span class="line">  Time: 22:11</span><br><span class="line">  To change this template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">$&#123;msg&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>6.测试<a href="http://localhost:8080/hello/h1">http://localhost:8080/hello/h1</a></p><p>7.有问题，可以在项目结构中添加lib包</p><p><img src="Untitled%2012.png" alt="Untitled"></p><p>8.步骤总结：</p><p>创建项目</p><p>导入jar包</p><p>添加web支持</p><p>在web.xml在配置dispatcherservlet</p><p>在resource下创建springmvc.xml</p><p>创建controller</p><h2 id="2-3、Controller配置总结"><a href="#2-3、Controller配置总结" class="headerlink" title="2.3、Controller配置总结"></a>2.3、Controller配置总结</h2><h3 id="2-3-1、控制器Controller"><a href="#2-3-1、控制器Controller" class="headerlink" title="2.3.1、控制器Controller"></a>2.3.1、控制器Controller</h3><p>控制器提供访问程序的行为，通常通过实现接口定义或注解定义两种方式。</p><p>控制器负责解析用户请求并将器转换为一个模型，返回到视图解析器。</p><p>在SpringMVC中，一个控制器中可以包含多个方法。</p><p>在SpringMVC中，对于Controller的配置有很多种。</p><p>我们来看看有哪些方式可以实现：</p><h3 id="2-3-2、使用实现Controller接口的方式"><a href="#2-3-2、使用实现Controller接口的方式" class="headerlink" title="2.3.2、使用实现Controller接口的方式"></a>2.3.2、使用实现Controller接口的方式</h3><p><strong>springmvc-04-controller</strong></p><p><strong>测试：</strong></p><p>mvc配置文件只留下视图解析器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/context/spring-context-4.2.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--自动扫描包，让报下注解生效，由IOC统一管理--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;context:component-scan base-package=&quot;com.kuang&quot;/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--让SpringMVC不出来静态资源 .css .js .html .mp3 .mp4等--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;mvc:default-servlet-handler /&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        支持mvc注解驱动</span></span><br><span class="line"><span class="comment">        在spring中一般采用@RequestMapping注解来完成映射关系</span></span><br><span class="line"><span class="comment">        想要@RequestMapping注解直接生效，必须向上下文注册DefaultAnnotationHandlerMapping和一个AnnotationMethodHandlerAdapter实例</span></span><br><span class="line"><span class="comment">        这两个实例分别在类级别和方法级别处理</span></span><br><span class="line"><span class="comment">        而annotation-driven配置帮助我们完成这2个实例配置注册IOC</span></span><br><span class="line"><span class="comment">        就不需要处理器映射器和处理器适配器了</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;mvc:annotation-driven /&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--前缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--后缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>1、编写一个Controller类，ControllerTest1</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.servlet.ModelAndView;</span><br><span class="line">import org.springframework.web.servlet.mvc.Controller;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/1</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">//只要实现了Controller接口的类，这就是一个控制器</span><br><span class="line">public class ControllerTest1 implements Controller &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception &#123;</span><br><span class="line">        ModelAndView mv = new ModelAndView();</span><br><span class="line"></span><br><span class="line">        mv.addObject(&quot;msg&quot;,&quot;ControllerTest1&quot;);</span><br><span class="line">        mv.setViewName(&quot;test&quot;);</span><br><span class="line">        return mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、在spring配置文件中添加ControllerTest1的bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/t1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.controller.ControllerTest1&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>说明：</p><p>这里没有显示的配置映射器和适配器。</p><p>一个控制器只能写一个方法。</p><h3 id="2-3-3、使用注解实现Controller方式"><a href="#2-3-3、使用注解实现Controller方式" class="headerlink" title="2.3.3、使用注解实现Controller方式"></a>2.3.3、使用注解实现Controller方式</h3><p>回忆：IOC时还讲过和Controller效果一样的注解</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Component //只是组件意思</span><br><span class="line">@Service  //业务层</span><br><span class="line">@Controller //控制层</span><br><span class="line">@Repository  //dao层</span><br></pre></td></tr></table></figure><p>1、创建ControllerTest2</p><p>使用注解必须开启包扫描</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/context/spring-context-4.2.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--自动扫描包，让报下注解生效，由IOC统一管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.kuang&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--让SpringMVC不出来静态资源 .css .js .html .mp3 .mp4等--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;mvc:default-servlet-handler /&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        支持mvc注解驱动</span></span><br><span class="line"><span class="comment">        在spring中一般采用@RequestMapping注解来完成映射关系</span></span><br><span class="line"><span class="comment">        想要@RequestMapping注解直接生效，必须向上下文注册DefaultAnnotationHandlerMapping和一个AnnotationMethodHandlerAdapter实例</span></span><br><span class="line"><span class="comment">        这两个实例分别在类级别和方法级别处理</span></span><br><span class="line"><span class="comment">        而annotation-driven配置帮助我们完成这2个实例配置注册IOC</span></span><br><span class="line"><span class="comment">        就不需要处理器映射器和处理器适配器了</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;mvc:annotation-driven /&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--前缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--后缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/t1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.controller.ControllerTest1&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/1</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Controller</span><br><span class="line">public class ControllerTest2 &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/t2&quot;)</span><br><span class="line">    public String test1(Model model) &#123;</span><br><span class="line">        model.addAttribute(&quot;msg&quot;, &quot;ControllerTest2&quot;);</span><br><span class="line">        return &quot;test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>说明：</strong></p><p>没有开启<!--<mvc:default-servlet-handler />-->、<!--<mvc:annotation-driven />-->，也可访问</p><p><a href="http://localhost:8080/t2">http://localhost:8080/t2</a>。</p><p>jsp可以复用。</p><p>除了这2中还有2种方式。最常用注解。</p><p><strong>idea使用技巧：</strong></p><p>改java代码使用redeploy，改配置文件需要重新启动，只改前端页面使用刷新。</p><h2 id="2-4、RequestMappimg"><a href="#2-4、RequestMappimg" class="headerlink" title="2.4、RequestMappimg"></a>2.4、RequestMappimg</h2><p>@RequestMapping注解用于映射url到控制器或一个特定的方法。</p><p>1、创建ControllerTest3</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/1</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/c3&quot;)</span><br><span class="line">public class ControllerTest3 &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/t1&quot;)</span><br><span class="line">    public String test1(Model model) &#123;</span><br><span class="line">        model.addAttribute(&quot;msg&quot;, &quot;ControllerTest2&quot;);</span><br><span class="line">        return &quot;test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、访问<a href="http://localhost:8080/c3/t1">http://localhost:8080/c3/t1</a></p><p>要先访问类，在访问方法。admin可以在类上放一个admin，其他都在一个类中写方法就好了。</p><h2 id="2-5、RestFul风格"><a href="#2-5、RestFul风格" class="headerlink" title="2.5、RestFul风格"></a>2.5、RestFul风格</h2><h3 id="2-5-1、概念"><a href="#2-5-1、概念" class="headerlink" title="2.5.1、概念"></a>2.5.1、概念</h3><p>RestFul就是一个资源定位及资源操作的风格。不是标准也不是协议，只是一种风格。基于这个风格设计的软件<strong>更简洁、更有层次感、更易于实现缓存机制</strong>。</p><h3 id="2-5-2、功能"><a href="#2-5-2、功能" class="headerlink" title="2.5.2、功能"></a>2.5.2、功能</h3><p>资源：互联网所有的事务都可以被抽象为资源</p><p>资源操作：使用POST、DELETE、PUT、GET，使用不同方法对资源进行操作</p><p>分别对应：添加、删除、修改、查询</p><h3 id="2-5-3、传统方式操作资源"><a href="#2-5-3、传统方式操作资源" class="headerlink" title="2.5.3、传统方式操作资源"></a>2.5.3、传统方式操作资源</h3><p>通过不同的参数和链接实现不同的效果！方法单一，只有post和get</p><p><a href="http://localhost/item/queryItem.action?id=1">http://localhost/item/queryItem.action?id=1</a>  查询，GET</p><p><a href="http://localhost/item/queryItem.action?id=1">http://localhost/item/saveItem.action</a>  新增，POST</p><p><a href="http://localhost/item/queryItem.action?id=1">http://localhost/item/updateItem.action</a>  更新，POST</p><p><a href="http://localhost/item/queryItem.action?id=1">http://localhost/item/deleteItem.action?id=1</a>  删除，GET或POST</p><h3 id="2-5-4、RestFul风格操作资源"><a href="#2-5-4、RestFul风格操作资源" class="headerlink" title="2.5.4、RestFul风格操作资源"></a>2.5.4、RestFul风格操作资源</h3><p>可以通过不同的请求方式(method)实现不同的效果！如下：请求地址一样，但是功能可以不一样!</p><p><a href="http://localhost/item/queryItem.action?id=1">http://localhost/item/1</a>  查询，GET</p><p><a href="http://localhost/item/queryItem.action?id=1">http://localhost/item</a>  新增，POST</p><p><a href="http://localhost/item/queryItem.action?id=1">http://localhost/item</a>  更新，PUT</p><p><a href="http://localhost/item/queryItem.action?id=1">http://localhost/item/1</a>  删除，DELETE</p><h3 id="2-5-5、学习测试"><a href="#2-5-5、学习测试" class="headerlink" title="2.5.5、学习测试"></a>2.5.5、学习测试</h3><p><strong>先用传统方式:</strong></p><p>1、在<strong>springmvc-04-controller</strong>中新建RestFulController</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line">import com.sun.org.apache.xpath.internal.operations.Mod;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/1</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Controller</span><br><span class="line">public class RestFulController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/add&quot;)</span><br><span class="line">    public String test1(int a, int b, Model model) &#123;</span><br><span class="line">        int res = a + b;</span><br><span class="line">        model.addAttribute(&quot;msg&quot;, &quot;结果为：&quot; + res);</span><br><span class="line">        return &quot;test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、访问:<a href="http://localhost:8080/add?a=1&b=2">http://localhost:8080/add?a=1&amp;b=2</a></p><p><strong>修改用RestFul方式:</strong></p><p>在SpringMVC中可以使用@PathVariable注解，让方法的参数值绑定到一个URI模板变量中。</p><p>1、修改RestFulController</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line">import com.sun.org.apache.xpath.internal.operations.Mod;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/1</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Controller</span><br><span class="line">public class RestFulController &#123;</span><br><span class="line"></span><br><span class="line">    //@RequestMapping(value=&quot;/add/&#123;a&#125;/&#123;b&#125;&quot;,method  = RequestMethod.GET)</span><br><span class="line">    @GetMapping(&quot;/add/&#123;a&#125;/&#123;b&#125;&quot;)</span><br><span class="line">    public String test1(@PathVariable int a, @PathVariable int b, Model model) &#123;</span><br><span class="line">        int res = a + b;</span><br><span class="line">        model.addAttribute(&quot;msg&quot;, &quot;结果为：&quot; + res);</span><br><span class="line">        return &quot;test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.测试访问<a href="http://localhost:8080/add/1/2">http://localhost:8080/add/1/2</a> GET</p><p>方法基本的注解变体有如下几个：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping</span><br><span class="line">@PostMapping</span><br><span class="line">@PutMapping</span><br><span class="line">@DeleteMapping</span><br><span class="line">@PatchMapping</span><br></pre></td></tr></table></figure><p>3.相同路径不同效果，修改java</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line">import com.sun.org.apache.xpath.internal.operations.Mod;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/1</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Controller</span><br><span class="line">public class RestFulController &#123;</span><br><span class="line"></span><br><span class="line">    //@RequestMapping(value=&quot;/add/&#123;a&#125;/&#123;b&#125;&quot;,method  = RequestMethod.GET)</span><br><span class="line">    @GetMapping(&quot;/add/&#123;a&#125;/&#123;b&#125;&quot;)</span><br><span class="line">    public String test1(@PathVariable int a, @PathVariable int b, Model model) &#123;</span><br><span class="line">        int res = a + b;</span><br><span class="line">        model.addAttribute(&quot;msg&quot;, &quot;和为：&quot; + res);</span><br><span class="line">        return &quot;test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //@RequestMapping(value=&quot;/add/&#123;a&#125;/&#123;b&#125;&quot;,method  = RequestMethod.GET)</span><br><span class="line">    @PostMapping(&quot;/add/&#123;a&#125;/&#123;b&#125;&quot;)</span><br><span class="line">    public String test2(@PathVariable int a, @PathVariable int b, Model model) &#123;</span><br><span class="line">        int res = a * b;</span><br><span class="line">        model.addAttribute(&quot;msg&quot;, &quot;乘积为：&quot; + res);</span><br><span class="line">        return &quot;test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.测试访问 </p><p><a href="http://localhost:8080/add/1/2">http://localhost:8080/add/3/2</a> GET  和为：5</p><p><a href="http://localhost:8080/add/1/2">http://localhost:8080/add/3/2</a> POST  乘积为：6</p><p><strong>小结：</strong></p><p>@RequestMapping有name、value、path，name会报错</p><p>restful不爆露参数名</p><p>小黄鸭调试法：向自己解释一遍，读一遍代码。描述到一半可能找到错误了！</p><h2 id="2-6、结果跳转方式-重定向和转发"><a href="#2-6、结果跳转方式-重定向和转发" class="headerlink" title="2.6、结果跳转方式-重定向和转发"></a>2.6、结果跳转方式-重定向和转发</h2><h3 id="2-6-1、ModelAndView"><a href="#2-6-1、ModelAndView" class="headerlink" title="2.6.1、ModelAndView"></a>2.6.1、ModelAndView</h3><p>设置ModelAndView对象，根据view的名称，和视图解析器跳到指定的页面。</p><p>页面：{视图解析器前缀}+viewName+{视图解析器后缀}</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--前缀--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--后缀--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>对应的controller类</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception &#123;</span><br><span class="line">    ModelAndView mv = new ModelAndView();</span><br><span class="line"></span><br><span class="line">    mv.addObject(&quot;msg&quot;,&quot;ControllerTest1&quot;);</span><br><span class="line">    mv.setViewName(&quot;test&quot;);</span><br><span class="line">    return mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这些是最老的办法。</p><h3 id="2-6-2、调用ServletApi"><a href="#2-6-2、调用ServletApi" class="headerlink" title="2.6.2、调用ServletApi"></a>2.6.2、调用ServletApi</h3><p><strong>在springmvc-04-controller中新建ModelTest</strong></p><p>通过设置ServletAPI，不需要视图解析器。</p><p>1.通过HttpServletResponse进行传输</p><p>2.通过HttpServletResponse实现重定向</p><p>3.HttpServletRequest实现转发</p><p><strong>新建ModelTest:</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/m1&quot;)</span><br><span class="line">public void m1(HttpServletRequest request, HttpServletResponse response) throws IOException &#123;</span><br><span class="line">    response.getWriter().println(&quot;Hello,SpringMVC&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;/m2&quot;)</span><br><span class="line">public void m2(HttpServletRequest request, HttpServletResponse response) throws IOException &#123;</span><br><span class="line">    //重定向</span><br><span class="line">    response.sendRedirect(&quot;/index.jsp&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;/m3&quot;)</span><br><span class="line">public void m3(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException &#123;</span><br><span class="line">    //转发</span><br><span class="line">    request.setAttribute(&quot;msg&quot;,&quot;request.getRequestDispatcher&quot;);</span><br><span class="line">    request.getRequestDispatcher(&quot;/WEB-INF/jsp/test.jsp&quot;).forward(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不建议这样做</p><h3 id="2-6-3、通过SpringMVC实现转发和重定向"><a href="#2-6-3、通过SpringMVC实现转发和重定向" class="headerlink" title="2.6.3、通过SpringMVC实现转发和重定向"></a>2.6.3、通过SpringMVC实现转发和重定向</h3><p><strong>一、无视图解析器:</strong></p><p>需要自己拼接url</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//springmvc-无视图解析器</span><br><span class="line">http://localhost:8080/mvcm1</span><br><span class="line">@GetMapping(&quot;/mvcm1&quot;)</span><br><span class="line">public String mvcm1()&#123;</span><br><span class="line">    //转发</span><br><span class="line">    return &quot;/index.jsp&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http://localhost:8080/mvcm2</span><br><span class="line">@GetMapping(&quot;/mvcm2&quot;)</span><br><span class="line">public String mvcm2() &#123;</span><br><span class="line">    //转发</span><br><span class="line">    return &quot;forward:/index.jsp&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http://localhost:8080/mvcm3</span><br><span class="line">@GetMapping(&quot;/mvcm3&quot;)</span><br><span class="line">public String mvcm3() &#123;</span><br><span class="line">    //重定向</span><br><span class="line">    return &quot;redirect:/index.jsp&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>转发和重定向都需要自己拼接完整的路径。</p><p>返回视图名中添加了前缀forward:或redirect:后不会走视图解析器。</p><p><strong>二、配置视图解析器:</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//Springmvc-配置视图解析器</span><br><span class="line">http://localhost:8080/mvcm4</span><br><span class="line">@GetMapping(&quot;/mvcm4&quot;)</span><br><span class="line">public String mvcm4()&#123;</span><br><span class="line">    //转发</span><br><span class="line">    return &quot;test&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http://localhost:8080/mvcm5</span><br><span class="line">@GetMapping(&quot;/mvcm5&quot;)</span><br><span class="line">public String mvcm5() &#123;</span><br><span class="line">    //重定向</span><br><span class="line">    return &quot;redirect:/index.jsp&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>直接返回视图名会走视图解析器。转发不需要拼接完整路径。</p><p>添加了前缀redirect:后不会走视图解析器。需要自己拼接完整路径。</p><h2 id="2-7、处理提交数据和数据返回前端"><a href="#2-7、处理提交数据和数据返回前端" class="headerlink" title="2.7、处理提交数据和数据返回前端"></a>2.7、处理提交数据和数据返回前端</h2><p><strong>在springmvc-04-controller中新建ModelTest</strong></p><h3 id="2-7-1、提交的字段名称和处理方法中的参数名一致"><a href="#2-7-1、提交的字段名称和处理方法中的参数名一致" class="headerlink" title="2.7.1、提交的字段名称和处理方法中的参数名一致"></a>2.7.1、提交的字段名称和处理方法中的参数名一致</h3><p>提交数据：GET <a href="http://localhost:8080/user/test1?name=qinjiang">http://localhost:8080/user/test1?name=qinjiang</a></p><p>处理方法：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/test1&quot;)</span><br><span class="line">public String test1(String name, Model model) &#123;</span><br><span class="line">    //1.接收前端参数</span><br><span class="line">    System.out.println(name);</span><br><span class="line">    //2.将返回结果传递给前端</span><br><span class="line">    model.addAttribute(&quot;msg&quot;, name);</span><br><span class="line">    //3.跳转试图</span><br><span class="line">    return &quot;test&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-7-2、提交的字段名称和处理方法中的参数名不一致"><a href="#2-7-2、提交的字段名称和处理方法中的参数名不一致" class="headerlink" title="2.7.2、提交的字段名称和处理方法中的参数名不一致"></a>2.7.2、提交的字段名称和处理方法中的参数名不一致</h3><p>@RequestParam(“name”) String userName</p><p>提交数据：GET <a href="http://localhost:8080/user/test2?username=qinjiang">http://localhost:8080/user/test2?username=qinjiang</a></p><p>处理方法：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/test2&quot;)</span><br><span class="line">public String test2(@RequestParam(&quot;username&quot;)String name, Model model) &#123;</span><br><span class="line">    //1.接收前端参数</span><br><span class="line">    System.out.println(name);</span><br><span class="line">    //2.将返回结果传递给前端</span><br><span class="line">    model.addAttribute(&quot;msg&quot;, name);</span><br><span class="line">    //3.跳转试图</span><br><span class="line">    return &quot;test&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>必须要写上RequestParam</strong></p><h3 id="2-7-3、提交的一个对象"><a href="#2-7-3、提交的一个对象" class="headerlink" title="2.7.3、提交的一个对象"></a>2.7.3、提交的一个对象</h3><p>提交数据：GET <a href="http://localhost:8080/user/test3?id=1&name=qinjiang&age=21">http://localhost:8080/user/test3?id=1&amp;name=qinjiang&amp;age=21</a></p><p>处理方法：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 前端传递对象：id，name，age</span><br><span class="line"> * 接收参数时，判断参数的名字，假设名字直接在方法参数里，直接使用</span><br><span class="line"> * 假设传递的是一个对象User，匹配User对象中的字段名。匹配不到为null</span><br><span class="line"> */</span><br><span class="line">@GetMapping(&quot;/test3&quot;)</span><br><span class="line">public String test3(User user, Model model) &#123;</span><br><span class="line">    //1.接收前端参数</span><br><span class="line">    System.out.println(user.toString());</span><br><span class="line">    //2.将返回结果传递给前端</span><br><span class="line">    model.addAttribute(&quot;msg&quot;, user.toString());</span><br><span class="line">    //3.跳转试图</span><br><span class="line">    return &quot;test&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-7-4、通过ModelAndView返回数据"><a href="#2-7-4、通过ModelAndView返回数据" class="headerlink" title="2.7.4、通过ModelAndView返回数据"></a>2.7.4、通过ModelAndView返回数据</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception &#123;</span><br><span class="line">    ModelAndView mv = new ModelAndView();</span><br><span class="line"></span><br><span class="line">    mv.addObject(&quot;msg&quot;,&quot;ControllerTest1&quot;);</span><br><span class="line">    mv.setViewName(&quot;test&quot;);</span><br><span class="line">    return mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-7-5、通过ModelMap返回数据"><a href="#2-7-5、通过ModelMap返回数据" class="headerlink" title="2.7.5、通过ModelMap返回数据"></a>2.7.5、通过ModelMap返回数据</h3><p>class ModelMap extends LinkedHashMap&lt;String, Object&gt;</p><p>ModelMap:继承了LinkedHashMap，继承了LinkedHashMap的所有方法和特性。</p><p>Model :精简版，大部分使用它，只有简单几个方法，简化了操作和理解。</p><p>提交数据：GET <a href="http://localhost:8080/user/test3?id=1&name=qinjiang&age=21">http://localhost:8080/user/test4?id=1&amp;name=qinjiang&amp;age=21</a></p><p>处理方法：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/test4&quot;)</span><br><span class="line">public String test4(User user,ModelMap map) &#123;</span><br><span class="line">    //1.接收前端参数</span><br><span class="line">    System.out.println(user.toString());</span><br><span class="line">    //2.将返回结果传递给前端</span><br><span class="line">    map.addAttribute(&quot;msg&quot;, user.toString());</span><br><span class="line">    //3.跳转试图</span><br><span class="line">    return &quot;test&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-7-6、通过Model返回数据"><a href="#2-7-6、通过Model返回数据" class="headerlink" title="2.7.6、通过Model返回数据"></a>2.7.6、通过Model返回数据</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;/t2&quot;)</span><br><span class="line">public String test1(Model model) &#123;</span><br><span class="line">    model.addAttribute(&quot;msg&quot;, &quot;ControllerTest2&quot;);</span><br><span class="line">    return &quot;test&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-8、乱码问题"><a href="#2-8、乱码问题" class="headerlink" title="2.8、乱码问题"></a>2.8、乱码问题</h2><h3 id="2-8-1、测试"><a href="#2-8-1、测试" class="headerlink" title="2.8.1、测试"></a>2.8.1、测试</h3><p><strong>在springmvc-04-controller中新建EncodingController</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/2</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Controller</span><br><span class="line">public class EncodingController &#123;</span><br><span class="line"></span><br><span class="line">    @PostMapping(&quot;/e1/t1&quot;)</span><br><span class="line">    public String test1(String name, Model model) &#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        model.addAttribute(&quot;msg&quot;, name);</span><br><span class="line">        return &quot;test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>form.jsp</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/e1/t1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试结果为：é­å®èª</p><h3 id="2-8-2、过滤器解决乱码"><a href="#2-8-2、过滤器解决乱码" class="headerlink" title="2.8.2、过滤器解决乱码"></a>2.8.2、过滤器解决乱码</h3><p>web.xml，配置springmvc的乱码过滤器，注意url-pattern配置为/*</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong>：/只过滤请求，如：POST <a href="http://localhost:8080/e1/t1?name=%E7%A7%A6%E5%B0%86">http://localhost:8080/e1/t1?name=秦将</a>，</p><p>jsp页面提交的会依旧乱码。</p><p><strong>乱码解决了，如果解决不了处理思路：</strong></p><p>1.检查tomcat配置文件设置编码：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URLEncoding</span>=<span class="string">&quot;utf-8&quot;</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-9、JSON"><a href="#2-9、JSON" class="headerlink" title="2.9、JSON"></a>2.9、JSON</h2><h3 id="2-9-1、什么是JSON"><a href="#2-9-1、什么是JSON" class="headerlink" title="2.9.1、什么是JSON"></a>2.9.1、什么是JSON</h3><ul><li>JSON（JavaScript Object Notation，JS对象标记）是一种轻量级的数据交换格式，目前使用最广泛。</li><li>采用了完全独立于编程语言的纯文本格式来储存和表示数据。</li><li>简介和清晰的层次结构使得JSON成为理想的数据交换语言。</li><li>易于人阅读和编写，同时也易于机器解析和生成，并有效地提升网络传输率。</li></ul><p>在JavaScript中，一切皆对象。因此，任何JavaScript支持的类型都可以通过JSON来表示，字符串、数字、对象、数组等。语法格式：</p><p>对象表示为键值对，数据由逗号分隔。</p><p>花括号保存对象。</p><p>方括号保存数组。</p><p><strong>JSON键值对</strong>是用来保存对象的一种方式。键/值对组合中的键名写在前并用双引号包裹，使用冒号分割，然后是值：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;qinjiang&quot;&#125;</span><br></pre></td></tr></table></figure><p><strong>JSON和JavaScript对象的转换</strong></p><p>从JSON字符串转换为JavaScript对象，使用JSON.parse()方法：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var obj = JSON.parse(&#x27;&#123;&quot;a&quot;:&quot;Hello&quot;, &quot;b&quot;:&quot;world&quot;&#125;&#x27;);</span><br><span class="line">//结果是 &#123;a:&#x27;Hello&#x27;, b:&#x27;world&#x27;&#125;</span><br></pre></td></tr></table></figure><p>从JavaScript对象转换为JSON字符串，使用JSON.stringify()方法：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var json= JSON.stringify(&#123;a:&#x27;Hello&#x27;, b:&#x27;world&#x27;&#125;);</span><br><span class="line">//结果是 &#x27;&#123;&quot;a&quot;:&quot;Hello&quot;, &quot;b&quot;:&quot;world&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure><p><strong>代码测试:</strong></p><p><strong>springmvc-05-json</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>JSONTEST<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;application/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//编写一个对象</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> user = &#123;</span></span><br><span class="line"><span class="javascript">            name : <span class="string">&quot;秦将&quot;</span>,</span></span><br><span class="line">            age : 3,</span><br><span class="line"><span class="javascript">            sex : <span class="string">&quot;男&quot;</span></span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(user);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">//将js对象转换为JSON对象</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// var json = JSON.stringify(&#123;a:&#x27;Hello&#x27;, b:&#x27;world&#x27;&#125;);</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(user);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(json);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">//将JSON对象转换为js对象</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(json);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(obj);</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-9-2、Controller返回JSON数据-Jackson"><a href="#2-9-2、Controller返回JSON数据-Jackson" class="headerlink" title="2.9.2、Controller返回JSON数据-Jackson"></a>2.9.2、Controller返回JSON数据-Jackson</h3><p><strong>springmvc-05-json</strong></p><p>Jackson是目前比较好用的json解析工具。</p><p>阿里巴巴的fastjson。</p><p>1.导入依赖:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--springmav解决乱码的过滤器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.springmvc.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/context/spring-context-4.2.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--自动扫描包，让报下注解生效，由IOC统一管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.kuang&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--前缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--后缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--JSON数据乱码统一解决--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;objectMapper&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.Jackson2ObjectMapperFactoryBean&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;failOnEmptyBeans&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4.新建User实体类</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.pojo;</span><br><span class="line"></span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/2</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class User &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line">    private String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.引入注解，新建UserController：</p><ul><li>@ResponseBody //不走视图解析器,直接返回字符串</li><li>@RequestMapping(value = “/j1”, produces = “application/json;charset=utf-8”中的produces 定义返回格式，开发不会这么做，springmvc有个全能的。</li><li>@RestController  所有的方法都不在视图解析器,直接返回数据</li></ul><p><strong>ObjectMapper把普通对象转换为json字符串</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package com.kuang.controller;</span><br><span class="line"></span><br><span class="line">import com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line">import com.kuang.pojo.User;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author 郭宇航</span><br><span class="line"> * @date 2021/10/2</span><br><span class="line"> * @apiNote</span><br><span class="line"> */</span><br><span class="line">//@Controller</span><br><span class="line">@RestController //所有的方法都不在视图解析器,直接返回数据</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/j1&quot;)</span><br><span class="line">    //@ResponseBody //不走视图解析器,直接返回字符串</span><br><span class="line">    public String json1() throws JsonProcessingException &#123;</span><br><span class="line">        User user = new User(&quot;亲家境&quot;,12,&quot;男&quot;);</span><br><span class="line"></span><br><span class="line">        //jackson,ObjectMapper</span><br><span class="line">        //ObjectMapper把对象转换为json字符串</span><br><span class="line">        ObjectMapper mapper = new ObjectMapper();</span><br><span class="line">        String json = mapper.writeValueAsString(user);</span><br><span class="line">        return json;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6.测试访问 <a href="http://localhost:8080/j1">http://localhost:8080/j1</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;亲家境&quot;,</span><br><span class="line">&quot;age&quot;: 12,</span><br><span class="line">&quot;sex&quot;: &quot;男&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>7.集合转json字符串</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 集合对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> JsonProcessingException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/j2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">json2</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">    List&lt;User&gt; users = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">&quot;亲家境&quot;</span>, <span class="number">12</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    User user2 = <span class="keyword">new</span> User(<span class="string">&quot;亲家境&quot;</span>, <span class="number">12</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    User user3 = <span class="keyword">new</span> User(<span class="string">&quot;亲家境&quot;</span>, <span class="number">12</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    User user4 = <span class="keyword">new</span> User(<span class="string">&quot;亲家境&quot;</span>, <span class="number">12</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    users.add(user);</span><br><span class="line">    users.add(user2);</span><br><span class="line">    users.add(user3);</span><br><span class="line">    users.add(user4);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ObjectMapper把对象转换为json字符串</span></span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    String json = mapper.writeValueAsString(users);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>8.测试访问 <a href="http://localhost:8080/j1">http://localhost:8080/j</a>2</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;亲家境&quot;</span>,</span><br><span class="line"><span class="attr">&quot;age&quot;</span>: <span class="number">12</span>,</span><br><span class="line"><span class="attr">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;亲家境&quot;</span>,</span><br><span class="line"><span class="attr">&quot;age&quot;</span>: <span class="number">12</span>,</span><br><span class="line"><span class="attr">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;亲家境&quot;</span>,</span><br><span class="line"><span class="attr">&quot;age&quot;</span>: <span class="number">12</span>,</span><br><span class="line"><span class="attr">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;亲家境&quot;</span>,</span><br><span class="line"><span class="attr">&quot;age&quot;</span>: <span class="number">12</span>,</span><br><span class="line"><span class="attr">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>9**.时间地下转json字符串**</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> JsonProcessingException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/j3&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">json3</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">    <span class="comment">//ObjectMapper把对象转换为json字符串</span></span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    Date date = <span class="keyword">new</span> Date();</span><br><span class="line">    <span class="comment">//将时间解析后的默认格式为Timestamp 1633167988542</span></span><br><span class="line">    String json = mapper.writeValueAsString(date);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第一种格式化时间:手动</span></span><br><span class="line">    <span class="comment">//自定义返回格式 yyy-MM-dd HH:mm:ss</span></span><br><span class="line">    SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">    json = mapper.writeValueAsString(simpleDateFormat.format(date));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种：使用mapper.configure配置</span></span><br><span class="line">    <span class="comment">//关闭使用时间戳的方式</span></span><br><span class="line">    mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, <span class="keyword">false</span>);</span><br><span class="line">    <span class="comment">//自定义日期格式</span></span><br><span class="line">    SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">    <span class="comment">//设置为自定义格式</span></span><br><span class="line">    mapper.setDateFormat(sdf);</span><br><span class="line"></span><br><span class="line">    json = mapper.writeValueAsString(simpleDateFormat.format(date));</span><br><span class="line">    <span class="keyword">return</span> json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>10.测试访问 <a href="http://localhost:8080/j1">http://localhost:8080/j</a>3</p><p>11.提取公共的操作ObjectMapper的JsonUtils 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转object为json字符串，和配置时间返回格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object 转json字符串的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> json字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJson</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mapper.writeValueAsString(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转object为json字符串，和配置时间返回格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object 转json字符串的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sdf 时间返回格式字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> json字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJson</span><span class="params">(Object object,String sdf)</span> </span>&#123;</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭使用时间戳的方式</span></span><br><span class="line">        mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//自定义日期格式</span></span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(sdf);</span><br><span class="line">        <span class="comment">//设置为自定义格式</span></span><br><span class="line">        mapper.setDateFormat(simpleDateFormat);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mapper.writeValueAsString(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>12.测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试使用jsonUtils</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> JsonProcessingException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/j4&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">json4</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">    Date date = <span class="keyword">new</span> Date();</span><br><span class="line">    <span class="keyword">return</span> JsonUtils.getJson(date,<span class="string">&quot;yyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-9-3、JSON数据乱码统一解决"><a href="#2-9-3、JSON数据乱码统一解决" class="headerlink" title="2.9.3、JSON数据乱码统一解决"></a>2.9.3、JSON数据乱码统一解决</h3><p>@RequestMapping(value = “/j1”, produces = “application/json;charset=utf-8”中的produces 定义返回格式，开发不会这么做，springmvc有个全能的。</p><p>可以在springmvc的配置文件中添加一段消息StringHttpMessageConverter转换配置！</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--JSON数据乱码统一解决--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;objectMapper&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.Jackson2ObjectMapperFactoryBean&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;failOnEmptyBeans&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-9-4、Controller返回JSON数据-FastJson"><a href="#2-9-4、Controller返回JSON数据-FastJson" class="headerlink" title="2.9.4、Controller返回JSON数据-FastJson"></a>2.9.4、Controller返回JSON数据-FastJson</h3><p>fastjson.jar是阿里巴巴开发的专门用于java的包，方便json对象与javabean之间的转换。</p><p>依赖:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/com.alibaba/fastjson --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.78&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p><strong>fastjson主要的三个类：</strong></p><ul><li>JSONObject代表json对象<ul><li>JSONObject实现类Map接口</li><li>对应json对象，通过各种形式的get()方法可以获得json对象的数据，也可以利用size()、isEmpty()等方法获得键值对的个数和是否为空。本质是通过Map的方法实现的。</li></ul></li><li>JSONArray代表json对象数组<ul><li>内部是由List接口的方法来完成的</li></ul></li><li>JSON代表JSONObject和JSONArray的转化<ul><li>JSON类原发分析与使用</li><li>仔细观察这些方法，主要是实现json对象、json对象数组、javabean对象、json字符串之间的相互转化。</li></ul></li></ul><p><strong>代码测试：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试使用fastjson</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> JsonProcessingException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/j5&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">json5</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">    String json;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.1java的list对象转json数组字符串</span></span><br><span class="line">    List&lt;User&gt; users = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">&quot;亲家境&quot;</span>, <span class="number">12</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    User user2 = <span class="keyword">new</span> User(<span class="string">&quot;亲家境&quot;</span>, <span class="number">12</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    User user3 = <span class="keyword">new</span> User(<span class="string">&quot;亲家境&quot;</span>, <span class="number">12</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    User user4 = <span class="keyword">new</span> User(<span class="string">&quot;亲家境&quot;</span>, <span class="number">12</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    users.add(user);</span><br><span class="line">    users.add(user2);</span><br><span class="line">    users.add(user3);</span><br><span class="line">    users.add(user4);</span><br><span class="line">    json = JSON.toJSONString(users);</span><br><span class="line">    System.out.println(<span class="string">&quot;java的list对象转json数组字符串:&quot;</span>);</span><br><span class="line">    System.out.println(json);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.2json数组字符串转java的list对象</span></span><br><span class="line">    List&lt;User&gt; jsonArray = JSON.parseArray(json,User.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;json数组字符串转java的list对象:&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (User user1 : jsonArray) &#123;</span><br><span class="line">        System.out.print(user1.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.1java对象转json字符串</span></span><br><span class="line">    json = JSON.toJSONString(user);</span><br><span class="line">    System.out.println(<span class="string">&quot;java对象转json字符串:&quot;</span>);</span><br><span class="line">    System.out.println(json);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.2json对象字符串转java对象</span></span><br><span class="line">    user = JSON.parseObject(json, User.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;json对象字符串转java对象:&quot;</span>);</span><br><span class="line">    System.out.println(json);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java的list对象转json数组字符串:</span><br><span class="line">[&#123;<span class="string">&quot;age&quot;</span>:<span class="number">12</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;亲家境&quot;</span>,<span class="string">&quot;sex&quot;</span>:<span class="string">&quot;男&quot;</span>&#125;,&#123;<span class="string">&quot;age&quot;</span>:<span class="number">12</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;亲家境&quot;</span>,<span class="string">&quot;sex&quot;</span>:<span class="string">&quot;男&quot;</span>&#125;,&#123;<span class="string">&quot;age&quot;</span>:<span class="number">12</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;亲家境&quot;</span>,<span class="string">&quot;sex&quot;</span>:<span class="string">&quot;男&quot;</span>&#125;,&#123;<span class="string">&quot;age&quot;</span>:<span class="number">12</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;亲家境&quot;</span>,<span class="string">&quot;sex&quot;</span>:<span class="string">&quot;男&quot;</span>&#125;]</span><br><span class="line">json数组字符串转java的list对象:</span><br><span class="line">User(name=亲家境, age=<span class="number">12</span>, sex=男)User(name=亲家境, age=<span class="number">12</span>, sex=男)User(name=亲家境, age=<span class="number">12</span>, sex=男)User(name=亲家境, age=<span class="number">12</span>, sex=男)</span><br><span class="line">java对象转json字符串:</span><br><span class="line">&#123;<span class="string">&quot;age&quot;</span>:<span class="number">12</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;亲家境&quot;</span>,<span class="string">&quot;sex&quot;</span>:<span class="string">&quot;男&quot;</span>&#125;</span><br><span class="line">json对象字符串转java对象:</span><br><span class="line">&#123;<span class="string">&quot;age&quot;</span>:<span class="number">12</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;亲家境&quot;</span>,<span class="string">&quot;sex&quot;</span>:<span class="string">&quot;男&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="2-10、SSM整合"><a href="#2-10、SSM整合" class="headerlink" title="2.10、SSM整合"></a>2.10、SSM整合</h2><p>需要熟练掌握MySQL数据库、Spring、JavaWeb及Mybatis。</p><p><strong>工具环境：</strong></p><ul><li>IDEA</li><li>mybatis5.7.19</li><li>tomcat9</li><li>maven3.6</li></ul><p><strong>数据库环境：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">drop database <span class="keyword">if</span> exists ssmbuild;</span><br><span class="line">create database ssmbuild;</span><br><span class="line">use ssmbuild;</span><br><span class="line"></span><br><span class="line">drop table <span class="keyword">if</span> exists books;</span><br><span class="line"><span class="function">create table <span class="title">books</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">bookId <span class="keyword">int</span>(<span class="number">10</span>)</span> not <span class="keyword">null</span> auto_increment comment &#x27;书id&#x27;,</span></span><br><span class="line"><span class="function">    bookName <span class="title">varchar</span><span class="params">(<span class="number">100</span>)</span> not <span class="keyword">null</span> comment &#x27;书名&#x27;,</span></span><br><span class="line"><span class="function">    bookCounts <span class="title">int</span><span class="params">(<span class="number">100</span>)</span> not <span class="keyword">null</span> comment &#x27;数量&#x27;,</span></span><br><span class="line"><span class="function">    detail <span class="title">varchar</span><span class="params">(<span class="number">200</span>)</span> not <span class="keyword">null</span> comment &#x27;描述&#x27;,</span></span><br><span class="line"><span class="function">    key <span class="title">bookId</span> <span class="params">( bookId )</span></span></span><br><span class="line"><span class="function">) engine</span>=InnoDB <span class="keyword">default</span> charset=utf8;</span><br><span class="line"><span class="function">insert into <span class="title">books</span><span class="params">(bookId,bookName,bookCounts,detail)</span> values</span></span><br><span class="line"><span class="function"><span class="params">(<span class="number">1</span>,<span class="string">&#x27;Java&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;从入门到精通&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function"><span class="params">(<span class="number">2</span>,<span class="string">&#x27;MySQL&#x27;</span>,<span class="number">10</span>,<span class="string">&#x27;从删库到跑路&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function"><span class="params">(<span class="number">3</span>,<span class="string">&#x27;Linux&#x27;</span>,<span class="number">15</span>,<span class="string">&#x27;从入门到进牢&#x27;</span>)</span></span>;</span><br></pre></td></tr></table></figure><p>1、创建maven项目ssmbuild</p><p>2、导入依赖</p><!--依赖:junit.数据库驱动.连接池.servlet.jsp.mybatis.mybatis-spring.spring-→spring5.0以上使用mybatis2.*.*<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--依赖:junit.数据库驱动.连接池.servlet.jsp.mybatis.mybatis-spring.spring--&gt;</span><br><span class="line">&lt;!--Junit--&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/junit/junit --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--数据库驱动--&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.1.49&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--C3P0--&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/com.mchange/c3p0 --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.mchange&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;c3p0&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.9.5.5&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--Servlet - JSP--&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/javax.servlet/servlet-api --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.5&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/javax.servlet.jsp/jsp-api --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/javax.servlet.jsp.jstl/jstl --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jstl&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--Mybatis--&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.5.7&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.mybatis/mybatis-spring --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.6&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--SpringMVC--&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.3.10&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--Spring JDBC--&gt;</span><br><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.springframework/spring-jdbc --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.3.10&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--Spring Aop--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.9.7&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>3.maven过滤</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--静态资源导出问题--&gt;</span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">        &lt;resource&gt;</span><br><span class="line">            &lt;directory&gt;src/main/java&lt;/directory&gt;</span><br><span class="line">            &lt;includes&gt;</span><br><span class="line">                &lt;include&gt;**<span class="comment">/*.properties&lt;/include&gt;</span></span><br><span class="line">                &lt;include&gt;**/*.xml&lt;/include&gt;</span><br><span class="line">            &lt;/includes&gt;</span><br><span class="line">            &lt;filtering&gt;false&lt;/filtering&gt;</span><br><span class="line">        &lt;/resource&gt;</span><br><span class="line">        &lt;resource&gt;</span><br><span class="line">            &lt;directory&gt;src/main/resources&lt;/directory&gt;</span><br><span class="line">            &lt;includes&gt;</span><br><span class="line">                &lt;include&gt;**<span class="comment">/*.properties&lt;/include&gt;</span></span><br><span class="line">                &lt;include&gt;**/*.xml&lt;/include&gt;</span><br><span class="line">            &lt;/includes&gt;</span><br><span class="line">            &lt;filtering&gt;false&lt;/filtering&gt;</span><br><span class="line">        &lt;/resource&gt;</span><br><span class="line">    &lt;/resources&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure><p>4.新建基本包结构</p><ul><li><strong>pojo</strong></li><li><strong>dao</strong></li><li><strong>service</strong></li><li><strong>controller</strong></li><li>filter</li><li>utils</li></ul><p>5.resources目录新建mybatis-config.xml、applicationContext.xml</p><p>mybatis-config.xml:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><p>applicationContext.xml:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h3 id="2-10-1、Mybatis层"><a href="#2-10-1、Mybatis层" class="headerlink" title="2.10.1、Mybatis层"></a>2.10.1、Mybatis层</h3><p>1.db.properties</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">driver=com.mysql.jdbc.Driver</span><br><span class="line">#如果使用mysql8.0+，增加一个时区配置&amp;serverTimezone=Asia/Shanghai</span><br><span class="line">url=jdbc:mysql:<span class="comment">//39.106.63.189:3307/ssmbuild?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line">username=root</span><br><span class="line">password=root</span><br></pre></td></tr></table></figure><p>2.编写mybatis-config.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置数据源，交给spring去做--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">1.</span>日志--&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;setting name=<span class="string">&quot;logImpl&quot;</span> value=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">2.</span>取别名--&gt;</span><br><span class="line">    &lt;typeAliases&gt;</span><br><span class="line">        &lt;<span class="keyword">package</span> name=<span class="string">&quot;com.kuang.pojo&quot;</span>/&gt;</span><br><span class="line">    &lt;/typeAliases&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">3.</span>Mapper文件注册--&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.dao.BookMapper&quot;</span>/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><p>3.pojo包下新建实体类Books</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Books</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bookId;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> String bookCounts;</span><br><span class="line">    <span class="keyword">private</span> String detail;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Books</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Books</span><span class="params">(<span class="keyword">int</span> bookId, String bookName, String bookCounts, String detail)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookId = bookId;</span><br><span class="line">        <span class="keyword">this</span>.bookName = bookName;</span><br><span class="line">        <span class="keyword">this</span>.bookCounts = bookCounts;</span><br><span class="line">        <span class="keyword">this</span>.detail = detail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBookId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBookId</span><span class="params">(<span class="keyword">int</span> bookId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookId = bookId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBookName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBookName</span><span class="params">(String bookName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookName = bookName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBookCounts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookCounts;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBookCounts</span><span class="params">(String bookCounts)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookCounts = bookCounts;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDetail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> detail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDetail</span><span class="params">(String detail)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.detail = detail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Books&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;bookId=&quot;</span> + bookId +</span><br><span class="line">                <span class="string">&quot;, bookName=&#x27;&quot;</span> + bookName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, bookCounts=&#x27;&quot;</span> + bookCounts + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, detail=&#x27;&quot;</span> + detail + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        Books books = (Books) o;</span><br><span class="line">        <span class="keyword">return</span> bookId == books.bookId &amp;&amp;</span><br><span class="line">                Objects.equals(bookName, books.bookName) &amp;&amp;</span><br><span class="line">                Objects.equals(bookCounts, books.bookCounts) &amp;&amp;</span><br><span class="line">                Objects.equals(detail, books.detail);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(bookId, bookName, bookCounts, detail);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.dao包下新建接口BookMapper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.Books;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加一本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> books</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">addBook</span><span class="params">(Books books)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除一本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteBook</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新一本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> books</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateBook</span><span class="params">(Books books)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询一本书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Books <span class="title">queryBookById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有书</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;Books&gt; <span class="title">queryAllBook</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.dao包下新建接口BookMapper.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.kuang.dao.BookMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert id=<span class="string">&quot;addBook&quot;</span> parameterType=<span class="string">&quot;books&quot;</span>&gt;</span><br><span class="line">        <span class="function">insert into <span class="title">books</span><span class="params">(bookName, bookCounts, detail)</span></span></span><br><span class="line"><span class="function">        <span class="title">values</span> <span class="params">(#&#123;bookName&#125;,#&#123;bookCounts&#125;,#&#123;detail&#125;)</span></span></span><br><span class="line"><span class="function">    &lt;/insert&gt;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    &lt;delete id</span>=<span class="string">&quot;deleteBookById&quot;</span> parameterType=<span class="string">&quot;int&quot;</span>&gt;</span><br><span class="line">        delete from books where bookId = #&#123;bookId&#125;</span><br><span class="line">    &lt;/delete&gt;</span><br><span class="line"></span><br><span class="line">    &lt;update id=<span class="string">&quot;updateBook&quot;</span> parameterType=<span class="string">&quot;books&quot;</span>&gt;</span><br><span class="line">        update books</span><br><span class="line">        set bookName = #&#123;bookName&#125;, bookCounts = #&#123;bookCounts&#125;, detail = #&#123;detail&#125;</span><br><span class="line">        where bookId = #&#123;bookId&#125;</span><br><span class="line">    &lt;/update&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=<span class="string">&quot;queryBookById&quot;</span> parameterType=<span class="string">&quot;int&quot;</span> resultType=<span class="string">&quot;books&quot;</span>&gt;</span><br><span class="line">        select bookId,bookName,bookCounts,detail</span><br><span class="line">        from books</span><br><span class="line">        where bookId = #&#123;bookId&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=<span class="string">&quot;queryAllBook&quot;</span> resultType=<span class="string">&quot;books&quot;</span>&gt;</span><br><span class="line">        select bookId,bookName,bookCounts,detail</span><br><span class="line">        from books</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><p>5.在mybatis-config.xml中注册Mapper.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;mapper <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.dao.BookMapper&quot;</span>/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure><p>6.service新建接口BookService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.Books;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加一本书</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> books</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">addBook</span><span class="params">(Books books)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除一本书</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteBookById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新一本书</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> books</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateBook</span><span class="params">(Books books)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询一本书</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Books <span class="title">queryBookById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有书</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;Books&gt; <span class="title">queryAllBook</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>7.service新建接口实现类BookServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kuang.dao.BookMapper;</span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.Books;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title">BookService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务层调dao层：组合dao层</span></span><br><span class="line">    <span class="keyword">private</span> BookMapper bookMapper;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBookMapper</span><span class="params">(BookMapper bookMapper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookMapper = bookMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addBook</span><span class="params">(Books books)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookMapper.addBook(books);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteBookById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookMapper.deleteBookById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateBook</span><span class="params">(Books books)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookMapper.updateBook(books);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Books <span class="title">queryBookById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookMapper.queryBookById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Books&gt; <span class="title">queryAllBook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookMapper.queryAllBook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>业务层调dao层：需要组合dao层的mapper</p><p>还有事务等，直接springaop横切就行。</p><h3 id="2-10-2、Spring层"><a href="#2-10-2、Spring层" class="headerlink" title="2.10.2、Spring层"></a>2.10.2、Spring层</h3><p>1.在resources包下创建spring-dao.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">1.</span>关联数据库文件--&gt;</span><br><span class="line">    &lt;context:property-placeholder location=<span class="string">&quot;classpath:db.properties&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">    <span class="number">2.</span>连接池:</span><br><span class="line">        DriverManagerDataSource</span><br><span class="line">        dbcp 半自动化操作，不自动连接</span><br><span class="line">        c3p0 自动化的加载配置文件，自动设置到对象中！</span><br><span class="line">        druid 很强大,公司用的多</span><br><span class="line">        hikari springboot2<span class="number">.0</span>默认集成</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;dataSource&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;driverClass&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcUrl&quot;</span> value=<span class="string">&quot;jdbc:mysql://39.106.63.189:3307/ssmbuild?useSSL=false&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;user&quot;</span> value=<span class="string">&quot;root&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;root&quot;</span> /&gt;</span><br><span class="line">        &lt;!--c3p0:私有属性--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;maxPoolSize&quot;</span> value=<span class="string">&quot;30&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;minPoolSize&quot;</span> value=<span class="string">&quot;10&quot;</span> /&gt;</span><br><span class="line">        &lt;!--c3p0:关闭连接后不自动commit--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;autoCommitOnClose&quot;</span> value=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line">        &lt;!--c3p0:获取连接超时时间--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;checkoutTimeout&quot;</span> value=<span class="string">&quot;10000&quot;</span> /&gt;</span><br><span class="line">        &lt;!--c3p0:当前获取连接失败重试次数--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;acquireRetryAttempts&quot;</span> value=<span class="string">&quot;2&quot;</span> /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">3.</span>整合sqlSessionFactory--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span><br><span class="line">        &lt;!--绑定连接池--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span>/&gt;</span><br><span class="line">        &lt;!--绑定Mybatis配置文件--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;configLocation&quot;</span> value=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">4.</span>配置dao接口扫描包，动态的把Dao接口注入到Spring容器中.</span><br><span class="line">    以前是写BookMapperImpl extends SqlSessionDaoSupport，使用sqlSessionTemplate。</span><br><span class="line">    现在通过MapperScannerConfigurer动态实现了BookMapperImpl</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span><br><span class="line">        &lt;!--注入sqlSessionFactory--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> value=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span><br><span class="line">        &lt;!--扫描的包--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;basePackage&quot;</span> value=<span class="string">&quot;com.kuang.dao&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>2.在resources包下创建spring-service.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">1.</span>扫描service下的包--&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;com.kuang.service&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">2.</span>将我们的所有业务类，注入到spring，通过配置或注解,这里使用配置--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;BookServiceImpl&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.service.BookServiceImpl&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;bookMapper&quot;</span> ref=<span class="string">&quot;bookMapper&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">3.</span>声明式事务，默认都创建事务--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;transactionManager&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br><span class="line">        &lt;!--注入数据源--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">4.</span>aop事务支持-自定义!--&gt;</span><br><span class="line">    &lt;!--配置事务通知--&gt;</span><br><span class="line">    &lt;tx:advice id=<span class="string">&quot;txAdvice&quot;</span> transaction-manager=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><br><span class="line">        &lt;!--给哪些方法配置事务--&gt;</span><br><span class="line">        &lt;!--配置事务的传播特性--&gt;</span><br><span class="line">        &lt;tx:attributes&gt;</span><br><span class="line">            &lt;tx:method name=<span class="string">&quot;add&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span><br><span class="line">            &lt;tx:method name=<span class="string">&quot;delete&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span><br><span class="line">            &lt;tx:method name=<span class="string">&quot;update&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span><br><span class="line">            &lt;tx:method name=<span class="string">&quot;query&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span> read-only=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">            &lt;tx:method name=<span class="string">&quot;*&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span><br><span class="line">        &lt;/tx:attributes&gt;</span><br><span class="line">    &lt;/tx:advice&gt;</span><br><span class="line">    &lt;!--配置事务切入点--&gt;</span><br><span class="line">    &lt;aop:config&gt;</span><br><span class="line">        &lt;aop:pointcut id=<span class="string">&quot;txPointCut&quot;</span> expression=<span class="string">&quot;execution(* com.kuang.dao.*.*(..))&quot;</span>/&gt;</span><br><span class="line">        &lt;aop:advisor advice-ref=<span class="string">&quot;txAdvice&quot;</span> pointcut-ref=<span class="string">&quot;txPointCut&quot;</span>/&gt;</span><br><span class="line">    &lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>3.修改applicationContext.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--整合配置文件--&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> resource=<span class="string">&quot;classpath:spring-dao.xml&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> resource=<span class="string">&quot;classpath:spring-service.xml&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h3 id="2-10-3、SpringMVC层"><a href="#2-10-3、SpringMVC层" class="headerlink" title="2.10.3、SpringMVC层"></a>2.10.3、SpringMVC层</h3><p>1.增加web支持</p><p>2.配置webxml</p><p>dispathcerServlet、乱码处理等</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;web-app xmlns=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="line">         version=<span class="string">&quot;4.0&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">1.</span>DispatcherServlet--&gt;</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-<span class="class"><span class="keyword">class</span>&gt;<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">servlet</span>.<span class="title">DispatcherServlet</span>&lt;/<span class="title">servlet</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">param</span>-<span class="title">name</span>&gt;<span class="title">contextConfigLocation</span>&lt;/<span class="title">param</span>-<span class="title">name</span>&gt;</span></span><br><span class="line">            &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">2.</span>乱码过滤--&gt;</span><br><span class="line">    &lt;filter&gt;</span><br><span class="line">        &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;</span><br><span class="line">        &lt;filter-<span class="class"><span class="keyword">class</span>&gt;<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">filter</span>.<span class="title">CharacterEncodingFilter</span>&lt;/<span class="title">filter</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">param</span>-<span class="title">name</span>&gt;<span class="title">encoding</span>&lt;/<span class="title">param</span>-<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">param</span>-<span class="title">value</span>&gt;<span class="title">utf</span>-8&lt;/<span class="title">param</span>-<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">filter</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">filter</span>-<span class="title">mapping</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">filter</span>-<span class="title">name</span>&gt;<span class="title">encodingFilter</span>&lt;/<span class="title">filter</span>-<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">url</span>-<span class="title">pattern</span>&gt;/*&lt;/<span class="title">url</span>-<span class="title">pattern</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">filter</span>-<span class="title">mapping</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;!--3.默认<span class="title">Session</span>过期时间 15分钟--&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">session</span>-<span class="title">config</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">session</span>-<span class="title">timeout</span>&gt;15&lt;/<span class="title">session</span>-<span class="title">timeout</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">session</span>-<span class="title">config</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">web</span>-<span class="title">app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.在resource包下新建spring-mvc.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:mvc=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/cache/spring-mvc.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">1.</span>注解驱动--&gt;</span><br><span class="line">    &lt;mvc:annotation-driven /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">2.</span>静态资源过滤--&gt;</span><br><span class="line">    &lt;mvc:<span class="keyword">default</span>-servlet-handler /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">3.</span>扫描包controller--&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;com.kuang.controller&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">4.</span>视图解析器--&gt;</span><br><span class="line">    &lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span><br><span class="line">        &lt;!--前缀:WEB-INF下的jsp包--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;prefix&quot;</span> value=<span class="string">&quot;/WEB-INF/jsp/&quot;</span> /&gt;</span><br><span class="line">        &lt;!--后缀--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;suffix&quot;</span> value=<span class="string">&quot;.jsp&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>4.在applicationContext.xml添加spring-mvc.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--整合配置文件--&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> resource=<span class="string">&quot;classpath:spring-dao.xml&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> resource=<span class="string">&quot;classpath:spring-service.xml&quot;</span>/&gt;</span><br><span class="line">    &lt;<span class="keyword">import</span> resource=<span class="string">&quot;classpath:spring-mvc.xml&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><h3 id="2-10-4、查阅书籍"><a href="#2-10-4、查阅书籍" class="headerlink" title="2.10.4、查阅书籍"></a>2.10.4、查阅书籍</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">问题：bean不存在</span><br><span class="line">步骤：</span><br><span class="line">1.查看这个bean是否注入成功！</span><br><span class="line">2.Junit单元测试,看我们的代码是否能查询处理结果</span><br><span class="line">3.问题，db配置文件编码格式问题</span><br><span class="line">4.springmvc整合的时候没调用到我们的service层的bean</span><br><span class="line">    1.applicationContext没有注册bean x</span><br><span class="line">    2.web.xml中，绑定配置文件出问题，应绑定applicationContext.xml而不是spring-mvc.xml</span><br></pre></td></tr></table></figure><p>1.新建BookController，写listBook</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.Books;</span><br><span class="line"><span class="keyword">import</span> com.kuang.service.BookService;</span><br><span class="line"><span class="keyword">import</span> com.kuang.service.BookServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;BookServiceImpl&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询全部的书籍，并返回到一个书籍展示页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/book/allBook&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">listBook</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        List&lt;Books&gt; list = bookService.queryAllBook();</span><br><span class="line">        <span class="keyword">for</span> (Books books : list) &#123;</span><br><span class="line">            System.out.println(books);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>, list);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;allBook&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.在WEB-INF/jsp/下新建allBook.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: <span class="number">2021</span>/<span class="number">10</span>/<span class="number">3</span></span><br><span class="line">  Time: <span class="number">16</span>:<span class="number">04</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;书记展示&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;row clearfix&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;col-md-12 column&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;page-header&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;</span><br><span class="line">                    &lt;small&gt;书籍列表&lt;/small&gt;</span><br><span class="line">                &lt;/h1&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;a href=&quot;/book/toAddBookPiper&quot;&gt;添加数据&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;row clearfix&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;col-md-12 column&quot;</span>&gt;</span><br><span class="line">            &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;table table-hover table-striped&quot;</span>&gt;</span><br><span class="line">                &lt;thead&gt;&lt;/thead&gt;</span><br><span class="line">                    &lt;tr&gt;书籍编号&lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;书籍名称&lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;书籍数量&lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;书籍详情&lt;/tr&gt;</span><br><span class="line">                &lt;tbody&gt;</span><br><span class="line">                    &lt;c:forEach items=<span class="string">&quot;$&#123;bookList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;book&quot;</span>&gt;</span><br><span class="line">                        &lt;tr&gt;</span><br><span class="line">                            &lt;td&gt;$&#123;book.bookId&#125;&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;$&#123;book.bookName&#125;&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;$&#123;book.bookCounts&#125;&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;$&#123;book.detail&#125;&lt;/td&gt;</span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">                    &lt;/c:forEach&gt;</span><br><span class="line">                &lt;/tbody&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>3.访问<a href="http://localhost:8080/book/allBook">http://localhost:8080/book/allBook</a></p><p>4.web.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp-config&gt;</span><br><span class="line">    &lt;taglib&gt;</span><br><span class="line">        &lt;taglib-uri&gt;http:<span class="comment">//java.sun.com/jsp/jstl/core&lt;/taglib-uri&gt;</span></span><br><span class="line">        &lt;taglib-location&gt;/WEB-INF/c.tld&lt;/taglib-location&gt;</span><br><span class="line">    &lt;/taglib&gt;</span><br><span class="line">&lt;/jsp-config&gt;</span><br></pre></td></tr></table></figure><h3 id="2-10-4、添加书籍"><a href="#2-10-4、添加书籍" class="headerlink" title="2.10.4、添加书籍"></a>2.10.4、添加书籍</h3><p>1.allBook.jsp界面增加跳转增加书籍界面功能</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;/book/toAddBookPiper&quot;&gt;添加数据&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>2.写toAddBookPiper方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 跳转addBook.jsp</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/book/toAddBookPiper&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toAddBookPiper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;addBook&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.增加书籍页面addBook.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: <span class="number">2021</span>/<span class="number">10</span>/<span class="number">3</span></span><br><span class="line">  Time: <span class="number">16</span>:<span class="number">04</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;书记展示&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;row clearfix&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;col-md-12 column&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;page-header&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;</span><br><span class="line">                    &lt;small&gt;书籍列表&lt;/small&gt;</span><br><span class="line">                &lt;/h1&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;a href=&quot;/book/toAddBookPiper&quot;&gt;添加数据&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;row clearfix&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;col-md-12 column&quot;</span>&gt;</span><br><span class="line">            &lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;table table-hover table-striped&quot;</span>&gt;</span><br><span class="line">                &lt;thead&gt;</span><br><span class="line">                    &lt;tr&gt;书籍编号&lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;书籍名称&lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;书籍数量&lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;书籍详情&lt;/tr&gt;</span><br><span class="line">                    &lt;tr&gt;操作&lt;/tr&gt;</span><br><span class="line">                &lt;/thead&gt;</span><br><span class="line">                &lt;tbody&gt;</span><br><span class="line">                    &lt;c:forEach items=<span class="string">&quot;$&#123;bookList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;book&quot;</span>&gt;</span><br><span class="line">                        &lt;tr&gt;</span><br><span class="line">                            &lt;td&gt;$&#123;book.bookId&#125;&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;$&#123;book.bookName&#125;&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;$&#123;book.bookCounts&#125;&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;$&#123;book.detail&#125;&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;a href=&quot;#&quot;&gt;修改&lt;/a&gt; | &amp;nbsp;</span><br><span class="line">                                &lt;a href=&quot;#&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">                    &lt;/c:forEach&gt;</span><br><span class="line">                &lt;/tbody&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>4.写addBook，添加书籍到数据库  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * addBook添加书籍</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/book/addBook&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addBook</span><span class="params">(Books books,Model model)</span> </span>&#123;</span><br><span class="line">    System.out.println(books);</span><br><span class="line">    bookService.addBook(books);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/book/allBook&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-10-4、修改书籍"><a href="#2-10-4、修改书籍" class="headerlink" title="2.10.4、修改书籍"></a>2.10.4、修改书籍</h3><p>1.allBook.jsp增加修改样式和按钮</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;table <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;table table-hover table-striped&quot;</span>&gt;</span><br><span class="line">  &lt;thead&gt;</span><br><span class="line">      &lt;tr&gt;书籍编号&lt;/tr&gt;</span><br><span class="line">      &lt;tr&gt;书籍名称&lt;/tr&gt;</span><br><span class="line">      &lt;tr&gt;书籍数量&lt;/tr&gt;</span><br><span class="line">      &lt;tr&gt;书籍详情&lt;/tr&gt;</span><br><span class="line">      &lt;tr&gt;操作&lt;/tr&gt;</span><br><span class="line">  &lt;/thead&gt;</span><br><span class="line">  &lt;tbody&gt;</span><br><span class="line">      &lt;c:forEach items=<span class="string">&quot;$&#123;bookList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;book&quot;</span>&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">              &lt;td&gt;$&#123;book.bookId&#125;&lt;/td&gt;</span><br><span class="line">              &lt;td&gt;$&#123;book.bookName&#125;&lt;/td&gt;</span><br><span class="line">              &lt;td&gt;$&#123;book.bookCounts&#125;&lt;/td&gt;</span><br><span class="line">              &lt;td&gt;$&#123;book.detail&#125;&lt;/td&gt;</span><br><span class="line">              &lt;td&gt;</span><br><span class="line">                  &lt;a href=&quot;#&quot;&gt;修改&lt;/a&gt; | &amp;nbsp;</span><br><span class="line">                  &lt;a href=&quot;#&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">              &lt;/td&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">      &lt;/c:forEach&gt;</span><br><span class="line">  &lt;/tbody&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure><p>2.增加跳转修改界面和修改功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 跳转updateBook.jsp</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/book/toUpdateBookPiper&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toUpdateBookPiper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;updateBook&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * updateBook修改书籍</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/book/updateBook&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">updateBook</span><span class="params">(Books books, Model model)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;/book/updateBook&quot;</span>);</span><br><span class="line">    System.out.println(books);</span><br><span class="line">    bookService.updateBook(books);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/book/allBook&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.修改界面updateBook.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: <span class="number">2021</span>/<span class="number">10</span>/<span class="number">3</span></span><br><span class="line">  Time: <span class="number">16</span>:<span class="number">04</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;修改书籍&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;container&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;row clearfix&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;col-md-12 column&quot;</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;page-header&quot;</span>&gt;</span><br><span class="line">                    &lt;h1&gt;</span><br><span class="line">                        &lt;small&gt;修改书籍&lt;/small&gt;</span><br><span class="line">                    &lt;/h1&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;form action=<span class="string">&quot;/book/updateBook&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-control hidden&quot;</span> name=<span class="string">&quot;bookId&quot;</span> value=<span class="string">&quot;$&#123;book.bookId&#125;&quot;</span>/&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;label&gt;书籍名称：&lt;/label&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;text&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-control&quot;</span> name=<span class="string">&quot;bookName&quot;</span> value=<span class="string">&quot;$&#123;book.bookName&#125;&quot;</span> required/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;label&gt;书籍数量：&lt;/label&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;text&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-control&quot;</span> name=<span class="string">&quot;bookCounts&quot;</span> value=<span class="string">&quot;$&#123;book.bookCounts&#125;&quot;</span> required/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;label&gt;书籍描述：&lt;/label&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;text&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-control&quot;</span> name=<span class="string">&quot;detail&quot;</span> value=<span class="string">&quot;$&#123;book.detail&#125;&quot;</span> required/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;submit&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-control&quot;</span> value=<span class="string">&quot;修改&quot;</span>/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="2-10-4、删除书籍"><a href="#2-10-4、删除书籍" class="headerlink" title="2.10.4、删除书籍"></a>2.10.4、删除书籍</h3><p>1.在BookController新增deleteBook</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * deleteBook删除书籍</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/book/deleteBook/&#123;bookId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deleteBook</span><span class="params">(<span class="meta">@PathVariable(&quot;bookId&quot;)</span> <span class="keyword">int</span> id, Model model)</span> </span>&#123;</span><br><span class="line">    bookService.deleteBookById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/book/allBook&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.allBook.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;/book/deleteBook/$&#123;book.bookId&#125;&quot; class=&quot;btn btn-danger&quot;&gt;删除&lt;/a&gt;</span><br></pre></td></tr></table></figure><h3 id="2-10-5、搜索书籍"><a href="#2-10-5、搜索书籍" class="headerlink" title="2.10.5、搜索书籍"></a>2.10.5、搜索书籍</h3><p>1.allBook.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;row clearfix&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;col-md-2 column&quot;</span>&gt;</span><br><span class="line">        &lt;a href=&quot;/book/toAddBookPiper&quot; class=&quot;btn btn-success&quot;&gt;添加数据&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;col-md-5 column&quot;</span>&gt;</span><br><span class="line">        &lt;form action=<span class="string">&quot;/book/searchBook&quot;</span> method=<span class="string">&quot;post&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-inline&quot;</span> role=<span class="string">&quot;form&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;label&gt;书籍名称：&lt;/label&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;text&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;form-control&quot;</span> name=<span class="string">&quot;bookName&quot;</span> placeholder=<span class="string">&quot;书籍名称&quot;</span> required/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;查询&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;btn&quot;</span>&gt;</span><br><span class="line">            &lt;a href=&quot;/book/allBook&quot; class=&quot;btn btn-success&quot;&gt;重置&lt;/a&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>2.BookMapper.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询一本书name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bookName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;Books&gt; <span class="title">queryBookByBookName</span><span class="params">(<span class="meta">@Param(&quot;bookName&quot;)</span>String bookName)</span></span>;</span><br></pre></td></tr></table></figure><p>3.BookMapper.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;queryBookByBookName&quot;</span> resultType=<span class="string">&quot;books&quot;</span> parameterType=<span class="string">&quot;string&quot;</span>&gt;</span><br><span class="line">    select bookId,bookName,bookCounts,detail</span><br><span class="line">    from books</span><br><span class="line">    where bookName like &#x27;%&#x27; #&#123;bookName&#125; &#x27;%&#x27;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><p>4.BookService.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询一本书name</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bookName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;Books&gt; <span class="title">queryBookByBookName</span><span class="params">(String bookName)</span></span>;</span><br></pre></td></tr></table></figure><p>5.BookServiceImpl.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Books&gt; <span class="title">queryBookByBookName</span><span class="params">(String bookName)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> bookMapper.queryBookByBookName(bookName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6.BookController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询书籍根据书名</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/book/searchBook&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">searchBook</span><span class="params">(String bookName, Model model)</span> </span>&#123;</span><br><span class="line">    System.out.println(bookName);</span><br><span class="line">    List&lt;Books&gt; bookSearchList = bookService.queryBookByBookName(bookName);</span><br><span class="line">    <span class="keyword">for</span> (Books books : bookSearchList) &#123;</span><br><span class="line">        System.out.println(books.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;bookList&quot;</span>, bookSearchList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;allBook&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-11、拦截器"><a href="#2-11、拦截器" class="headerlink" title="2.11、拦截器"></a>2.11、拦截器</h2><p>拦截器是AOP思想的应用，是横切进去的。</p><p>拦截器是SpirngMVC自己的</p><p>只会拦截控制器的方法，如果访问js/html/css/image/jsp/是不会拦截的，就是自带静态资源过滤。</p><h3 id="2-11-1、自定义拦截器"><a href="#2-11-1、自定义拦截器" class="headerlink" title="2.11.1、自定义拦截器"></a>2.11.1、自定义拦截器</h3><p>自定义拦截器，需要实现HandlerInterceptor接口。</p><p>1、<strong>springmvc-06-interceptor</strong>,添加web支持</p><p>2、配置web.xml、springmvc.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;web-app xmlns=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="line">         version=<span class="string">&quot;4.0&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">1.</span>DispatcherServlet--&gt;</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-<span class="class"><span class="keyword">class</span>&gt;<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">servlet</span>.<span class="title">DispatcherServlet</span>&lt;/<span class="title">servlet</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">param</span>-<span class="title">name</span>&gt;<span class="title">contextConfigLocation</span>&lt;/<span class="title">param</span>-<span class="title">name</span>&gt;</span></span><br><span class="line">            &lt;param-value&gt;classpath:spring-mvc.xml&lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">2.</span>乱码过滤--&gt;</span><br><span class="line">    &lt;filter&gt;</span><br><span class="line">        &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;</span><br><span class="line">        &lt;filter-<span class="class"><span class="keyword">class</span>&gt;<span class="title">org</span>.<span class="title">springframework</span>.<span class="title">web</span>.<span class="title">filter</span>.<span class="title">CharacterEncodingFilter</span>&lt;/<span class="title">filter</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">param</span>-<span class="title">name</span>&gt;<span class="title">encoding</span>&lt;/<span class="title">param</span>-<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">param</span>-<span class="title">value</span>&gt;<span class="title">utf</span>-8&lt;/<span class="title">param</span>-<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">filter</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">filter</span>-<span class="title">mapping</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">filter</span>-<span class="title">name</span>&gt;<span class="title">encodingFilter</span>&lt;/<span class="title">filter</span>-<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">url</span>-<span class="title">pattern</span>&gt;/*&lt;/<span class="title">url</span>-<span class="title">pattern</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">filter</span>-<span class="title">mapping</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;!--3.默认<span class="title">Session</span>过期时间 15分钟--&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">session</span>-<span class="title">config</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">session</span>-<span class="title">timeout</span>&gt;15&lt;/<span class="title">session</span>-<span class="title">timeout</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">session</span>-<span class="title">config</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">web</span>-<span class="title">app</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;?<span class="title">xml</span> <span class="title">version</span></span>=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xmlns:mvc=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">            http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span></span><br><span class="line"><span class="string">            http://www.springframework.org/schema/mvc</span></span><br><span class="line"><span class="string">            http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd</span></span><br><span class="line"><span class="string">            http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">            http://www.springframework.org/schema/context/spring-context-4.2.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">1.</span>注解驱动--&gt;</span><br><span class="line">    &lt;mvc:annotation-driven /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">2.</span>静态资源过滤--&gt;</span><br><span class="line">    &lt;mvc:<span class="keyword">default</span>-servlet-handler /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">3.</span>扫描包controller--&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;com.kuang.controller&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--<span class="number">4.</span>视图解析器--&gt;</span><br><span class="line">    &lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span><br><span class="line">        &lt;!--前缀:WEB-INF下的jsp包--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;prefix&quot;</span> value=<span class="string">&quot;/WEB-INF/jsp/&quot;</span> /&gt;</span><br><span class="line">        &lt;!--后缀--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;suffix&quot;</span> value=<span class="string">&quot;.jsp&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>3、新建MyInterceptor.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置</span></span><br><span class="line"><span class="comment">     * 返回true就是放行，执行下一个拦截器</span></span><br><span class="line"><span class="comment">     * 返回false就是拦截，不执行下一个拦截器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====处理前=======&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 核心</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modelAndView</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====处理后======&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====清理=====&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、配置spring-mvc.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:interceptors&gt;</span><br><span class="line">    &lt;mvc:interceptor&gt;</span><br><span class="line">        &lt;!--<span class="comment">/**代表/**/</span>admin/ 只要在**后面的都会拦截，直接写/a不会拦截/a/下面的/a/b--&gt;</span><br><span class="line">        &lt;mvc:mapping path=<span class="string">&quot;/**&quot;</span>/&gt;</span><br><span class="line">        &lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.interceptor.MyInterceptor&quot;</span>/&gt;</span><br><span class="line">    &lt;/mvc:interceptor&gt;</span><br><span class="line">&lt;/mvc:interceptors&gt;</span><br></pre></td></tr></table></figure><p>5、测试<a href="http://localhost:8080/test">http://localhost:8080/test</a>结果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">=====处理前=======</span><br><span class="line">test</span><br><span class="line">=====处理后======</span><br><span class="line">=====清理=====</span><br></pre></td></tr></table></figure><p>6、修改MyInterceptor.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置</span></span><br><span class="line"><span class="comment">     * 返回true就是放行，执行下一个拦截器</span></span><br><span class="line"><span class="comment">     * 返回false就是拦截，不执行下一个拦截器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====处理前=======&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截日志</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modelAndView</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====处理后======&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====清理=====&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>7、测试<a href="http://localhost:8080/test">http://localhost:8080/test</a>结果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=====处理前=======</span><br></pre></td></tr></table></figure><p>直接在拦截前preHandle方法中拦截死了。</p><h3 id="2-11-2、自定义拦截器-例子-登录验证"><a href="#2-11-2、自定义拦截器-例子-登录验证" class="headerlink" title="2.11.2、自定义拦截器-例子-登录验证"></a>2.11.2、自定义拦截器-例子-登录验证</h3><p>实现非登录禁止进入main.jsp</p><p>1、新建WEB-INF/jsp/main.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: <span class="number">2021</span>/<span class="number">10</span>/<span class="number">5</span></span><br><span class="line">  Time: <span class="number">22</span>:<span class="number">13</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;用户中心&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">欢迎$&#123;userLoginInfo&#125;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>2、新建WEB-INF/jsp/login.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: <span class="number">2021</span>/<span class="number">10</span>/<span class="number">5</span></span><br><span class="line">  Time: <span class="number">22</span>:<span class="number">12</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;登录页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;/login&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    用户名：</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">    密码：</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登录&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>3、index.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: <span class="number">2021</span>/<span class="number">10</span>/<span class="number">5</span></span><br><span class="line">  Time: <span class="number">21</span>:<span class="number">51</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;主页&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;a href=&quot;/goLogin&quot;&gt;登录&lt;/a&gt;</span><br><span class="line">  &lt;a href=&quot;/main&quot;&gt;用户中心&lt;/a&gt;</span><br><span class="line">  &lt;a href=&quot;/signOut&quot;&gt;退出&lt;/a&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>4、新建LoginController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(HttpSession session, String username, String password)</span> </span>&#123;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;userLoginInfo&quot;</span>,username);</span><br><span class="line">        <span class="comment">//登录成功</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;main&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/signOut&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">signOut</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">        session.removeAttribute(<span class="string">&quot;userLoginInfo&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/main&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;main&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/goLogin&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">goLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5、LoginInterceptor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置:判断什么情况下没有登录</span></span><br><span class="line"><span class="comment">     * 用户没有登录应该重定向，而不是false</span></span><br><span class="line"><span class="comment">     * 判断session</span></span><br><span class="line"><span class="comment">     * 返回true就是放行，执行下一个拦截器</span></span><br><span class="line"><span class="comment">     * 返回false就是拦截，不执行下一个拦截器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====处理是否登录=======&quot;</span>);</span><br><span class="line">        <span class="comment">//已登录时放行</span></span><br><span class="line">        <span class="keyword">if</span> (request.getSession().getAttribute(<span class="string">&quot;userLoginInfo&quot;</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//前往登录界面时放行</span></span><br><span class="line">        <span class="keyword">if</span> (request.getRequestURI().contains(<span class="string">&quot;ogin&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//否则重定向到登录</span></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;/goLogin&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6、配置拦截器spring-mvc.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:interceptors&gt;</span><br><span class="line">    &lt;mvc:interceptor&gt;</span><br><span class="line">        &lt;!--<span class="comment">/**代表/**/</span>admin/ 只要在**后面的都会拦截，直接写/a不会拦截/a/下面的/a/b--&gt;</span><br><span class="line">        &lt;mvc:mapping path=<span class="string">&quot;/**&quot;</span>/&gt;</span><br><span class="line">        &lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.interceptor.LoginInterceptor&quot;</span>/&gt;</span><br><span class="line">    &lt;/mvc:interceptor&gt;</span><br><span class="line">&lt;/mvc:interceptors&gt;</span><br></pre></td></tr></table></figure><h2 id="2-12、文件上传下载"><a href="#2-12、文件上传下载" class="headerlink" title="2.12、文件上传下载"></a>2.12、文件上传下载</h2><p><strong>springmvc-07-file</strong></p><ul><li>springmvc可以很好的支持文件上传，但是SpringMVC上下文中默认没有装配MultipartResolver，因此默认情况下其不能处理文件上传工作。如果想使用Spring的文件上传功能，<strong>需要在上下文中配置MultipartResolver。</strong></li><li>2003年，Apache Software Foundation发布开源的Commons FileUpload组件。</li><li>Servlet3.0规范已经提供方法来处理文件上传，但这种上传需要在Servlet中完成。</li><li>而SpringMVC则提供简单的封装。</li><li>SpringMVC为文件上传提供了直接的支持，这种支持是用即插即用的MultipartResolver实现的。</li><li><strong>SpringMVC使用Commons FileUpload组件技术实现了一个MultipartResolver实现类：</strong><ul><li><strong>CommonsMultipartResolver</strong></li></ul></li><li><strong>CommonsMultipartResolver常用方法：</strong><ul><li><strong>String getOriginalFilename()：获取上传文件的原名</strong></li><li><strong>InputStream getInputStream()：获取文件流</strong></li><li><strong>void transferTo(File dest)：将上传文件保存到一个文件目录中</strong></li></ul></li></ul><p><strong>前端表单要求：</strong>为了支持上传，表单的method设置为POST，并将enctype设置为multpart/form-data。只有在这样情况下，浏览器才会把用户选择的文件比二进制数据发送给服务器。</p><p><strong>表单中enctype属性详细说明：</strong></p><p>multipart/form-data是指表单数据有多部分构成：既有文本数据，又有文件等二进制数据的意思。</p><p>默认情况下，enctype的值是application/x-www-form-urlencoded，不能用于文件上传；</p><p>只有使用了multipart/form-data，才能完整的传递文件数据。</p><p>对于文件上传工作，其实是在前端完成的</p><p><strong>依赖：</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--文件上传--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.3.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--servlet-api导入高版本的--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.0.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h3 id="2-12-1、文件上传下载案例"><a href="#2-12-1、文件上传下载案例" class="headerlink" title="2.12.1、文件上传下载案例"></a>2.12.1、文件上传下载案例</h3><p>配置bean:MultipartResolver</p><p>bean的id必须为multipartResolver，否则上传会被400</p><p>1.spring-mvc.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--文件上传配置--&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;multipartResolver&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span><br><span class="line">    &lt;!--请求的编码格式,必须和jsp的pageEncoding属性一致，一边正确读取表单的内容，默认ISO-<span class="number">8859</span>-<span class="number">1</span>--&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;defaultEncoding&quot;</span> value=<span class="string">&quot;utf-8&quot;</span>/&gt;</span><br><span class="line">    &lt;!--上传文件的大小限制，单位字节<span class="number">10485760</span>=10M--&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;maxUploadSize&quot;</span> value=<span class="string">&quot;10485760&quot;</span>/&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;maxInMemorySize&quot;</span> value=<span class="string">&quot;40960&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>2.index.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 郭宇航</span><br><span class="line">  Date: <span class="number">2021</span>/<span class="number">10</span>/<span class="number">5</span></span><br><span class="line">  Time: <span class="number">22</span>:<span class="number">45</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;$Title$&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line"></span><br><span class="line">  &lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;/upload&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;上传&quot;</span>&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>3.FileController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 郭宇航</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第一种方式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestParam</span>(&quot;file&quot;)将name=file空间得到的文件封装成CommonsMultipartFile对象</span></span><br><span class="line"><span class="comment">     * 批量上传CommonsMultipartFile变为数组即可</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> CommonsMultipartFile file, HttpServletRequest request)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获取文件名</span></span><br><span class="line">        String uploadName = file.getOriginalFilename();</span><br><span class="line">        System.out.println(<span class="string">&quot;文件名：&quot;</span>+uploadName);</span><br><span class="line">        <span class="comment">//判断是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (uploadName == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:/index.jsp&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置保存上传路径</span></span><br><span class="line">        String path = request.getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line">        <span class="comment">//如果路径不存在创建</span></span><br><span class="line">        File realPath = <span class="keyword">new</span> File(path);</span><br><span class="line">        <span class="keyword">if</span> (!realPath.exists()) &#123;</span><br><span class="line">            realPath.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;文件保存路径：&quot;</span>+realPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//上传文件的输入流</span></span><br><span class="line">        InputStream inputStream = file.getInputStream();</span><br><span class="line">        <span class="comment">//创建文件输出流</span></span><br><span class="line">        OutputStream outputStream = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(realPath,uploadName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取和写入</span></span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span> ((len = inputStream.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            outputStream.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            outputStream.flush();</span><br><span class="line">        &#125;</span><br><span class="line">        outputStream.close();</span><br><span class="line">        inputStream.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/index.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">fileUpload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> CommonsMultipartFile file, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//上传路径,获取运行时的工程存放目录</span></span><br><span class="line">        String path = request.getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line">        File realPath = <span class="keyword">new</span> File(path);</span><br><span class="line">        <span class="keyword">if</span> (!realPath.exists()) &#123;</span><br><span class="line">            realPath.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;文件保存路径：&quot;</span>+realPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过transferTo写入文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file.transferTo(<span class="keyword">new</span> File(realPath+<span class="string">&quot;/&quot;</span>+file.getOriginalFilename()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;文件保存错误&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/index.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.文件下载</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">download</span><span class="params">(HttpServletResponse response, HttpServletRequest request)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//要下载的图片</span></span><br><span class="line">    String path = request.getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line">    String filename = <span class="string">&quot;新建文本文档.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.设置response响应头</span></span><br><span class="line">    response.reset();<span class="comment">//设置页面不缓存，情况buffer</span></span><br><span class="line">    response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>); <span class="comment">//字符编码</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;multipart/form-data&quot;</span>); <span class="comment">//二进制传输数据</span></span><br><span class="line">    response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>,<span class="string">&quot;attachment;fileName=&quot;</span>+ URLEncoder.encode(filename,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.读取文件</span></span><br><span class="line">    File file = <span class="keyword">new</span> File(path,filename);</span><br><span class="line">    InputStream inputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//3.写出文件</span></span><br><span class="line">    OutputStream outputStream = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">    <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((index = inputStream.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">        outputStream.write(buffer, <span class="number">0</span>, index);</span><br><span class="line">        outputStream.flush();</span><br><span class="line">    &#125;</span><br><span class="line">    outputStream.close();</span><br><span class="line">    inputStream.close();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring-MVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zookeeper学习笔记</title>
      <link href="/2020/11/13/learn-zookeeper/"/>
      <url>/2020/11/13/learn-zookeeper/</url>
      
        <content type="html"><![CDATA[<h1 id="第一章-Zookeeper入门-了解"><a href="#第一章-Zookeeper入门-了解" class="headerlink" title="第一章 Zookeeper入门-了解"></a>第一章 Zookeeper入门-了解</h1><h2 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h2><p>开源的分布式的，为分布式应用提供<strong>协调服务</strong>的Apache项目</p><p><img src="Untitled.png" alt="Untitled.png"></p><h2 id="1-2-特点"><a href="#1-2-特点" class="headerlink" title="1.2 特点"></a>1.2 特点</h2><p><img src="Untitled%201.png" alt="Untitled%201.png"></p><h2 id="1-3-数据结构"><a href="#1-3-数据结构" class="headerlink" title="1.3 数据结构"></a>1.3 数据结构</h2><p><img src="Untitled%202.png" alt="Untitled%202.png"></p><h2 id="1-4-应用场景"><a href="#1-4-应用场景" class="headerlink" title="1.4 应用场景"></a>1.4 应用场景</h2><p>提供的服务包括：统一命名服务、统一配置管理、统一集权管理、服务器节点动态上下线、软负载均衡等。</p><p>统一命名服务：</p><p><img src="Untitled%203.png" alt="Untitled%203.png"></p><p>统一配置管理：</p><p><img src="Untitled%204.png" alt="Untitled%204.png"></p><p>统一集权管理：</p><p><img src="Untitled%205.png" alt="Untitled%205.png"></p><p>服务器节点动态上下线：</p><p><img src="Untitled%206.png" alt="Untitled%206.png"></p><p>4.4中会实现该案例.</p><p>软负载均衡：</p><p><img src="Untitled%207.png" alt="Untitled%207.png"></p><h2 id="1-5-下载地址"><a href="#1-5-下载地址" class="headerlink" title="1.5 下载地址"></a>1.5 下载地址</h2><p><a href="https://zookeeper.apache.org/releases.html">https://zookeeper.apache.org/releases.html</a></p><h1 id="第二章-Zookeeper安装"><a href="#第二章-Zookeeper安装" class="headerlink" title="第二章 Zookeeper安装"></a>第二章 Zookeeper安装</h1><h2 id="2-1-本地模式安装部署"><a href="#2-1-本地模式安装部署" class="headerlink" title="2.1 本地模式安装部署"></a>2.1 本地模式安装部署</h2><h3 id="2-1-1-安装jdk"><a href="#2-1-1-安装jdk" class="headerlink" title="2.1.1 安装jdk"></a>2.1.1 安装jdk</h3><p>上传jdk包到/opt/software</p><p>tar -zxvf jdk-8u291-linux-x64.tar.gz</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> JAVA_HOME=<span class="regexp">/opt/</span>software/jdk1<span class="number">.8</span><span class="number">.0_291</span>/  #jdk安装目录</span><br><span class="line"><span class="keyword">export</span> JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line"><span class="keyword">export</span> CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib:$CLASSPATH</span><br><span class="line"><span class="keyword">export</span> JAVA_PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;JRE_HOME&#125;/bin</span><br><span class="line"><span class="keyword">export</span> PATH=$PATH:$&#123;JAVA_PATH&#125;</span><br></pre></td></tr></table></figure><h3 id="2-1-2安装zookeeper"><a href="#2-1-2安装zookeeper" class="headerlink" title="2.1.2安装zookeeper"></a>2.1.2安装zookeeper</h3><p>拷贝到/opt/software</p><p>解压</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-zookeeper-<span class="number">3.7</span><span class="number">.0</span>.tar.gz</span><br></pre></td></tr></table></figure><h3 id="2-1-3修改zookeeper配置"><a href="#2-1-3修改zookeeper配置" class="headerlink" title="2.1.3修改zookeeper配置"></a>2.1.3修改zookeeper配置</h3><p>将”/opt/software/apache-zookeeper-3.7.0/conf/zoo_sample.cfg”拷贝份zoo.cfg</p><p>打开zoo.cfg，修改vim zoo.cfg</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataDir=<span class="regexp">/opt/</span>software/apache-zookeeper-<span class="number">3.7</span><span class="number">.0</span>/zkData/</span><br></pre></td></tr></table></figure><h3 id="2-1-4操作zookeeper"><a href="#2-1-4操作zookeeper" class="headerlink" title="2.1.4操作zookeeper"></a>2.1.4操作zookeeper</h3><p>(1) 启动zookeeper</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/software/apache-zookeeper-<span class="number">3.7</span><span class="number">.0</span>/bin</span><br><span class="line">./zkServer.sh start</span><br></pre></td></tr></table></figure><p>(2) 查看进程</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jps</span><br><span class="line">./zkServer.sh status</span><br></pre></td></tr></table></figure><p>(3)启动客户端</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./zkCli.sh</span><br><span class="line">quit</span><br><span class="line">./zkServer.sh stop</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -apn | grep <span class="number">2181</span></span><br></pre></td></tr></table></figure><h2 id="2-2-配置参数解读"><a href="#2-2-配置参数解读" class="headerlink" title="2.2 配置参数解读"></a>2.2 配置参数解读</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 心跳ms</span></span><br><span class="line">tickTime=<span class="number">2000</span></span><br><span class="line"><span class="comment"># 10个2s 启动时，leader和felower之间最大延迟时间，超过挂了</span></span><br><span class="line">initLimit=<span class="number">10</span></span><br><span class="line"><span class="comment"># 5个2s 集群启动之后，leader和felower之间最大延迟时间，超过挂了</span></span><br><span class="line">syncLimit=<span class="number">5</span></span><br><span class="line"><span class="comment"># 客户端访问服务器的端口号</span></span><br><span class="line">clientPort=<span class="number">2181</span></span><br></pre></td></tr></table></figure><h1 id="第三章-Zookeeper内部原理"><a href="#第三章-Zookeeper内部原理" class="headerlink" title="第三章 Zookeeper内部原理"></a>第三章 Zookeeper内部原理</h1><h2 id="3-1-选举机制（面试重点）"><a href="#3-1-选举机制（面试重点）" class="headerlink" title="3.1 选举机制（面试重点）"></a>3.1 选举机制（面试重点）</h2><ol><li><p>半数机制：集群中半数以上机器存活，集群可用。所以Zookeeper适合安装奇数台服务器。</p></li><li><p>Zookeeper在配置文件中没有配置Leader和Follower，但是Zookeeper在工作时，是有一个Leader的，其他的则为Follower，Leader通过内部的选举机制选举产生的。</p></li><li><p>以一个简单的例子说明选举过程</p></li></ol><p>假设有5台服务器组成的Zookeeper集群，它们的id从1-5，同时他们都是最新启动的。也就没有历史数据。在存放数据量上都是一样的。假设服务器依次启动，会发生什么：</p><p><img src="Untitled%208.png" alt="Untitled%208.png"></p><p>(1) 服务器1启动，此时只有它一个服务器启动了，它发出去的报文没有任何响应，所以它选举状态一直是LOOKING状态。</p><p>(2) 服务器2启动，它也投自己，它与最开始启动的服务器1进行通信，互相交换选举结果，由于两者都没有历史数据。所以id值较大的2号胜出，但由于没有达到半数以上。</p><p>(3) 服务器3启动，它投自己，前边的服务器1、2投自己后发现选不出leader，都选择id大的3号服务器。</p><p>(4) 服务器4启动，它投自己，但是3号服务器已经担任leader责任。4号服务器当不了了。</p><p>(5) 服务器5启动，只要leader选出来之后。改变不了leader了。</p><h2 id="3-2-节点类型"><a href="#3-2-节点类型" class="headerlink" title="3.2 节点类型"></a>3.2 节点类型</h2><h3 id="2大类"><a href="#2大类" class="headerlink" title="2大类"></a>2大类</h3><p>持久：客户端和服务端断开连接后，创建的目录节点不删除</p><p>短暂：客户端和服务端断开连接后，创建的目录节点自己删除</p><p><img src="Untitled%209.png" alt="Untitled%209.png"></p><h3 id="持久分类："><a href="#持久分类：" class="headerlink" title="持久分类："></a>持久分类：</h3><p>(1) 持久化目录节点</p><p>客户端与Zookeeper断开连接后，该节点依旧存在</p><p>(2) 持久化顺序编号目录节点</p><p>客户端与Zookeeper断开连接后，该节点依旧存在，只是Zookeeper给该节点名称进行顺序编号</p><p><strong>说明：</strong></p><p>创建znode时设置顺序编号，znode名称后会附加一个值，顺序号是一个单调递增的计数器，由父节点维护</p><p><strong>注意：</strong></p><p>在分布式系统中，顺序号可以被用于为所有的事件进行全局排序，这样客户端可以通过顺序号推断事件的顺序</p><h3 id="短暂分类："><a href="#短暂分类：" class="headerlink" title="短暂分类："></a>短暂分类：</h3><p>(1) 临时目录节点</p><p>客户端和Zookeeper断开连接后，创建的目录节点被立刻删除，适合动态上下线</p><p>(2) 临时顺序编号目录节点</p><p>客户端与Zookeeper断开连接后，该节点被删除，只是Zookeeper给该节点名称进行了顺序编号</p><p><img src="Untitled%2010.png" alt="Untitled%2010.png"></p><h2 id="3-3-Stat结构体"><a href="#3-3-Stat结构体" class="headerlink" title="3.3 Stat结构体"></a>3.3 Stat结构体</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:<span class="number">2181</span>(CONNECTED) <span class="number">15</span>] get -s /sanguo</span><br><span class="line">jinlian</span><br><span class="line">cZxid = <span class="number">0</span>xd</span><br><span class="line"><span class="comment"># 创建节点的事务id，每次修改节点状态都会收到一个zxid形势的时间戳，也就是zookeeper事务id。</span></span><br><span class="line"><span class="comment"># 事务id是zookeeper中所有修改总的次序。每个修改都有唯一的zxid，如果zxid1小于zxid2，</span></span><br><span class="line"><span class="comment"># 那么zxid1在zxid2之前发生</span></span><br><span class="line"></span><br><span class="line">ctime = Wed Jun <span class="number">16</span> <span class="number">13</span>:<span class="number">44</span>:<span class="number">06</span> CST <span class="number">2021</span></span><br><span class="line"><span class="comment"># znode被创建的毫秒数(从1970年开始)</span></span><br><span class="line"></span><br><span class="line">mZxid = <span class="number">0</span>xe</span><br><span class="line"><span class="comment">#最后更新的事务zxid</span></span><br><span class="line"></span><br><span class="line">mtime = Wed Jun <span class="number">16</span> <span class="number">13</span>:<span class="number">44</span>:<span class="number">19</span> CST <span class="number">2021</span></span><br><span class="line"><span class="comment"># znode最后被修改的毫秒数(从1970年开始)</span></span><br><span class="line"></span><br><span class="line">pZxid = <span class="number">0</span>xf</span><br><span class="line"><span class="comment"># 最后更新的子节点zxid</span></span><br><span class="line"></span><br><span class="line">cversion = <span class="number">1</span></span><br><span class="line"><span class="comment"># znode子节点变化号，znode子节点修改次数</span></span><br><span class="line"></span><br><span class="line">dataVersion = <span class="number">1</span></span><br><span class="line"><span class="comment"># znode数据变化号</span></span><br><span class="line"></span><br><span class="line">aclVersion = <span class="number">0</span></span><br><span class="line"><span class="comment"># znode访问控制列表的变化</span></span><br><span class="line"></span><br><span class="line">ephemeralOwner = <span class="number">0</span>x0</span><br><span class="line"><span class="comment"># 如果是临时节点，这个znode拥有者的session的id。如果不是临时节点则是0</span></span><br><span class="line"></span><br><span class="line">dataLength = <span class="number">7</span></span><br><span class="line"><span class="comment"># znode的数据长度</span></span><br><span class="line"></span><br><span class="line">numChildren = <span class="number">1</span></span><br><span class="line"><span class="comment"># znode子节点数量</span></span><br></pre></td></tr></table></figure><h2 id="3-4-监听原理（面试重点）"><a href="#3-4-监听原理（面试重点）" class="headerlink" title="3.4 监听原理（面试重点）"></a>3.4 监听原理（面试重点）</h2><h3 id="3-4-1监听原理详解："><a href="#3-4-1监听原理详解：" class="headerlink" title="3.4.1监听原理详解："></a>3.4.1监听原理详解：</h3><ol><li><p>首先有一个main线程</p></li><li><p>在main线程中创建zookeeper客户端，这时创建两个线程，一个负责网络通信(connect)，一个负责监听(listener)</p></li><li><p>通过connect将注册的监听事件发送给zookeeper</p></li><li><p>在zookeeper的zhu’c监听器列表中将注册的监听事件添加到列表中</p></li><li><p>zookeeper监听到有数据或路劲的变化后，就会将这条消息发送给listener线程</p></li><li><p>listener线程内部钓用process方法(在程序中自己写)</p></li></ol><p><img src="Untitled%2011.png" alt="Untitled%2011.png"></p><h3 id="3-4-2常见的监听"><a href="#3-4-2常见的监听" class="headerlink" title="3.4.2常见的监听"></a>3.4.2常见的监听</h3><ol><li>监听节点数据的变化</li></ol><p>get path [watch]</p><ol start="2"><li>监听子节点增减的变化</li></ol><p>ls path [watch]</p><h2 id="3-5-写数据流程"><a href="#3-5-写数据流程" class="headerlink" title="3.5 写数据流程"></a>3.5 写数据流程</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>客户端提交数据，是怎么写的？</p><p>怎么保持副本中都一样？</p><p>leader干什么事、server干什么事？</p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p><img src="Untitled%2012.png" alt="Untitled%2012.png"></p><h1 id="第四章-Zookeeper实战（开发重点）"><a href="#第四章-Zookeeper实战（开发重点）" class="headerlink" title="第四章 Zookeeper实战（开发重点）"></a>第四章 Zookeeper实战（开发重点）</h1><h2 id="4-1-分布式安装部署"><a href="#4-1-分布式安装部署" class="headerlink" title="4.1 分布式安装部署"></a>4.1 分布式安装部署</h2><h3 id="4-1-1集群规划"><a href="#4-1-1集群规划" class="headerlink" title="4.1.1集群规划"></a>4.1.1集群规划</h3><p>在服务器102、服务器103、服务器104三个节点上部署zookeeper</p><h3 id="4-1-2解压安装"><a href="#4-1-2解压安装" class="headerlink" title="4.1.2解压安装"></a>4.1.2解压安装</h3><p>(1) 解压Zookeeper安装包到/opt/modult/目录下</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf zookeeper-<span class="number">3.4</span>.<span class="number">10</span>.tar.gz -C /opt/module/</span><br></pre></td></tr></table></figure><p>(2) 同步/opt/module/zookeeper-3.4.10目录内容到服务器103、服务器104</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync zookeeper-<span class="number">3.4</span>.<span class="number">10</span></span><br></pre></td></tr></table></figure><h3 id="4-1-3-配置服务器编号"><a href="#4-1-3-配置服务器编号" class="headerlink" title="4.1.3 配置服务器编号"></a>4.1.3 配置服务器编号</h3><p>(1) 在/opt/module/zookeeper-3.4.10/下创建zkData</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p zkData</span><br></pre></td></tr></table></figure><p>(2) 在/opt/module/zookeeper-3.4.10/zkData/目录下创建一个myid文件</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch myid</span><br></pre></td></tr></table></figure><p>(3) 编辑myid文件</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim myid</span><br><span class="line"><span class="comment">#添加与server对应编号</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure><p>(4) 拷贝配置好的zookeeper到其他服务器上</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync myid</span><br></pre></td></tr></table></figure><p>分别在103、104服务器上修改myid文件内容为3、4</p><h3 id="4-1-4-配置zoo-cfg文件"><a href="#4-1-4-配置zoo-cfg文件" class="headerlink" title="4.1.4 配置zoo.cfg文件"></a>4.1.4 配置zoo.cfg文件</h3><p>(1) 添加如下配置</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###############cluster###################</span></span><br><span class="line">server.<span class="number">2</span>=hadoop102:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server.<span class="number">3</span>=hadoop103:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line">server.<span class="number">4</span>=hadoop104:<span class="number">2888</span>:<span class="number">3888</span> </span><br></pre></td></tr></table></figure><p>(2) 同步zoo.cfg</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync zoo.cfg</span><br></pre></td></tr></table></figure><p>(3) 配置解读</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.A=B:C:D</span><br></pre></td></tr></table></figure><p>A是一个数字，myid些什么A就写什么。</p><p>集群模式下配置了一个myid文件，zookeeper启动时读取此文件，拿到数据后与zoo.cfg中的配置信息进行对比从而确定是哪个server</p><p>B是这个服务器的ip地址</p><p>C是这个服务器与集群中的Leader服务器与Follower交换信息的端口</p><p>D是万一集群中的Leader服务器挂了，需要一个端口来进行重新选举，选出一个新的Leader</p><h3 id="4-1-5-集群操作"><a href="#4-1-5-集群操作" class="headerlink" title="4.1.5 集群操作"></a>4.1.5 集群操作</h3><p>(1) 分别启动zookeeper</p><p>(2) 查看状态</p><h2 id="4-2-客户端命令行操作"><a href="#4-2-客户端命令行操作" class="headerlink" title="4.2 客户端命令行操作"></a>4.2 客户端命令行操作</h2><p><a href="https://www.notion.so/3c402338899946a68de5eea00d2ea386">shell</a></p><h2 id="4-3-API应用"><a href="#4-3-API应用" class="headerlink" title="4.3 API应用"></a>4.3 API应用</h2><h3 id="4-3-1-环境搭建"><a href="#4-3-1-环境搭建" class="headerlink" title="4.3.1 环境搭建"></a>4.3.1 环境搭建</h3><p>1.创建工程</p><p>2.pom文件添加依赖</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.14.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.5.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>3.resources目录创建log4j.properties</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 设置###</span></span><br><span class="line">log4j.rootLogger = info,stdout</span><br><span class="line"></span><br><span class="line"><span class="comment">### 输出信息到控制抬 ###</span></span><br><span class="line">log4j.appender.stdout = org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.Target = System.out</span><br><span class="line">log4j.appender.logfile=org.apache.log4j.FileAppender</span><br><span class="line">log4j.appender.logfile.File=target/spring.log</span><br><span class="line">log4j.appender.logfile.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern = [%-<span class="number">5</span>p] %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; method:%l%n%m%n</span><br></pre></td></tr></table></figure><h3 id="4-3-2-创建Zookeeper客户端"><a href="#4-3-2-创建Zookeeper客户端" class="headerlink" title="4.3.2 创建Zookeeper客户端"></a>4.3.2 创建Zookeeper客户端</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Before</span><br><span class="line">public void init() throws IOException &#123;</span><br><span class="line">    String connectString = <span class="string">&quot;39.106.63.189:2181&quot;</span>;</span><br><span class="line">    int sessionTimeout = <span class="number">200000</span>;</span><br><span class="line">    ZooKeeper zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() &#123;</span><br><span class="line">        //监听回调</span><br><span class="line">        @Override</span><br><span class="line">        public void process(WatchedEvent watchedEvent) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-3-创建子节点"><a href="#4-3-3-创建子节点" class="headerlink" title="4.3.3 创建子节点"></a>4.3.3 创建子节点</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void createNode() throws KeeperException, InterruptedException &#123;</span><br><span class="line">    //参数<span class="number">1</span>：节点路径</span><br><span class="line">    //参数<span class="number">2</span>：节点数据</span><br><span class="line">    //参数<span class="number">3</span>：节点权限</span><br><span class="line">    //参数<span class="number">4</span>：节点类型</span><br><span class="line">    String path = zkCli.create(<span class="string">&quot;/guoyh&quot;</span>, <span class="string">&quot;guoyh&quot;</span>.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line">    System.out.println(path);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-4-获取子节点并监听节点变化"><a href="#4-3-4-获取子节点并监听节点变化" class="headerlink" title="4.3.4 获取子节点并监听节点变化"></a>4.3.4 获取子节点并监听节点变化</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void getDataAndWatch() throws KeeperException, InterruptedException &#123;</span><br><span class="line">    //参数<span class="number">1</span>：节点路径</span><br><span class="line">    //参数<span class="number">2</span>：是否监听</span><br><span class="line">    List&lt;String&gt; datas = zkCli.getChildren(<span class="string">&quot;/&quot;</span>,true);</span><br><span class="line">    for (String data : datas) &#123;</span><br><span class="line">        System.out.println(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //睡一会，当有节点变化时响应,在process中处理</span><br><span class="line">    Thread.sleep(Long.MAX_VALUE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Before</span><br><span class="line">public void init() throws IOException &#123;</span><br><span class="line">    String connectString = <span class="string">&quot;39.106.63.189:2181&quot;</span>;</span><br><span class="line">    int sessionTimeout = <span class="number">200000</span>;</span><br><span class="line">    ZooKeeper zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() &#123;</span><br><span class="line">        //监听回调</span><br><span class="line">        @Override</span><br><span class="line">        public void process(WatchedEvent watchedEvent) &#123;</span><br><span class="line">            //监听节点变化</span><br><span class="line">            List&lt;String&gt; datas = null;</span><br><span class="line">            try &#123;</span><br><span class="line">                datas = zkCli.getChildren(<span class="string">&quot;/&quot;</span>, true);</span><br><span class="line">                for (String data : datas) &#123;</span><br><span class="line">                    System.out.println(data);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (KeeperException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-5-判断Znode是否存在"><a href="#4-3-5-判断Znode是否存在" class="headerlink" title="4.3.5 判断Znode是否存在"></a>4.3.5 判断Znode是否存在</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void exist() throws KeeperException, InterruptedException &#123;</span><br><span class="line">    //参数<span class="number">1</span>：节点路径</span><br><span class="line">    //参数<span class="number">2</span>：是否监听</span><br><span class="line">    Stat stat = zkCli.exists(<span class="string">&quot;/guoyha&quot;</span>, false);</span><br><span class="line">    System.out.println(stat == null ? <span class="string">&quot;not exist&quot;</span>:<span class="string">&quot;exist&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-4-监听服务器节点动态上下线案例"><a href="#4-4-监听服务器节点动态上下线案例" class="headerlink" title="4.4 监听服务器节点动态上下线案例"></a>4.4 监听服务器节点动态上下线案例</h2><h3 id="4-4-1-需求"><a href="#4-4-1-需求" class="headerlink" title="4.4.1 需求"></a>4.4.1 需求</h3><p>某分布式系统中，主节点可以有多台，可以动态上下线，任意一台客户端都能实时感知主节点服务器的上下线。</p><h3 id="4-4-2-需求分析"><a href="#4-4-2-需求分析" class="headerlink" title="4.4.2 需求分析"></a>4.4.2 需求分析</h3><p><img src="Untitled%2013.png" alt="Untitled%2013.png"></p><p>相对于在Zookeeper集群，3个服务器和3个客户端都是连接zookeeper的客户端，3个服务器在zookeeper的/servers目录下创建对应的节点并存储连接数。3个客户端连接zookeeper集群并监听/servers目录下节点列表，当有服务器下线后，能够监听到节点列表的变化。</p><h3 id="4-4-3-代码实现"><a href="#4-4-3-代码实现" class="headerlink" title="4.4.3 代码实现"></a>4.4.3 代码实现</h3><p><strong>服务端：</strong></p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">package com.example.zookeeper.server;</span><br><span class="line"></span><br><span class="line">import org.apache.zookeeper.*;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author guoyh</span><br><span class="line"> */</span><br><span class="line">public class DistributeServer &#123;</span><br><span class="line">    private ZooKeeper zkCli;</span><br><span class="line">    String connectString = <span class="string">&quot;127.0.0.1:2181&quot;</span>;</span><br><span class="line">    int sessionTimeout = <span class="number">200000</span>;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        DistributeServer server = new DistributeServer();</span><br><span class="line"></span><br><span class="line">        // <span class="number">1</span>、连接Zookeeper集群</span><br><span class="line">        server.getConnect();</span><br><span class="line"></span><br><span class="line">        // <span class="number">2</span>、注册创建临时节点</span><br><span class="line">        // 设置服务器名称</span><br><span class="line">        String application = <span class="string">&quot;hadoop101&quot;</span>;</span><br><span class="line">        server.regist(application);</span><br><span class="line"></span><br><span class="line">        // <span class="number">3</span>、自己的业务逻辑代码处理</span><br><span class="line">        server.business();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 服务自己的业务处理</span><br><span class="line">     */</span><br><span class="line">    private void business() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            //保证进程不结束</span><br><span class="line">            Thread.sleep(Long.MAX_VALUE);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注册服务</span><br><span class="line">     * @param hostname</span><br><span class="line">     */</span><br><span class="line">    private void regist(String hostname) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            //创建短暂带序号的子节点,存放主机名</span><br><span class="line">            String path = zkCli.create(<span class="string">&quot;/servers/server&quot;</span>, hostname.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);</span><br><span class="line">            System.out.println(hostname + <span class="string">&quot;is online&quot;</span>);</span><br><span class="line">        &#125; catch (KeeperException | InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取Zookeeper连接</span><br><span class="line">     */</span><br><span class="line">    private void getConnect() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() &#123;</span><br><span class="line">                //监听回调</span><br><span class="line">                @Override</span><br><span class="line">                public void process(WatchedEvent watchedEvent) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>客户端：</strong></p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">package com.example.zookeeper.client;</span><br><span class="line"></span><br><span class="line">import org.apache.zookeeper.*;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author guoyh</span><br><span class="line"> */</span><br><span class="line">public class DistributeClient &#123;</span><br><span class="line">    private ZooKeeper zkCli;</span><br><span class="line">    String connectString = <span class="string">&quot;0.0.0.0:2181&quot;</span>;</span><br><span class="line">    int sessionTimeout = <span class="number">200000</span>;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        DistributeClient client = new DistributeClient();</span><br><span class="line"></span><br><span class="line">        // <span class="number">1</span>、获取zookeeper连接</span><br><span class="line">        client.getConnect();</span><br><span class="line"></span><br><span class="line">        // <span class="number">2</span>、注册监听</span><br><span class="line">        String application = <span class="string">&quot;hadoop101&quot;</span>;</span><br><span class="line">        client.getChildren();</span><br><span class="line"></span><br><span class="line">        // <span class="number">3</span>、业务逻辑处理</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注册服务</span><br><span class="line">     */</span><br><span class="line">    private void getChildren() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            List&lt;String&gt; children = zkCli.getChildren(<span class="string">&quot;/servers/server&quot;</span>, true);</span><br><span class="line">            // 存储服务器节点主机名称集合</span><br><span class="line">            List&lt;String&gt; hostnames = new ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;------start------&quot;</span>);</span><br><span class="line">            for (String child : children) &#123;</span><br><span class="line">                byte[] data = zkCli.getData(<span class="string">&quot;/servers/&quot;</span> + child, false, null);</span><br><span class="line">                hostnames.add(new String(data));</span><br><span class="line">            &#125;</span><br><span class="line">            // 将所有在线主机名打印</span><br><span class="line">            System.out.println(hostnames);</span><br><span class="line">            System.out.println(<span class="string">&quot;------end------&quot;</span>);</span><br><span class="line">        &#125; catch (KeeperException | InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取Zookeeper连接</span><br><span class="line">     */</span><br><span class="line">    private void getConnect() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            zkCli = new ZooKeeper(connectString, sessionTimeout, new Watcher() &#123;</span><br><span class="line">                //监听回调</span><br><span class="line">                @Override</span><br><span class="line">                public void process(WatchedEvent watchedEvent) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="第五章-企业面试真题（面试重点）"><a href="#第五章-企业面试真题（面试重点）" class="headerlink" title="第五章 企业面试真题（面试重点）"></a>第五章 企业面试真题（面试重点）</h1><h2 id="5-1-简述Zookeeper的选择机制"><a href="#5-1-简述Zookeeper的选择机制" class="headerlink" title="5.1 简述Zookeeper的选择机制"></a>5.1 简述Zookeeper的选择机制</h2><p>详见3.1</p><p>半数机制</p><h2 id="5-2-Zookeeper的监听原理是什么"><a href="#5-2-Zookeeper的监听原理是什么" class="headerlink" title="5.2  Zookeeper的监听原理是什么"></a>5.2  Zookeeper的监听原理是什么</h2><p>详见3.4</p><h2 id="5-3-Zookeeper的部署方式有哪几种？"><a href="#5-3-Zookeeper的部署方式有哪几种？" class="headerlink" title="5.3  Zookeeper的部署方式有哪几种？"></a>5.3  Zookeeper的部署方式有哪几种？</h2><p>(1) 单机模式、集群模式</p><p>(2) 角色：Leader和Follower</p><p>(3) 集群最少需要机器数3个</p><h2 id="5-4-Zookeeper的常见命令"><a href="#5-4-Zookeeper的常见命令" class="headerlink" title="5.4 Zookeeper的常见命令"></a>5.4 Zookeeper的常见命令</h2><p>ls、create、get、delete、set</p>]]></content>
      
      
      <categories>
          
          <category> 中间件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8-Optional</title>
      <link href="/2020/10/14/JDK-Optional/"/>
      <url>/2020/10/14/JDK-Optional/</url>
      
        <content type="html"><![CDATA[<p>Created: September 4, 2021 10:52 AM</p><blockquote><p>从 Java 8 引入的一个很有趣的特性是 <em>Optional</em>  类。Optional 类主要解决的问题是臭名昭著的空指针异常（NullPointerException） —— 每个 Java 程序员都非常了解的异常。</p></blockquote><blockquote><p>本质上，这是一个包含有可选值的包装类，这意味着 Optional 类既可以含有对象也可以为空。</p></blockquote><blockquote><p>Optional 是 Java 实现函数式编程的强劲一步，并且帮助在范式中实现。但是 Optional 的意义显然不止于此。</p></blockquote><p>我们从一个简单的用例开始。在 Java 8 之前，任何访问对象方法或属性的调用都可能导致 <em>NullPointerException</em>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String isocode = user.getAddress().getCountry().getIsocode().toUpperCase();</span><br></pre></td></tr></table></figure><p>在这个小示例中，如果我们需要确保不触发异常，就得在访问每一个值之前对其进行明确地检查：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if (user !&#x3D; null) &#123;</span><br><span class="line">    Address address &#x3D; user.getAddress();</span><br><span class="line">    if (address !&#x3D; null) &#123;</span><br><span class="line">        Country country &#x3D; address.getCountry();</span><br><span class="line">        if (country !&#x3D; null) &#123;</span><br><span class="line">            String isocode &#x3D; country.getIsocode();</span><br><span class="line">            if (isocode !&#x3D; null) &#123;</span><br><span class="line">                isocode &#x3D; isocode.toUpperCase();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你看到了，这很容易就变得冗长，难以维护。</p><p>为了简化这个过程，我们来看看用 <em>Optional</em>  类是怎么做的。从创建和验证实例，到使用其不同的方法，并与其它返回相同类型的方法相结合，下面是见证 <em>Optional</em>  奇迹的时刻。</p><h2 id="创建-Optional-实例"><a href="#创建-Optional-实例" class="headerlink" title="创建 Optional 实例"></a><strong>创建 <em>Optional</em> 实例</strong></h2><p>重申一下，这个类型的对象可能包含值，也可能为空。你可以使用同名方法创建一个空的 Optional。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Test(expected &#x3D; NoSuchElementException.class)</span><br><span class="line">public void whenCreateEmptyOptional_thenNull() &#123;</span><br><span class="line">    Optional&lt;User&gt; emptyOpt &#x3D; Optional.empty();</span><br><span class="line">    emptyOpt.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>毫不奇怪，尝试访问 <em>emptyOpt</em> 变量的值会导致 <em>NoSuchElementException</em>。</p><p>你可以使用  <em>of()</em> 和 ofNullable() 方法创建包含值的 <em>Optional</em>。两个方法的不同之处在于如果你把 <em>null</em> 值作为参数传递进去，<em>of()</em> 方法会抛出 <em>NullPointerException</em>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Test(expected &#x3D; NullPointerException.class)</span><br><span class="line">public void whenCreateOfEmptyOptional_thenNullPointerException() &#123;</span><br><span class="line">    Optional&lt;User&gt; opt &#x3D; Optional.of(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你看，我们并没有完全摆脱 <em>NullPointerException</em>。因此，你应该明确对象不为 <em>null</em>  的时候使用 *of()*。</p><p>如果对象即可能是 <em>null</em> 也可能是非 null，你就应该使用 <em>ofNullable()</em> 方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;User&gt; opt &#x3D; Optional.ofNullable(user);</span><br></pre></td></tr></table></figure><h2 id="访问-Optional-对象的值"><a href="#访问-Optional-对象的值" class="headerlink" title="访问 Optional 对象的值"></a><strong>访问 <em>Optional</em> 对象的值</strong></h2><p>从 <em>Optional</em> 实例中取回实际值对象的方法之一是使用 <em>get()</em> 方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenCreateOfNullableOptional_thenOk() &#123;</span><br><span class="line">    String name &#x3D; &quot;John&quot;;</span><br><span class="line">    Optional&lt;String&gt; opt &#x3D; Optional.ofNullable(name);</span><br><span class="line"></span><br><span class="line">    assertEquals(&quot;John&quot;, opt.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不过，你看到了，这个方法会在值为 <em>null</em> 的时候抛出异常。要避免异常，你可以选择首先验证是否有值：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenCheckIfPresent_thenOk() &#123;</span><br><span class="line">    User user &#x3D; new User(&quot;john@gmail.com&quot;, &quot;1234&quot;);</span><br><span class="line">    Optional&lt;User&gt; opt &#x3D; Optional.ofNullable(user);</span><br><span class="line">    assertTrue(opt.isPresent());</span><br><span class="line"></span><br><span class="line">    assertEquals(user.getEmail(), opt.get().getEmail());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>检查是否有值的另一个选择是 <em>ifPresent()</em> 方法。该方法除了执行检查，还接受一个<em>Consumer(消费者</em>) 参数，如果对象不是空的，就对执行传入的 Lambda 表达式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opt.ifPresent( u -&gt; assertEquals(user.getEmail(), u.getEmail()));</span><br></pre></td></tr></table></figure><p>这个例子中，只有 user 用户不为 null 的时候才会执行断言。</p><p>接下来，我们来看看提供空值的方法。</p><h2 id="返回默认值"><a href="#返回默认值" class="headerlink" title="返回默认值"></a><strong>返回默认值</strong></h2><p><em>Optional</em> 类提供了 API 用以返回对象值，或者在对象为空的时候返回默认值。</p><p>这里你可以使用的第一个方法是 *orElse()*，它的工作方式非常直接，如果有值则返回该值，否则返回传递给它的参数值：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenEmptyValue_thenReturnDefault() &#123;</span><br><span class="line">    User user &#x3D; null;</span><br><span class="line">    User user2 &#x3D; new User(&quot;anna@gmail.com&quot;, &quot;1234&quot;);</span><br><span class="line">    User result &#x3D; Optional.ofNullable(user).orElse(user2);</span><br><span class="line"></span><br><span class="line">    assertEquals(user2.getEmail(), result.getEmail());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里 <em>user</em> 对象是空的，所以返回了作为默认值的 <em>user2</em>。</p><p>如果对象的初始值不是 null，那么默认值会被忽略：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenValueNotNull_thenIgnoreDefault() &#123;</span><br><span class="line">    User user &#x3D; new User(&quot;john@gmail.com&quot;,&quot;1234&quot;);</span><br><span class="line">    User user2 &#x3D; new User(&quot;anna@gmail.com&quot;, &quot;1234&quot;);</span><br><span class="line">    User result &#x3D; Optional.ofNullable(user).orElse(user2);</span><br><span class="line"></span><br><span class="line">    assertEquals(&quot;john@gmail.com&quot;, result.getEmail());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二个同类型的 API 是 <em>orElseGet()</em> —— 其行为略有不同。这个方法会在有值的时候返回值，如果没有值，它会执行作为参数传入的 <em>Supplier(供应者)</em> 函数式接口，并将返回其执行结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User result &#x3D; Optional.ofNullable(user).orElseGet( () -&gt; user2);</span><br></pre></td></tr></table></figure><h3 id="orElse-和-orElseGet-的不同之处"><a href="#orElse-和-orElseGet-的不同之处" class="headerlink" title="orElse() 和 orElseGet() 的不同之处"></a><strong><em>orElse()</em> 和 <em>orElseGet()</em> 的不同之处</strong></h3><p>乍一看，这两种方法似乎起着同样的作用。然而事实并非如此。我们创建一些示例来突出二者行为上的异同。</p><p>我们先来看看对象为空时他们的行为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void givenEmptyValue_whenCompare_thenOk() &#123;</span><br><span class="line">    User user &#x3D; null</span><br><span class="line">    logger.debug(&quot;Using orElse&quot;);</span><br><span class="line">    User result &#x3D; Optional.ofNullable(user).orElse(createNewUser());</span><br><span class="line">    logger.debug(&quot;Using orElseGet&quot;);</span><br><span class="line">    User result2 &#x3D; Optional.ofNullable(user).orElseGet(() -&gt; createNewUser());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private User createNewUser() &#123;</span><br><span class="line">    logger.debug(&quot;Creating New User&quot;);</span><br><span class="line">    return new User(&quot;extra@gmail.com&quot;, &quot;1234&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码中，两种方法都调用了 <em>createNewUser()</em> 方法，这个方法会记录一个消息并返回 <em>User</em> 对象。</p><p>代码输出如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Using orElse</span><br><span class="line">Creating New User</span><br><span class="line">Using orElseGet</span><br><span class="line">Creating New User</span><br></pre></td></tr></table></figure><p>由此可见，当对象为空而返回默认对象时，行为并无差异。</p><p>我们接下来看一个类似的示例，但这里 <em>Optional</em>  不为空：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void givenPresentValue_whenCompare_thenOk() &#123;</span><br><span class="line">    User user &#x3D; new User(&quot;john@gmail.com&quot;, &quot;1234&quot;);</span><br><span class="line">    logger.info(&quot;Using orElse&quot;);</span><br><span class="line">    User result &#x3D; Optional.ofNullable(user).orElse(createNewUser());</span><br><span class="line">    logger.info(&quot;Using orElseGet&quot;);</span><br><span class="line">    User result2 &#x3D; Optional.ofNullable(user).orElseGet(() -&gt; createNewUser());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这次的输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Using orElse</span><br><span class="line">Creating New User</span><br><span class="line">Using orElseGet</span><br></pre></td></tr></table></figure><p>这个示例中，两个 <em>Optional</em>  对象都包含非空值，两个方法都会返回对应的非空值。不过，<em>orElse()</em> 方法仍然创建了 <em>User</em> 对象。<strong>与之相反，<em>orElseGet()</em> 方法不创建 <em>User</em> 对象。</strong></p><p>在执行较密集的调用时，比如调用 Web 服务或数据查询，<strong>这个差异会对性能产生重大影响</strong>。</p><h2 id="返回异常"><a href="#返回异常" class="headerlink" title="返回异常"></a><strong>返回异常</strong></h2><p>除了 <em>orElse()</em> 和 <em>orElseGet()</em> 方法，Optional 还定义了 <em>orElseThrow()</em> API —— 它会在对象为空的时候抛出异常，而不是返回备选的值：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Test(expected &#x3D; IllegalArgumentException.class)</span><br><span class="line">public void whenThrowException_thenOk() &#123;</span><br><span class="line">    User result &#x3D; Optional.ofNullable(user)</span><br><span class="line">      .orElseThrow( () -&gt; new IllegalArgumentException());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里，如果 <em>user</em> 值为 null，会抛出 <em>IllegalArgumentException</em>。</p><p>这个方法让我们有更丰富的语义，可以决定抛出什么样的异常，而不总是抛出 <em>NullPointerException</em>。</p><p>现在我们已经很好地理解了如何使用 Optional，我们来看看其它可以对 <em>Optional</em> 值进行转换和过滤的方法。</p><h2 id="转换值和过滤值"><a href="#转换值和过滤值" class="headerlink" title="转换值和过滤值"></a><strong>转换值和过滤值</strong></h2><h3 id="转换值"><a href="#转换值" class="headerlink" title="转换值"></a><strong>转换值</strong></h3><p>有很多种方法可以转换 <em>Optional</em>  的值。我们从 <em>map()</em> 和 <em>flatMap()</em> 方法开始。</p><p>先来看一个使用 <em>map()</em> API 的例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenMap_thenOk() &#123;</span><br><span class="line">    User user &#x3D; new User(&quot;anna@gmail.com&quot;, &quot;1234&quot;);</span><br><span class="line">    String email &#x3D; Optional.ofNullable(user)</span><br><span class="line">      .map(u -&gt; u.getEmail()).orElse(&quot;default@gmail.com&quot;);</span><br><span class="line"></span><br><span class="line">    assertEquals(email, user.getEmail());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>map()</em> 对值应用(调用)作为参数的<em>函数</em>，然后将返回的值包装在 <em>Optional</em> 中。</strong>这就使对返回值进行链试调用的操作成为可能 —— 这里的下一环就是 *orElse()*。</p><p>相比这下，<em>flatMap()</em> 也需要<em>函数</em>作为参数，并对值调用这个函数，然后直接返回结果。</p><p>下面的操作中，我们给 <em>User</em> 类添加了一个方法，用来返回 <em>Optional</em>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">    private String position;</span><br><span class="line"></span><br><span class="line">    public Optional&lt;String&gt; getPosition() &#123;</span><br><span class="line">        return Optional.ofNullable(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>既然 getter 方法返回 String 值的 <em>Optional</em>，你可以在对 <em>User 的 Optional</em> 对象调用 <em>flatMap()</em> 时，用它作为参数。其返回的值是解除包装的 String 值：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenFlatMap_thenOk() &#123;</span><br><span class="line">    User user &#x3D; new User(&quot;anna@gmail.com&quot;, &quot;1234&quot;);</span><br><span class="line">    user.setPosition(&quot;Developer&quot;);</span><br><span class="line">    String position &#x3D; Optional.ofNullable(user)</span><br><span class="line">      .flatMap(u -&gt; u.getPosition()).orElse(&quot;default&quot;);</span><br><span class="line"></span><br><span class="line">    assertEquals(position, user.getPosition().get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="过滤值"><a href="#过滤值" class="headerlink" title="过滤值"></a><strong>过滤值</strong></h3><p>除了转换值之外，<em>Optional</em>  类也提供了按条件“过滤”值的方法。</p><p><strong><em>filter()</em> 接受一个 <em>Predicate</em> 参数</strong>，返回测试结果为 true 的值。如果测试结果为 false，会返回一个空的 <em>Optional</em>。</p><p>来看一个根据基本的电子邮箱验证来决定接受或拒绝 <em>User(用户)</em> 的示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenFilter_thenOk() &#123;</span><br><span class="line">    User user &#x3D; new User(&quot;anna@gmail.com&quot;, &quot;1234&quot;);</span><br><span class="line">    Optional&lt;User&gt; result &#x3D; Optional.ofNullable(user)</span><br><span class="line">      .filter(u -&gt; u.getEmail() !&#x3D; null &amp;&amp; u.getEmail().contains(&quot;@&quot;));</span><br><span class="line"></span><br><span class="line">    assertTrue(result.isPresent());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果通过过滤器测试，<em>result</em> 对象会包含非空值。</p><h2 id="Optional-类的链式方法"><a href="#Optional-类的链式方法" class="headerlink" title="Optional 类的链式方法"></a><strong><em>Optional</em> 类的链式方法</strong></h2><p>为了更充分的使用 <em>Optional</em>，你可以链接组合其大部分方法，因为它们都返回相同类似的对象。</p><p>我们使用 <em>Optional</em>  重写最早介绍的示例。</p><p>首先，重构类，使其 getter 方法返回 <em>Optional</em> 引用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">    private Address address;</span><br><span class="line"></span><br><span class="line">    public Optional&lt;Address&gt; getAddress() &#123;</span><br><span class="line">        return Optional.ofNullable(address);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br><span class="line">public class Address &#123;</span><br><span class="line">    private Country country;</span><br><span class="line"></span><br><span class="line">    public Optional&lt;Country&gt; getCountry() &#123;</span><br><span class="line">        return Optional.ofNullable(country);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的嵌套结构可以用下面的图来表示：</p><p><img src="https://images2017.cnblogs.com/blog/782702/201709/782702-20170923094507806-345950041.png" alt="https://images2017.cnblogs.com/blog/782702/201709/782702-20170923094507806-345950041.png"></p><p>现在可以删除 <em>null</em> 检查，替换为 <em>Optional</em> 的方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenChaining_thenOk() &#123;</span><br><span class="line">    User user &#x3D; new User(&quot;anna@gmail.com&quot;, &quot;1234&quot;);</span><br><span class="line"></span><br><span class="line">    String result &#x3D; Optional.ofNullable(user)</span><br><span class="line">      .flatMap(u -&gt; u.getAddress())</span><br><span class="line">      .flatMap(a -&gt; a.getCountry())</span><br><span class="line">      .map(c -&gt; c.getIsocode())</span><br><span class="line">      .orElse(&quot;default&quot;);</span><br><span class="line"></span><br><span class="line">    assertEquals(result, &quot;default&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码可以通过方法引用进一步缩减：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String result &#x3D; Optional.ofNullable(user)</span><br><span class="line">  .flatMap(User::getAddress)</span><br><span class="line">  .flatMap(Address::getCountry)</span><br><span class="line">  .map(Country::getIsocode)</span><br><span class="line">  .orElse(&quot;default&quot;);</span><br></pre></td></tr></table></figure><p>结果现在的代码看起来比之前采用条件分支的冗长代码简洁多了。</p><h2 id="Java-9-增强"><a href="#Java-9-增强" class="headerlink" title="Java 9 增强"></a><strong>Java 9 增强</strong></h2><p>我们介绍了 Java 8 的特性，<strong>Java 9 为 Optional 类添加了三个方法：<em>or()<em>、</em>ifPresentOrElse()</em> 和 *stream()*。</strong></p><p><em>or()</em> 方法与 <em>orElse()</em> 和 <em>orElseGet()</em> 类似，它们都在对象为空的时候提供了替代情况。<em>or()</em> 的返回值是由 <em>Supplier</em> 参数产生的另一个 <em>Optional</em> 对象。</p><p>如果对象包含值，则 Lambda 表达式不会执行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenEmptyOptional_thenGetValueFromOr() &#123;</span><br><span class="line">    User result &#x3D; Optional.ofNullable(user)</span><br><span class="line">      .or( () -&gt; Optional.of(new User(&quot;default&quot;,&quot;1234&quot;))).get();</span><br><span class="line"></span><br><span class="line">    assertEquals(result.getEmail(), &quot;default&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的示例中，如果 <em>user</em> 变量是 null，它会返回一个 <em>Optional</em>，它所包含的 <em>User</em> 对象，其电子邮件为 “default”。</p><p><em>ifPresentOrElse()</em> 方法需要两个参数：一个 <em>Consumer</em> 和一个 <em>Runnable</em>。如果对象包含值，会执行 <em>Consumer</em> 的动作，否则运行 <em>Runnable</em>。</p><p>如果你想在有值的时候执行某个动作，或者只是跟踪是否定义了某个值，那么这个方法非常有用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable(user).ifPresentOrElse( u -&gt; logger.info(&quot;User is:&quot; + u.getEmail()),</span><br><span class="line">  () -&gt; logger.info(&quot;User not found&quot;));</span><br></pre></td></tr></table></figure><p>最后介绍的是新的 <em>stream()</em> 方法，它<strong>通过把实例转换为 <em>Stream</em> 对象，</strong>让你从广大的 <em>Stream</em> API 中受益。如果没有值，它会得到空的 <em>Stream</em>；有值的情况下，<em>Stream</em> 则会包含单一值。</p><p>我们来看一个把 <em>Optional</em> 处理成 <em>Stream</em> 的例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenGetStream_thenOk() &#123;</span><br><span class="line">    User user &#x3D; new User(&quot;john@gmail.com&quot;, &quot;1234&quot;);</span><br><span class="line">    List&lt;String&gt; emails &#x3D; Optional.ofNullable(user)</span><br><span class="line">      .stream()</span><br><span class="line">      .filter(u -&gt; u.getEmail() !&#x3D; null &amp;&amp; u.getEmail().contains(&quot;@&quot;))</span><br><span class="line">      .map( u -&gt; u.getEmail())</span><br><span class="line">      .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    assertTrue(emails.size() &#x3D;&#x3D; 1);</span><br><span class="line">    assertEquals(emails.get(0), user.getEmail());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里对 <em>Stream</em> 的使用带来了其 <em>filter()、map()</em> 和 <em>collect()</em> 接口，以获取 <em>List</em>。</p><h2 id="Optional-应该怎样用？"><a href="#Optional-应该怎样用？" class="headerlink" title="Optional 应该怎样用？"></a><strong><em>Optional</em> 应该怎样用？</strong></h2><p>在使用 <em>Optional</em> 的时候需要考虑一些事情，以决定什么时候怎样使用它。</p><p>重要的一点是 <strong><em>Optional</em> 不是 <em>Serializable</em></strong>。因此，它不应该用作类的字段。</p><p>如果你需要序列化的对象包含 <em>Optional</em> 值，*<a href="https://stackify.com/java-xml-jackson/">Jackson* 库</a>支持把 <em>Optional</em> 当作普通对象。也就是说，<em>Jackson</em> 会把空对象看作 <em>null</em>，而有值的对象则把其值看作对应域的值。这个功能在 <a href="https://github.com/FasterXML/jackson-modules-java8">jackson-modules-java8</a> 项目中。</p><p>它在另一种情况下也并不怎么有用，就是在将其类型用作方法或构建方法的参数时。这样做会让代码变得复杂，完全没有必要：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User user &#x3D; new User(&quot;john@gmail.com&quot;, &quot;1234&quot;, Optional.empty());</span><br></pre></td></tr></table></figure><p>使用重载方法来处理非要的参数要容易得多。</p><p><strong><em>Optional</em> 主要用作返回类型。</strong>在获取到这个类型的实例后，如果它有值，你可以取得这个值，否则可以进行一些替代行为。</p><p><em>Optional</em> 类有一个非常有用的用例，就是将其与流或其它返回 <em>Optional</em> 的方法结合，以<strong>构建流畅的API</strong>。</p><p>我们来看一个示例，使用 <em>Stream</em> 返回 <em>Optional</em> 对象的 <em>findFirst()</em> 方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void whenEmptyStream_thenReturnDefaultOptional() &#123;</span><br><span class="line">    List&lt;User&gt; users &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">    User user &#x3D; users.stream().findFirst().orElse(new User(&quot;default&quot;, &quot;1234&quot;));</span><br><span class="line"></span><br><span class="line">    assertEquals(user.getEmail(), &quot;default&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><p><em>Optional</em> 是 Java 语言的有益补充 —— 它旨在减少代码中的 <em>NullPointerExceptions</em>，虽然还不能完全消除这些异常。</p><p>它也是精心设计，自然融入 Java 8 函数式支持的功能。</p><p>总的来说，这个简单而强大的类有助于创建简单、可读性更强、比对应程序错误更少的程序。</p>]]></content>
      
      
      <categories>
          
          <category> jdk8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 新特性 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 Stream</title>
      <link href="/2020/10/14/Java8%20Stream%EF%BC%9A2%E4%B8%87%E5%AD%9720%E4%B8%AA%E5%AE%9E%E4%BE%8B%EF%BC%8C%E7%8E%A9%E8%BD%AC%E9%9B%86%E5%90%88%E7%9A%84%E7%AD%9B%E9%80%89%E3%80%81%E5%BD%92%E7%BA%A6%E3%80%81%E5%88%86%E7%BB%84%E3%80%81%E8%81%9A%E5%90%88%208f8fb566f7f94c8c9d6fe53603b461e7/"/>
      <url>/2020/10/14/Java8%20Stream%EF%BC%9A2%E4%B8%87%E5%AD%9720%E4%B8%AA%E5%AE%9E%E4%BE%8B%EF%BC%8C%E7%8E%A9%E8%BD%AC%E9%9B%86%E5%90%88%E7%9A%84%E7%AD%9B%E9%80%89%E3%80%81%E5%BD%92%E7%BA%A6%E3%80%81%E5%88%86%E7%BB%84%E3%80%81%E8%81%9A%E5%90%88%208f8fb566f7f94c8c9d6fe53603b461e7/</url>
      
        <content type="html"><![CDATA[<p>blog.csdn.net/mu_wind/article/details/109516995</p><p><a href="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxLfiaDrpVicXB9IRHibwib8ahP8StxILIwao9J1nG13d1E76ZNaB3domqiaw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1">https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxLfiaDrpVicXB9IRHibwib8ahP8StxILIwao9J1nG13d1E76ZNaB3domqiaw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1</a></p><p>先贴上几个案例，水平高超的同学可以挑战一下：</p><ol><li>从员工集合中筛选出salary大于8000的员工，并放置到新的集合里。</li><li>统计员工的最高薪资、平均薪资、薪资之和。</li><li>将员工按薪资从高到低排序，同样薪资者年龄小者在前。</li><li>将员工按性别分类，将员工按性别和地区分类，将员工按薪资是否高于8000分为两部分。</li></ol><p>用传统的迭代处理也不是很难，但代码就显得冗余了，跟Stream相比高下立判。Java 8 是一个非常成功的版本，这个版本新增的<code>Stream</code>，配合同版本出现的 <code>Lambda</code> ，给我们操作集合（Collection）提供了极大的便利。</p><h2 id="1-那么什么是Stream"><a href="#1-那么什么是Stream" class="headerlink" title="1. 那么什么是Stream"></a>1. <strong>那么什么是Stream</strong></h2><p><code>Stream</code>将要处理的元素集合看作一种流，在流的过程中，借助<code>Stream API</code>对流中的元素进行操作，比如：筛选、排序、聚合等。</p><p><code>Stream</code>可以由数组或集合创建，对流的操作分为两种：</p><ol><li>中间操作，每次返回一个新的流，可以有多个。</li><li>终端操作，每个流只能进行一次终端操作，终端操作结束后流无法再次使用。终端操作会产生一个新的集合或值。</li></ol><p>另外，<code>Stream</code>有几个特性：</p><ol><li>stream不存储数据，而是按照特定的规则对数据进行计算，一般会输出结果。</li><li>stream不会改变数据源，通常情况下会产生一个新的集合或一个值。</li><li>stream具有延迟执行特性，只有调用终端操作时，中间操作才会执行。</li></ol><h2 id="2-Stream的创建"><a href="#2-Stream的创建" class="headerlink" title="2. Stream的创建"></a><strong>2. Stream的创建</strong></h2><p><code>Stream</code>可以通过集合数组创建。</p><p>1、通过 <code>java.util.Collection.stream()</code> 方法用集合创建流</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list &#x3D; Arrays.asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);</span><br><span class="line">&#x2F;&#x2F; 创建一个顺序流</span><br><span class="line">Stream&lt;String&gt; stream &#x3D; list.stream();</span><br><span class="line">&#x2F;&#x2F; 创建一个并行流</span><br><span class="line">Stream&lt;String&gt; parallelStream &#x3D; list.parallelStream();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2、使用<code>java.util.Arrays.stream(T[] array)</code>方法用数组创建流</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int[] array&#x3D;&#123;1,3,5,6,8&#125;;</span><br><span class="line">IntStream stream &#x3D; Arrays.stream(array);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3、使用<code>Stream</code>的静态方法：<code>of()、iterate()、generate()</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; stream &#x3D; Stream.of(1, 2, 3, 4, 5, 6);</span><br><span class="line"></span><br><span class="line">Stream&lt;Integer&gt; stream2 &#x3D; Stream.iterate(0, (x) -&gt; x + 3).limit(4);</span><br><span class="line">stream2.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">Stream&lt;Double&gt; stream3 &#x3D; Stream.generate(Math::random).limit(3);</span><br><span class="line">stream3.forEach(System.out::println);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><blockquote><p>0 3 6 9 0.6796156909271994 0.1914314208854283 0.8116932592396652</p></blockquote><p><strong><code>stream</code>和<code>parallelStream</code>的简单区分：</strong> <code>stream</code>是顺序流，由主线程按顺序对流执行操作，而<code>parallelStream</code>是并行流，内部以多线程并行执行的方式对流进行操作，但前提是流中的数据处理没有顺序要求。例如筛选集合中的奇数，两者的处理不同之处：</p><p><a href="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxv7ia3b9wP4mZicicEp4YFdA7oHkaA8Uj4RLGo4xkhj5ypiaVYHM9pjXKpA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1">https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxv7ia3b9wP4mZicicEp4YFdA7oHkaA8Uj4RLGo4xkhj5ypiaVYHM9pjXKpA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1</a></p><p>如果流中的数据量足够大，并行流可以加快处速度。除了直接创建并行流，还可以通过<code>parallel()</code>把顺序流转换成并行流：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Integer&gt; findFirst &#x3D; list.stream().parallel().filter(x-&gt;x&gt;6).findFirst();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在使用stream之前，先理解一个概念：<code>Optional</code> 。</p><blockquote><p>Optional类是一个可以为null的容器对象。如果值存在则isPresent()方法会返回true，调用get()方法会返回该对象。更详细说明请见：菜鸟教程Java 8 Optional类</p></blockquote><p><strong>接下来，大批代码向你袭来！我将用20个案例将Stream的使用整得明明白白，只要跟着敲一遍代码，就能很好地掌握。</strong></p><p><a href="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==">data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==</a></p><h2 id="3-案例使用的员工类"><a href="#3-案例使用的员工类" class="headerlink" title="3. 案例使用的员工类"></a><strong>3. 案例使用的员工类</strong></h2><p>这是后面案例中使用的员工类：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line">personList.add(new Person(&quot;Tom&quot;, 8900, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">personList.add(new Person(&quot;Jack&quot;, 7000, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">personList.add(new Person(&quot;Lily&quot;, 7800, &quot;female&quot;, &quot;Washington&quot;));</span><br><span class="line">personList.add(new Person(&quot;Anni&quot;, 8200, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line">personList.add(new Person(&quot;Owen&quot;, 9500, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">personList.add(new Person(&quot;Alisa&quot;, 7900, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line"></span><br><span class="line">class Person &#123;</span><br><span class="line">  private String name;&#x2F;&#x2F; 姓名</span><br><span class="line">  private int salary;&#x2F;&#x2F; 薪资</span><br><span class="line">  private int age;&#x2F;&#x2F; 年龄</span><br><span class="line">  private String sex;&#x2F;&#x2F;性别</span><br><span class="line">  private String area;&#x2F;&#x2F; 地区</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 构造方法</span><br><span class="line">  public Person(String name, int salary, int age,String sex,String area) &#123;</span><br><span class="line">    this.name &#x3D; name;</span><br><span class="line">    this.salary &#x3D; salary;</span><br><span class="line">    this.age &#x3D; age;</span><br><span class="line">    this.sex &#x3D; sex;</span><br><span class="line">    this.area &#x3D; area;</span><br><span class="line">  &#125;</span><br><span class="line">&#x2F;&#x2F; 省略了get和set，请自行添加</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-1-遍历-匹配（foreach-find-match）"><a href="#3-1-遍历-匹配（foreach-find-match）" class="headerlink" title="3.1 遍历/匹配（foreach/find/match）"></a><strong><em>3.1 遍历/匹配（foreach/find/match）</em></strong></h2><p><code>Stream</code>也是支持类似集合的遍历和匹配元素的，只是<code>Stream</code>中的元素是以<code>Optional</code>类型存在的。<code>Stream</code>的遍历、匹配非常简单。</p><p><a href="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==">data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; import已省略，请自行添加，后面代码亦是</span><br><span class="line"></span><br><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;Integer&gt; list &#x3D; Arrays.asList(7, 6, 9, 3, 8, 2, 1);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 遍历输出符合条件的元素</span><br><span class="line">        list.stream().filter(x -&gt; x &gt; 6).forEach(System.out::println);</span><br><span class="line">&#x2F;&#x2F; 匹配第一个</span><br><span class="line">        Optional&lt;Integer&gt; findFirst &#x3D; list.stream().filter(x -&gt; x &gt; 6).findFirst();</span><br><span class="line">&#x2F;&#x2F; 匹配任意（适用于并行流）</span><br><span class="line">        Optional&lt;Integer&gt; findAny &#x3D; list.parallelStream().filter(x -&gt; x &gt; 6).findAny();</span><br><span class="line">&#x2F;&#x2F; 是否包含符合特定条件的元素</span><br><span class="line">        boolean anyMatch &#x3D; list.stream().anyMatch(x -&gt; x &lt; 6);</span><br><span class="line">        System.out.println(&quot;匹配第一个值：&quot; + findFirst.get());</span><br><span class="line">        System.out.println(&quot;匹配任意一个值：&quot; + findAny.get());</span><br><span class="line">        System.out.println(&quot;是否存在大于6的值：&quot; + anyMatch);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-2-筛选（filter）"><a href="#3-2-筛选（filter）" class="headerlink" title="3.2 筛选（filter）"></a><strong><em>3.2 筛选（filter）</em></strong></h2><p>筛选，是按照一定的规则校验流中的元素，将符合条件的元素提取到新的流中的操作。</p><p><a href="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==">data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==</a></p><h3 id="案例一：筛选出Integer集合中大于7的元素，并打印出来"><a href="#案例一：筛选出Integer集合中大于7的元素，并打印出来" class="headerlink" title="案例一：筛选出Integer集合中大于7的元素，并打印出来"></a><strong><strong>案例一：筛选出<code>Integer</code>集合中大于7的元素，并打印出来</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Integer&gt; list &#x3D; Arrays.asList(6, 7, 3, 8, 1, 2, 9);</span><br><span class="line">    Stream&lt;Integer&gt; stream &#x3D; list.stream();</span><br><span class="line">    stream.filter(x -&gt; x &gt; 7).forEach(System.out::println);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>预期结果：</p><blockquote><p>8 9</p></blockquote><h3 id="案例二：筛选员工中工资高于8000的人，并形成新的集合。形成新集合依赖collect（收集），后文有详细介绍。"><a href="#案例二：筛选员工中工资高于8000的人，并形成新的集合。形成新集合依赖collect（收集），后文有详细介绍。" class="headerlink" title="案例二：筛选员工中工资高于8000的人，并形成新的集合。形成新集合依赖collect（收集），后文有详细介绍。"></a><strong><strong>案例二：筛选员工中工资高于8000的人，并形成新的集合。形成新集合依赖<code>collect</code>（收集），后文有详细介绍。</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line">    personList.add(new Person(&quot;Tom&quot;, 8900, 23, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Jack&quot;, 7000, 25, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Lily&quot;, 7800, 21, &quot;female&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Anni&quot;, 8200, 24, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Owen&quot;, 9500, 25, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Alisa&quot;, 7900, 26, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; fiterList &#x3D; personList.stream().filter(x -&gt; x.getSalary() &gt; 8000).map(Person::getName)</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">    System.out.print(&quot;高于8000的员工姓名：&quot; + fiterList);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><p>高于8000的员工姓名：[Tom, Anni, Owen]</p></blockquote><h2 id="3-3-聚合（max-min-count"><a href="#3-3-聚合（max-min-count" class="headerlink" title="3.3 聚合（max/min/count)"></a><strong><em>3.3 聚合（max/min/count)</em></strong></h2><p><code>max</code>、<code>min</code>、<code>count</code>这些字眼你一定不陌生，没错，在mysql中我们常用它们进行数据统计。Java stream中也引入了这些概念和用法，极大地方便了我们对集合、数组的数据统计工作。</p><p><a href="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==">data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==</a></p><h3 id="案例一：获取String集合中最长的元素。"><a href="#案例一：获取String集合中最长的元素。" class="headerlink" title="案例一：获取String集合中最长的元素。"></a><strong><strong>案例一：获取<code>String</code>集合中最长的元素。</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;String&gt; list &#x3D; Arrays.asList(&quot;adnm&quot;, &quot;admmt&quot;, &quot;pot&quot;, &quot;xbangd&quot;, &quot;weoujgsd&quot;);</span><br><span class="line"></span><br><span class="line">    Optional&lt;String&gt; max &#x3D; list.stream().max(Comparator.comparing(String::length));</span><br><span class="line">    System.out.println(&quot;最长的字符串：&quot; + max.get());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><blockquote><p>最长的字符串：weoujgsd</p></blockquote><h3 id="案例二：获取Integer集合中的最大值。"><a href="#案例二：获取Integer集合中的最大值。" class="headerlink" title="案例二：获取Integer集合中的最大值。"></a><strong><strong>案例二：获取<code>Integer</code>集合中的最大值。</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Integer&gt; list &#x3D; Arrays.asList(7, 6, 9, 4, 11, 6);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 自然排序</span><br><span class="line">    Optional&lt;Integer&gt; max &#x3D; list.stream().max(Integer::compareTo);</span><br><span class="line">&#x2F;&#x2F; 自定义排序</span><br><span class="line">    Optional&lt;Integer&gt; max2 &#x3D; list.stream().max(new Comparator&lt;Integer&gt;() &#123;</span><br><span class="line">      @Override</span><br><span class="line">      public int compare(Integer o1, Integer o2) &#123;</span><br><span class="line">        return o1.compareTo(o2);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(&quot;自然排序的最大值：&quot; + max.get());</span><br><span class="line">    System.out.println(&quot;自定义排序的最大值：&quot; + max2.get());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><blockquote><p>自然排序的最大值：11 自定义排序的最大值：11</p></blockquote><h3 id="案例三：获取员工工资最高的人。"><a href="#案例三：获取员工工资最高的人。" class="headerlink" title="案例三：获取员工工资最高的人。"></a><strong><strong>案例三：获取员工工资最高的人。</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line">    personList.add(new Person(&quot;Tom&quot;, 8900, 23, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Jack&quot;, 7000, 25, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Lily&quot;, 7800, 21, &quot;female&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Anni&quot;, 8200, 24, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Owen&quot;, 9500, 25, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Alisa&quot;, 7900, 26, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line"></span><br><span class="line">    Optional&lt;Person&gt; max &#x3D; personList.stream().max(Comparator.comparingInt(Person::getSalary));</span><br><span class="line">    System.out.println(&quot;员工工资最大值：&quot; + max.get().getSalary());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><blockquote><p>员工工资最大值：9500</p></blockquote><h3 id="案例四：计算Integer集合中大于6的元素的个数。"><a href="#案例四：计算Integer集合中大于6的元素的个数。" class="headerlink" title="案例四：计算Integer集合中大于6的元素的个数。"></a><strong><strong>案例四：计算<code>Integer</code>集合中大于6的元素的个数。</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Integer&gt; list &#x3D; Arrays.asList(7, 6, 4, 8, 2, 11, 9);</span><br><span class="line"></span><br><span class="line">    long count &#x3D; list.stream().filter(x -&gt; x &gt; 6).count();</span><br><span class="line">    System.out.println(&quot;list中大于6的元素个数：&quot; + count);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><blockquote><p>list中大于6的元素个数：4</p></blockquote><h2 id="3-4-映射-map-flatMap"><a href="#3-4-映射-map-flatMap" class="headerlink" title="3.4 映射(map/flatMap)"></a><strong><em>3.4 映射(map/flatMap)</em></strong></h2><p>映射，可以将一个流的元素按照一定的映射规则映射到另一个流中。分为<code>map</code>和<code>flatMap</code>：</p><ul><li><code>map</code>：接收一个函数作为参数，该函数会被应用到每个元素上，并将其映射成一个新的元素。</li><li><code>flatMap</code>：接收一个函数作为参数，将流中的每个值都换成另一个流，然后把所有流连接成一个流。</li></ul><p><a href="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==">data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==</a></p><p><a href="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==">data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==</a></p><h3 id="案例一：英文字符串数组的元素全部改为大写。整数数组每个元素-3。"><a href="#案例一：英文字符串数组的元素全部改为大写。整数数组每个元素-3。" class="headerlink" title="案例一：英文字符串数组的元素全部改为大写。整数数组每个元素+3。"></a><strong><strong>案例一：英文字符串数组的元素全部改为大写。整数数组每个元素+3。</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    String[] strArr &#x3D; &#123; &quot;abcd&quot;, &quot;bcdd&quot;, &quot;defde&quot;, &quot;fTr&quot; &#125;;</span><br><span class="line">    List&lt;String&gt; strList &#x3D; Arrays.stream(strArr).map(String::toUpperCase).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    List&lt;Integer&gt; intList &#x3D; Arrays.asList(1, 3, 5, 7, 9, 11);</span><br><span class="line">    List&lt;Integer&gt; intListNew &#x3D; intList.stream().map(x -&gt; x + 3).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;每个元素大写：&quot; + strList);</span><br><span class="line">    System.out.println(&quot;每个元素+3：&quot; + intListNew);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><blockquote><p>每个元素大写：[ABCD, BCDD, DEFDE, FTR] 每个元素+3：[4, 6, 8, 10, 12, 14]</p></blockquote><h3 id="案例二：将员工的薪资全部增加1000。"><a href="#案例二：将员工的薪资全部增加1000。" class="headerlink" title="案例二：将员工的薪资全部增加1000。"></a><strong><strong>案例二：将员工的薪资全部增加1000。</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line">    personList.add(new Person(&quot;Tom&quot;, 8900, 23, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Jack&quot;, 7000, 25, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Lily&quot;, 7800, 21, &quot;female&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Anni&quot;, 8200, 24, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Owen&quot;, 9500, 25, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Alisa&quot;, 7900, 26, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 不改变原来员工集合的方式</span><br><span class="line">    List&lt;Person&gt; personListNew &#x3D; personList.stream().map(person -&gt; &#123;</span><br><span class="line">      Person personNew &#x3D; new Person(person.getName(), 0, 0, null, null);</span><br><span class="line">      personNew.setSalary(person.getSalary() + 10000);</span><br><span class="line">      return personNew;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    System.out.println(&quot;一次改动前：&quot; + personList.get(0).getName() + &quot;--&gt;&quot; + personList.get(0).getSalary());</span><br><span class="line">    System.out.println(&quot;一次改动后：&quot; + personListNew.get(0).getName() + &quot;--&gt;&quot; + personListNew.get(0).getSalary());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 改变原来员工集合的方式</span><br><span class="line">    List&lt;Person&gt; personListNew2 &#x3D; personList.stream().map(person -&gt; &#123;</span><br><span class="line">      person.setSalary(person.getSalary() + 10000);</span><br><span class="line">      return person;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    System.out.println(&quot;二次改动前：&quot; + personList.get(0).getName() + &quot;--&gt;&quot; + personListNew.get(0).getSalary());</span><br><span class="line">    System.out.println(&quot;二次改动后：&quot; + personListNew2.get(0).getName() + &quot;--&gt;&quot; + personListNew.get(0).getSalary());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><blockquote><p>一次改动前：Tom–&gt;8900 一次改动后：Tom–&gt;18900 二次改动前：Tom–&gt;18900 二次改动后：Tom–&gt;18900</p></blockquote><h3 id="案例三：将两个字符数组合并成一个新的字符数组。"><a href="#案例三：将两个字符数组合并成一个新的字符数组。" class="headerlink" title="案例三：将两个字符数组合并成一个新的字符数组。"></a><strong><strong>案例三：将两个字符数组合并成一个新的字符数组。</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;String&gt; list &#x3D; Arrays.asList(&quot;m,k,l,a&quot;, &quot;1,3,5,7&quot;);</span><br><span class="line">    List&lt;String&gt; listNew &#x3D; list.stream().flatMap(s -&gt; &#123;</span><br><span class="line">&#x2F;&#x2F; 将每个元素转换成一个stream</span><br><span class="line">      String[] split &#x3D; s.split(&quot;,&quot;);</span><br><span class="line">      Stream&lt;String&gt; s2 &#x3D; Arrays.stream(split);</span><br><span class="line">      return s2;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;处理前的集合：&quot; + list);</span><br><span class="line">    System.out.println(&quot;处理后的集合：&quot; + listNew);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><blockquote><p>处理前的集合：[m-k-l-a, 1-3-5] 处理后的集合：[m, k, l, a, 1, 3, 5]</p></blockquote><h2 id="3-5-归约-reduce"><a href="#3-5-归约-reduce" class="headerlink" title="3.5 归约(reduce)"></a><strong><em>3.5 归约(reduce)</em></strong></h2><p>归约，也称缩减，顾名思义，是把一个流缩减成一个值，能实现对集合求和、求乘积和求最值操作。</p><p><a href="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxm1sibbFxD2NKcicHpgzJwibWTK87YxJ1En5F9IY4zphhqzdqgkMWibTmWQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1">https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxm1sibbFxD2NKcicHpgzJwibWTK87YxJ1En5F9IY4zphhqzdqgkMWibTmWQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1</a></p><h3 id="案例一：求Integer集合的元素之和、乘积和最大值。"><a href="#案例一：求Integer集合的元素之和、乘积和最大值。" class="headerlink" title="案例一：求Integer集合的元素之和、乘积和最大值。"></a><strong><strong>案例一：求<code>Integer</code>集合的元素之和、乘积和最大值。</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Integer&gt; list &#x3D; Arrays.asList(1, 3, 2, 8, 11, 4);</span><br><span class="line">&#x2F;&#x2F; 求和方式1</span><br><span class="line">    Optional&lt;Integer&gt; sum &#x3D; list.stream().reduce((x, y) -&gt; x + y);</span><br><span class="line">&#x2F;&#x2F; 求和方式2</span><br><span class="line">    Optional&lt;Integer&gt; sum2 &#x3D; list.stream().reduce(Integer::sum);</span><br><span class="line">&#x2F;&#x2F; 求和方式3</span><br><span class="line">    Integer sum3 &#x3D; list.stream().reduce(0, Integer::sum);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 求乘积</span><br><span class="line">    Optional&lt;Integer&gt; product &#x3D; list.stream().reduce((x, y) -&gt; x * y);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 求最大值方式1</span><br><span class="line">    Optional&lt;Integer&gt; max &#x3D; list.stream().reduce((x, y) -&gt; x &gt; y ? x : y);</span><br><span class="line">&#x2F;&#x2F; 求最大值写法2</span><br><span class="line">    Integer max2 &#x3D; list.stream().reduce(1, Integer::max);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;list求和：&quot; + sum.get() + &quot;,&quot; + sum2.get() + &quot;,&quot; + sum3);</span><br><span class="line">    System.out.println(&quot;list求积：&quot; + product.get());</span><br><span class="line">    System.out.println(&quot;list求和：&quot; + max.get() + &quot;,&quot; + max2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><blockquote><p>list求和：29,29,29 list求积：2112 list求和：11,11</p></blockquote><h3 id="案例二：求所有员工的工资之和和最高工资。"><a href="#案例二：求所有员工的工资之和和最高工资。" class="headerlink" title="案例二：求所有员工的工资之和和最高工资。"></a><strong><strong>案例二：求所有员工的工资之和和最高工资。</strong></strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line">    personList.add(new Person(&quot;Tom&quot;, 8900, 23, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Jack&quot;, 7000, 25, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Lily&quot;, 7800, 21, &quot;female&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Anni&quot;, 8200, 24, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Owen&quot;, 9500, 25, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Alisa&quot;, 7900, 26, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 求工资之和方式1：</span><br><span class="line">    Optional&lt;Integer&gt; sumSalary &#x3D; personList.stream().map(Person::getSalary).reduce(Integer::sum);</span><br><span class="line">&#x2F;&#x2F; 求工资之和方式2：</span><br><span class="line">    Integer sumSalary2 &#x3D; personList.stream().reduce(0, (sum, p) -&gt; sum +&#x3D; p.getSalary(),</span><br><span class="line">        (sum1, sum2) -&gt; sum1 + sum2);</span><br><span class="line">&#x2F;&#x2F; 求工资之和方式3：</span><br><span class="line">    Integer sumSalary3 &#x3D; personList.stream().reduce(0, (sum, p) -&gt; sum +&#x3D; p.getSalary(), Integer::sum);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 求最高工资方式1：</span><br><span class="line">    Integer maxSalary &#x3D; personList.stream().reduce(0, (max, p) -&gt; max &gt; p.getSalary() ? max : p.getSalary(),</span><br><span class="line">        Integer::max);</span><br><span class="line">&#x2F;&#x2F; 求最高工资方式2：</span><br><span class="line">    Integer maxSalary2 &#x3D; personList.stream().reduce(0, (max, p) -&gt; max &gt; p.getSalary() ? max : p.getSalary(),</span><br><span class="line">        (max1, max2) -&gt; max1 &gt; max2 ? max1 : max2);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;工资之和：&quot; + sumSalary.get() + &quot;,&quot; + sumSalary2 + &quot;,&quot; + sumSalary3);</span><br><span class="line">    System.out.println(&quot;最高工资：&quot; + maxSalary + &quot;,&quot; + maxSalary2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><blockquote><p>工资之和：49300,49300,49300 最高工资：9500,9500</p></blockquote><h2 id="3-6-收集-collect"><a href="#3-6-收集-collect" class="headerlink" title="3.6 收集(collect)"></a><strong><em>3.6 收集(collect)</em></strong></h2><p><code>collect</code>，收集，可以说是内容最繁多、功能最丰富的部分了。从字面上去理解，就是把一个流收集起来，最终可以是收集成一个值也可以收集成一个新的集合。</p><blockquote><p>collect主要依赖java.util.stream.Collectors类内置的静态方法。</p></blockquote><h3 id="3-6-1-归集-toList-toSet-toMap"><a href="#3-6-1-归集-toList-toSet-toMap" class="headerlink" title="3.6.1 归集(toList/toSet/toMap)"></a><strong><strong>3.6.1 归集(toList/toSet/toMap)</strong></strong></h3><p>因为流不存储数据，那么在流中的数据完成处理后，需要将流中的数据重新归集到新的集合里。<code>toList</code>、<code>toSet</code>和<code>toMap</code>比较常用，另外还有<code>toCollection</code>、<code>toConcurrentMap</code>等复杂一些的用法。</p><p>下面用一个案例演示<code>toList</code>、<code>toSet</code>和<code>toMap</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Integer&gt; list &#x3D; Arrays.asList(1, 6, 3, 4, 6, 7, 9, 6, 20);</span><br><span class="line">    List&lt;Integer&gt; listNew &#x3D; list.stream().filter(x -&gt; x % 2 &#x3D;&#x3D; 0).collect(Collectors.toList());</span><br><span class="line">    Set&lt;Integer&gt; set &#x3D; list.stream().filter(x -&gt; x % 2 &#x3D;&#x3D; 0).collect(Collectors.toSet());</span><br><span class="line"></span><br><span class="line">    List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line">    personList.add(new Person(&quot;Tom&quot;, 8900, 23, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Jack&quot;, 7000, 25, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Lily&quot;, 7800, 21, &quot;female&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Anni&quot;, 8200, 24, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line"></span><br><span class="line">    Map&lt;?, Person&gt; map &#x3D; personList.stream().filter(p -&gt; p.getSalary() &gt; 8000)</span><br><span class="line">        .collect(Collectors.toMap(Person::getName, p -&gt; p));</span><br><span class="line">    System.out.println(&quot;toList:&quot; + listNew);</span><br><span class="line">    System.out.println(&quot;toSet:&quot; + set);</span><br><span class="line">    System.out.println(&quot;toMap:&quot; + map);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><p>toList：[6, 4, 6, 6, 20] toSet：[4, 20, 6] toMap：{Tom=mutest.Person@5fd0d5ae, Anni=mutest.Person@2d98a335}</p></blockquote><h3 id="3-6-2-统计-count-averaging"><a href="#3-6-2-统计-count-averaging" class="headerlink" title="3.6.2 统计(count/averaging)"></a><strong><strong>3.6.2 统计(count/averaging)</strong></strong></h3><p><code>Collectors</code>提供了一系列用于数据统计的静态方法：</p><ul><li>计数：<code>count</code></li><li>平均值：<code>averagingInt</code>、<code>averagingLong</code>、<code>averagingDouble</code></li><li>最值：<code>maxBy</code>、<code>minBy</code></li><li>求和：<code>summingInt</code>、<code>summingLong</code>、<code>summingDouble</code></li><li>统计以上所有：<code>summarizingInt</code>、<code>summarizingLong</code>、<code>summarizingDouble</code></li></ul><h4 id="案例：统计员工人数、平均工资、工资总额、最高工资。"><a href="#案例：统计员工人数、平均工资、工资总额、最高工资。" class="headerlink" title="*案例：统计员工人数、平均工资、工资总额、最高工资。**"></a>*<strong>案例：统计员工人数、平均工资、工资总额、最高工资。**</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line">    personList.add(new Person(&quot;Tom&quot;, 8900, 23, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Jack&quot;, 7000, 25, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Lily&quot;, 7800, 21, &quot;female&quot;, &quot;Washington&quot;));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 求总数</span><br><span class="line">    Long count &#x3D; personList.stream().collect(Collectors.counting());</span><br><span class="line">&#x2F;&#x2F; 求平均工资</span><br><span class="line">    Double average &#x3D; personList.stream().collect(Collectors.averagingDouble(Person::getSalary));</span><br><span class="line">&#x2F;&#x2F; 求最高工资</span><br><span class="line">    Optional&lt;Integer&gt; max &#x3D; personList.stream().map(Person::getSalary).collect(Collectors.maxBy(Integer::compare));</span><br><span class="line">&#x2F;&#x2F; 求工资之和</span><br><span class="line">    Integer sum &#x3D; personList.stream().collect(Collectors.summingInt(Person::getSalary));</span><br><span class="line">&#x2F;&#x2F; 一次性统计所有信息</span><br><span class="line">    DoubleSummaryStatistics collect &#x3D; personList.stream().collect(Collectors.summarizingDouble(Person::getSalary));</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;员工总数：&quot; + count);</span><br><span class="line">    System.out.println(&quot;员工平均工资：&quot; + average);</span><br><span class="line">    System.out.println(&quot;员工工资总和：&quot; + sum);</span><br><span class="line">    System.out.println(&quot;员工工资所有统计：&quot; + collect);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><p>员工总数：3 员工平均工资：7900.0 员工工资总和：23700 员工工资所有统计：DoubleSummaryStatistics{count=3, sum=23700.000000,min=7000.000000, average=7900.000000, max=8900.000000}</p></blockquote><h3 id="3-6-3-分组-partitioningBy-groupingBy"><a href="#3-6-3-分组-partitioningBy-groupingBy" class="headerlink" title="3.6.3 分组(partitioningBy/groupingBy)"></a><strong><strong>3.6.3 分组(partitioningBy/groupingBy)</strong></strong></h3><ul><li>分区：将<code>stream</code>按条件分为两个<code>Map</code>，比如员工按薪资是否高于8000分为两部分。</li><li>分组：将集合分为多个Map，比如员工按性别分组。有单级分组和多级分组。</li></ul><p><a href="https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxxgc7mS7KDrhxYeVEibrWib25icv7Q7gzK3U2sTdZnibsl07Hicebsh2HQfQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1">https://mmbiz.qpic.cn/mmbiz_png/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxxgc7mS7KDrhxYeVEibrWib25icv7Q7gzK3U2sTdZnibsl07Hicebsh2HQfQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1</a></p><h4 id="案例：将员工按薪资是否高于8000分为两部分；将员工按性别和地区分组"><a href="#案例：将员工按薪资是否高于8000分为两部分；将员工按性别和地区分组" class="headerlink" title="案例：将员工按薪资是否高于8000分为两部分；将员工按性别和地区分组"></a><strong><strong><em>案例：将员工按薪资是否高于8000分为两部分；将员工按性别和地区分组</em></strong></strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line">    personList.add(new Person(&quot;Tom&quot;, 8900, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Jack&quot;, 7000, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Lily&quot;, 7800, &quot;female&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Anni&quot;, 8200, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Owen&quot;, 9500, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Alisa&quot;, 7900, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 将员工按薪资是否高于8000分组</span><br><span class="line">        Map&lt;Boolean, List&lt;Person&gt;&gt; part &#x3D; personList.stream().collect(Collectors.partitioningBy(x -&gt; x.getSalary() &gt; 8000));</span><br><span class="line">&#x2F;&#x2F; 将员工按性别分组</span><br><span class="line">        Map&lt;String, List&lt;Person&gt;&gt; group &#x3D; personList.stream().collect(Collectors.groupingBy(Person::getSex));</span><br><span class="line">&#x2F;&#x2F; 将员工先按性别分组，再按地区分组</span><br><span class="line">        Map&lt;String, Map&lt;String, List&lt;Person&gt;&gt;&gt; group2 &#x3D; personList.stream().collect(Collectors.groupingBy(Person::getSex, Collectors.groupingBy(Person::getArea)));</span><br><span class="line">        System.out.println(&quot;员工按薪资是否大于8000分组情况：&quot; + part);</span><br><span class="line">        System.out.println(&quot;员工按性别分组情况：&quot; + group);</span><br><span class="line">        System.out.println(&quot;员工按性别、地区：&quot; + group2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">员工按薪资是否大于8000分组情况：&#123;false&#x3D;[mutest.Person@2d98a335, mutest.Person@16b98e56, mutest.Person@7ef20235], true&#x3D;[mutest.Person@27d6c5e0, mutest.Person@4f3f5b24, mutest.Person@15aeb7ab]&#125;</span><br><span class="line">员工按性别分组情况：&#123;female&#x3D;[mutest.Person@16b98e56, mutest.Person@4f3f5b24, mutest.Person@7ef20235], male&#x3D;[mutest.Person@27d6c5e0, mutest.Person@2d98a335, mutest.Person@15aeb7ab]&#125;</span><br><span class="line">员工按性别、地区：&#123;female&#x3D;&#123;New York&#x3D;[mutest.Person@4f3f5b24, mutest.Person@7ef20235], Washington&#x3D;[mutest.Person@16b98e56]&#125;, male&#x3D;&#123;New York&#x3D;[mutest.Person@27d6c5e0, mutest.Person@15aeb7ab], Washington&#x3D;[mutest.Person@2d98a335]&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-6-4-接合-joining"><a href="#3-6-4-接合-joining" class="headerlink" title="3.6.4 接合(joining)"></a><strong><strong>3.6.4 接合(joining)</strong></strong></h3><p><code>joining</code>可以将stream中的元素用特定的连接符（没有的话，则直接连接）连接成一个字符串。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line">    personList.add(new Person(&quot;Tom&quot;, 8900, 23, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Jack&quot;, 7000, 25, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Lily&quot;, 7800, 21, &quot;female&quot;, &quot;Washington&quot;));</span><br><span class="line"></span><br><span class="line">    String names &#x3D; personList.stream().map(p -&gt; p.getName()).collect(Collectors.joining(&quot;,&quot;));</span><br><span class="line">    System.out.println(&quot;所有员工的姓名：&quot; + names);</span><br><span class="line">    List&lt;String&gt; list &#x3D; Arrays.asList(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;);</span><br><span class="line">    String string &#x3D; list.stream().collect(Collectors.joining(&quot;-&quot;));</span><br><span class="line">    System.out.println(&quot;拼接后的字符串：&quot; + string);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><p>所有员工的姓名：Tom,Jack,Lily 拼接后的字符串：A-B-C</p></blockquote><h3 id="3-6-5-归约-reducing"><a href="#3-6-5-归约-reducing" class="headerlink" title="3.6.5 归约(reducing)"></a><strong><strong>3.6.5 归约(reducing)</strong></strong></h3><p><code>Collectors</code>类提供的<code>reducing</code>方法，相比于<code>stream</code>本身的<code>reduce</code>方法，增加了对自定义归约的支持。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line">    personList.add(new Person(&quot;Tom&quot;, 8900, 23, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Jack&quot;, 7000, 25, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Lily&quot;, 7800, 21, &quot;female&quot;, &quot;Washington&quot;));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 每个员工减去起征点后的薪资之和（这个例子并不严谨，但一时没想到好的例子）</span><br><span class="line">    Integer sum &#x3D; personList.stream().collect(Collectors.reducing(0, Person::getSalary, (i, j) -&gt; (i + j - 5000)));</span><br><span class="line">    System.out.println(&quot;员工扣税薪资总和：&quot; + sum);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; stream的reduce</span><br><span class="line">    Optional&lt;Integer&gt; sum2 &#x3D; personList.stream().map(Person::getSalary).reduce(Integer::sum);</span><br><span class="line">    System.out.println(&quot;员工薪资总和：&quot; + sum2.get());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><p>员工扣税薪资总和：8700 员工薪资总和：23700</p></blockquote><h2 id="3-7-排序-sorted"><a href="#3-7-排序-sorted" class="headerlink" title="3.7 排序(sorted)"></a><strong><em>3.7 排序(sorted)</em></strong></h2><p>sorted，中间操作。有两种排序：</p><ul><li>sorted()：自然排序，流中元素需实现Comparable接口</li><li>sorted(Comparator com)：Comparator排序器自定义排序</li></ul><p><strong>案例：将员工按工资由高到低（工资一样则按年龄由大到小）排序</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;Person&gt; personList &#x3D; new ArrayList&lt;Person&gt;();</span><br><span class="line"></span><br><span class="line">    personList.add(new Person(&quot;Sherry&quot;, 9000, 24, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Tom&quot;, 8900, 22, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Jack&quot;, 9000, 25, &quot;male&quot;, &quot;Washington&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Lily&quot;, 8800, 26, &quot;male&quot;, &quot;New York&quot;));</span><br><span class="line">    personList.add(new Person(&quot;Alisa&quot;, 9000, 26, &quot;female&quot;, &quot;New York&quot;));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 按工资升序排序（自然排序）</span><br><span class="line">    List&lt;String&gt; newList &#x3D; personList.stream().sorted(Comparator.comparing(Person::getSalary)).map(Person::getName)</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">&#x2F;&#x2F; 按工资倒序排序</span><br><span class="line">    List&lt;String&gt; newList2 &#x3D; personList.stream().sorted(Comparator.comparing(Person::getSalary).reversed())</span><br><span class="line">        .map(Person::getName).collect(Collectors.toList());</span><br><span class="line">&#x2F;&#x2F; 先按工资再按年龄升序排序</span><br><span class="line">    List&lt;String&gt; newList3 &#x3D; personList.stream()</span><br><span class="line">        .sorted(Comparator.comparing(Person::getSalary).thenComparing(Person::getAge)).map(Person::getName)</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">&#x2F;&#x2F; 先按工资再按年龄自定义排序（降序）</span><br><span class="line">    List&lt;String&gt; newList4 &#x3D; personList.stream().sorted((p1, p2) -&gt; &#123;</span><br><span class="line">      if (p1.getSalary() &#x3D;&#x3D; p2.getSalary()) &#123;</span><br><span class="line">        return p2.getAge() - p1.getAge();</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return p2.getSalary() - p1.getSalary();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).map(Person::getName).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;按工资升序排序：&quot; + newList);</span><br><span class="line">    System.out.println(&quot;按工资降序排序：&quot; + newList2);</span><br><span class="line">    System.out.println(&quot;先按工资再按年龄升序排序：&quot; + newList3);</span><br><span class="line">    System.out.println(&quot;先按工资再按年龄自定义降序排序：&quot; + newList4);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><p>按工资升序排序：[Lily, Tom, Sherry, Jack, Alisa] 按工资降序排序：[Sherry, Jack, Alisa, Tom, Lily] 先按工资再按年龄升序排序：[Lily, Tom, Sherry, Jack, Alisa] 先按工资再按年龄自定义降序排序：[Alisa, Jack, Sherry, Tom, Lily]</p></blockquote><h2 id="3-8-提取-组合"><a href="#3-8-提取-组合" class="headerlink" title="3.8 提取/组合"></a><strong>3.8 提取/组合</strong></h2><p>流也可以进行合并、去重、限制、跳过等操作。</p><p><a href="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxib2AKRxUOoTchOZALI1QBw842MtU1BVThOkMbuk7RDqp3QSvzSDWbDg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1">https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxib2AKRxUOoTchOZALI1QBw842MtU1BVThOkMbuk7RDqp3QSvzSDWbDg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1</a></p><p><a href="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxIYqUenVAFm8MpRRdUmN0GA3XQXYkwnkXzVlG9iciazV6PSTYvt8IY1iaQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1">https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxIYqUenVAFm8MpRRdUmN0GA3XQXYkwnkXzVlG9iciazV6PSTYvt8IY1iaQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1</a></p><p><a href="https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxh8m7w7tfQ5NSGLarvrN4F6G1OqvESLAh7WXymBxJmibCBu6FeibtmCdg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1">https://mmbiz.qpic.cn/mmbiz_jpg/oTKHc6F8tshlcDdYLwybrjgMR9CvUtJxh8m7w7tfQ5NSGLarvrN4F6G1OqvESLAh7WXymBxJmibCBu6FeibtmCdg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    String[] arr1 &#x3D; &#123; &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot; &#125;;</span><br><span class="line">    String[] arr2 &#x3D; &#123; &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot; &#125;;</span><br><span class="line"></span><br><span class="line">    Stream&lt;String&gt; stream1 &#x3D; Stream.of(arr1);</span><br><span class="line">    Stream&lt;String&gt; stream2 &#x3D; Stream.of(arr2);</span><br><span class="line">&#x2F;&#x2F; concat:合并两个流 distinct：去重</span><br><span class="line">    List&lt;String&gt; newList &#x3D; Stream.concat(stream1, stream2).distinct().collect(Collectors.toList());</span><br><span class="line">&#x2F;&#x2F; limit：限制从流中获得前n个数据</span><br><span class="line">    List&lt;Integer&gt; collect &#x3D; Stream.iterate(1, x -&gt; x + 2).limit(10).collect(Collectors.toList());</span><br><span class="line">&#x2F;&#x2F; skip：跳过前n个数据</span><br><span class="line">    List&lt;Integer&gt; collect2 &#x3D; Stream.iterate(1, x -&gt; x + 2).skip(1).limit(5).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;流合并：&quot; + newList);</span><br><span class="line">    System.out.println(&quot;limit：&quot; + collect);</span><br><span class="line">    System.out.println(&quot;skip：&quot; + collect2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><p>流合并：[a, b, c, d, e, f, g] limit：[1, 3, 5, 7, 9, 11, 13, 15, 17, 19] skip：[3, 5, 7, 9, 11]</p></blockquote><p>好，以上就是全部内容，能坚持看到这里，你一定很有收获。</p><hr><p><a href="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==">data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==</a></p>]]></content>
      
      
      <categories>
          
          <category> Java8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 新特性 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis学习笔记</title>
      <link href="/2020/10/14/learn-redis/"/>
      <url>/2020/10/14/learn-redis/</url>
      
        <content type="html"><![CDATA[<p><img src="Untitled.png" alt="Untitled.png"></p><p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。</p><h1 id="learn-redis"><a href="#learn-redis" class="headerlink" title="learn-redis"></a><strong>learn-redis</strong></h1><blockquote><p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。</p></blockquote><h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a><strong>基础</strong></h1><h2 id="1-基本命令"><a href="#1-基本命令" class="headerlink" title="1.基本命令"></a><strong>1.基本命令</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ping                    # 测试联通：PONG</span><br><span class="line">set name value          # 设置KEY</span><br><span class="line">get name                # 获取KEY</span><br><span class="line">keys *                  # 查所有KEY</span><br><span class="line">select 0                # 切换数据库</span><br><span class="line">flushall                # 清空所有数据库</span><br><span class="line">flushdb                 # 清空所选数据库</span><br><span class="line">expire name time        # 设置KEY过期时间</span><br><span class="line">ttl name                # 查看剩余时间，-2为已过期</span><br><span class="line">exist name              # 判断KEY是否存在</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-五大基础类型"><a href="#2-五大基础类型" class="headerlink" title="2.五大基础类型"></a><strong>2.五大基础类型</strong></h2><h3 id="2-1-String类型"><a href="#2-1-String类型" class="headerlink" title="2.1.String类型"></a><strong>2.1.String类型</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">append                  # 追加数据，name不存在set</span><br><span class="line">strlen                  # 数据长度</span><br><span class="line"></span><br><span class="line">&lt;!-- 微信公众号浏览量,实现i++、i-- --&gt;</span><br><span class="line">set views 0</span><br><span class="line">incr views              # i++,持久化可以持久过去，暂时并不是要mysql</span><br><span class="line">decr views              # i--</span><br><span class="line"></span><br><span class="line">&lt;!-- 实现java步长 --&gt;</span><br><span class="line">incrby views 10         # 在基础上增加10</span><br><span class="line">decrby views 10         # 在基础上减少10</span><br><span class="line"></span><br><span class="line">&lt;!-- 截取字符串(左闭右开区间) --&gt;</span><br><span class="line">getrange name start end # 获得截取字符串</span><br><span class="line">getrange name 0 3       </span><br><span class="line">getrange name 0 -1      # 查看全部数据 </span><br><span class="line"></span><br><span class="line">&lt;!-- 替换数据 --&gt;</span><br><span class="line">setrange name 1 xx      # 0 -1，替换指定位置开始的字符串</span><br><span class="line"></span><br><span class="line">setex key seconds value # 如果存在,再设置过期时间</span><br><span class="line">setex key3 30 &quot;hello&quot;</span><br><span class="line">setnx key seconds value # 如果不存在,创建设置过期时间(分布式锁常常用)，如果已存在创建失败</span><br><span class="line">setnx name &quot;mongoDB&quot;    # 不存在再设置值，1成功，0失败</span><br><span class="line">mset k1 v1 k2 v2 k3 v3  # 设置多个</span><br><span class="line">mget k1 k2 k3           # 获取多个</span><br><span class="line">msetnx                  # 不存在设置成功，存在设置失败（1个存在都失败，原子性）</span><br><span class="line">mget </span><br><span class="line"></span><br><span class="line">&lt;!-- 设置user对象 --&gt;</span><br><span class="line">&lt;!-- value为json来保存1个对象 --&gt;</span><br><span class="line">set user:1 &#123;name:zhangsan,age:3&#125;</span><br><span class="line">mset user:1:name zhangsan user:1:age 2  # mset user:&#123;id&#125;:&#123;field&#125;</span><br><span class="line">mget user:1name user:1:age</span><br><span class="line">set article:1000:views  #设置当前文章浏览量，key可以复用</span><br><span class="line"></span><br><span class="line">&lt;!-- 组合命令：如果不存再返回nil,如果存在返回旧值，并设置新值 --&gt;</span><br><span class="line">getset db redis         # 先get再set</span><br><span class="line">getset db mongoDB       # 得出来redis,再get db 为mongoDB </span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>String使用场景：value可以是int、string，计数器、统计多单位数量、粉丝数、对象储存</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set uid:9555:follow 0 incr</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-2-List类型"><a href="#2-2-List类型" class="headerlink" title="2.2.List类型"></a><strong>2.2.List类型</strong></h3><blockquote><p>基本数据类型，增加点规则玩成：栈、队列 所有List命令都是l开头</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">lpush list one  # 将1个或多个插入到列表的头部</span><br><span class="line">lpush list two</span><br><span class="line">lrange list 0 -1</span><br><span class="line">rpush list one  # 将1个或多个插入到列表的底部</span><br><span class="line">lpop   # 去除左边的，头部</span><br><span class="line">rpop   # 去除右边的，底部</span><br><span class="line">Lindex list index  # 获取下表数值0</span><br><span class="line">Llen list   # 列表长度</span><br><span class="line">lrem list 1 one  # 移除list中的one且1个</span><br><span class="line">lrem list 2 one  # 移除list中的one且2个</span><br><span class="line">ltrim list 1 2  # 通过下表截取指定长度，list被改变，只剩下截取的元素</span><br><span class="line">rpoplpush source des # 移除列表的最后一个元素，且移动到新list</span><br><span class="line">lset list 0 item  # 指定下标添加时，list不存在就报错</span><br><span class="line">lpush list item</span><br><span class="line">lrange list 0 0</span><br><span class="line">lset list 0 newItem  # 若存在，把0号元素更新掉</span><br><span class="line">lset list 1 newItem  # 不存在的下标就把报错 </span><br><span class="line">linsert key befor|after pivot value # list前或后</span><br><span class="line">rpush list hello</span><br><span class="line">rpush list world</span><br><span class="line">linsert list before world other # 在world上面插入other</span><br><span class="line">linsert list after world other # 在world下面插入other</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>List实际是1个链条，key不存在创建新链表，key存在新增内容 空链表也代表不存在，两边改动效率 最高 Lpush Rpop：队列 Lpush Lpop：栈</p></blockquote><h3 id="2-3-Set-集合"><a href="#2-3-Set-集合" class="headerlink" title="2.3.Set(集合)"></a><strong>2.3.Set(集合)</strong></h3><blockquote><p>set中的值不能重复</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sadd myset hello        # 在myset中添加hello</span><br><span class="line">sadd myset kangshen  </span><br><span class="line">smembers myset          # 查看set所有制</span><br><span class="line">sismember myset hello   # 判断元素是否存在</span><br><span class="line">scard myset             # 查询set个数</span><br><span class="line">srem myset hello        # 移除hello</span><br><span class="line">srandmember myset       # 随机读取1个</span><br><span class="line">srandmember myset 2     # 随机读取指定个数</span><br><span class="line">spop myset              # 随机移除1个</span><br><span class="line">smove myset myset2 &quot;ku&quot; # 移动ku到myset2</span><br><span class="line">&lt;!-- 例子：共同关注：交集 --&gt;</span><br><span class="line">sdiff key1 key2         # 差集，显示不同的</span><br><span class="line">sinter key1 key2        # 交集:共同好友</span><br><span class="line">sunion key1 key2        # 并集</span><br><span class="line">&lt;!-- 例子：微博A用户所有关注的人放在SET集合中 --&gt;</span><br><span class="line">&lt;!-- 共同关注,共同爱好，六度理论 --&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-4-Hash-Map"><a href="#2-4-Hash-Map" class="headerlink" title="2.4.Hash~Map"></a><strong>2.4.Hash~Map</strong></h3><blockquote><p>Map集合，key-value,村的也是键值对，但是value是个map集合</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">hset key field value    # 添加key-value到Hash</span><br><span class="line">hget key field          # 获取keyHash中的field</span><br><span class="line">hmset myhash k1 v1 k2 v2# 插入多个值</span><br><span class="line">hmget myhash k1 k2      # 获取多个值</span><br><span class="line">hgetall myhash          # 获取所有的值</span><br><span class="line">hdel key field          # 删除field字段</span><br><span class="line">hlen key                # 获取hash表字段数量</span><br><span class="line">hexists myhash field    # 判断hash指定字段是否存在</span><br><span class="line"># 只获得所有field</span><br><span class="line">hkeys myhash</span><br><span class="line"># 后的所有的值</span><br><span class="line">kvals myhash</span><br><span class="line"># 指定自增 i++ &#x2F; i--</span><br><span class="line">hincrby myhash field3 1 </span><br><span class="line">hdecr myhash field 3 1 </span><br><span class="line">hsetnx myhash field4 hello  #不存在会创建，存在就不创建</span><br><span class="line">&lt;!-- 例子:hash变更数据,设置对象 --&gt;</span><br><span class="line">hset user:1 name qinjing</span><br><span class="line">hget user:1 name</span><br><span class="line">&lt;!-- hash更适合存储对象 --&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-5-Zset-有序集合"><a href="#2-5-Zset-有序集合" class="headerlink" title="2.5.Zset(有序集合)"></a><strong>2.5.Zset(有序集合)</strong></h3><blockquote><p>在set的基础上，增加1个值，set k1 v1 / zset k1 score1 v1</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">zadd myzset 1 one           # 添加1个值</span><br><span class="line">zadd myzset 2 two 3 three   # 添加多个值</span><br><span class="line">zrange myset 0 -1           # 查询所有值</span><br><span class="line">&lt;!-- 排序 --&gt;</span><br><span class="line">zadd salary 2500 xiaohong 5000 zhangsan 500 kuangshen</span><br><span class="line">zrangebyscore salary -inf +inf              # 从小到大</span><br><span class="line">1) &quot;kuangshen&quot;</span><br><span class="line">2) &quot;xiaohong&quot; </span><br><span class="line">3) &quot;zhangsan&quot;</span><br><span class="line">zrangebyscore salary -inf +inf withscores   # 从小到大，并输出score</span><br><span class="line">zrem salary xiaohong        # 移除小红</span><br><span class="line">zcard salary                # 获取个数</span><br><span class="line">zrevrange salary 0 -1       # 从大到小:反转</span><br><span class="line">zcount salary key min max   # 判断区间个数(闭区间)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>案例思路：set-&gt;排序、班级成绩表、工资表、带权重的消息、排行榜(有序集合zset中)</p></blockquote><h2 id="3-三种特殊数据类型"><a href="#3-三种特殊数据类型" class="headerlink" title="3.三种特殊数据类型"></a><strong>3.三种特殊数据类型</strong></h2><h3 id="3-1-geospatial地理位置"><a href="#3-1-geospatial地理位置" class="headerlink" title="3.1.geospatial地理位置"></a><strong>3.1.geospatial地理位置</strong></h3><blockquote><p>朋友的定位，附近的人，打车距离怎么算？城市经度纬度，redis3.2版本的geo就退出了。 只有6个命令：GEOADD、GEODIST、GEOHASH、GEOPOS、GEORADIUS、GEORADIUSBYMEMBER</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">geoadd                      #添加地理位置</span><br><span class="line">geoadd china:city 116.40 39.90 beijing</span><br><span class="line">geoadd china:city 121.47 31.23 shanghai</span><br><span class="line">geoadd china:city 160.50 29.53 chongqing 114.05 22.52 shenzhen</span><br><span class="line"># 规则：两级无法直接添加，我们一般会下载城市数据，用JAVA一次导入</span><br><span class="line"># 参数：key 维度 精度 名称</span><br><span class="line">geopos key name             # 获取精度和纬度</span><br><span class="line"># geodist 单位，两地之间距离：</span><br><span class="line"># m 米</span><br><span class="line"># km 千米</span><br><span class="line"># mi 盈利</span><br><span class="line"># ft 英尺</span><br><span class="line">geodist key beijin shanghai km # 两地之间距离直线，单位千米</span><br><span class="line">&lt;!-- 例子：我附近的人,找朋友： --&gt;</span><br><span class="line">&lt;!-- georedius:以给定的经纬度为中心，找出半径内的元素 --&gt;</span><br><span class="line"># 1、记录所有人的经纬度</span><br><span class="line"># 2、获得所有附近的人的地址，定位最近的老师！</span><br><span class="line"># 以经纬度为精心，显示城市到我某距离内的指定人数</span><br><span class="line">georadius key logitude latitude radius m|km|ft|mi withdist withcoord count num</span><br><span class="line">georadius china:city 110 120 1000 km withdist withcoord count 3</span><br><span class="line"># 以经纬度为精心，显示城市到我有多远:距离</span><br><span class="line">georadius china:city 110 120 1000 km withdist</span><br><span class="line"># 以经纬度为精心，显示城市到我某距离内所有人到我的经纬度信息</span><br><span class="line">georadius china:city 110 120 1000 km withcoord</span><br><span class="line"># 以北京元素为中心找出距离我某距离的所有城市</span><br><span class="line">&lt;!-- 例子：导航定位，georadiusbymember：找出位于指定元素周围的其他元素 --&gt;</span><br><span class="line">georadiusbymember china:city beijing 1000 km</span><br><span class="line">georadiusbymember china:city shanghai 400 km</span><br><span class="line"># geohash:找到1个或多个元素的geohash表示:52点证书编码，返回11个字符的字符串，所以没有精度,还是两个元素距离：将二位经纬度转换为1维的经纬度hash字符串表示：2个字符串长得越像，越接近</span><br><span class="line">geohash china:city beijing shanghai </span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>geo实现原理：基于Zset,可以使用Zset操作geo 所以用zset命令进行删除修改</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zrange china:city 0 -1              # 查看所有城市</span><br><span class="line">zrem china:city beijing             # 删除北京</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-2-Hyperloglog基数统计"><a href="#3-2-Hyperloglog基数统计" class="headerlink" title="3.2.Hyperloglog基数统计"></a><strong>3.2.Hyperloglog基数统计</strong></h3><blockquote><p>什么是基数？不重复的元素 A {1,3,5,7,8,7} B {1,3,5,7,8} 基数：1,3,5,7,8 Redis 2.8.9 半根更新了Heyperloglog数据结构 统计网页UV(1个人访问1个网站多次，但是还算1个人) 传统方法，set保存用户id,然后用set元素数量作为统计标准 这种方式保存大量id比较麻烦，占内存。因为目的是计数，不是存id Hyperloglog： 优点:占用内存固定，2^64不同的元素，12kb内存。内存角度比较比set好 缺点:有0.81%的错误率</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PFadd key element [element ...]</span><br><span class="line">PFadd mykey a b c d e f g       # 添加数据到第一组</span><br><span class="line">PFadd mykey2 a b c d e f g      # 添加数据到第二组</span><br><span class="line">PFCOUNT mykey                   # 统计mykey中元素基数的数量</span><br><span class="line">PFMERGE mykey3 mykey mykey2     # 合并mykey与mykey2到mykey3：删除重复</span><br><span class="line">PFCOUNT mykey3                  # 查看并集的数量</span><br><span class="line"># 如果允许容错，一定要使用Hyperloglog !</span><br><span class="line"># 如果不允许容错，就要使用set或者自己的数据类型 !</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-3-Bitmaps-位存储"><a href="#3-3-Bitmaps-位存储" class="headerlink" title="3.3.Bitmaps 位存储"></a><strong>3.3.Bitmaps 位存储</strong></h3><blockquote><p>筛选用户：用0101最快: 例子：1、统计疫情感染人数：0 1 0 1 0 1，2、活跃不活跃，3、是否登录，4、打卡（mysql:user: status date）这样很慢，所有两个状态都可以使用Bitmaps! Bitmaps位图，数据结构！都是操作魏晋至进行记录，就只有0和1两个状态。 365天 = 365bit/8bit = 46kb</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用bitmap记录周一到周日打卡！ --&gt;</span><br><span class="line"># 周一：1 周二：0 周三：1 周四：1 周五：0 周六：1 周日：1</span><br><span class="line"># 统计有多少个1</span><br><span class="line">setbit sign 1 0</span><br><span class="line">setbit sign 2 0</span><br><span class="line">setbit sign 3 0</span><br><span class="line">setbit sign 4 0</span><br><span class="line">setbit sign 5 0</span><br><span class="line">setbit sign 6 0</span><br><span class="line">setbit sign 7 0</span><br><span class="line">getbit sign 1</span><br><span class="line">getbit sign 2</span><br><span class="line">getbit sign 3</span><br><span class="line">getbit sign 4</span><br><span class="line">getbit sign 5</span><br><span class="line">getbit sign 6</span><br><span class="line">getbit sign 7</span><br><span class="line"># 统计打卡天数</span><br><span class="line">bitcount sign [start end]</span><br><span class="line">bitcount sign                       # 统计打卡天数，默认所有</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-Redis的基本事务操作"><a href="#4-Redis的基本事务操作" class="headerlink" title="4.Redis的基本事务操作"></a><strong>4.Redis的基本事务操作</strong></h2><blockquote><p>redis单条命令保存原子性，但是redis事务不保证原子性，没有隔离集合概念！ Redis事务本质：一组命令的集合！一个手游命令被序列化，进行顺序执行！ 一次性、顺序性、排他性！这样执行一系列命令 redis的事务：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 正常执行事务：</span><br><span class="line">1、开启事务(multi)</span><br><span class="line">2、命令入队(...)</span><br><span class="line">&gt;set k1 v1</span><br><span class="line">&gt;set k2 v2</span><br><span class="line">&gt;get k2</span><br><span class="line">3、执行事务(exec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>执行完后都要重新开启新事务</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 放弃执行事务：</span><br><span class="line">1、开启事务(multi)</span><br><span class="line">2、命令入队(...)</span><br><span class="line">&gt;set k1 v1</span><br><span class="line">&gt;set k2 v2</span><br><span class="line">&gt;get k2</span><br><span class="line">3、取消事务(discard)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>执行错误: 1、编译型异常(代码问题~命令问题):事务所有命令不会执行. multi set k1 v1 setget k1 v1 exec EXECABORT Transaction discarded because of previous errors. 2、运行异常(1/0):若事务命令存在语法错误，其他命令可以正常执行，错误命令抛出异常. multi incr k1 set k1 v1 exec ERR value is not an integer or out of range</p></blockquote><h2 id="5-监控！Watch：Redis实现乐观锁、悲观锁"><a href="#5-监控！Watch：Redis实现乐观锁、悲观锁" class="headerlink" title="5.监控！Watch：Redis实现乐观锁、悲观锁"></a><strong>5.监控！Watch：Redis实现乐观锁、悲观锁</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 悲观锁：</span><br><span class="line">· 很悲观，认为什么时候都出问题，所以什么时候都会加锁！</span><br><span class="line"># 乐观锁：</span><br><span class="line">· 很乐观，认为什么时候都不会出现问题，什么时候都不上锁，更新时候会判断一下，此期间是否有人修改过这个数据</span><br><span class="line">· 获取version</span><br><span class="line">· 更新时候比较version</span><br><span class="line">· 常用，效率高</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>Redis监视测试</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 正常执行：成功</span><br><span class="line">multi                       # 开启事务</span><br><span class="line">set money 100               # 钱包100元</span><br><span class="line">get out 0                   # 记录支出0</span><br><span class="line">watch money                 # 监视money钱包</span><br><span class="line">decrby money 20             # 钱包花去20</span><br><span class="line">incrby out 20               # 支出增加20</span><br><span class="line">exec                        # 执行事务</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>watch相当于乐观锁</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 多个窗口执行时：</span><br><span class="line">1:watch money                 # 线程1：监视钱包</span><br><span class="line">1:multi                       # 线程1：开启事务</span><br><span class="line">1:decrby money 20             # 线程1：钱包花去20</span><br><span class="line">1:incrby out 20               # 线程1：支出增加20</span><br><span class="line">2:get money                   # 线程2：查看钱包</span><br><span class="line">2:set money 1000              # 线程2：修改钱包</span><br><span class="line">1:exec                        # 线程1：执行事务时，前边的watch会提醒当前事务一定执行失败，因为线程2修改了我们的值，执行失败</span><br><span class="line">&gt;nil                          # 修改失败</span><br><span class="line">1:unwatch                     # 事务执行失败先解锁，放弃监视</span><br><span class="line">1:watch monet                 # 再监视获取最新的值，执行别的操作</span><br><span class="line">1:exec                        # 执行事务时会比对监视的值是否发生变化</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>分布式秒杀乐观锁</p></blockquote><h2 id="6-Jedis"><a href="#6-Jedis" class="headerlink" title="6.Jedis"></a><strong>6.Jedis</strong></h2><blockquote><p>我们要使用JAVA来操作Redis 什么是Jedis?是Redis官方推荐的java连接工具！使用Java操作Redis中间件！如果你要是用java操作redis，那么一定要对jedis十分熟悉. 1、导入依赖</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;redis.clients&#x2F;jedis --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.2.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.alibaba&#x2F;fastjson --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.62&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2、编码测试 2.1.连接数据库 2.2.操作命令 2.3.断开连接</p><h2 id="7-SpringBoot整合"><a href="#7-SpringBoot整合" class="headerlink" title="7.SpringBoot整合"></a><strong>7.SpringBoot整合</strong></h2><blockquote><p>springboot操作数据：springdata封装了 jpa jdbc mongdb redis，springdata也是和springboot齐名的项目 说明：在springboot2.x之后，原来的jedis替换为lettuce! jedis:采用直连：多线程不安全，避免不安全，得用jedis pool连接池！更像BIO模式 lettuce:采用netty异步请求，实例可以在多个线程中共享，不存在线程不安全的情况！更像NIO模式</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">源码分析：</span><br><span class="line">&#x2F;*</span><br><span class="line"> * Copyright 2012-2020 the original author or authors.</span><br><span class="line"> *</span><br><span class="line"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line"> * you may not use this file except in compliance with the License.</span><br><span class="line"> * You may obtain a copy of the License at</span><br><span class="line"> *</span><br><span class="line"> *      https:&#x2F;&#x2F;www.apache.org&#x2F;licenses&#x2F;LICENSE-2.0</span><br><span class="line"> *</span><br><span class="line"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="line"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line"> * See the License for the specific language governing permissions and</span><br><span class="line"> * limitations under the License.</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">package org.springframework.boot.autoconfigure.data.redis;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line">import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;</span><br><span class="line">import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line">import org.springframework.boot.autoconfigure.condition.ConditionalOnSingleCandidate;</span><br><span class="line">import org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.context.annotation.Import;</span><br><span class="line">import org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line">import org.springframework.data.redis.core.RedisOperations;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * &#123;@link EnableAutoConfiguration Auto-configuration&#125; for Spring Data&#39;s Redis support.</span><br><span class="line"> *</span><br><span class="line"> * @author Dave Syer</span><br><span class="line"> * @author Andy Wilkinson</span><br><span class="line"> * @author Christian Dupuis</span><br><span class="line"> * @author Christoph Strobl</span><br><span class="line"> * @author Phillip Webb</span><br><span class="line"> * @author Eddú Meléndez</span><br><span class="line"> * @author Stephane Nicoll</span><br><span class="line"> * @author Marco Aust</span><br><span class="line"> * @author Mark Paluch</span><br><span class="line"> * @since 1.0.0</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration(proxyBeanMethods &#x3D; false)</span><br><span class="line">@ConditionalOnClass(RedisOperations.class)</span><br><span class="line">@EnableConfigurationProperties(RedisProperties.class)</span><br><span class="line">@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)</span><br><span class="line">public class RedisAutoConfiguration &#123;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@ConditionalOnMissingBean(name &#x3D; &quot;redisTemplate&quot;)</span><br><span class="line">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span><br><span class="line">public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) &#123;</span><br><span class="line">&#x2F;&#x2F; 默认的RedisTemplate没有过多的设置，redis对象都是需要序列化！Dubbo</span><br><span class="line">&#x2F;&#x2F; 两个反省都是object,object类型，后续使用都要强转</span><br><span class="line">&#x2F;&#x2F; 我们可以自己定义一个RedisTemplate</span><br><span class="line">RedisTemplate&lt;Object, Object&gt; template &#x3D; new RedisTemplate&lt;&gt;();</span><br><span class="line">template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">return template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@ConditionalOnMissingBean</span><br><span class="line">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span><br><span class="line">&#x2F;&#x2F;由于String是Redis中最常用的类型,所以我们要单独提出来一个bean！</span><br><span class="line">public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory redisConnectionFactory) &#123;</span><br><span class="line">StringRedisTemplate template &#x3D; new StringRedisTemplate();</span><br><span class="line">template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">return template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>整合测试一下</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">1.导入配置</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">2.配置连接</span><br><span class="line"># Springboot 所有得配置类都有一个自动配置类 RedisAutoConfiguration</span><br><span class="line"># 自动配置类都会绑定一个properties配置文件  RedisProperties</span><br><span class="line">spring.redis.host&#x3D;127.0.0.1</span><br><span class="line">spring.redis.port&#x3D;6379</span><br><span class="line"># spring.redis.database&#x3D;0</span><br><span class="line"># spring.redis.lettuce.pool.max-active&#x3D;</span><br><span class="line"></span><br><span class="line">3.测试！</span><br><span class="line">package com.example;</span><br><span class="line"></span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.data.redis.connection.RedisConnection;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"></span><br><span class="line">import java.time.Duration;</span><br><span class="line"></span><br><span class="line">@SpringBootTest</span><br><span class="line">class RedisSpringbootApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() &#123;</span><br><span class="line">        &#x2F;&#x2F; redis操作字符串的，类似String</span><br><span class="line">        redisTemplate.opsForValue().set(&quot;name&quot;,&quot;yuhang&quot;);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(&quot;name&quot;));</span><br><span class="line">        &#x2F;&#x2F; redis操作字符串的，List</span><br><span class="line">        redisTemplate.opsForList().leftPush(&quot;name&quot;,&quot;yuhang&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; redis操作字符串的，Set</span><br><span class="line">        redisTemplate.opsForSet();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; redis操作字符串的，Hash</span><br><span class="line">        redisTemplate.opsForHash();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; redis操作字符串的，Geo</span><br><span class="line">        redisTemplate.opsForGeo();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; redis操作字符串的，ZSet</span><br><span class="line">        redisTemplate.opsForZSet();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; redis操作字符串的，HyperLogLog</span><br><span class="line">        redisTemplate.opsForHyperLogLog();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; redis操作字符串的，Bitmap</span><br><span class="line">        redisTemplate.opsForCluster();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 常用的操作,直接用redisTemplate</span><br><span class="line">        &#x2F;&#x2F; 比如事务和基本的CRUD</span><br><span class="line">        redisTemplate.multi();</span><br><span class="line">        redisTemplate.watch(&quot;&quot;);</span><br><span class="line">        redisTemplate.exec();</span><br><span class="line">        redisTemplate.delete(&quot;&quot;);</span><br><span class="line">        redisTemplate.expire(&quot;&quot;, Duration.ZERO);</span><br><span class="line">        redisTemplate.move(&quot;&quot;, 1);</span><br><span class="line">        &#x2F;&#x2F; 获取链接,操作数据方法</span><br><span class="line">        RedisConnection redisConnection &#x3D; redisTemplate.getConnectionFactory().getConnection();</span><br><span class="line">        redisConnection.flushAll();</span><br><span class="line">        redisConnection.flushDb();</span><br><span class="line">        redisConnection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">\\ 编写自己的序列化配置</span><br><span class="line">package com.example.config;</span><br><span class="line"></span><br><span class="line">import com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class="line">import com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class="line">import org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line">public class RedisConfig &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 固定的模板</span><br><span class="line">    &#x2F;&#x2F; 编写我们自己的RedisTemplate</span><br><span class="line">    @Bean</span><br><span class="line">    @SuppressWarnings(&quot;all&quot;)</span><br><span class="line">    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) &#123;</span><br><span class="line">        &#x2F;&#x2F; 我们为了自己方便一般用String, Object类型</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template &#x3D; new RedisTemplate&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; json序列化配置,转义：</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer &#x3D; new Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper objectMapper &#x3D; new ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; string序列化配置</span><br><span class="line">        StringRedisSerializer stringRedisSerializer &#x3D; new StringRedisSerializer();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 配置具体的序列化方式,配置自己的序列化</span><br><span class="line">        &#x2F;&#x2F; key采用string序列化</span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        &#x2F;&#x2F; hash的key也用sting序列化</span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        &#x2F;&#x2F; value使用json序列化</span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        &#x2F;&#x2F; hash的value使用json序列化</span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line"></span><br><span class="line">        return template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>所有的redis操作，对于开发人员来说，重要的是要理解redis的思想和每一种数据结构的用处与作用场景</p></blockquote><h1 id="高级"><a href="#高级" class="headerlink" title="高级"></a><strong>高级</strong></h1><h2 id="8-Redis-conf详解"><a href="#8-Redis-conf详解" class="headerlink" title="8.Redis.conf详解"></a><strong>8.Redis.conf详解</strong></h2><blockquote><p>启动时候通过配置文件启动的！</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 单位:units大小写不敏感</span><br><span class="line"># Redis configuration file example.</span><br><span class="line">#</span><br><span class="line"># Note that in order to read the configuration file, Redis must be</span><br><span class="line"># started with the file path as first argument:</span><br><span class="line">#</span><br><span class="line"># .&#x2F;redis-server &#x2F;path&#x2F;to&#x2F;redis.conf</span><br><span class="line"></span><br><span class="line"># Note on units: when memory size is needed, it is possible to specify</span><br><span class="line"># it in the usual form of 1k 5GB 4M and so forth:</span><br><span class="line">#</span><br><span class="line"># 1k &#x3D;&gt; 1000 bytes</span><br><span class="line"># 1kb &#x3D;&gt; 1024 bytes</span><br><span class="line"># 1m &#x3D;&gt; 1000000 bytes</span><br><span class="line"># 1mb &#x3D;&gt; 1024*1024 bytes</span><br><span class="line"># 1g &#x3D;&gt; 1000000000 bytes</span><br><span class="line"># 1gb &#x3D;&gt; 1024*1024*1024 bytes</span><br><span class="line">#</span><br><span class="line"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 包含文件</span><br><span class="line">################################## INCLUDES ###################################</span><br><span class="line"></span><br><span class="line"># Include one or more other config files here.  This is useful if you</span><br><span class="line"># have a standard template that goes to all Redis servers but also need</span><br><span class="line"># to customize a few per-server settings.  Include files can include</span><br><span class="line"># other files, so use this wisely.</span><br><span class="line">#</span><br><span class="line"># Notice option &quot;include&quot; won&#39;t be rewritten by command &quot;CONFIG REWRITE&quot;</span><br><span class="line"># from admin or Redis Sentinel. Since Redis always uses the last processed</span><br><span class="line"># line as value of a configuration directive, you&#39;d better put includes</span><br><span class="line"># at the beginning of this file to avoid overwriting config change at runtime.</span><br><span class="line">#</span><br><span class="line"># If instead you are interested in using includes to override configuration</span><br><span class="line"># options, it is better to use include as the last line.</span><br><span class="line"># 导入文件</span><br><span class="line"># include &#x2F;path&#x2F;to&#x2F;local.conf</span><br><span class="line"># include &#x2F;path&#x2F;to&#x2F;other.conf</span><br><span class="line"></span><br><span class="line">################################## MODULES #####################################</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 网络</span><br><span class="line">bind 127.0.0.1      #绑定ip</span><br><span class="line">protected-mode yes  # 保护模式</span><br><span class="line">port 6379           # 端口设置</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 通用配置</span><br><span class="line">daemonize yes       # 以守护的方式进行，默认no不开启</span><br><span class="line">pidfile &#x2F;var&#x2F;run&#x2F;redis_6379.pid             #如果以后太方式运行需要文件</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 日志</span><br><span class="line"># Specify the server verbosity level.</span><br><span class="line"># This can be one of:</span><br><span class="line"># debug (a lot of information, useful for development&#x2F;testing)              # 开发阶段</span><br><span class="line"># verbose (many rarely useful info, but not a mess like the debug level)    # debug</span><br><span class="line"># notice (moderately verbose, what you want in production probably)         # 生产环境</span><br><span class="line"># warning (only very important &#x2F; critical messages are logged)              # 警告</span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line">logfile &quot;&quot;          # 日志文件位置名，</span><br><span class="line">database 16         # 数据库数量，默认16</span><br><span class="line">always-show-logo yes# 是否总是显示露沟</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># RDB</span><br><span class="line"># 快照：持久化时，在规定时间内执行了多少次操作会持久化生成文件(.rdb&#x2F;aof)</span><br><span class="line"># 若不持久化就会丢</span><br><span class="line"># 持久化规则,我们以后自己定义</span><br><span class="line">save 900 1          # 如果1个key进行了修改在900s内就进行持久化操作</span><br><span class="line">save 300 10         # 如果10个key进行了修改在300s内就进行持久化操作</span><br><span class="line">save 60 10000       # 如果10000个key进行了修改在60s内就进行持久化操作，高并发</span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error yes # 持久化出错是否还继续持久化操作</span><br><span class="line"></span><br><span class="line">rdbcompression yes              # 是否压缩rdb文件，耗cpu资源</span><br><span class="line">rdbchecksum yes                 # 保存时是否检查rdb文件校验并修复</span><br><span class="line">dir .&#x2F;                          # rdb保存目录</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># REPLICATION 主从复制时再看，多个Redis</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 密码</span><br><span class="line"></span><br><span class="line">################################## SECURITY ###################################</span><br><span class="line"># Require clients to issue AUTH &lt;PASSWORD&gt; before processing any other</span><br><span class="line"># commands.  This might be useful in environments in which you do not trust</span><br><span class="line"># others with access to the host running redis-server.</span><br><span class="line">#</span><br><span class="line"># This should stay commented out for backward compatibility and because most</span><br><span class="line"># people do not need auth (e.g. they run their own servers).</span><br><span class="line">#</span><br><span class="line"># Warning: since Redis is pretty fast an outside user can try up to</span><br><span class="line"># 150k passwords per second against a good box. This means that you should</span><br><span class="line"># use a very strong password otherwise it will be very easy to break.</span><br><span class="line">#</span><br><span class="line"># requirepass foobared</span><br><span class="line"># 密码</span><br><span class="line">requirepass 123456</span><br><span class="line"></span><br><span class="line"># 命令设置获取密码</span><br><span class="line">config get requirpass</span><br><span class="line">config set requirpass &quot;123456&quot;</span><br><span class="line">auth 123456                 # 验证密码登录</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CLIENTS客户端限制配置，一般不管</span><br><span class="line">maxclients 10000            # 设置redis最大客户端数量</span><br><span class="line">maxmemory                   # 最大内存数量</span><br><span class="line">maxmemory-policy noeviction # 内存到达上限之后的处理策略：juc线程池满了处罚四种策略，# 移除过期的key、报错、等6种</span><br><span class="line">    1、volatile-lru：只对设置了过期时间的key进行LRU（默认值） </span><br><span class="line">    2、allkeys-lru ： 删除lru算法的key   </span><br><span class="line">    3、volatile-random：随机删除即将过期key   </span><br><span class="line">    4、allkeys-random：随机删除   </span><br><span class="line">    5、volatile-ttl ： 删除即将过期的   </span><br><span class="line">    6、noeviction ： 永不过期，返回错误</span><br><span class="line">lazyfree                    # 释放内存</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">APPEND ONLY模式|AOF模式设置</span><br><span class="line">appendonly no               # 默认不开启，默认RDB方式用来持久化，一般够用了，rdb完全够用了</span><br><span class="line">appendfilename &quot;*.aof&quot;      # aof持久化文件 </span><br><span class="line">appendfsync everysec        # 每秒同步可能会丢失1秒的数据；always每次都同步，速度慢；no不同步</span><br></pre></td></tr></table></figure><h2 id="9-Redis持久化"><a href="#9-Redis持久化" class="headerlink" title="9.Redis持久化"></a><strong>9.Redis持久化</strong></h2><blockquote><p>面试和工作，持久化是重点！ Redis是内存数据库，如果不讲内存中的数据库状态保存到磁盘，一旦服务器进程退出，服务器中的数据库状态也会消失，所以Redis提供了持久化功能！ 在主从复制中，rdb是备用的。备用在从机上面，不占用主机内存，aof一般不用</p></blockquote><h3 id="9-1-RDB-Redis-DataBase"><a href="#9-1-RDB-Redis-DataBase" class="headerlink" title="9.1.RDB (Redis DataBase)"></a><strong>9.1.RDB (Redis DataBase)</strong></h3><p>什么是RDB?</p><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/RDB.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/RDB.png"></p><blockquote><p>在指定的时间间隔内写入磁盘，储存snapshot快照，恢复时是讲快照文件直接读到内存里。</p></blockquote><blockquote><p>Redis会单独创建（fork）一个进程来进行持久化，会先将数据写入到一个临时RDB文件中，待持久化过程结束了，用临时文件替换上次的持久化好的文件，退出子进程。整个过程中主进程不进行任何IO操作的，确保了极高的性能。</p></blockquote><blockquote><p>如果需要进行大规模数据的回复，且对于回复的完整性不是非常敏感，那RDB方式更加的搞笑。RDB的缺点是最后一次持久化后的数据可能丢失. 我们默认使用RDB，一般情况下不需要修改这个配置！</p></blockquote><p>==rdb保存的文件是dump.rdb==,在配置文件“dbfilename dump.rdb”行中配置 ==在生产环境我们会备份rdb文件==</p><blockquote><p>触发机制 1.save条件满足 2.flush all 默认产生一个rdb 3.推出Redis时自动产生rdb文件 备份完成后自动生成一个rdb文件</p></blockquote><blockquote><p>恢复rdb文件 1.只需要讲rdb文件放到redis启动目录下，redis启动时自动检查dump.rdb回复其中的数据。全自动 2.config get dir 查看存放位置，把rdb文件放到这里，启动redis会自动扫描完后恢复</p></blockquote><blockquote><p>优点 1.适合大规模的数据恢复，宕机了别删除rdb。 2.对数据完整性不高时。若设置60s，在59秒时宕机时10000条数据就会丢失。 缺点 1.需要一定的时间间隔，如果redis意外宕机了，最后一次修改的数据就没有了。 2.当fork一个进程时需要一个内存空间。</p></blockquote><h3 id="9-2-AOF-Append-Only-File"><a href="#9-2-AOF-Append-Only-File" class="headerlink" title="9.2.AOF (Append Only File)"></a><strong>9.2.AOF (Append Only File)</strong></h3><p>什么是AOF?</p><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/AOF.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/AOF.png"></p><blockquote><p>以日志的方式来记录每个写操作，将Reids执行过的所有指令记录下在(读操作不记录)。只追加文件但不改写文件，redis启动时读写文件重构建数据，redis重启的话根据日志文件内容将写指令从前到后执行一次，完成数据恢复的操作。 AOF保存的文件为appendonly.aof 默认不开启,将appendonly yes,重启redis就生效。aof文件有问题启动不了redis</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">解决问题：</span><br><span class="line">ps -ef|grep redis   &#x2F;&#x2F;redis没开启</span><br><span class="line"># 用redis-check-aof自动修复文件</span><br><span class="line">redis-check-aof --fix appendonly.aof</span><br><span class="line">yes</span><br><span class="line"># 重启就恢复成功，但是有一些会删除掉</span><br></pre></td></tr></table></figure><p>== ABD是全丢，AOF是丢失部分 ==</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line">appendfsync always              # 每次修改都会sync,消耗性能</span><br><span class="line">appendfsync everysec            # 每秒执行一次sync,可能丢失1s数据</span><br><span class="line">appendfsync no                  # 不执行sync，操作系统自己同步数据，速度最快</span><br><span class="line"># 重写规则，redis记录上次文件大小，大于64mb时，重新fork新进程将文件重写</span><br><span class="line">no-appendfsync-no-rewirte no    # 默认不打开，文件无线的追加，文件会越来越大，开启后保证aof体积不要太大</span><br><span class="line">auto-aof-rewirte-percentage 100 # </span><br><span class="line">auto-aof-rewirte-min-size 64mb  # </span><br></pre></td></tr></table></figure><blockquote><p>优点 1.每次修改都同步，文件完整性更好 2.默认开启每秒同步一次 2.no 从不同步效率最高 缺点 1.相对据数据文件，aof文件远远大于rdb，修复速度比rdb慢 2.AOF运行效率比rdb慢，redis默认为rdb持久化</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">拓展：</span><br><span class="line">只做缓存，如果你希望数据仅在服务器运行的时候存在，不用开启持久化</span><br><span class="line">两种持久化同时开启，会使用aof来恢复数据。</span><br><span class="line">建议在从机上使用rdb，15分钟备份一次 save 900 1</span><br><span class="line">如果不开启aof，仅靠Master-Salve-Replication实现高性能也可以。减少了rewirte打来的系统开销，如果断电Master&#x2F;Salve，就会把所有数据都丢掉了,启动脚本会比较Master与Salve的rdb文件，恢复最新的。微博就是这种架构。</span><br></pre></td></tr></table></figure><h2 id="10-Redis发布订阅"><a href="#10-Redis发布订阅" class="headerlink" title="10.Redis发布订阅"></a><strong>10.Redis发布订阅</strong></h2><blockquote><p>Redis发布/订阅，是一种消息通信模式：发送者发送消息(pub)，订阅者就收消息(sub)，微信、微博、关注系统！还有rabbitmq、kafka Redis发布消息图,用list也可以做，第一个：消息发送者，第二个：频道，第三个：消息订阅者  下图展示了频道channel1，以及订阅这个频道的客户端–clent2，clent5，clent1，之间的关系：  当有新消息时，通过publish命令发送给频道channel1时，这个消息会被发送给订阅它的三个客户端：  命令： 这些命令被广泛用于构建即时通讯应用，比如网络聊天和实时广播、实时提醒等：</p></blockquote><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/1.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/1.png"></p><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/2.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/2.png"></p><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/3.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/3.png"></p><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/4.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/4.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#订阅者-窗口1-自动监听</span><br><span class="line">redis-cli -p 6379</span><br><span class="line">subscribe kangshenshuo</span><br><span class="line"># 等待推送者发布信息</span><br><span class="line"># 收到信息，格式：</span><br><span class="line"># message               # 消息</span><br><span class="line"># kuangshenshuo         # 消息的频道</span><br><span class="line"># hello,kuangshen       # 消息内容</span><br><span class="line">#发布者-窗口2-发布消息</span><br><span class="line">redis-cli -p 6379</span><br><span class="line">publish kuangshenshuo &quot;hello,kuangshen&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>原理</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis是c实现的，通过分析源码pubsub.c文件，了解底层机制</span><br><span class="line">通过subscribe订阅一个频道后，redis-server里维护1个字典，字典的键是1个个频道，字典的值是1个链表。链表中保存者订阅这个频道的所有channel的客户端，subscribe命令的关键是将客户端添加给给定的channel订阅链表中。</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/5.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/5.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通过publish发送消息给订阅者，redis-server会使用给定的频道作为关键字，找出它维护的链表中的所有订阅这个频道的客户端，发送消息给他们</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 使用场景</span><br><span class="line">1、实时消息系统</span><br><span class="line">2、实时聊天，频道当作聊天室，将信息回显给所有人</span><br><span class="line">3、订阅关注系统</span><br><span class="line"># 复杂场景会使用消息中间件来做：kafka、rebitmq</span><br></pre></td></tr></table></figure><h2 id="11-Redis主从复制"><a href="#11-Redis主从复制" class="headerlink" title="11.Redis主从复制"></a><strong>11.Redis主从复制</strong></h2><blockquote><p>概念：主从复制，复制1台redis数据到另一台,数据的复制是单向的，智能由主节点到从节点。master以写为主，slave以读为主。 默认情况下，每台redis都是一个主节点。 主从复制作用主要包括：</p></blockquote><blockquote><p>1、数据冗余：主从复制实现数据的热备份，是持久化外的一种数据冗余方式！</p></blockquote><blockquote><p>2、故障恢复：当主节点出现问题，还可以由节点提供服务，实现快速故障恢复。</p></blockquote><blockquote><p>3、负载均衡：配合读写分离，主节点提供写服务，从节点提供读服务，分担服务器负载。</p></blockquote><blockquote><p>4、高可用集群：除以上外，主从复制还是哨兵和集群能够实施的基础。</p></blockquote><blockquote><p>一般来说：要将redis运用到项目中去，必须一主二从3个服务器，原因如下：</p></blockquote><ol><li>从结构上，单个redis服务器会发生单点故障，并且1台服务器需要处理所有的请求负载，压力较大。</li><li>从容量上来说，单个redis服务器内存容量是有限的。单台redis最大使用内存不应该超过20g。</li></ol><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/6.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/6.png"></p><blockquote><p>电商商品都是1次上传，无数次浏览，多读少写。 80%的情况下都是在读，把压力放到从机上，减缓主机服务器压力。一主二从，最少3台。</p></blockquote><blockquote><p>环境配置：只配置从库，因为默认是主库</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">编写3个配置文件启动3个配置服务。</span><br><span class="line"># 启动服务</span><br><span class="line">redis-server kconfig&#x2F;redis.config</span><br><span class="line"># 连接</span><br><span class="line">redis-cli -p 6379</span><br><span class="line">info replication        # 打印主从复制信息,查看当前库信息</span><br><span class="line"># 打开3个端口</span><br><span class="line"># 修改配置文件，copy多个：redis.conf、redis1.conf、redis2.conf、redis3.conf</span><br><span class="line">redis1.conf：   </span><br><span class="line">daemonize yes</span><br><span class="line">pidfile &#x2F;var&#x2F;run&#x2F;redis_6001.pid</span><br><span class="line">logfile &quot;1.log&quot;</span><br><span class="line">dbfilename dump1.rdb</span><br><span class="line">prot 6001</span><br><span class="line"></span><br><span class="line">redis2.conf：</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile &#x2F;var&#x2F;run&#x2F;redis_6002.pid</span><br><span class="line">logfile &quot;2.log&quot;</span><br><span class="line">dbfilename dump2.rdb</span><br><span class="line">prot 6002</span><br><span class="line"></span><br><span class="line">redis3.conf：</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile &#x2F;var&#x2F;run&#x2F;redis_6003.pid</span><br><span class="line">logfile &quot;3.log&quot;</span><br><span class="line">dbfilename dump3.rdb</span><br><span class="line">prot 6003</span><br><span class="line"># 修改对应内容：</span><br><span class="line">1.端口号</span><br><span class="line">2.pid名字</span><br><span class="line">3.log名字</span><br><span class="line">4.备份文件dump.rdb文明 </span><br><span class="line"></span><br><span class="line"># 单机多集群-启动：</span><br><span class="line">redis-server kconfig&#x2F;redis.config</span><br><span class="line">redis-cli -p 6379</span><br><span class="line"></span><br><span class="line">redis-server kconfig&#x2F;redis1.config</span><br><span class="line">redis-cli -p 6001</span><br><span class="line"></span><br><span class="line">redis-server kconfig&#x2F;redis2.config</span><br><span class="line">redis-cli -p 6002</span><br><span class="line"></span><br><span class="line">redis-server kconfig&#x2F;redis3.config</span><br><span class="line">redis-cli -p 6003</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>一主二从： 默认每一台都是主节点，查看主从信息：info replication，都是主机，开始配置从机(一般只配置从机，找老大) 主（6379），从（6001，6002，6003）</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">从机6001:</span><br><span class="line">slaveof 127.0.0.1 6379</span><br><span class="line">info replication</span><br><span class="line"></span><br><span class="line">从机6002:</span><br><span class="line">slaveof 127.0.0.1 6379</span><br><span class="line">info replication</span><br><span class="line"></span><br><span class="line">从机6003:</span><br><span class="line">slaveof 127.0.0.1 6379</span><br><span class="line">info replication</span><br><span class="line"></span><br><span class="line">主机6379：</span><br><span class="line">info replication</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>真是的主从配置应该在文件中配置，文件中配置是永久的，命令行是暂时的。</p></blockquote><blockquote><p>文件配置：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REPLICATION</span><br><span class="line">replicaof masterip masterport       # 主机ip和port </span><br><span class="line">masterauth                          # 主机密码</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>细节：主机可以写，从机不能写，只能读，主机中的所有数据自动被从机保存。</p></blockquote><blockquote><p>测试</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">主机：</span><br><span class="line">set k1 v1 </span><br><span class="line">从机：</span><br><span class="line">get k1</span><br><span class="line">set k2 v2</span><br><span class="line"># READONLY You can&#39;t write against a read only replica.</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>主机才能写，从机不能写。</p></blockquote><blockquote><p>测试主机断掉</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">主机：</span><br><span class="line">shutdown</span><br><span class="line">从机：</span><br><span class="line">info replication</span><br><span class="line"># 如果主机端了，从机必须手动改配置。</span><br><span class="line"># 主机断开重新上线后，从机依旧连接到主机，获取到数据。</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>测试从机断掉</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">从机：</span><br><span class="line">shutdown</span><br><span class="line">主机：</span><br><span class="line">info replication</span><br><span class="line">set k3 v3</span><br><span class="line">从机:</span><br><span class="line">get k3</span><br><span class="line">nil</span><br><span class="line"># 默认断开重启之后，只要没配置到文件配置中，默认变回主机。原先复制的数据还在，再变成从机还可以拿到主机数据。只要变回从机立马从主机中获取值。</span><br><span class="line">全量复制：从机连接主机第一次，全复制</span><br><span class="line">增量复制：已经连接，之后会把增加的复制过来</span><br><span class="line"># </span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>层层链路：</p></blockquote><blockquote><p>master-&gt;slave-&gt;slave,三个连在一起，m断了，第一个s能不能写呢,第一个s依旧是从节点不能写入。</p></blockquote><blockquote><p>谋朝篡位： 如果没有老大master了，能不能选出新老大，能，得手动。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">从机：</span><br><span class="line">slaveof no one # 自己当老大</span><br><span class="line"># 如果老大回来了，得重新配置连接</span><br><span class="line">slaveof 127.0.0.1 6379</span><br><span class="line"># 一层一层变动</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="12-哨兵模式："><a href="#12-哨兵模式：" class="headerlink" title="12.哨兵模式："></a><strong>12.哨兵模式：</strong></h2><p>（如果没有老大master了，自动选取新老大。）</p><blockquote><p>概念：</p></blockquote><p>谋朝篡位自动版，能够监控主机是否故障，如果故障了根据投票数自动将从库转为主库。</p><p>哨兵模式是一种特殊的模式，首先Redis提供哨兵模式的命令，哨兵是个独立的进程，它会独立运行。原理是哨兵通过发送指令，等待redis服务器响应，从而监控运行的多个redis实例。</p><p>单机哨兵：  命令：</p><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/7.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/7.png"></p><ol><li>redis-sentinel</li></ol><p>这里哨兵的两个作用：</p><ol><li>通过发送命令，让redis服务器返回运行状态，包括主从机服务器。</li><li>当哨兵检测到master舵机，自动将slave转为master，然后通过发布订阅模式通知其他的从服务器，修改配置文件让它转换为主机</li></ol><p>然而一个哨兵进程对redis服务器监控，可能出现问题，为此我们使用多哨兵进行监控。各个哨兵之间进行监控。6个进程</p><p>多哨兵模式：</p><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/8.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/8.png"></p><p>假设主服务器舵机，哨兵1先检测结果，系统不会立马进行failover过程，这仅仅是哨兵1主观的认为主服务器不可用，这个现象叫主观下线。当后面的哨兵也发现主服务器不可用，并且当数量达到一定值，他们认为主服务器彻底凉掉了。那么哨兵们进行一次投票（投票算法），后进行failover故障转移操作。转移之后，就会发布订阅模式，让哨兵把自己监控的从服务器切换为主机，这个过程为客观下线。</p><blockquote><p>测试</p></blockquote><p>目前状态1主3从，配置哨兵。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 1.创建哨兵文件配置：</span><br><span class="line">vim sentinel.conf：</span><br><span class="line"># sentinel monitor 监控名称 ip port </span><br><span class="line">sentinel monitor myredis 127.0.0.1 6379 1 </span><br><span class="line"># 监控主机,1代表主机挂了，从机会投票找新主机，票数多着成为主机</span><br><span class="line"></span><br><span class="line"># 2.启动哨兵</span><br><span class="line">redis-sentinel sentinel.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>测试</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">主机：</span><br><span class="line">shutdown</span><br><span class="line"></span><br><span class="line">从机01：</span><br><span class="line">info replication # 现在它还是从机,哨兵过一会再选举，进行故障转移</span><br><span class="line"></span><br><span class="line">从机02：</span><br><span class="line">info replication </span><br><span class="line"># 自动变为了master</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果master节点断开了，从从中随机选择1个转为主机。 哨兵日志有输出记录，新机回来了只能当从机，自动扫描并规定到新主机下当从机，这就是哨兵模式的规则</p><p>优点：</p><p>1)哨兵集群，基于主从复制，所有的主从配置优点他都有</p><p>2)主从可以切换，故障可以转移，系统可用性会更好 3)哨兵模式就是主从复制的升级，手动到自动，更加健壮</p><p>缺点：</p><p>1)redis不好在线扩容，当配置文件写死了更麻烦，在线扩容麻烦</p><p>2)实现哨兵配置很麻烦，里面有很多选择</p><blockquote><p>哨兵全部配置</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 哨兵sentinel实例运行的端口，多个哨兵配置多个端口</span><br><span class="line">prot 6379</span><br><span class="line"></span><br><span class="line"># 哨兵工作目录文件</span><br><span class="line">dir &#x2F;tmp</span><br><span class="line"></span><br><span class="line"># 哨兵监控的redis主节点的ip port</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 prot quorum</span><br><span class="line"></span><br><span class="line"># 当redis实例开启时requirepass foobared 授权密码，这样所有连接redis实例的客户端都要提供密码</span><br><span class="line">sentinel auth-pass mymaster password</span><br><span class="line"></span><br><span class="line"># 指定转换延迟秒数，默认30秒</span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"></span><br><span class="line"># 配置当某一事件发生需要执行的脚本</span><br><span class="line"># 脚本规则：</span><br><span class="line"># 脚本执行返回1：那么该脚本稍后会再次执行，重复执行数默认为10 </span><br><span class="line"># 脚本执行返回2：或者比2更大的数，脚本将不会再执行</span><br><span class="line"># 脚本被终端默认返回1，脚本最大执行时间为60s，超过60s，被sigkill信号终止，之后重新进行。</span><br><span class="line"></span><br><span class="line"># 通知类脚本：</span><br><span class="line"># 当sentinel有任何警告级别事件(主观、客观下线)，都会调用脚本，脚本应该通过邮件或sms形式通知管理员。调用该脚本将传给脚本2个参数，一个是事件的类型，一个是事件的描述，如果配置了脚本路径，必须存在该文件，否则sentinel启动不了</span><br><span class="line"></span><br><span class="line">#通知脚本：</span><br><span class="line">sentinel notification-script mymaster &#x2F;var&#x2F;redis&#x2F;notify.sh</span><br><span class="line"></span><br><span class="line">#客户端重新配置主节点参数脚本：</span><br><span class="line">#当一个master由于failover发生改变时，调用该脚本，通知相关客户端关于master的地址已经改变的信息。</span><br><span class="line">#一下参数将会在调用时传递给脚本：</span><br><span class="line">#master-name role state from-ip from-port to-ip to-port</span><br><span class="line">#目前state总是failover</span><br><span class="line">#role是leader或者observer中1个</span><br><span class="line">#参数from-ip from-port to-ip to-port是用来和旧的master和新的master通信的</span><br><span class="line">#这个脚本应该是通用的能被多次调用的，不是针对性的</span><br><span class="line">#sentinel client-reconfig-script master-name script-path</span><br><span class="line">#sentinel client-reconfig-script mymaster &#x2F;var&#x2F;redis&#x2F;reconfig.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>高级程序员：springboot、springcloud、架构、大数据、elk</p><h2 id="13-Redis缓存穿透和雪崩"><a href="#13-Redis缓存穿透和雪崩" class="headerlink" title="13.Redis缓存穿透和雪崩"></a><strong>13.Redis缓存穿透和雪崩</strong></h2><blockquote><p>都是服务高可用问题</p></blockquote><h3 id="13-1-缓存穿透（查不到）"><a href="#13-1-缓存穿透（查不到）" class="headerlink" title="13.1.缓存穿透（查不到）"></a><strong>13.1.缓存穿透（查不到）</strong></h3><blockquote><p>概念:</p></blockquote><p>读的请求先去redis中查，如果缓存中没有就去数据库中查询 如果jmeter，压力测试器或多请求客户端一直请求mysql，当很多时，给数据库造成很大压力。mysql崩了。</p><blockquote><p>解决方案:</p></blockquote><ol><li><p>布隆过滤器:布隆过滤器是一种数据结构，对所有查询的参数以hash形式储存，再控制器先校验，不符合就丢弃，从而避免对底层存储系统的查询压力。</p><p> <img src="https://github.com/peinimogu/learn-redis/raw/main/images/9.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/9.png"></p></li><li><p>缓存空对象：当存储层没有被命中后，即使返回的空对象也将缓存起来，同时设置一个过期时间，之后再访问这个数据将从缓存中获取，保护后端数据源。</p><p> <img src="https://github.com/peinimogu/learn-redis/raw/main/images/10.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/10.png"></p></li></ol><p>但是这种方法存在两个问题：</p><p>1)如果空值被缓存起来，需要更多的空间。</p><p>1)即使设置了过期时间，还是会存在缓存层和储存层的数据会有一段时间窗口不一致，这对需要保持一致性的业务有影响。</p><h3 id="13-2-缓存击穿（查的量太大）"><a href="#13-2-缓存击穿（查的量太大）" class="headerlink" title="13.2.缓存击穿（查的量太大）"></a><strong>13.2.缓存击穿（查的量太大）</strong></h3><blockquote><p>概念：</p></blockquote><p>火力全部击中一个点，指一个key非常热点，在不停的抗者大并发，大并发集中对这一个点进行访问，当key在失效的瞬间，持续的大并发就穿破缓存，直接请求到数据库。如：微博热搜。如果在这个点没有抗住，就会宕机。</p><blockquote><p>解决方案：</p></blockquote><p>1)设置热点数据永不过期</p><p>2)加互斥锁-分布式锁：保证对每个key同时只有一个线程去查询服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发转移到了分布式锁，因此对分布式锁考验很大。JUC并发</p><h3 id="13-1-缓存雪崩"><a href="#13-1-缓存雪崩" class="headerlink" title="13.1.缓存雪崩"></a><strong>13.1.缓存雪崩</strong></h3><blockquote><p>概念：</p></blockquote><p>指在某一个时间段，缓存集体失效。或者redis宕机。</p><p>比如双十一时，把这波比较集中的商品放入缓存中，假设缓存1个小时，那么过了1小时后，对这批商品的访问，全部落到数据库上，对数据库来说产生周期性的压力波峰。储存层调用量增大，造成储存层挂掉的情况。</p><p><img src="https://github.com/peinimogu/learn-redis/raw/main/images/11.png" alt="https://github.com/peinimogu/learn-redis/raw/main/images/11.png"></p><p>如果集中过期，倒不是最致命的，最致命的缓存雪崩是缓存缓存服务器的某个节点宕机或断网。 例子：双十一时候停掉一些服务或服务降级，保证主要的服务可用，如退款。</p><blockquote><p>解决方案：</p></blockquote><p>1)redis高可用：这个思想的含义是，既然redis可能挂掉，那么我多增设几台redis，这样1台挂掉之后，其他的还可以工作，其实就是搭建的集群。</p><p>2)降流降级：思想是在缓存就失效后，通过枷锁或者队列来控制都数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p><p>3)数据预热：在正式部署之前，对可能的数据预先访问一遍，在即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间尽量均匀。</p>]]></content>
      
      
      <categories>
          
          <category> 中间件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven学习笔记</title>
      <link href="/2019/08/13/Maven%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2019/08/13/Maven%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="Maven介绍"><a href="#Maven介绍" class="headerlink" title="Maven介绍:"></a>Maven介绍:</h2><p>Maven就是是专门为Java项目打造的管理和构建工具，它的主要功能有：</p><ul><li>提供了一套标准化的项目结构；</li><li>提供了一套标准化的构建流程（编译，测试，打包，发布……）；</li><li>提供了一套依赖管理机制。</li></ul><h3 id="Maven项目结构"><a href="#Maven项目结构" class="headerlink" title="Maven项目结构"></a>Maven项目结构</h3><p>一个使用Maven管理的普通的Java项目，它的目录结构默认如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a-maven-project</span><br><span class="line">├── pom.xml</span><br><span class="line">├── src</span><br><span class="line">│   ├── main</span><br><span class="line">│   │   ├── java</span><br><span class="line">│   │   └── resources</span><br><span class="line">│   └── test</span><br><span class="line">│       ├── java</span><br><span class="line">│       └── resources</span><br><span class="line">└── target</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>项目的根目录<code>a-maven-project</code>是项目名，它有一个项目描述文件<code>pom.xml</code>，存放Java源码的目录是<code>src/main/java</code>，存放资源文件的目录是<code>src/main/resources</code>，存放测试源码的目录是<code>src/test/java</code>，存放测试资源的目录是<code>src/test/resources</code>，最后，所有编译、打包生成的文件都放在<code>target</code>目录里。这些就是一个Maven项目的标准目录结构。</p><p>所有的目录结构都是约定好的标准结构，我们千万不要随意修改目录结构。使用标准结构不需要做任何配置，Maven就可以正常使用。</p><p>我们再来看最关键的一个项目描述文件<code>pom.xml</code>，它的内容长得像下面：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;project ...&gt;</span><br><span class="line">&lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">&lt;groupId&gt;com.itranswarp.learnjava&lt;&#x2F;groupId&gt;</span><br><span class="line">&lt;artifactId&gt;hello&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">        ...</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-logging&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-logging&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中，<code>groupId</code>类似于Java的包名，通常是公司或组织名称，<code>artifactId</code>类似于Java的类名，通常是项目名称，再加上<code>version</code>，一个Maven工程就是由<code>groupId</code>，<code>artifactId</code>和<code>version</code>作为唯一标识。我们在引用其他第三方库的时候，也是通过这3个变量确定。例如，依赖<code>commons-logging</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-logging&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-logging&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用<code>&lt;dependency&gt;</code>声明一个依赖后，Maven就会自动下载这个依赖包并把它放到classpath中。</p><h3 id="安装Maven"><a href="#安装Maven" class="headerlink" title="安装Maven"></a>安装Maven</h3><p>要安装Maven，可以从<a href="https://maven.apache.org/">Maven官网</a>下载最新的Maven 3.6.x，然后在本地解压，设置几个环境变量：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">M2_HOME&#x3D;&#x2F;path&#x2F;to&#x2F;maven-3.6.xPATH&#x3D;$PATH:$M2_HOME&#x2F;bin</span><br></pre></td></tr></table></figure><h2 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理:"></a>依赖管理:</h2><p>如果我们的项目依赖第三方的jar包，例如commons logging，那么问题来了：commons logging发布的jar包在哪下载？</p><p>如果我们还希望依赖log4j，那么使用log4j需要哪些jar包？</p><p>类似的依赖还包括：JUnit，JavaMail，MySQL驱动等等，一个可行的方法是通过搜索引擎搜索到项目的官网，然后手动下载zip包，解压，放入classpath。但是，这个过程非常繁琐。</p><p>Maven解决了依赖管理问题。例如，我们的项目依赖<code>abc</code>这个jar包，而<code>abc</code>又依赖<code>xyz</code>这个jar包：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">┌──────────────┐</span><br><span class="line">│Sample Project│</span><br><span class="line">└──────────────┘</span><br><span class="line">        │</span><br><span class="line">        ▼</span><br><span class="line">┌──────────────┐</span><br><span class="line">│     abc      │</span><br><span class="line">└──────────────┘</span><br><span class="line">        │</span><br><span class="line">        ▼</span><br><span class="line">┌──────────────┐</span><br><span class="line">│     xyz      │</span><br><span class="line">└──────────────┘</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>当我们声明了<code>abc</code>的依赖时，Maven自动把<code>abc</code>和<code>xyz</code>都加入了我们的项目依赖，不需要我们自己去研究<code>abc</code>是否需要依赖<code>xyz</code>。</p><p>因此，Maven的第一个作用就是解决依赖管理。我们声明了自己的项目需要<code>abc</code>，Maven会自动导入<code>abc</code>的jar包，再判断出<code>abc</code>需要<code>xyz</code>，又会自动导入<code>xyz</code>的jar包，这样，最终我们的项目会依赖<code>abc</code>和<code>xyz</code>两个jar包。</p><p>我们来看一个复杂依赖示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4.2.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>当我们声明一个<code>spring-boot-starter-web</code>依赖时，Maven会自动解析并判断最终需要大概二三十个其他依赖：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">spring-boot-starter-web</span><br><span class="line">  spring-boot-starter</span><br><span class="line">    spring-boot</span><br><span class="line">    sprint-boot-autoconfigure</span><br><span class="line">    spring-boot-starter-logging</span><br><span class="line">      logback-classic</span><br><span class="line">        logback-core</span><br><span class="line">        slf4j-api</span><br><span class="line">      jcl-over-slf4j</span><br><span class="line">        slf4j-api</span><br><span class="line">      jul-to-slf4j</span><br><span class="line">        slf4j-api</span><br><span class="line">      log4j-over-slf4j</span><br><span class="line">        slf4j-api</span><br><span class="line">    spring-core</span><br><span class="line">    snakeyaml</span><br><span class="line">  spring-boot-starter-tomcat</span><br><span class="line">    tomcat-embed-core</span><br><span class="line">    tomcat-embed-el</span><br><span class="line">    tomcat-embed-websocket</span><br><span class="line">      tomcat-embed-core</span><br><span class="line">  jackson-databind</span><br><span class="line">  ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果我们自己去手动管理这些依赖是非常费时费力的，而且出错的概率很大。</p><h3 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系:"></a>依赖关系:</h3><p>Maven定义了几种依赖关系，分别是<code>compile</code>、<code>test</code>、<code>runtime</code>和<code>provided</code>：</p><p><a href="https://www.notion.so/6247453f8f38404c9e697d1c7283ff04">Untitled</a></p><p>其中，默认的<code>compile</code>是最常用的，Maven会把这种类型的依赖直接放入classpath。</p><p><code>test</code>依赖表示仅在测试时使用，正常运行时并不需要。最常用的<code>test</code>依赖就是JUnit：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.junit.jupiter&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit-jupiter-api&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.3.2&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>runtime</code>依赖表示编译时不需要，但运行时需要。最典型的<code>runtime</code>依赖是JDBC驱动，例如MySQL驱动：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.1.48&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>provided</code>依赖表示编译时需要，但运行时不需要。最典型的<code>provided</code>依赖是Servlet API，编译的时候需要，但是运行时，Servlet服务器内置了相关的jar，所以运行期不需要：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.servlet-api&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.0.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后一个问题是，Maven如何知道从何处下载所需的依赖？也就是相关的jar包？答案是Maven维护了一个中央仓库（<a href="https://repo1.maven.org/">repo1.maven.org</a>），所有第三方库将自身的jar以及相关信息上传至中央仓库，Maven就可以从中央仓库把所需依赖下载到本地。</p><p>Maven并不会每次都从中央仓库下载jar包。一个jar包一旦被下载过，就会被Maven自动缓存在本地目录（用户主目录的<code>.m2</code>目录），所以，除了第一次编译时因为下载需要时间会比较慢，后续过程因为有本地缓存，并不会重复下载相同的jar包。</p><h3 id="唯一ID"><a href="#唯一ID" class="headerlink" title="唯一ID"></a>唯一ID</h3><p>对于某个依赖，Maven只需要3个变量即可唯一确定某个jar包：</p><ul><li>groupId：属于组织的名称，类似Java的包名；</li><li>artifactId：该jar包自身的名称，类似Java的类名；</li><li>version：该jar包的版本。</li></ul><p>通过上述3个变量，即可唯一确定某个jar包。Maven通过对jar包进行PGP签名确保任何一个jar包一经发布就无法修改。修改已发布jar包的唯一方法是发布一个新版本。</p><p>因此，某个jar包一旦被Maven下载过，即可永久地安全缓存在本地。</p><p>注：只有以<code>-SNAPSHOT</code>结尾的版本号会被Maven视为开发版本，开发版本每次都会重复下载，这种SNAPSHOT版本只能用于内部私有的Maven repo，公开发布的版本不允许出现SNAPSHOT。</p><h3 id="Maven镜像"><a href="#Maven镜像" class="headerlink" title="Maven镜像"></a>Maven镜像</h3><p>除了可以从Maven的中央仓库下载外，还可以从Maven的镜像仓库下载。如果访问Maven的中央仓库非常慢，我们可以选择一个速度较快的Maven的镜像仓库。Maven镜像仓库定期从中央仓库同步：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">           slow    ┌───────────────────┐</span><br><span class="line">    ┌─────────────&gt;│Maven Central Repo.│</span><br><span class="line">    │              └───────────────────┘</span><br><span class="line">    │                        │</span><br><span class="line">    │                        │sync</span><br><span class="line">    │                        ▼</span><br><span class="line">┌───────┐  fast    ┌───────────────────┐</span><br><span class="line">│ User  │─────────&gt;│Maven Mirror Repo. │</span><br><span class="line">└───────┘          └───────────────────┘</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>中国区用户可以使用阿里云提供的Maven镜像仓库。使用Maven镜像仓库需要一个配置，在用户主目录下进入<code>.m2</code>目录，创建一个<code>settings.xml</code>配置文件，内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">    &lt;mirrors&gt;</span><br><span class="line">        &lt;mirror&gt;</span><br><span class="line">            &lt;id&gt;aliyun&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;name&gt;aliyun&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">&lt;!-- 国内推荐阿里云的Maven镜像 --&gt;&lt;url&gt;https:&#x2F;&#x2F;maven.aliyun.com&#x2F;repository&#x2F;central&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;&#x2F;mirror&gt;</span><br><span class="line">    &lt;&#x2F;mirrors&gt;</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置镜像仓库后，Maven的下载速度就会非常快。</p><h3 id="搜索第三方组件"><a href="#搜索第三方组件" class="headerlink" title="搜索第三方组件"></a>搜索第三方组件</h3><p>最后一个问题：如果我们要引用一个第三方组件，比如<code>okhttp</code>，如何确切地获得它的<code>groupId</code>、<code>artifactId</code>和<code>version</code>？方法是通过<a href="https://search.maven.org/">search.maven.org</a>搜索关键字，找到对应的组件后，直接复制：</p><p><a href="https://www.liaoxuefeng.com/files/attachments/1322179230695490/l">https://www.liaoxuefeng.com/files/attachments/1322179230695490/l</a></p><h3 id="命令行编译"><a href="#命令行编译" class="headerlink" title="命令行编译"></a>命令行编译</h3><p>在命令中，进入到<code>pom.xml</code>所在目录，输入以下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mvn clean package</span><br></pre></td></tr></table></figure><h2 id="构建流程"><a href="#构建流程" class="headerlink" title="构建流程:"></a>构建流程:</h2><h3 id="构建流程-1"><a href="#构建流程-1" class="headerlink" title="构建流程"></a>构建流程</h3><p>Maven不但有标准化的项目结构，而且还有一套标准化的构建流程，可以自动化实现编译，打包，发布，等等。</p><h3 id="Lifecycle和Phase"><a href="#Lifecycle和Phase" class="headerlink" title="Lifecycle和Phase"></a>Lifecycle和Phase</h3><p>使用Maven时，我们首先要了解什么是Maven的生命周期（lifecycle）。</p><p>Maven的生命周期由一系列阶段（phase）构成，以内置的生命周期<code>default</code>为例，它包含以下phase：</p><ul><li>validate</li><li>initialize</li><li>generate-sources</li><li>process-sources</li><li>generate-resources</li><li>process-resources</li><li>compile</li><li>process-classes</li><li>generate-test-sources</li><li>process-test-sources</li><li>generate-test-resources</li><li>process-test-resources</li><li>test-compile</li><li>process-test-classes</li><li>test</li><li>prepare-package</li><li>package</li><li>pre-integration-test</li><li>integration-test</li><li>post-integration-test</li><li>verify</li><li>install</li><li>deploy</li></ul><p>如果我们运行<code>mvn package</code>，Maven就会执行<code>default</code>生命周期，它会从开始一直运行到<code>package</code>这个phase为止：</p><ul><li>validate</li><li>…</li><li>package</li></ul><p>如果我们运行<code>mvn compile</code>，Maven也会执行<code>default</code>生命周期，但这次它只会运行到<code>compile</code>，即以下几个phase：</p><ul><li>validate</li><li>…</li><li>compile</li></ul><p>Maven另一个常用的生命周期是<code>clean</code>，它会执行3个phase：</p><ul><li>pre-clean</li><li>clean （注意这个clean不是lifecycle而是phase）</li><li>post-clean</li></ul><p>所以，我们使用<code>mvn</code>这个命令时，后面的参数是phase，Maven自动根据生命周期运行到指定的phase。</p><p>更复杂的例子是指定多个phase，例如，运行<code>mvn clean package</code>，Maven先执行<code>clean</code>生命周期并运行到<code>clean</code>这个phase，然后执行<code>default</code>生命周期并运行到<code>package</code>这个phase，实际执行的phase如下：</p><ul><li>pre-clean</li><li>clean （注意这个clean是phase）</li><li>validate</li><li>…</li><li>package</li></ul><p>在实际开发过程中，经常使用的命令有：</p><p><code>mvn clean</code>：清理所有生成的class和jar；</p><p><code>mvn clean compile</code>：先清理，再执行到<code>compile</code>；</p><p><code>mvn clean test</code>：先清理，再执行到<code>test</code>，因为执行<code>test</code>前必须执行<code>compile</code>，所以这里不必指定<code>compile</code>；</p><p><code>mvn clean package</code>：先清理，再执行到<code>package</code>。</p><p>大多数phase在执行过程中，因为我们通常没有在<code>pom.xml</code>中配置相关的设置，所以这些phase什么事情都不做。</p><p>经常用到的phase其实只有几个：</p><ul><li>clean：清理</li><li>compile：编译</li><li>test：运行测试</li><li>package：打包</li></ul><h3 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h3><p>执行一个phase又会触发一个或多个goal：</p><p><a href="https://www.notion.so/a20188a3e0174e87a895099f07ad5bf6">Untitled</a></p><p>goal的命名总是<code>abc:xyz</code>这种形式。</p><p>看到这里，相信大家对lifecycle、phase和goal已经明白了吧？</p><h2 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件:"></a>使用插件:</h2><p>我们在前面介绍了Maven的lifecycle，phase和goal：使用Maven构建项目就是执行lifecycle，执行到指定的phase为止。每个phase会执行自己默认的一个或多个goal。goal是最小任务单元。</p><p>我们以<code>compile</code>这个phase为例，如果执行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn compile</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Maven将执行<code>compile</code>这个phase，这个phase会调用<code>compiler</code>插件执行关联的<code>compiler:compile</code>这个goal。</p><p>实际上，执行每个phase，都是通过某个插件（plugin）来执行的，Maven本身其实并不知道如何执行<code>compile</code>，它只是负责找到对应的<code>compiler</code>插件，然后执行默认的<code>compiler:compile</code>这个goal来完成编译。</p><p>所以，使用Maven，实际上就是配置好需要使用的插件，然后通过phase调用它们。</p><p>Maven已经内置了一些常用的标准插件：</p><p><a href="https://www.notion.so/885e77e11f2d4d69af41315dd443f44f">Untitled</a></p><p>如果标准插件无法满足需求，我们还可以使用自定义插件。使用自定义插件的时候，需要声明。例如，使用<code>maven-shade-plugin</code>可以创建一个可执行的jar，要使用这个插件，需要在<code>pom.xml</code>中声明它：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;build&gt;</span><br><span class="line">&lt;plugins&gt;</span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">&lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">&lt;artifactId&gt;maven-shade-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.2.1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;executions&gt;</span><br><span class="line">&lt;execution&gt;</span><br><span class="line">&lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">&lt;goals&gt;</span><br><span class="line">&lt;goal&gt;shade&lt;&#x2F;goal&gt;</span><br><span class="line">&lt;&#x2F;goals&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">                            ...</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;execution&gt;</span><br><span class="line">&lt;&#x2F;executions&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br><span class="line">&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>自定义插件往往需要一些配置，例如，<code>maven-shade-plugin</code>需要指定Java程序的入口，它的配置是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;transformers&gt;</span><br><span class="line">        &lt;transformer implementation&#x3D;&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;&gt;</span><br><span class="line">            &lt;mainClass&gt;com.itranswarp.learnjava.Main&lt;&#x2F;mainClass&gt;</span><br><span class="line">        &lt;&#x2F;transformer&gt;</span><br><span class="line">    &lt;&#x2F;transformers&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意，Maven自带的标准插件例如<code>compiler</code>是无需声明的，只有引入其它的插件才需要声明。</p><p>下面列举了一些常用的插件：</p><ul><li>maven-shade-plugin：打包所有依赖包并生成可执行jar；</li><li>cobertura-maven-plugin：生成单元测试覆盖率报告；</li><li>findbugs-maven-plugin：对Java源码进行静态分析以找出潜在问题。</li></ul><h2 id="模块管理"><a href="#模块管理" class="headerlink" title="模块管理:"></a>模块管理:</h2><p>在软件开发中，把一个大项目分拆为多个模块是降低软件复杂度的有效方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">                        ┌ ─ ─ ─ ─ ─ ─ ┐</span><br><span class="line">                          ┌─────────┐</span><br><span class="line">                        │ │Module A │ │</span><br><span class="line">                          └─────────┘</span><br><span class="line">┌──────────────┐ split  │ ┌─────────┐ │</span><br><span class="line">│Single Project│───────&gt;  │Module B │</span><br><span class="line">└──────────────┘        │ └─────────┘ │</span><br><span class="line">                          ┌─────────┐</span><br><span class="line">                        │ │Module C │ │</span><br><span class="line">                          └─────────┘</span><br><span class="line">                        └ ─ ─ ─ ─ ─ ─ ┘</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>对于Maven工程来说，原来是一个大项目：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">single-project</span><br><span class="line">├── pom.xml</span><br><span class="line">└── src</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>现在可以分拆成3个模块：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mutiple-project</span><br><span class="line">├── module-a</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">├── module-b</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">└── module-c</span><br><span class="line">    ├── pom.xml</span><br><span class="line">    └── src</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Maven可以有效地管理多个模块，我们只需要把每个模块当作一个独立的Maven项目，它们有各自独立的<code>pom.xml</code>。例如，模块A的<code>pom.xml</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">    xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.itranswarp.learnjava&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;module-a&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;name&gt;module-a&lt;&#x2F;name&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;&#x2F;project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;&#x2F;maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;&#x2F;maven.compiler.target&gt;</span><br><span class="line">        &lt;java.version&gt;11&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-api&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.7.28&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-classic&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.3&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.junit.jupiter&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit-jupiter-engine&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.5.2&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>模块B的<code>pom.xml</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">    xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.itranswarp.learnjava&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;module-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;name&gt;module-b&lt;&#x2F;name&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;&#x2F;project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;&#x2F;maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;&#x2F;maven.compiler.target&gt;</span><br><span class="line">        &lt;java.version&gt;11&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-api&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.7.28&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-classic&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.3&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.junit.jupiter&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit-jupiter-engine&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.5.2&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看出来，模块A和模块B的<code>pom.xml</code>高度相似，因此，我们可以提取出共同部分作为<code>parent</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">    xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.itranswarp.learnjava&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;name&gt;parent&lt;&#x2F;name&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;&#x2F;project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;&#x2F;maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;&#x2F;maven.compiler.target&gt;</span><br><span class="line">        &lt;java.version&gt;11&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-api&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.7.28&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-classic&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.3&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.junit.jupiter&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit-jupiter-engine&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.5.2&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意到parent的<code>&lt;packaging&gt;</code>是<code>pom</code>而不是<code>jar</code>，因为<code>parent</code>本身不含任何Java代码。编写<code>parent</code>的<code>pom.xml</code>只是为了在各个模块中减少重复的配置。现在我们的整个工程结构如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">multiple-project</span><br><span class="line">├── pom.xml</span><br><span class="line">├── parent</span><br><span class="line">│   └── pom.xml</span><br><span class="line">├── module-a</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">├── module-b</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">└── module-c</span><br><span class="line">    ├── pom.xml</span><br><span class="line">    └── src</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这样模块A就可以简化为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">    xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;com.itranswarp.learnjava&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;relativePath&gt;..&#x2F;parent&#x2F;pom.xml&lt;&#x2F;relativePath&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;module-a&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;name&gt;module-a&lt;&#x2F;name&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>模块B、模块C都可以直接从<code>parent</code>继承，大幅简化了<code>pom.xml</code>的编写。</p><p>如果模块A依赖模块B，则模块A需要模块B的jar包才能正常编译，我们需要在模块A中引入模块B：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.itranswarp.learnjava&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;module-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后，在编译的时候，需要在根目录创建一个<code>pom.xml</code>统一编译：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">    xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;maven-v4_0_0.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;com.itranswarp.learnjava&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;build&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;name&gt;build&lt;&#x2F;name&gt;</span><br><span class="line"></span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;parent&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;module&gt;module-a&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;module&gt;module-b&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;module&gt;module-c&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这样，在根目录执行<code>mvn clean package</code>时，Maven根据根目录的<code>pom.xml</code>找到包括<code>parent</code>在内的共4个<code>&lt;module&gt;</code>，一次性全部编译。</p><h3 id="中央仓库"><a href="#中央仓库" class="headerlink" title="中央仓库"></a>中央仓库</h3><p>其实我们使用的大多数第三方模块都是这个用法，例如，我们使用commons logging、log4j这些第三方模块，就是第三方模块的开发者自己把编译好的jar包发布到Maven的中央仓库中。</p><h3 id="私有仓库"><a href="#私有仓库" class="headerlink" title="私有仓库"></a>私有仓库</h3><p>私有仓库是指公司内部如果不希望把源码和jar包放到公网上，那么可以搭建私有仓库。私有仓库总是在公司内部使用，它只需要在本地的<code>~/.m2/settings.xml</code>中配置好，使用方式和中央仓位没有任何区别。</p><h3 id="本地仓库"><a href="#本地仓库" class="headerlink" title="本地仓库"></a>本地仓库</h3><p>本地仓库是指把本地开发的项目“发布”在本地，这样其他项目可以通过本地仓库引用它。但是我们不推荐把自己的模块安装到Maven的本地仓库，因为每次修改某个模块的源码，都需要重新安装，非常容易出现版本不一致的情况。更好的方法是使用模块化编译，在编译的时候，告诉Maven几个模块之间存在依赖关系，需要一块编译，Maven就会自动按依赖顺序编译这些模块。</p><h2 id="使用mvnw"><a href="#使用mvnw" class="headerlink" title="使用mvnw:"></a>使用mvnw:</h2><p>我们使用Maven时，基本上只会用到<code>mvn</code>这一个命令。有些童鞋可能听说过<code>mvnw</code>，这个是啥？</p><p><code>mvnw</code>是Maven Wrapper的缩写。因为我们安装Maven时，默认情况下，系统所有项目都会使用全局安装的这个Maven版本。但是，对于某些项目来说，它可能必须使用某个特定的Maven版本，这个时候，就可以使用Maven Wrapper，它可以负责给这个特定的项目安装指定版本的Maven，而其他项目不受影响。</p><p>简单地说，Maven Wrapper就是给一个项目提供一个独立的，指定版本的Maven给它使用。</p><h3 id="安装Maven-Wrapper"><a href="#安装Maven-Wrapper" class="headerlink" title="安装Maven Wrapper"></a>安装Maven Wrapper</h3><p>安装Maven Wrapper最简单的方式是在项目的根目录（即<code>pom.xml</code>所在的目录）下运行安装命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn -N io.takari:maven:0.7.6:wrapper</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>它会自动使用最新版本的Maven。注意<code>0.7.6</code>是Maven Wrapper的版本。最新的Maven Wrapper版本可以去<a href="https://github.com/takari/maven-wrapper">官方网站</a>查看。</p><p>如果要指定使用的Maven版本，使用下面的安装命令指定版本，例如<code>3.3.3</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -N io.takari:maven:0.7.6:wrapper -Dmaven&#x3D;3.3.3</span><br></pre></td></tr></table></figure><p>安装后，查看项目结构：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">my-project</span><br><span class="line">├── .mvn</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── MavenWrapperDownloader.java</span><br><span class="line">│       ├── maven-wrapper.jar</span><br><span class="line">│       └── maven-wrapper.properties</span><br><span class="line">├── mvnw</span><br><span class="line">├── mvnw.cmd</span><br><span class="line">├── pom.xml</span><br><span class="line">└── src</span><br><span class="line">    ├── main</span><br><span class="line">    │   ├── java</span><br><span class="line">    │   └── resources</span><br><span class="line">    └── test</span><br><span class="line">        ├── java</span><br><span class="line">        └── resources</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>发现多了<code>mvnw</code>、<code>mvnw.cmd</code>和<code>.mvn</code>目录，我们只需要把<code>mvn</code>命令改成<code>mvnw</code>就可以使用跟项目关联的Maven。例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvnw cleanpackage</span><br></pre></td></tr></table></figure><p>在Linux或macOS下运行时需要加上<code>./</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;mvnw cleanpackage</span><br></pre></td></tr></table></figure><p>Maven Wrapper的另一个作用是把项目的<code>mvnw</code>、<code>mvnw.cmd</code>和<code>.mvn</code>提交到版本库中，可以使所有开发人员使用统一的Maven版本。</p><h2 id="发布Artifact"><a href="#发布Artifact" class="headerlink" title="发布Artifact:"></a>发布Artifact:</h2><p>当我们使用<code>commons-logging</code>这些第三方开源库的时候，我们实际上是通过Maven自动下载它的jar包，并根据其<code>pom.xml</code>解析依赖，自动把相关依赖包都下载后加入到classpath。</p><p>那么问题来了：当我们自己写了一个牛逼的开源库时，非常希望别人也能使用，总不能直接放个jar包的链接让别人下载吧？</p><p>如果我们把自己的开源库放到Maven的repo中，那么，别人只需按标准引用<code>groupId:artifactId:version</code>，即可自动下载jar包以及相关依赖。因此，本节我们介绍如何发布一个库到Maven的repo中。</p><p>把自己的库发布到Maven的repo中有好几种方法，我们介绍3种最常用的方法。</p><h3 id="以静态文件发布"><a href="#以静态文件发布" class="headerlink" title="以静态文件发布"></a>以静态文件发布</h3><p>如果我们观察一个中央仓库的Artifact结构，例如<a href="https://commons.apache.org/proper/commons-math/">Commons Math</a>，它的groupId是<code>org.apache.commons</code>，artifactId是<code>commons-math3</code>，以版本<code>3.6.1</code>为例，发布在中央仓库的文件夹路径就是<a href="https://repo1.maven.org/maven2/org/apache/commons/commons-math3/3.6.1/">https://repo1.maven.org/maven2/org/apache/commons/commons-math3/3.6.1/</a>，在此文件夹下，<code>commons-math3-3.6.1.jar</code>就是发布的jar包，<code>commons-math3-3.6.1.pom</code>就是它的<code>pom.xml</code>描述文件，<code>commons-math3-3.6.1-sources.jar</code>是源代码，<code>commons-math3-3.6.1-javadoc.jar</code>是文档。其它以<code>.asc</code>、<code>.md5</code>、<code>.sha1</code>结尾的文件分别是GPG签名、MD5摘要和SHA-1摘要。</p><p>我们只要按照这种目录结构组织文件，它就是一个有效的Maven仓库。</p><p>我们以广受好评的开源项目<a href="https://github.com/michaelliao/how-to-become-rich">how-to-become-rich</a>为例，先创建Maven工程目录结构如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">how-to-become-rich</span><br><span class="line">├── maven-repo        &lt;-- Maven本地文件仓库</span><br><span class="line">├── pom.xml           &lt;-- 项目文件</span><br><span class="line">├── src</span><br><span class="line">│   ├── main</span><br><span class="line">│   │   ├── java      &lt;-- 源码目录</span><br><span class="line">│   │   └── resources &lt;-- 资源目录</span><br><span class="line">│   └── test</span><br><span class="line">│       ├── java      &lt;-- 测试源码目录</span><br><span class="line">│       └── resources &lt;-- 测试资源目录</span><br><span class="line">└── target            &lt;-- 编译输出目录</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在<code>pom.xml</code>中添加如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;project ...&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;distributionManagement&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;local-repo-release&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;name&gt;GitHub Release&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;url&gt;file:&#x2F;&#x2F;$&#123;project.basedir&#125;&#x2F;maven-repo&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;&#x2F;repository&gt;</span><br><span class="line">    &lt;&#x2F;distributionManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-source-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;attach-sources&lt;&#x2F;id&gt;</span><br><span class="line">                        &lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;jar-no-fork&lt;&#x2F;goal&gt;</span><br><span class="line">                        &lt;&#x2F;goals&gt;</span><br><span class="line">                    &lt;&#x2F;execution&gt;</span><br><span class="line">                &lt;&#x2F;executions&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-javadoc-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;attach-javadocs&lt;&#x2F;id&gt;</span><br><span class="line">                        &lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;jar&lt;&#x2F;goal&gt;</span><br><span class="line">                        &lt;&#x2F;goals&gt;</span><br><span class="line">                    &lt;&#x2F;execution&gt;</span><br><span class="line">                &lt;&#x2F;executions&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意到<code>&lt;distributionManagement&gt;</code>，它指示了发布的软件包的位置，这里的<code>&lt;url&gt;</code>是项目根目录下的<code>maven-repo</code>目录，在<code>&lt;build&gt;</code>中定义的两个插件<code>maven-source-plugin</code>和<code>maven-javadoc-plugin</code>分别用来创建源码和javadoc，如果不想发布源码，可以把对应的插件去掉。</p><p>我们直接在项目根目录下运行Maven命令<code>mvn clean package deploy</code>，如果一切顺利，我们就可以在<code>maven-repo</code>目录下找到部署后的所有文件如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">maven-repo</span><br><span class="line">└── com</span><br><span class="line">    └── itranswarp</span><br><span class="line">        └── rich</span><br><span class="line">            └── how-to-become-rich</span><br><span class="line">                ├── 1.0.0</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0-javadoc.jar</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0-javadoc.jar.md5</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0-javadoc.jar.sha1</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0-sources.jar</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0-sources.jar.md5</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0-sources.jar.sha1</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0.jar</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0.jar.md5</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0.jar.sha1</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0.pom</span><br><span class="line">                │   ├── how-to-become-rich-1.0.0.pom.md5</span><br><span class="line">                │   └── how-to-become-rich-1.0.0.pom.sha1</span><br><span class="line">                ├── maven-metadata.xml</span><br><span class="line">                ├── maven-metadata.xml.md5</span><br><span class="line">                └── maven-metadata.xml.sha1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后一步，是把这个工程推到GitHub上，并选择<code>Settings</code>-<code>GitHub Pages</code>，选择<code>master branch</code>启用Pages服务：</p><p><img src="learn-maven%20eb9d5ffa7bae4b5bb1e0874b7f871af4/Untitled.png" alt="learn-maven%20eb9d5ffa7bae4b5bb1e0874b7f871af4/Untitled.png"></p><p>这样，把全部内容推送至GitHub后，即可作为静态网站访问Maven的repo，它的地址是<a href="https://michaelliao.github.io/how-to-become-rich/maven-repo/">https://michaelliao.github.io/how-to-become-rich/maven-repo/</a>。版本<code>1.0.0</code>对应的jar包地址是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;michaelliao.github.io&#x2F;how-to-become-rich&#x2F;maven-repo&#x2F;com&#x2F;itranswarp&#x2F;rich&#x2F;how-to-become-rich&#x2F;1.0.0&#x2F;how-to-become-rich-1.0.0.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>现在，如果其他人希望引用这个Maven包，我们可以告知如下依赖即可：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.itranswarp.rich&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;how-to-become-rich&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但是，除了正常导入依赖外，对方还需要再添加一个<code>&lt;repository&gt;</code>的声明，即使用方完整的<code>pom.xml</code>如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">    xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;example&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;how-to-become-rich-usage&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;11&lt;&#x2F;maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;11&lt;&#x2F;maven.compiler.target&gt;</span><br><span class="line">        &lt;java.version&gt;11&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;repositories&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;github-rich-repo&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;name&gt;The Maven Repository on Github&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;url&gt;https:&#x2F;&#x2F;michaelliao.github.io&#x2F;how-to-become-rich&#x2F;maven-repo&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;&#x2F;repository&gt;</span><br><span class="line">    &lt;&#x2F;repositories&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.itranswarp.rich&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;how-to-become-rich&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在<code>&lt;repository&gt;</code>中，我们必须声明发布的Maven的repo地址，其中<code>&lt;id&gt;</code>和<code>&lt;name&gt;</code>可以任意填写，<code>&lt;url&gt;</code>填入GitHub Pages提供的地址+<code>/maven-repo/</code>后缀。现在，即可正常引用这个库并编写代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Millionaire millionaire &#x3D;new Millionaire();</span><br><span class="line">System.out.println(millionaire.howToBecomeRich());</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>有的童鞋会问，为什么使用<code>commons-logging</code>等第三方库时，并不需要声明repo地址？这是因为这些库都是发布到Maven中央仓库的，发布到中央仓库后，不需要告诉Maven仓库地址，因为它知道中央仓库的地址默认是<a href="https://repo1.maven.org/maven2/">https://repo1.maven.org/maven2/</a>，也可以通过<code>~/.m2/settings.xml</code>指定一个代理仓库地址以替代中央仓库来提高速度（参考<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1309301178105890">依赖管理</a>的Maven镜像）。</p><p>因为GitHub Pages并不会把我们发布的Maven包同步到中央仓库，所以自然使用方必须手动添加一个我们提供的仓库地址。</p><p>此外，通过GitHub Pages发布Maven repo时需要注意一点，即不要改动已发布的版本。因为Maven的仓库是不允许修改任何版本的，对一个库进行修改的唯一方法是发布一个新版本。但是通过静态文件的方式发布repo，实际上我们是可以修改jar文件的，但最好遵守规范，不要修改已发布版本。</p><h3 id="通过Nexus发布到中央仓库"><a href="#通过Nexus发布到中央仓库" class="headerlink" title="通过Nexus发布到中央仓库"></a>通过Nexus发布到中央仓库</h3><p>有的童鞋会问，能不能把自己的开源库发布到Maven的中央仓库，这样用户就不需要声明repo地址，可以直接引用，显得更专业。</p><p>当然可以，但我们不能直接发布到Maven中央仓库，而是通过曲线救国的方式，发布到<a href="https://central.sonatype.org/">central.sonatype.org</a>，它会定期自动同步到Maven的中央仓库。<a href="https://www.sonatype.com/nexus-repository-oss">Nexus</a>是一个支持Maven仓库的软件，由Sonatype开发，有免费版和专业版两个版本，很多大公司内部都使用Nexus作为自己的私有Maven仓库，而这个<a href="https://central.sonatype.org/">central.sonatype.org</a>相当于面向开源的一个Nexus公共服务。</p><p>所以，第一步是在<a href="https://central.sonatype.org/">central.sonatype.org</a>上注册一个账号，注册链接非常隐蔽，可以自己先找找，找半小时没找到点这里查看攻略。</p><p>如果注册顺利并审核通过，会得到一个登录账号，然后，通过<a href="https://central.sonatype.org/pages/apache-maven.html">这个页面</a>一步一步操作就可以成功地将自己的Artifact发布到Nexus上，再耐心等待几个小时后，你的Artifact就会出现在Maven的中央仓库中。</p><p>这里简单提一下发布重点与难点：</p><ul><li>必须正确创建GPG签名，Linux和Mac下推荐使用gnupg2；</li><li>必须在<code>~/.m2/settings.xml</code>中配置好登录用户名和口令，以及GPG口令：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings ...&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;servers&gt;</span><br><span class="line">        &lt;server&gt;</span><br><span class="line">            &lt;id&gt;ossrh&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;username&gt;OSSRH-USERNAME&lt;&#x2F;username&gt;</span><br><span class="line">            &lt;password&gt;OSSRH-PASSWORD&lt;&#x2F;password&gt;</span><br><span class="line">        &lt;&#x2F;server&gt;</span><br><span class="line">    &lt;&#x2F;servers&gt;</span><br><span class="line">    &lt;profiles&gt;</span><br><span class="line">        &lt;profile&gt;</span><br><span class="line">            &lt;id&gt;ossrh&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;activation&gt;</span><br><span class="line">                &lt;activeByDefault&gt;true&lt;&#x2F;activeByDefault&gt;</span><br><span class="line">            &lt;&#x2F;activation&gt;</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;gpg.executable&gt;gpg2&lt;&#x2F;gpg.executable&gt;</span><br><span class="line">                &lt;gpg.passphrase&gt;GPG-PASSWORD&lt;&#x2F;gpg.passphrase&gt;</span><br><span class="line">            &lt;&#x2F;properties&gt;</span><br><span class="line">        &lt;&#x2F;profile&gt;</span><br><span class="line">    &lt;&#x2F;profiles&gt;</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在待发布的Artifact的<code>pom.xml</code>中添加OSS的Maven repo地址，以及<code>maven-jar-plugin</code>、<code>maven-source-plugin</code>、<code>maven-javadoc-plugin</code>、<code>maven-gpg-plugin</code>、<code>nexus-staging-maven-plugin</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;project ...&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;distributionManagement&gt;</span><br><span class="line">        &lt;snapshotRepository&gt;</span><br><span class="line">            &lt;id&gt;ossrh&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;url&gt;https:&#x2F;&#x2F;oss.sonatype.org&#x2F;content&#x2F;repositories&#x2F;snapshots&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;&#x2F;snapshotRepository&gt;</span><br><span class="line"></span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;ossrh&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;name&gt;Nexus Release Repository&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;url&gt;http:&#x2F;&#x2F;oss.sonatype.org&#x2F;service&#x2F;local&#x2F;staging&#x2F;deploy&#x2F;maven2&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;&#x2F;repository&gt;</span><br><span class="line">    &lt;&#x2F;distributionManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-jar-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;jar&lt;&#x2F;goal&gt;</span><br><span class="line">                            &lt;goal&gt;test-jar&lt;&#x2F;goal&gt;</span><br><span class="line">                        &lt;&#x2F;goals&gt;</span><br><span class="line">                    &lt;&#x2F;execution&gt;</span><br><span class="line">                &lt;&#x2F;executions&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-source-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;attach-sources&lt;&#x2F;id&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;jar-no-fork&lt;&#x2F;goal&gt;</span><br><span class="line">                        &lt;&#x2F;goals&gt;</span><br><span class="line">                    &lt;&#x2F;execution&gt;</span><br><span class="line">                &lt;&#x2F;executions&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-javadoc-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;attach-javadocs&lt;&#x2F;id&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;jar&lt;&#x2F;goal&gt;</span><br><span class="line">                        &lt;&#x2F;goals&gt;</span><br><span class="line">                        &lt;configuration&gt;</span><br><span class="line">                            &lt;additionalOption&gt;</span><br><span class="line">                                &lt;additionalOption&gt;-Xdoclint:none&lt;&#x2F;additionalOption&gt;</span><br><span class="line">                            &lt;&#x2F;additionalOption&gt;</span><br><span class="line">                        &lt;&#x2F;configuration&gt;</span><br><span class="line">                    &lt;&#x2F;execution&gt;</span><br><span class="line">                &lt;&#x2F;executions&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-gpg-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;sign-artifacts&lt;&#x2F;id&gt;</span><br><span class="line">                        &lt;phase&gt;verify&lt;&#x2F;phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;sign&lt;&#x2F;goal&gt;</span><br><span class="line">                        &lt;&#x2F;goals&gt;</span><br><span class="line">                    &lt;&#x2F;execution&gt;</span><br><span class="line">                &lt;&#x2F;executions&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.sonatype.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;nexus-staging-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;1.6.3&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;extensions&gt;true&lt;&#x2F;extensions&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;serverId&gt;ossrh&lt;&#x2F;serverId&gt;</span><br><span class="line">                    &lt;nexusUrl&gt;https:&#x2F;&#x2F;oss.sonatype.org&#x2F;&lt;&#x2F;nexusUrl&gt;</span><br><span class="line">                    &lt;autoReleaseAfterClose&gt;true&lt;&#x2F;autoReleaseAfterClose&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后执行命令<code>mvn clean package deploy</code>即可发布至<a href="https://central.sonatype.org/">central.sonatype.org</a>。</p><p>此方法前期需要复杂的申请账号和项目的流程，后期需要安装调试GPG，但只要跑通流程，后续发布都只需要一行命令。</p><h3 id="发布到私有仓库"><a href="#发布到私有仓库" class="headerlink" title="发布到私有仓库"></a>发布到私有仓库</h3><p>通过<code>nexus-staging-maven-plugin</code>除了可以发布到<a href="https://central.sonatype.org/">central.sonatype.org</a>外，也可以发布到私有仓库，例如，公司内部自己搭建的Nexus服务器。</p><p>如果没有私有Nexus服务器，还可以发布到<a href="https://github.com/features/packages">GitHub Packages</a>。GitHub Packages是GitHub提供的仓库服务，支持Maven、NPM、Docker等。使用GitHub Packages时，无论是发布Artifact，还是引用已发布的Artifact，都需要明确的授权Token，因此，GitHub Packages只能作为私有仓库使用。</p><p>在发布前，我们必须首先登录后在用户的<code>Settings</code>-<code>Developer settings</code>-<code>Personal access tokens</code>中创建两个Token，一个用于发布，一个用于使用。发布Artifact的Token必须有<code>repo</code>、<code>write:packages</code>和<code>read:packages</code>权限：</p><p><a href="https://www.liaoxuefeng.com/files/attachments/1347999282233410/l">https://www.liaoxuefeng.com/files/attachments/1347999282233410/l</a></p><p>使用Artifact的Token只需要<code>read:packages</code>权限。</p><p>在发布端，把GitHub的用户名和发布Token写入<code>~/.m2/settings.xml</code>配置中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings ...&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;servers&gt;</span><br><span class="line">        &lt;server&gt;</span><br><span class="line">            &lt;id&gt;github-release&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;username&gt;GITHUB-USERNAME&lt;&#x2F;username&gt;</span><br><span class="line">            &lt;password&gt;f052...c21f&lt;&#x2F;password&gt;</span><br><span class="line">        &lt;&#x2F;server&gt;</span><br><span class="line">    &lt;&#x2F;servers&gt;</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后，在需要发布的Artifact的<code>pom.xml</code>中，添加一个<code>&lt;repository&gt;</code>声明：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project ...&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;distributionManagement&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;github-release&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;name&gt;GitHub Release&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;url&gt;https:&#x2F;&#x2F;maven.pkg.github.com&#x2F;michaelliao&#x2F;complex&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;&#x2F;repository&gt;</span><br><span class="line">    &lt;&#x2F;distributionManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意到<code>&lt;id&gt;</code>和<code>~/.m2/settings.xml</code>配置中的<code>&lt;id&gt;</code>要保持一致，因为发布时Maven根据id找到用于登录的用户名和Token，才能成功上传文件到GitHub。我们直接通过命令<code>mvn clean package deploy</code>部署，成功后，在GitHub用户页面可以看到该Artifact：</p><p><a href="https://www.liaoxuefeng.com/files/attachments/1348000710393922/l">https://www.liaoxuefeng.com/files/attachments/1348000710393922/l</a></p><p>完整的配置请参考<a href="https://github.com/michaelliao/complex/">complex</a>项目，这是一个非常简单的支持复数运算的库。</p><p>使用该Artifact时，因为GitHub的Package只能作为私有仓库使用，所以除了在使用方的<code>pom.xml</code>中声明<code>&lt;repository&gt;</code>外：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;project ...&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;repositories&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;github-release&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;name&gt;GitHub Release&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;url&gt;https:&#x2F;&#x2F;maven.pkg.github.com&#x2F;michaelliao&#x2F;complex&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;&#x2F;repository&gt;</span><br><span class="line">    &lt;&#x2F;repositories&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.itranswarp&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;complex&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>还需要把有读权限的Token配置到<code>~/.m2/settings.xml</code>文件中。</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Learn-TypeScript</title>
      <link href="/2018/09/15/learn-typescript/"/>
      <url>/2018/09/15/learn-typescript/</url>
      
        <content type="html"><![CDATA[<p><img src="Untitled.png" alt="Untitled.png"></p><h1 id="10分钟搞定TypeScript-语法"><a href="#10分钟搞定TypeScript-语法" class="headerlink" title="10分钟搞定TypeScript 语法"></a><strong>10分钟搞定TypeScript 语法</strong></h1><h3 id="一、多行字符串"><a href="#一、多行字符串" class="headerlink" title="一、多行字符串"></a><strong>一、多行字符串</strong></h3><blockquote><p>注意是Esc下面的符号</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var context &#x3D; &#96;aaa</span><br><span class="line">asdf</span><br><span class="line">dsaf&#96;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; $&#123;param&#125; 输出param变量 </span><br><span class="line">console.log(&#96;hell $&#123;context&#125;&#96;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="二、字符串模板"><a href="#二、字符串模板" class="headerlink" title="二、字符串模板"></a><strong>二、字符串模板</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">console.log(&#96;&lt;div&gt;</span><br><span class="line">                &lt;span&gt;$&#123;context&#125;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;div&#x2F;&gt;&#96;</span><br><span class="line">            )</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="三、自动拆分字符串"><a href="#三、自动拆分字符串" class="headerlink" title="三、自动拆分字符串"></a><strong>三、自动拆分字符串</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function test(template:any, name:string, age:Number)&#123;</span><br><span class="line">    console.log(template)</span><br><span class="line">    console.log(name)</span><br><span class="line">    console.log(age)</span><br><span class="line">&#125;</span><br><span class="line">var myName &#x3D; &quot;wo&quot;</span><br><span class="line">var getAge&#x3D; function()&#123;</span><br><span class="line">    return 12 </span><br><span class="line">&#125;</span><br><span class="line">test&#96;hello my name is $&#123;myName&#125;, i&#39;m $$&#123;getAge&#125;&#96;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="四、指定参数类型"><a href="#四、指定参数类型" class="headerlink" title="四、指定参数类型"></a><strong>四、指定参数类型</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var myName2:string &#x3D; &quot;guoyuhang&quot;</span><br><span class="line">myName2 &#x3D; 2     &#x2F;&#x2F;类型不同报错</span><br><span class="line">var alias &#x3D; &quot;xixi&quot;</span><br><span class="line">alias &#x3D;12       &#x2F;&#x2F;类型推断机制</span><br><span class="line">var tex:any &#x3D; &quot;abc&quot;</span><br><span class="line">tex &#x3D; 12</span><br><span class="line"></span><br><span class="line">var age2:Number &#x3D; 12</span><br><span class="line">var flag:boolean &#x3D; true</span><br><span class="line">function te(x:Number):Number&#123;</span><br><span class="line">    return 12</span><br><span class="line">&#125;</span><br><span class="line">class Person&#123;</span><br><span class="line">&#125;</span><br><span class="line">var zhangsan:Person &#x3D; new Person()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="五、参数指定默认值，给方法变量指定默认值"><a href="#五、参数指定默认值，给方法变量指定默认值" class="headerlink" title="五、参数指定默认值，给方法变量指定默认值"></a><strong>五、参数指定默认值，给方法变量指定默认值</strong></h3><h3 id="（1）默认值参数要放最后面"><a href="#（1）默认值参数要放最后面" class="headerlink" title="（1）默认值参数要放最后面"></a><strong>（1）默认值参数要放最后面</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function test3(a:string,b:string,c:string&#x3D;&quot;jojo&quot;)&#123;</span><br><span class="line">    console.log(&#96;$&#123;a&#125;$&#123;b&#125;$&#123;c&#125;&#96;)</span><br><span class="line">&#125;</span><br><span class="line">test3(&quot;xxx&quot;,&quot;yyy&quot;,&quot;zzz&quot;)</span><br><span class="line">test3(&quot;xxx&quot;,&quot;yyy&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="六、可选参数"><a href="#六、可选参数" class="headerlink" title="六、可选参数"></a><strong>六、可选参数</strong></h3><blockquote><p>要处理可选参数，不然会在方法体里报错</p></blockquote><h3 id="（1）可选参数必须放在必填参数后边"><a href="#（1）可选参数必须放在必填参数后边" class="headerlink" title="（1）可选参数必须放在必填参数后边"></a><strong>（1）可选参数必须放在必填参数后边</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function test4(a: string,b?: string,c: string&#x3D;&quot;jojo&quot;)&#123;</span><br><span class="line">    console.log(&#96;$&#123;a&#125;$&#123;b&#125;$&#123;c&#125;&#96;)</span><br><span class="line">&#125;</span><br><span class="line">test4(&quot;xxx&quot;,&quot;yyy&quot;,&quot;zzz&quot;)</span><br><span class="line">test4(&quot;xxx&quot;,&quot;yyy&quot;)</span><br><span class="line">test4(&quot;xxx&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="七、函数新特性"><a href="#七、函数新特性" class="headerlink" title="七、函数新特性"></a><strong>七、函数新特性</strong></h3><h3 id="1、Rest-and-Spread："><a href="#1、Rest-and-Spread：" class="headerlink" title="1、Rest and Spread："></a><strong>1、Rest and Spread：</strong></h3><h3 id="1-用来声明任意数量的方法参数"><a href="#1-用来声明任意数量的方法参数" class="headerlink" title="(1) 用来声明任意数量的方法参数"></a><strong>(1) 用来声明任意数量的方法参数</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function argfun(...args:any) &#123;</span><br><span class="line">    args.forEach(</span><br><span class="line">        function (arg:any)&#123;</span><br><span class="line">            console.log(arg)</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line">argfun(1,3,4,5,6)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-用来生命参数数量固定的方法-typescript还不支持，但是JS支持-可运行"><a href="#2-用来生命参数数量固定的方法-typescript还不支持，但是JS支持-可运行" class="headerlink" title="(2) 用来生命参数数量固定的方法,typescript还不支持，但是JS支持,可运行"></a><strong>(2) 用来生命参数数量固定的方法,typescript还不支持，但是JS支持,可运行</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function argfun2(arg1:string,arg2:string) &#123;</span><br><span class="line">    console.log(arg1)</span><br><span class="line">    console.log(arg2)</span><br><span class="line">&#125;</span><br><span class="line">var argArry &#x3D; [1]</span><br><span class="line">var argArry2 &#x3D; [1,2]</span><br><span class="line">argfun2(...argArry)</span><br><span class="line">argfun2(...argArry2)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2、generator函数，控制函数执行过程，Ts不支持-Es支持"><a href="#2、generator函数，控制函数执行过程，Ts不支持-Es支持" class="headerlink" title="2、generator函数，控制函数执行过程，Ts不支持, Es支持"></a><strong>2、generator函数，控制函数执行过程，Ts不支持, Es支持</strong></h3><h3 id="1-简单"><a href="#1-简单" class="headerlink" title="(1) 简单"></a><strong>(1) 简单</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function* doSomething()&#123;</span><br><span class="line">    console.log();</span><br><span class="line">    </span><br><span class="line">    yield;          &#x2F;&#x2F; 控制</span><br><span class="line"></span><br><span class="line">    console.log();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;方法必须赋值给对象</span><br><span class="line">var func1 &#x3D; doSomething();</span><br><span class="line">func1.next();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-复杂"><a href="#2-复杂" class="headerlink" title="(2) 复杂"></a><strong>(2) 复杂</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function* getStockPrice(stock)&#123;</span><br><span class="line">    while(true)&#123;</span><br><span class="line">        yield Math.random()*100;    &#x2F;&#x2F; 控制</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var priceGenerator &#x3D; getStockPrice(&quot;IBM&quot;);</span><br><span class="line">var limit &#x3D; 15;</span><br><span class="line">var price &#x3D; 100;</span><br><span class="line">while(price &gt; limit)&#123;</span><br><span class="line">    price &#x3D; priceGenerator.next().value;</span><br><span class="line">    console.log(&#96;the generate return$&#123;price&#125;&#96;)</span><br><span class="line">&#125;</span><br><span class="line">console.log(&#96;buying stock at $&#123;price&#125;&#96;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3、析构表达式"><a href="#3、析构表达式" class="headerlink" title="3、析构表达式"></a><strong>3、析构表达式</strong></h3><blockquote><p>表达式将对象或数组拆解成任意数量的变量</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">function getStock()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">        code: &quot;IBM&quot;,</span><br><span class="line">        price: &#123;</span><br><span class="line">            price1: 100,</span><br><span class="line">            price2: 200</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ES5:分别赋值到本地2个变量上去</span><br><span class="line">var stock &#x3D; getStock()</span><br><span class="line">var code &#x3D; stock.code</span><br><span class="line">var price &#x3D; stock.price</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ES6:把code属性放到codex变量里</span><br><span class="line">var &#123;code:codex,price: &#123;price1&#125;&#125; &#x3D; getStock()</span><br><span class="line">var array1 &#x3D; [1,2,3,4]</span><br><span class="line">var [,,n1,n2] &#x3D; array1</span><br><span class="line">var [n1,n2,...args] &#x3D; array1</span><br><span class="line">function doSome([nu1, nu2, ...others])&#123;</span><br><span class="line">    console.log(nu1),</span><br><span class="line">    console.log(nu2),</span><br><span class="line">    console.log(others)</span><br><span class="line">&#125;</span><br><span class="line">doSome(array1)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4、箭头表达式-解决this作用域范围预判的错误问题"><a href="#4、箭头表达式-解决this作用域范围预判的错误问题" class="headerlink" title="4、箭头表达式 : 解决this作用域范围预判的错误问题"></a><strong>4、箭头表达式 : 解决this作用域范围预判的错误问题</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var sum &#x3D; (args1:any,args2:Number) &#x3D;&gt; args1+args2</span><br><span class="line">var myArray &#x3D; [1,2,3,45,6]</span><br><span class="line">console.log(myArray.filter(value &#x3D;&gt; value%2 &#x3D;&#x3D; 0 ))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5、for-of-循环"><a href="#5、for-of-循环" class="headerlink" title="5、for of 循环"></a><strong>5、for of 循环</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var myArray &#x3D; [1,2,3,4]</span><br><span class="line">myArray.desc &#x3D; &quot;forc&quot;;&#x2F;&#x2F;ts里不能给array指定属性，js可以</span><br><span class="line">myArray.forEach(value &#x3D;&gt; console.log(value))&#x2F;&#x2F;不支持break，忽略掉属性值</span><br><span class="line"></span><br><span class="line">for(var n in myArray)&#123; &#x2F;&#x2F;for in 数组下标和属性名字，任何属性都是键值对</span><br><span class="line">    console.log(n) &#x2F;&#x2F;key</span><br><span class="line">    console.log(myArray[n]) &#x2F;&#x2F;value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for(var nn of myArray )&#123; &#x2F;&#x2F;只循环数组,忽略属性，可以break,循环字符串会循环字符</span><br><span class="line">    if(nn &gt; 2) break</span><br><span class="line">    console.log(nn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="6、类定义"><a href="#6、类定义" class="headerlink" title="6、类定义"></a><strong>6、类定义</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">class Person2&#123;</span><br><span class="line">    name:any;</span><br><span class="line"></span><br><span class="line">    eat()&#123;</span><br><span class="line">        console.log(&quot;i&#39;m eating&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private s()&#123;</span><br><span class="line">        &#x2F;&#x2F;只能内部访问</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected a:any;&#x2F;&#x2F;内部和子类可以访问</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;构造函数：实例化调用1次</span><br><span class="line">    &#x2F;&#x2F;public name2 是声明了1个属性，用this调用,否则不行</span><br><span class="line">    constructor(public name2:string)&#123;</span><br><span class="line">        &#x2F;&#x2F;内部访问</span><br><span class="line">        &#x2F;&#x2F;new 时调用1次</span><br><span class="line">        &#x2F;&#x2F;初始化</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var p1 &#x3D; new Person2(&quot;a&quot;)</span><br><span class="line">p1.name &#x3D; &quot;superman&quot;</span><br><span class="line">p1.eat()</span><br><span class="line"></span><br><span class="line">var p2 &#x3D; new Person2(&quot;b&quot;)</span><br><span class="line">p2.name &#x3D; &quot;superman2&quot;</span><br><span class="line">p2.eat()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7、类继承-extends-继承关系，”的”的关系"><a href="#7、类继承-extends-继承关系，”的”的关系" class="headerlink" title="7、类继承 extends : 继承关系，”的”的关系"></a><strong>7、类继承 extends : 继承关系，”的”的关系</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class Employee extends Person2&#123;</span><br><span class="line">    &#x2F;&#x2F;子类构造函数必须调用父类构造函数</span><br><span class="line">    constructor(name:string,code:string)&#123;</span><br><span class="line">        super(name)</span><br><span class="line">        this.code &#x3D; code</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;指定新的属性和方法</span><br><span class="line">    code: string &#x3D; &quot;&quot;;</span><br><span class="line">    work()&#123;</span><br><span class="line">        &#x2F;&#x2F;super可以调父类其他方法</span><br><span class="line">        super.eat();</span><br><span class="line">        console.log(&quot;do work&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    doWork()&#123;</span><br><span class="line">        console.log(&quot;do work&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var e1 &#x3D; new Employee(&quot;b&quot;,&quot;&quot;)</span><br><span class="line">e1.eat()</span><br><span class="line">e1.work()</span><br><span class="line">e1.doWork()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="8、泛型"><a href="#8、泛型" class="headerlink" title="8、泛型"></a><strong>8、泛型</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var work:Array&lt;Person2&gt; &#x3D; []</span><br><span class="line">work[0] &#x3D; new Person2(&quot;&quot;)</span><br><span class="line">work[1] &#x3D; new Employee(&quot;&quot;,&quot;&quot;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;接口建立代码约定,interface生命，implements</span><br><span class="line">interface IPerson&#123;</span><br><span class="line">    name:string;</span><br><span class="line">    age:number;</span><br><span class="line">    eat():any;</span><br><span class="line">&#125;</span><br><span class="line">class Person3 implements IPerson&#123;</span><br><span class="line">    &#x2F;&#x2F;方法参数类型声明</span><br><span class="line">    constructor(public config:IPerson) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    name &#x3D; &quot;&quot;;</span><br><span class="line">    age &#x3D;12;</span><br><span class="line">    eat()&#123;</span><br><span class="line">        console.log()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="9、模块-决定哪些资源让外部使用"><a href="#9、模块-决定哪些资源让外部使用" class="headerlink" title="9、模块-决定哪些资源让外部使用"></a><strong>9、模块-决定哪些资源让外部使用</strong></h3><blockquote><p>创建b.ts文件在同一目录下 “export”关键字表示导出模块中元素</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; b.ts  </span><br><span class="line">export var pro:any;</span><br><span class="line">var pro2:any;</span><br><span class="line">export function a()&#123;</span><br><span class="line">&#125;</span><br><span class="line">function b()&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 导入b模块</span><br><span class="line">import &#123;a, pro&#125; from &#39;.&#x2F;b&#39;;</span><br><span class="line">console.log(pro)</span><br><span class="line">a()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="10、注解"><a href="#10、注解" class="headerlink" title="10、注解"></a><strong>10、注解</strong></h3><blockquote><p>给程序元素加上更直观的说明，与逻辑无关，而是供给指定工具或框架使用 告诉框架，如何处理一下属性或或方法</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 如</span><br><span class="line">@action.object(&#123; type: &#39;param&#39; &#125;)</span><br><span class="line">export class ActionInput &#123;</span><br><span class="line">    @action.param(&#123; type: &#39;String&#39;, required: true &#125;)</span><br><span class="line">    name: string</span><br><span class="line"></span><br><span class="line">    @action.param(&#123; type: &#39;String&#39;, required: true &#125;)</span><br><span class="line">    description: string</span><br><span class="line"></span><br><span class="line">    @action.param(&#123; type: &#39;String&#39;, required: true &#125;)</span><br><span class="line">    type: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="11、类型定义文件-d-ts"><a href="#11、类型定义文件-d-ts" class="headerlink" title="*11、类型定义文件(.d.ts)**"></a>*<em>11、类型定义文件(</em>.d.ts)**</h3><blockquote><p>使用已有的javascript工具包</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chrome Extensions</title>
      <link href="/2017/09/15/ChromeExtensions/"/>
      <url>/2017/09/15/ChromeExtensions/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概览"><a href="#1-概览" class="headerlink" title="1. 概览:"></a>1. 概览:</h1><p><img src="Untitled.png" alt="Untitled.png"></p><h1 id="2-入门"><a href="#2-入门" class="headerlink" title="2. 入门"></a>2. <strong>入门</strong></h1><p>首先我们看看的浏览器插件的定义:</p><p>浏览器插件是基于Web技术（例如HTML，JavaScript和CSS）构建的可以定制浏览体验的小型软件程序。它们使用户可以根据个人需要或偏好来定制Chrome功能和行为。</p><p>要想开发一款浏览器插件,我们只需要有一个manifest.json文件即可, 为了快速上手浏览器插件开发,我们需要把浏览器开发者工具打开, 具体步骤如下:</p><ol><li><strong>在谷歌浏览器中输入chrome://extensions/</strong></li><li><strong>将开发者模式启动</strong></li></ol><p><img src="https://pic3.zhimg.com/80/v2-a557be3300d7012d25f89d00038b7e22_720w.jpg" alt="https://pic3.zhimg.com/80/v2-a557be3300d7012d25f89d00038b7e22_720w.jpg"></p><h2 id="2-1-导入自己的浏览器插件包"><a href="#2-1-导入自己的浏览器插件包" class="headerlink" title="2.1 导入自己的浏览器插件包"></a>2.1 <strong>导入自己的浏览器插件包</strong></h2><p>通过以上三个步骤我们就可以开启浏览器插件开发之旅了.浏览器插件一般放在浏览器地址栏右侧,我们可以在manifest.json文件配置插件的icon,并配置一定的规则,就能看到我们的浏览器插件图标了,如下图:</p><p><img src="https://pic4.zhimg.com/80/v2-023f0963017950f69fee85bfaf35bd3b_720w.jpg" alt="https://pic4.zhimg.com/80/v2-023f0963017950f69fee85bfaf35bd3b_720w.jpg"></p><p>下面我们来具体讲解一下浏览器插件开发的核心概念.</p><h2 id="2-2-核心知识点"><a href="#2-2-核心知识点" class="headerlink" title="2.2 核心知识点"></a>2.2 <strong>核心知识点</strong></h2><p>浏览器插件一般涉及以下几个核心文件:</p><ul><li><strong>manifest.json</strong> 用来配置所有和插件相关的配置(必须放在根目录)</li><li><strong>background.js</strong> 后台脚本(后台页面),生命周期和浏览器一致,一般放置全局代码</li><li><strong>content-scripts</strong> 插件向页面注入脚本的一种形式,我们可以通过content-scripts向页面注入js和css资源,并可控制允许注入的范围</li><li><strong>popup</strong> 点击插件图标后打开的自定义窗口, 用来处理用户交互</li></ul><p>笔者画了一张简图来大致表示一下它们之间的关系:</p><p><img src="https://pic4.zhimg.com/80/v2-bcebb2fc6d562fefac9de971f6e0ee9f_720w.jpg" alt="https://pic4.zhimg.com/80/v2-bcebb2fc6d562fefac9de971f6e0ee9f_720w.jpg"></p><p>接下来我们来具体了解一下一上几个核心知识点.</p><h3 id="2-2-1-manifest-json"><a href="#2-2-1-manifest-json" class="headerlink" title="2**.2.1 manifest.json**"></a>2**.2.1 manifest.json**</h3><p>谷歌官网简单的配置,如下:</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;My Extension&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;2.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Gets information from Google.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;icons&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;128&quot;</span>: <span class="string">&quot;icon_16.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;128&quot;</span>: <span class="string">&quot;icon_32.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;128&quot;</span>: <span class="string">&quot;icon_48.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;128&quot;</span>: <span class="string">&quot;icon_128.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;background&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;persistent&quot;</span>: false,</span><br><span class="line">      <span class="string">&quot;scripts&quot;</span>: [<span class="string">&quot;background_script.js&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;https://*.google.com/&quot;</span>, <span class="string">&quot;activeTab&quot;</span>],</span><br><span class="line">    <span class="string">&quot;browser_action&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;default_icon&quot;</span>: <span class="string">&quot;icon_16.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>各字段含义介绍如下:</p><ul><li><strong>name</strong> 浏览器插件名称, 将会在插件列表中显示</li><li><strong>description</strong> 浏览器插件简介, 方便告诉开发者插件的功能和作用, 将会在插件列表中显示</li><li><strong>version</strong> 浏览器插件版本</li><li><strong>icon</strong> 浏览器插件图标</li></ul><p><img src="Untitled%201.png" alt="Untitled%201.png"></p><ul><li><strong>background</strong> 背景页的脚本路径,一般为插件目录的相对地址</li><li><strong>permissions</strong> 允许使用的浏览器API的权限,比如contextMenus(右键菜单), tabs(操作标签), webRequest(使用web请求), storage(允许使用本地存储), “**http://**”(可以通过executeScript或者insertCSS访问的网站)</li><li><strong>browser_action</strong> 浏览器右上角图标设置(包括popup页面, 鼠标悬停时的标题, icon等)</li><li><strong>content_scripts</strong> 需要直接注入页面的javascript脚本</li><li><strong>web_accessible_resources</strong> 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</li><li><strong>chrome_url_overrides</strong> 覆盖浏览器默认页面(经常用来做浏览器的自定义桌面)</li><li><strong>omnibox</strong> 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字(多用于自定义搜索拦截)</li><li><strong>default_locale</strong> 默认语言(比如”zh_CN”)</li></ul><h3 id="2-2-2-background-js"><a href="#2-2-2-background-js" class="headerlink" title="2**.2.2 background.js**"></a>2**.2.2 background.js**</h3><p>background页面主要用来提供一些全局配置, 事件监听, 业务转发等.举几个常用案例:</p><p><strong>1.定义右键菜单</strong></p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// background.js</span><br><span class="line">const systems = &#123;</span><br><span class="line">  a: <span class="string">&#x27;趣谈前端&#x27;</span>,</span><br><span class="line">  b: <span class="string">&#x27;掘金&#x27;</span>,</span><br><span class="line">  c: <span class="string">&#x27;微信&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chrome.runtime.onInstalled.addListener(function() &#123;</span><br><span class="line">  // 上下文菜单</span><br><span class="line">  for (let key of Object.keys(systems)) &#123;</span><br><span class="line">    chrome.contextMenus.create(&#123;</span><br><span class="line">      id: key,</span><br><span class="line">      title: systems[key],</span><br><span class="line">      type: <span class="string">&#x27;normal&#x27;</span>,</span><br><span class="line">      contexts: [<span class="string">&#x27;selection&#x27;</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// manifest.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;contextMenus&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如下:</p><p><img src="Untitled%202.png" alt="Untitled%202.png"></p><p><strong>2.设置只有.com后缀的页面才会激活插件</strong></p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onInstalled.addListener(function() &#123;</span><br><span class="line">  // 类似于什么时候激活浏览器插件图标这种感觉</span><br><span class="line">  chrome.declarativeContent.onPageChanged.removeRules(undefined, function() &#123;</span><br><span class="line">    chrome.declarativeContent.onPageChanged.addRules([&#123;</span><br><span class="line">      conditions: [new chrome.declarativeContent.PageStateMatcher(&#123;</span><br><span class="line">        pageUrl: &#123;hostSuffix: <span class="string">&#x27;.com&#x27;</span>&#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">      ],</span><br><span class="line">      actions: [new chrome.declarativeContent.ShowPageAction()]</span><br><span class="line">    &#125;]);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>如下图所示,当页面地址的后缀不等于.com时,插件icon将不被激活:</p><p><img src="https://pic3.zhimg.com/80/v2-e71bb0259baff0138a3ed613d3636342_720w.jpg" alt="https://pic3.zhimg.com/80/v2-e71bb0259baff0138a3ed613d3636342_720w.jpg"></p><p><strong>3.和content_script或者popup页面进行消息通信</strong></p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(</span><br><span class="line">function(request, sender, sendResponse) &#123;</span><br><span class="line">  console.log(sender.tab ?</span><br><span class="line">              <span class="string">&quot;from a content script:&quot;</span> + sender.tab.url :</span><br><span class="line">              <span class="string">&quot;from the extension&quot;</span>);</span><br><span class="line">  if (request.greeting == <span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    sendResponse(&#123;farewell: <span class="string">&quot;goodbye&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="2-2-3-content-scripts"><a href="#2-2-3-content-scripts" class="headerlink" title="2.2.3 content-scripts"></a>2.<strong>2.3 content-scripts</strong></h3><p>内容脚本一般植入会被植入到页面中, 并且可以控制页面中的dom. 我们可以利用它实现屏蔽网页广告, 定制页面皮肤等操作. 在manifest.json中的基本配置如下:</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;content_scripts&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;matches&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;http://*/*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://*/*&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;js&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;lib/jquery3.4.min.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content_script.js&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;css&quot;</span>: [<span class="string">&quot;base.css&quot;</span>]</span><br><span class="line">  &#125;],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码中我们定义了content_scripts允许注入的页面范围, 插入页面的js以及css, 这样我们就能轻松改变某一个页面的样式.比如我们可以在页面中注入一个按钮:</p><p><img src="Untitled%203.png" alt="Untitled%203.png"></p><p>后面的浏览器插件案例中会详细介绍content_scripts的用法.</p><h3 id="2-2-4-popup"><a href="#2-2-4-popup" class="headerlink" title="2.2.4 popup"></a><strong>2.2.4 popup</strong></h3><p>popup是用户点击插件图标时打开的一个小窗口，当失去焦点后窗口就立即关闭，我们一般用它来处理一些简单的用户交互和插件说明。</p><p>由于popup窗口也是一个网页,所以我们一般会建立一个popup.html和popup.js用来控制popup的页面展示和交互.我们在manifest.json中配置如下:</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;page_action&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;default_title&quot;</span>: <span class="string">&quot;小夕图片提取插件&quot;</span>,</span><br><span class="line">        <span class="string">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里要注意一点的是,我们在popup.html中不能直接使用script脚本,需要用引入脚本文件的方式.如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>在线图片提取工具<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pop-wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;lib/jquery3.4.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;popup.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>以下是笔者写的一个插件的popup页面:</p><p><img src="Untitled%204.png" alt="Untitled%204.png"></p><h2 id="2-3-通信机制"><a href="#2-3-通信机制" class="headerlink" title="2.3.通信机制"></a>2.3.通信机制</h2><p>对于一个相对复杂的浏览器插件来说,我们不仅仅只操作dom或者提供基本的功能就行了,我们还需要向第三方或者自己的服务器抓取有用的页面数据,这个时候就需要用到插件的通信机制了.</p><p>因为content_script脚本存在于当前页面,受同源策略影响,导致我们无法将捕获到的数据传给第三方平台或者自己的服务器, 所以我们需要基于浏览器的通信API.一下是谷歌浏览器插件的通信流程:</p><p><img src="https://pic2.zhimg.com/80/v2-5a05979498bf90fe0443290623e1c8cd_720w.jpg" alt="https://pic2.zhimg.com/80/v2-5a05979498bf90fe0443290623e1c8cd_720w.jpg"></p><h3 id="2-3-1-popup和background相互通信"><a href="#2-3-1-popup和background相互通信" class="headerlink" title="2.3.1 popup和background相互通信"></a>2.<strong>3.1 popup和background相互通信</strong></h3><p>由官方文档可知popup可以直接访问background页的方法,所以popup可以直接与其通信:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// background.js</span><br><span class="line">var getData = (data) =&gt; &#123; console.log(&#x27;拿到数据:&#x27; + data) &#125;</span><br><span class="line">// popup.js</span><br><span class="line">let bgObj = chrome.extension.getBackgroundPage();</span><br><span class="line">bgObj.getData(); // 访问bg的函数</span><br></pre></td></tr></table></figure><h3 id="2-3-2-popup或者background页和content-script通信"><a href="#2-3-2-popup或者background页和content-script通信" class="headerlink" title="2.3.2 popup或者background页和content_script通信"></a>2.<strong>3.2 popup或者background页和content_script通信</strong></h3><p>这里我们使用chrome的tabs API,如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// popup.js</span><br><span class="line">// 发送消息给content_script</span><br><span class="line">chrome.tabs.query(&#123;active: true, currentWindow: true&#125;, function(tabs) &#123;</span><br><span class="line">    chrome.tabs.sendMessage(tabs[0].id, &quot;activeBtn&quot;, function(response) &#123;</span><br><span class="line">      console.log(response);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">// 接收消息</span><br><span class="line">chrome.runtime.onMessage.addListener(</span><br><span class="line">  function(request, sender, sendResponse) &#123;</span><br><span class="line">    console.log(sender.tab ?</span><br><span class="line">                &quot;from a content script:&quot; + sender.tab.url :</span><br><span class="line">                &quot;from the extension&quot;);</span><br><span class="line">    if (request.greeting == &quot;hello&quot;)</span><br><span class="line">      sendResponse(&#123;farewell: &quot;goodbye&quot;&#125;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>content_script接收和发送消息:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 接收消息</span><br><span class="line">chrome.runtime.onMessage.addListener(</span><br><span class="line">  function(message, sender, sendResponse) &#123;</span><br><span class="line">    if (message == &quot;activeBtn&quot;)&#123;</span><br><span class="line">      // ...</span><br><span class="line">      sendResponse(&#123;farewell: &quot;激活成功&quot;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;);</span><br><span class="line"> </span><br><span class="line"> // 主动发送消息</span><br><span class="line"> chrome.runtime.sendMessage(&#123;greeting: &quot;hello&quot;&#125;, function(response) &#123;</span><br><span class="line">   console.log(response, document.body);</span><br><span class="line">   // document.body.style.backgroundColor=&quot;orange&quot;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>有关消息的长连接,在谷歌官网也写的很清楚:</p><p><img src="https://pic2.zhimg.com/80/v2-8064fff68ca7ab8e0d40631b6b7155fd_720w.jpg" alt="https://pic2.zhimg.com/80/v2-8064fff68ca7ab8e0d40631b6b7155fd_720w.jpg"></p><p>我们可以采用如下方式进行长连接:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// content_script.js</span><br><span class="line">var port = chrome.runtime.connect(&#123;name: &quot;徐小夕&quot;&#125;);</span><br><span class="line">port.postMessage(&#123;Ling: &quot;你好&quot;&#125;);</span><br><span class="line">port.onMessage.addListener(function(msg) &#123;</span><br><span class="line">  if (msg.question == &quot;你是做什么滴?&quot;)</span><br><span class="line">    port.postMessage(&#123;answer: &quot;搬砖&quot;&#125;);</span><br><span class="line">  else if (msg.question == &quot;搬砖有钱吗?&quot;)</span><br><span class="line">    port.postMessage(&#123;answer: &quot;木有&quot;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// popup.js</span><br><span class="line">chrome.runtime.onConnect.addListener(function(port) &#123;</span><br><span class="line">  port.onMessage.addListener(function(msg) &#123;</span><br><span class="line">    if (msg.Ling == &quot;你好&quot;)</span><br><span class="line">      port.postMessage(&#123;question: &quot;你是做什么滴?&quot;&#125;);</span><br><span class="line">    else if (msg.answer == &quot;搬砖&quot;)</span><br><span class="line">      port.postMessage(&#123;question: &quot;搬砖有钱吗?&quot;&#125;);</span><br><span class="line">    else if (msg.answer == &quot;木有&quot;)</span><br><span class="line">      port.postMessage(&#123;question: &quot;太难了.&quot;&#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="4-数据存储"><a href="#4-数据存储" class="headerlink" title="4.数据存储"></a><strong>4.数据存储</strong></h2><p>chrome.storage用来针对插件全局进行数据存储,我们在任何一个页面(popup或content_script或background)下存储了数据,我们在以上三个页面都可以获取到, 具体用法如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">获取数据</span><br><span class="line">chrome.storage.sync.get(&#x27;imgArr&#x27;, function(data) &#123;</span><br><span class="line">  console.log(data)</span><br><span class="line">&#125;);</span><br><span class="line">// 保存数据</span><br><span class="line">chrome.storage.sync.set(&#123;&#x27;imgArr&#x27;: imgArr&#125;, function() &#123;</span><br><span class="line">    console.log(&#x27;保存成功&#x27;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">// 另一种方式</span><br><span class="line">chrome.storage.local.set(&#123;key: value&#125;, function() &#123;</span><br><span class="line">  console.log(&#x27;Value is set to &#x27; + value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="5-应用场景"><a href="#5-应用场景" class="headerlink" title="5.应用场景"></a><strong>5.应用场景</strong></h2><p>谷歌浏览器的插件应用场景很多,正如文章开头的思维导图中写的.以下是笔者总结的一些应用场景，大家感兴趣可以尝试去实现：</p><ul><li>谷歌浏览器自定义桌面</li><li>网页性能分析工具</li><li>网页爬虫</li><li>埋点工具</li><li>网页热力图生成工具</li><li>安全拦截插件</li><li>广告过滤插件</li><li>网站动态换肤</li><li>第三方数据导入</li><li>代码格式化工具</li><li>在线协作工具</li><li>防作弊插件</li></ul><p>还有很多实用工具可以开发，大家可以好好把玩。接下来就来通过实现一个网页图片提取插件，来总结以下浏览器插件开发流程。</p><h2 id="6-开发一款抓取网站图片资源的浏览器插件"><a href="#6-开发一款抓取网站图片资源的浏览器插件" class="headerlink" title="6.开发一款抓取网站图片资源的浏览器插件"></a>6.开发一款抓取网站图片资源的浏览器插件</h2><p>首先还是按照笔者的风格，在开发任何一种工具之前都要明确需求，所以我们来看看该插件的功能点：</p><ul><li>能植入网页按钮，通过点击按钮捕获网页图片</li><li>能在用户端展示捕获的图片</li><li>点击插件能预览捕获的图片</li></ul><p>基本上就这几个功能，接下来我会展示核心代码，在介绍代码之前我们先预览一下插件的实现效果：</p><p><img src="https://pic3.zhimg.com/80/v2-0c79ea16b92fb0619cd70248a8090462_720w.jpg" alt="https://pic3.zhimg.com/80/v2-0c79ea16b92fb0619cd70248a8090462_720w.jpg"></p><p><img src="https://pic2.zhimg.com/80/v2-ecee95b625f566a9595d73d55768c211_720w.jpg" alt="https://pic2.zhimg.com/80/v2-ecee95b625f566a9595d73d55768c211_720w.jpg"></p><p>插件目录结构如下：</p><p><img src="https://pic1.zhimg.com/80/v2-79f003a0e9a21ec8566a37a3a4820e50_720w.jpg" alt="https://pic1.zhimg.com/80/v2-79f003a0e9a21ec8566a37a3a4820e50_720w.jpg"></p><p>因为插件的开发比较简单，所以我直接用jquery开发。这里我们主要关注popup.js和content_script.js, popup.js中主要用来获取从content_script页传过来的图片数据，并展示在popup.html中，另外又一个需要注意的是当页面没有注入生成按钮时，popupu需要发送信息给content页面，主动让其生成按钮，代码如下：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">chrome.storage.sync.get(<span class="string">&#x27;imgArr&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  data.imgArr &amp;&amp; data.imgArr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> imgWrap = $(<span class="string">&quot;&lt;div class=&#x27;img-box&#x27;&gt;&lt;/div&gt;&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> img = $(<span class="string">&quot;&lt;img src=&#x27;&quot;</span> + item + <span class="string">&quot;&#x27; alt=&#x27;&quot;</span> + item + <span class="string">&quot;&#x27; /&gt;&quot;</span>)</span><br><span class="line">    imgWrap.append(img);</span><br><span class="line">    $(<span class="string">&#x27;#content&#x27;</span>).append(imgWrap);</span><br><span class="line">    $(<span class="string">&#x27;.empty&#x27;</span>).hide();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;#activeBtn&#x27;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">  chrome.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">tabs</span>) </span>&#123;</span><br><span class="line">    chrome.tabs.sendMessage(tabs[<span class="number">0</span>].id, <span class="string">&quot;activeBtn&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(response);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>对于content页面，我们需要实现的是动态生成按钮，并且在页面中植入弹窗来展示获取到的图片，另一方面需要将图片数据传递给storage，以便popup页面可以获取图片数据。</p><p>由于页面比较简单，笔者就不用过多的第三方库了，笔者先简单手写一个modal组件，代码如下：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 弹窗</span></span><br><span class="line">~<span class="function"><span class="keyword">function</span> <span class="title">Modal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> modal;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">this</span> <span class="keyword">instanceof</span> Modal) &#123;</span><br><span class="line">    <span class="built_in">this</span>.init = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>) </span>&#123;</span><br><span class="line">      modal = $(<span class="string">&quot;&lt;div class=&#x27;modal&#x27;&gt;&lt;/div&gt;&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> title = $(<span class="string">&quot;&lt;div class=&#x27;modal-title&#x27;&gt;&quot;</span> + opt.title + <span class="string">&quot;&lt;/div&gt;&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> close_btn = $(<span class="string">&quot;&lt;span class=&#x27;modal-close-btn&#x27;&gt;X&lt;/span&gt;&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> content = $(<span class="string">&quot;&lt;div class=&#x27;modal-content&#x27;&gt;&lt;/div&gt;&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> mask = $(<span class="string">&quot;&lt;div class=&#x27;modal-mask&#x27;&gt;&lt;/div&gt;&quot;</span>);</span><br><span class="line">      close_btn.click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        modal.hide()</span><br><span class="line">      &#125;)</span><br><span class="line">      title.append(close_btn);</span><br><span class="line">      content.append(title);</span><br><span class="line">      content.append(opt.content);</span><br><span class="line">      modal.append(content);</span><br><span class="line">      modal.append(mask);</span><br><span class="line">      $(<span class="string">&#x27;body&#x27;</span>).append(modal);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.show = <span class="function"><span class="keyword">function</span>(<span class="params">opt</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(modal) &#123;</span><br><span class="line">        modal.show();</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> options = &#123;</span><br><span class="line">          title: opt.title || <span class="string">&#x27;标题&#x27;</span>,</span><br><span class="line">          content: opt.content || <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.init(options)</span><br><span class="line">        modal.show();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.hide = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      modal.hide();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.Modal = <span class="keyword">new</span> Modal()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure><p><strong>第一步，我们先批量获取页面图片数据：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> imgArr = []</span><br><span class="line">$(<span class="string">&#x27;img&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> src = $(<span class="built_in">this</span>).attr(<span class="string">&#x27;src&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> realSrc = <span class="regexp">/^(http|https)/</span>.test(src) ? src : location.protocol+ <span class="string">&#x27;//&#x27;</span> + location.host + src;</span><br><span class="line">  imgArr.push(realSrc)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>因为图片的src路径可能是相对地址，所以笔者在这里用正则简单处理以下，当然我们可以进行更细粒度的控制。</p><p><strong>第二步，将图片数据存储到storage中：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chrome.storage.sync.set(&#123;<span class="string">&#x27;imgArr&#x27;</span>: imgArr&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;保存成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>第三步，生成预览图片的弹窗，这里用笔者上面实现的modal组件</strong>：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Modal.show(&#123;</span><br><span class="line">  title: <span class="string">&#x27;提取结果&#x27;</span>,</span><br><span class="line">  content: imgBox</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>第四步，当popup发送激活按钮的通知时，我们要在网页中动态插入生成按钮：</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">message, sender, sendResponse</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (message == <span class="string">&quot;activeBtn&quot;</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(!$(<span class="string">&#x27;.crawl-btn&#x27;</span>)) &#123;</span><br><span class="line">        $(<span class="string">&#x27;body&#x27;</span>).append(<span class="string">&quot;&lt;div class=&#x27;crawl-btn&#x27;&gt;提取&lt;/div&gt;&quot;</span>)</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        $(<span class="string">&#x27;.crawl-btn&#x27;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;orange&quot;</span>);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          $(<span class="string">&#x27;.crawl-btn&#x27;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;#06c&quot;</span>);</span><br><span class="line">        &#125;, <span class="number">3000</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      sendResponse(&#123;<span class="attr">farewell</span>: <span class="string">&quot;激活成功&quot;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><p>setTimeout那段纯属是为了吸引用户视线，当然我们可以用更优雅的方式来处理。插件核心代码主要是这些，当然还有很多细节要考虑，我把配置文件和一些细节放到github了，如果感兴趣的朋友可以安装感受一下。</p><p>github地址：<a href="https://github.com/MrXujiang/fetchImg">https://github.com/MrXujiang/fetchImg</a></p>]]></content>
      
      
      <categories>
          
          <category> 插件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 浏览器插件 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
